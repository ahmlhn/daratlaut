import{C as Tl,E as ce,G as Ca,o as Sl,D as El,c as n,a as Na,u as Ll,h as $l,m as Ol,b as t,t as u,j as i,e as g,d as _,n as T,f as m,x as V,F as U,s as G,i as Pa,v as w,w as ie,r as f,y as I,z as Il}from"./app-CSktj_Z2.js";import{_ as Fl}from"./AdminLayout-C-4Iczwe.js";const Ml={class:"space-y-4 animate-fade-in"},Ul={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3 bg-white dark:bg-dark-800 p-5 rounded-xl shadow-card border border-gray-100 dark:border-dark-700"},Al={class:"flex flex-wrap items-center gap-2"},jl={class:"px-3 py-2 rounded-lg bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 text-xs"},Gl={class:"font-semibold text-gray-900 dark:text-white"},Dl={class:"px-3 py-2 rounded-lg bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 text-xs"},Rl={class:"font-semibold text-gray-900 dark:text-white"},Vl={class:"px-3 py-2 rounded-lg bg-red-50/60 dark:bg-red-900/10 border border-red-200/60 dark:border-red-900/30 text-xs"},Bl={class:"font-semibold text-red-700 dark:text-red-300"},Kl={key:0,class:"bg-amber-50 dark:bg-amber-900/10 border border-amber-200 dark:border-amber-900/30 text-amber-800 dark:text-amber-200 rounded-xl p-4 text-sm"},Hl={key:1,class:"bg-white dark:bg-dark-800 border border-gray-100 dark:border-dark-700 rounded-xl p-6"},Jl={key:2,class:"relative"},zl={class:"grid grid-cols-1 lg:grid-cols-12 gap-4"},Xl={class:"relative flex-1 min-h-[420px] lg:min-h-0"},Zl={class:"absolute top-3 left-3 z-20 flex flex-wrap items-center gap-2 bg-white/90 dark:bg-dark-900/80 backdrop-blur border border-gray-200 dark:border-white/10 rounded-xl p-2 shadow-lg"},ql={class:"absolute top-16 left-3 z-20 w-64 max-w-[calc(100%-1.5rem)] bg-white/90 dark:bg-dark-900/80 backdrop-blur border border-gray-200 dark:border-white/10 rounded-xl shadow-lg overflow-hidden"},Wl={class:"flex items-center justify-between px-3 py-2 border-b border-gray-200/70 dark:border-white/10"},Yl={key:0,class:"p-3 space-y-2"},Ql={class:"absolute top-3 right-3 z-20 flex items-center gap-2 bg-white/90 dark:bg-dark-900/80 backdrop-blur border border-gray-200 dark:border-white/10 rounded-xl p-2 shadow-lg"},er=["disabled"],tr={class:"flex items-start justify-between gap-2"},ar={class:"min-w-0"},lr={class:"mt-1 text-sm font-semibold text-gray-900 dark:text-white truncate"},rr={class:"text-xs text-gray-500 dark:text-gray-400 truncate"},sr={class:"mt-3 grid grid-cols-1 gap-1.5"},or={class:"text-gray-500 dark:text-gray-400"},nr={class:"text-right font-medium text-gray-800 dark:text-gray-200"},ir={key:0,class:"mt-2 text-xs text-gray-600 dark:text-gray-300 line-clamp-2"},ur={class:"mt-3 flex flex-wrap items-center gap-2"},dr={key:1,class:"absolute inset-0 z-40 flex items-center justify-center p-6 bg-white/85 dark:bg-dark-900/70 backdrop-blur"},vr={class:"max-w-md text-center"},cr={class:"mt-1 text-xs text-gray-600 dark:text-gray-300"},pr={key:2,class:"absolute bottom-3 left-3 right-3 lg:right-auto lg:max-w-md bg-white/90 dark:bg-dark-900/80 backdrop-blur border border-gray-200 dark:border-white/10 rounded-xl p-3 text-xs text-gray-700 dark:text-gray-200 shadow-lg"},br={class:"font-semibold"},gr={class:"uppercase"},fr={key:0,class:"text-gray-600 dark:text-gray-300 mt-1"},mr={key:1,class:"text-gray-600 dark:text-gray-300 mt-1"},kr={class:"font-semibold"},yr={key:0,class:"ml-1 text-blue-700 dark:text-blue-300"},xr={key:2,class:"text-gray-600 dark:text-gray-300 mt-1"},_r={key:3,class:"mt-2 flex items-center gap-2 text-xs text-gray-700 dark:text-gray-200"},hr=["disabled"],wr={class:"mt-2 flex items-center gap-2"},Cr=["disabled"],Nr=["disabled"],Pr=["disabled"],Tr={class:"lg:hidden px-4 pt-2 pb-3 border-b border-gray-100 dark:border-dark-700"},Sr={class:"mt-2 flex items-center gap-2"},Er={value:"cables"},Lr={value:"points"},$r={value:"ports"},Or={value:"links"},Ir={value:"breaks"},Fr={class:"hidden lg:flex items-center gap-1 border-b border-gray-100 dark:border-dark-700 overflow-x-auto"},Mr={class:"p-4 overflow-y-auto flex-1 min-h-0"},Ur={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Ar={key:1,class:"text-sm text-red-600 dark:text-red-300"},jr={key:2,class:"space-y-3"},Gr={class:"flex items-center justify-between"},Dr={class:"flex items-center gap-2"},Rr=["placeholder"],Vr={key:0,class:"text-[11px] text-gray-500 dark:text-gray-400"},Br={class:"font-semibold text-gray-800 dark:text-gray-200"},Kr={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},Hr={key:2,class:"space-y-2 pr-1"},Jr=["onClick"],zr={class:"flex items-start justify-between gap-2"},Xr={class:"text-sm font-semibold text-gray-900 dark:text-white"},Zr={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},qr={key:0},Wr={key:1,class:"ml-2"},Yr={key:2,class:"ml-2"},Qr={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},es={class:"font-medium text-gray-700 dark:text-gray-200"},ts={class:"font-medium text-gray-700 dark:text-gray-200"},as={class:"flex items-center gap-1 shrink-0"},ls=["onClick"],rs=["onClick"],ss={key:3,class:"space-y-3"},os={class:"flex items-center justify-between"},ns={class:"flex items-center gap-2"},is=["placeholder"],us={key:0,class:"text-[11px] text-gray-500 dark:text-gray-400"},ds={class:"font-semibold text-gray-800 dark:text-gray-200"},vs={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},cs={key:2,class:"space-y-2 pr-1"},ps=["onClick"],bs={class:"flex items-start justify-between gap-2"},gs={class:"text-sm font-semibold text-gray-900 dark:text-white"},fs={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},ms={key:0},ks={key:1,class:"ml-2"},ys={class:"flex items-center gap-1 shrink-0"},xs=["onClick"],_s=["onClick"],hs={key:4,class:"space-y-3"},ws={class:"flex items-center justify-between"},Cs={class:"flex items-center gap-2"},Ns=["placeholder"],Ps={key:0,class:"text-[11px] text-gray-500 dark:text-gray-400"},Ts={class:"font-semibold text-gray-800 dark:text-gray-200"},Ss={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},Es={key:2,class:"space-y-2 pr-1"},Ls={class:"flex items-start justify-between gap-2"},$s={class:"text-xs font-bold text-indigo-700 dark:text-indigo-300"},Os={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1"},Is={class:"text-xs text-gray-500 dark:text-gray-400 mt-1 space-y-0.5"},Fs={class:"font-medium text-gray-700 dark:text-gray-200"},Ms={key:0},Us={class:"font-medium text-gray-700 dark:text-gray-200"},As={class:"ml-1"},js={class:"flex items-center gap-1 shrink-0"},Gs=["onClick"],Ds=["onClick"],Rs={key:5,class:"space-y-3"},Vs={class:"flex items-center justify-between"},Bs={class:"flex items-center gap-2"},Ks=["placeholder"],Hs={key:0,class:"text-[11px] text-gray-500 dark:text-gray-400"},Js={class:"font-semibold text-gray-800 dark:text-gray-200"},zs={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},Xs={key:2,class:"space-y-2 pr-1"},Zs={class:"flex items-start justify-between gap-2"},qs={class:"min-w-0"},Ws={class:"text-xs font-bold text-amber-700 dark:text-amber-300"},Ys={key:0,class:"ml-1"},Qs={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},eo={class:"font-medium text-gray-700 dark:text-gray-200"},to={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1 truncate"},ao={key:0,class:"text-gray-700 dark:text-gray-200"},lo={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-2"},ro={key:0},so={key:1,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},oo={class:"font-medium text-gray-700 dark:text-gray-200"},no={class:"flex items-center gap-1 shrink-0"},io=["onClick"],uo=["onClick"],vo={key:6,class:"space-y-3"},co={class:"flex items-center justify-between"},po=["disabled"],bo={class:"space-y-2"},go=["value"],fo={class:"flex items-center gap-2"},mo=["disabled"],ko=["disabled"],yo={key:0,class:"text-xs text-red-600 dark:text-red-300"},xo={key:0,class:"space-y-3"},_o={class:"text-xs text-gray-500 dark:text-gray-400"},ho={class:"font-semibold text-gray-800 dark:text-gray-200"},wo={class:"font-semibold text-gray-800 dark:text-gray-200"},Co={key:0,class:"ml-2 text-amber-700 dark:text-amber-300"},No={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Po={key:1,class:"space-y-2 max-h-[260px] overflow-auto pr-1"},To=["onClick"],So={class:"text-sm font-semibold text-gray-900 dark:text-white"},Eo={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},Lo={class:"font-medium text-gray-700 dark:text-gray-200"},$o={key:2,class:"rounded-xl border border-gray-100 dark:border-dark-700 p-3 bg-gray-50/40 dark:bg-dark-900/30"},Oo={class:"mt-2 space-y-1 max-h-[220px] overflow-auto pr-1"},Io={class:"font-medium text-gray-900 dark:text-white"},Fo={class:"text-gray-600 dark:text-gray-300"},Mo={key:7,class:"space-y-3"},Uo={class:"flex items-center justify-between"},Ao={class:"flex items-center gap-2"},jo=["placeholder"],Go={class:"flex flex-wrap items-center gap-2"},Do={key:0,class:"text-[11px] text-gray-500 dark:text-gray-400"},Ro={class:"font-semibold text-gray-800 dark:text-gray-200"},Vo={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},Bo={key:2,class:"space-y-2 pr-1"},Ko=["onClick"],Ho={class:"flex items-start justify-between gap-2"},Jo={class:"text-xs font-bold"},zo={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1"},Xo={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},Zo={key:0,class:"ml-2"},qo={key:0,class:"text-xs text-gray-600 dark:text-gray-300 mt-1 line-clamp-2"},Wo={class:"flex items-center gap-1 shrink-0"},Yo=["disabled","onClick"],Qo=["onClick"],en=["onClick"],tn={class:"relative pointer-events-auto w-full max-w-2xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},an={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},ln={class:"font-semibold text-gray-900 dark:text-white"},rn={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},sn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},on={key:0,class:"text-xs text-red-600 mt-1"},nn={key:0,class:"text-xs text-red-600 mt-1"},un={key:0,class:"text-xs text-red-600 mt-1"},dn={key:0,class:"text-xs text-red-600 mt-1"},vn={class:"md:col-span-2"},cn={class:"flex flex-col sm:flex-row gap-2"},pn={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},bn={class:"font-medium text-gray-700 dark:text-gray-200"},gn={class:"ml-2"},fn={key:0,class:"ml-2"},mn=["value"],kn=["value"],yn={class:"md:col-span-2"},xn={class:"flex items-center gap-2"},_n={class:"md:col-span-2"},hn={class:"rounded-xl border border-gray-100 dark:border-dark-700 p-3"},wn={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-2"},Cn={class:"text-xs text-gray-500 dark:text-gray-400"},Nn={class:"flex flex-wrap items-center gap-2"},Pn={class:"flex items-center gap-2 text-xs text-gray-700 dark:text-gray-200 px-3 py-2 rounded-xl border border-gray-200/70 dark:border-white/10 bg-white/70 dark:bg-dark-900/40"},Tn=["disabled"],Sn=["disabled"],En=["disabled"],Ln=["disabled"],$n={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},On=["disabled"],In={class:"relative pointer-events-auto w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},Fn={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Mn={class:"font-semibold text-gray-900 dark:text-white"},Un={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},An={key:0,class:"text-xs text-red-600 mt-1"},jn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Gn={key:0,class:"text-xs text-red-600 mt-1"},Dn={key:0,class:"text-xs text-red-600 mt-1"},Rn={class:"flex items-center gap-2"},Vn={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},Bn=["disabled"],Kn={class:"relative pointer-events-auto w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},Hn={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Jn={class:"font-semibold text-gray-900 dark:text-white"},zn={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},Xn=["value"],Zn=["value"],qn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Wn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Yn=["disabled"],Qn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ei={key:0,class:"text-xs text-red-600 mt-1"},ti={key:0,class:"text-xs text-red-600 mt-1"},ai={class:"flex items-center gap-2"},li={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},ri=["disabled"],si={key:3,class:"fixed inset-0 z-[10000] flex items-center justify-center p-4"},oi={class:"relative w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},ni={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},ii={class:"font-semibold text-gray-900 dark:text-white"},ui={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},di=["value"],vi={key:0,class:"text-xs text-red-600 mt-1"},ci={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},pi={key:0,class:"text-xs text-red-600 mt-1"},bi={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},gi=["value"],fi={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},mi=["disabled"],ki={key:4,class:"fixed inset-0 z-[10000] flex items-center justify-center p-4"},yi={class:"relative w-full max-w-2xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},xi={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},_i={class:"font-semibold text-gray-900 dark:text-white"},hi={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},wi=["value"],Ci={key:0,class:"text-xs text-red-600 mt-1"},Ni={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Pi={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ti=["value"],Si={key:0,class:"text-xs text-red-600 mt-1"},Ei={key:0,class:"text-xs text-red-600 mt-1"},Li={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},$i=["value"],Oi={key:1,class:"space-y-3 rounded-xl border border-gray-100 dark:border-dark-700 p-3"},Ii={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Fi={class:"flex items-center gap-2"},Mi={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},Ui={key:1,class:"space-y-2 max-h-[260px] overflow-auto pr-1"},Ai={class:"col-span-7"},ji=["onUpdate:modelValue"],Gi=["value"],Di={class:"col-span-3"},Ri=["onUpdate:modelValue"],Vi={class:"col-span-2 flex items-center justify-end"},Bi=["onClick"],Ki={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},Hi=["disabled"],Zi={__name:"Index",props:{tenantId:{type:Number,default:0},warning:{type:String,default:null},googleMapsApiKey:{type:String,default:""}},setup(Ta){const b=Tl("toast"),Ct=Ta,Jt=Il(),zt=I(()=>{var a,e;return((e=(a=Jt.props.auth)==null?void 0:a.user)==null?void 0:e.permissions)||[]}),Sa=I(()=>{var a,e;return(((e=(a=Jt.props.auth)==null?void 0:a.user)==null?void 0:e.role)||"").toString().toLowerCase().trim()});function Ea(a){const e=(a||"").toString().toLowerCase().trim();return e==="svp lapangan"?"svp_lapangan":e}function ut(a){const e=Ea(Sa.value);return["admin","owner"].includes(e)||zt.value.includes("manage fiber")?!0:zt.value.includes(a)}const Xt=I(()=>ut("view fiber")),Q=I(()=>ut("create fiber")),Z=I(()=>ut("edit fiber")),ue=I(()=>ut("delete fiber")),ze=f(!1),dt=f(""),pe=f({cables:0,points:0,breaks_total:0,breaks_open:0}),B=f([]),H=f([]),de=f([]),be=f([]),Xe=f([]),S=f("cables"),Ge=f(!0),De=f(!0),Re=f(!0),ge=f(null),Y=f(null),fe=f(null),Ve=f(!1),le=f(!1),E=f(""),ee=f("ALL"),me=f(null),vt=f([]),Zt=I(()=>{const a=new Set;return(vt.value||[]).forEach(e=>{const r=Number(e);Number.isFinite(r)&&r>0&&a.add(r)}),a});async function q(a,e={}){const r=await fetch(a,{credentials:"same-origin",headers:{Accept:"application/json",...e.headers||{}},...e}),s=await r.text();let o=null;try{o=s?JSON.parse(s):null}catch{o=null}return{ok:r.ok,status:r.status,data:o,text:s}}async function K(){var a,e,r,s,o,v,p,d,y,P,F,j;if(Xt.value){ze.value=!0,dt.value="";try{const[M,he]=await Promise.all([q("/api/v1/fiber/map-data"),q("/api/v1/fiber/summary")]);if(!M.ok){const R=((a=M.data)==null?void 0:a.message)||`Gagal memuat data fiber (HTTP ${M.status}).`;throw new Error(R)}he.ok?pe.value=((e=he.data)==null?void 0:e.data)||pe.value:pe.value={cables:0,points:0,breaks_total:0,breaks_open:0},B.value=((s=(r=M.data)==null?void 0:r.data)==null?void 0:s.cables)||[],H.value=((v=(o=M.data)==null?void 0:o.data)==null?void 0:v.points)||[],de.value=((d=(p=M.data)==null?void 0:p.data)==null?void 0:d.breaks)||[],be.value=((P=(y=M.data)==null?void 0:y.data)==null?void 0:P.ports)||[],Xe.value=((j=(F=M.data)==null?void 0:F.data)==null?void 0:j.links)||[],ta(),aa()}catch(M){console.error("Fiber: loadAll failed",M),dt.value=M&&M.message?M.message:"Gagal memuat data fiber."}finally{ze.value=!1}}}const Nt=f(null);let C=null,J=null,Pt=new Map,Tt=new Map,St=new Map,$e={markers:[],polyline:null},Et=!1;const Oe=f(""),Ie=f("roadmap"),Ze={roadmap:{label:"Roadmap",mapTypeId:"roadmap"},satellite:{label:"Satelit",mapTypeId:"satellite"},hybrid:{label:"Hybrid",mapTypeId:"hybrid"}},we=f(!1);function La(a){var r;const e=(a||"").toString().trim();return e?(r=window.google)!=null&&r.maps?Promise.resolve():(window.__fiberGoogleMapsPromise||(window.__fiberGoogleMapsPromise=new Promise((s,o)=>{const v=document.createElement("script"),p=new URLSearchParams({key:e,v:"weekly"});v.src=`https://maps.googleapis.com/maps/api/js?${p.toString()}`,v.async=!0,v.defer=!0,v.onload=()=>s(),v.onerror=()=>o(new Error("Gagal memuat Google Maps. Cek API key/koneksi.")),document.head.appendChild(v)})),window.__fiberGoogleMapsPromise):Promise.reject(new Error("Google Maps API key belum di-set."))}function $a(){var e;if(!C||!((e=window.google)!=null&&e.maps))return;const a=Ze[Ie.value]||Ze.roadmap;try{C.setMapTypeId(a.mapTypeId)}catch{}}function qt(){var a;if(!(!C||!((a=window.google)!=null&&a.maps)))try{window.google.maps.event.trigger(C,"resize")}catch{}}function Wt(){var a;$t();try{($e.markers||[]).forEach(e=>{try{e.setMap(null)}catch{}})}catch{}$e.markers=[];try{(a=$e.polyline)==null||a.setMap(null)}catch{}$e.polyline=null}function Be(a){try{Array.from(a.values()).forEach(e=>{try{e.setMap(null)}catch{}})}catch{}try{a.clear()}catch{}}function Oa(){var e;if(!((e=window.google)!=null&&e.maps)||!Nt.value)return;const a=Ze[Ie.value]||Ze.roadmap;C=new window.google.maps.Map(Nt.value,{center:{lat:-2.5489,lng:118.0149},zoom:5,mapTypeId:a.mapTypeId,clickableIcons:!1,fullscreenControl:!1,streetViewControl:!1,mapTypeControl:!1}),J=new window.google.maps.InfoWindow,C.addListener("click",Ua)}function Ia(){var a;if(!((a=window.google)!=null&&a.maps)){C=null,J=null;return}try{window.google.maps.event.clearInstanceListeners(C)}catch{}try{J==null||J.close()}catch{}Wt(),Be(Pt),Be(Tt),Be(St),C=null,J=null}const N=f(null),te=f(null),ae=f(!0),Ce=f(!1);let ke=[],Lt=null,qe=[];function Fa(a){var e,r,s,o;if(a){try{if(typeof a.remove=="function"){a.remove();return}}catch{}try{(o=(s=(r=(e=window.google)==null?void 0:e.maps)==null?void 0:r.event)==null?void 0:s.removeListener)==null||o.call(s,a)}catch{}}}function $t(){try{(qe||[]).forEach(a=>Fa(a))}catch{}qe=[]}function Ne(a){const e=Number(a);return Number.isFinite(e)?Math.round(e*1e7)/1e7:null}function Ma(){var a;return(a=window.google)!=null&&a.maps?(Lt||(Lt=new window.google.maps.DirectionsService),Lt):null}async function Yt(a,e){const r=Ma();if(!r)throw new Error("Google Maps Directions belum siap.");const s={origin:a,destination:e,travelMode:window.google.maps.TravelMode.DRIVING};return new Promise((o,v)=>{try{r.route(s,(p,d)=>{var F;if(d!=="OK"||!((F=p==null?void 0:p.routes)!=null&&F[0])){v(new Error(`Gagal ambil rute jalan (${d||"UNKNOWN"}).`));return}const P=(p.routes[0].overview_path||[]).map(j=>({lat:Ne(j.lat()),lng:Ne(j.lng())})).filter(j=>Number.isFinite(j.lat)&&Number.isFinite(j.lng));o(P)})}catch(p){v(p)}})}async function Ua(a){if(!(a!=null&&a.latLng))return;const e=Ne(a.latLng.lat()),r=Ne(a.latLng.lng());if(N.value==="pickPoint"){h.value.latitude=e,h.value.longitude=r,b&&b.success("Lokasi titik dipilih dari peta."),A();return}if(N.value==="pickBreak"){x.value.latitude=e,x.value.longitude=r,b&&b.success("Lokasi putus dipilih dari peta."),A();return}if(N.value==="drawCable"){const s=Array.isArray(c.value.path)?c.value.path:[];if(!Number.isFinite(e)||!Number.isFinite(r))return;if(s.length<1||!ae.value){ke.push(s.length),s.push({lat:e,lng:r}),c.value.path=s,re();return}if(Ce.value)return;ke.push(s.length),Ce.value=!0;try{const o=s[s.length-1],v=await Yt({lat:Number(o==null?void 0:o.lat),lng:Number(o==null?void 0:o.lng)},{lat:e,lng:r});if(Array.isArray(v)&&v.length>=2){const p=v.slice(1);c.value.path=s.concat(p)}else s.push({lat:e,lng:r}),c.value.path=s}catch(o){s.push({lat:e,lng:r}),c.value.path=s,b&&b.error((o==null?void 0:o.message)||"Gagal mengikuti jalan. Pakai garis lurus.")}finally{Ce.value=!1,re()}}}function A(a={}){const e=(a==null?void 0:a.reopen)!==!1,r=e?te.value:null;$t(),N.value=null,te.value=null,e&&r&&(r==="cable"&&(X.value=!0),r==="point"&&(oe.value=!0),r==="break"&&(ne.value=!0)),re()}function Aa(a){const e=document.createElement("div");return e.className="text-sm",(a||[]).forEach(r=>{const s=document.createElement("div");s.textContent=String(r??""),e.appendChild(s)}),e}function Ot(a,e,r=null){if(!C||!J)return;const s=(e||[]).filter(Boolean);if(!(s.length<1)){try{J.close()}catch{}J.setContent(Aa(s));try{if(r){J.open({map:C,anchor:r});return}a&&J.setPosition(a),J.open({map:C})}catch{}}}const It=I(()=>{const a=new Map;return(H.value||[]).forEach(e=>{const r=Number((e==null?void 0:e.id)||0);r>0&&a.set(r,e)}),a}),Ft=I(()=>{const a=new Map;return(B.value||[]).forEach(e=>{const r=Number((e==null?void 0:e.id)||0);r>0&&a.set(r,e)}),a}),ja=I(()=>{const a=new Map;return(de.value||[]).forEach(e=>{const r=Number((e==null?void 0:e.id)||0);r>0&&a.set(r,e)}),a}),Fe=I(()=>{const a=Number(ge.value||0);return a&&Ft.value.get(a)||null}),Pe=I(()=>{const a=Number(Y.value||0);return a&&It.value.get(a)||null}),Te=I(()=>{const a=Number(fe.value||0);return a&&ja.value.get(a)||null});function Qt(a,e){const r=Number(a),s=Number(e);return!Number.isFinite(r)||!Number.isFinite(s)?"-":`${r.toFixed(6)}, ${s.toFixed(6)}`}function Ga(a){if(!a)return"-";const e=new Date(a);if(!Number.isFinite(e.getTime()))return"-";try{return e.toLocaleString("id-ID",{dateStyle:"medium",timeStyle:"short"})}catch{return e.toISOString()}}const ye=I(()=>{if(Fe.value){const a=Fe.value;return{type:"cable",tone:"blue",badge:"KABEL",title:a.name||`Kabel #${a.id}`,subtitle:[a.code,a.cable_type].filter(Boolean).join(" | ")||"Jalur kabel",rows:[{label:"Core",value:a.core_count?`${a.core_count} core`:"-"},{label:"Panjang",value:jt(a.length_m)},{label:"Dari",value:D(a.from_point_id)||"-"},{label:"Ke",value:D(a.to_point_id)||"-"}],note:a.notes||""}}if(Pe.value){const a=Pe.value,e=Number((a==null?void 0:a.id)||0),r=(B.value||[]).filter(o=>Number((o==null?void 0:o.from_point_id)||0)===e||Number((o==null?void 0:o.to_point_id)||0)===e).length,s=(be.value||[]).filter(o=>Number((o==null?void 0:o.point_id)||0)===e).length;return{type:"point",tone:"teal",badge:"TITIK",title:a.name||`Titik #${a.id}`,subtitle:a.point_type||"Tanpa tipe",rows:[{label:"Koordinat",value:Qt(a.latitude,a.longitude)},{label:"Port",value:String(s)},{label:"Kabel terkait",value:String(r)}],note:a.address||a.notes||""}}if(Te.value){const a=Te.value,e=la(a.status);return{type:"break",tone:e==="OPEN"?"red":e==="IN PROGRESS"?"amber":e==="FIXED"?"green":"slate",badge:"PUTUS",title:z(a.cable_id)||(a.cable_id?`Kabel #${a.cable_id}`:"Tanpa kabel"),subtitle:e,rows:[{label:"Titik",value:D(a.point_id)||"-"},{label:"Severity",value:a.severity||"-"},{label:"Koordinat",value:Qt(a.latitude,a.longitude)},{label:"Dilaporkan",value:Ga(a.reported_at)}],note:a.description||""}}return null}),Da=I(()=>{var e;const a=(e=ye.value)==null?void 0:e.tone;return a==="blue"?"border-blue-200/80 dark:border-blue-900/40":a==="teal"?"border-teal-200/80 dark:border-teal-900/40":a==="red"?"border-red-200/80 dark:border-red-900/40":a==="amber"?"border-amber-200/80 dark:border-amber-900/40":a==="green"?"border-emerald-200/80 dark:border-emerald-900/40":"border-slate-200/80 dark:border-white/10"}),Ra=I(()=>{var e;const a=(e=ye.value)==null?void 0:e.tone;return a==="blue"?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-200":a==="teal"?"bg-teal-50 text-teal-700 dark:bg-teal-900/20 dark:text-teal-200":a==="red"?"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-200":a==="amber"?"bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-200":a==="green"?"bg-emerald-50 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-200":"bg-slate-100 text-slate-700 dark:bg-slate-700/40 dark:text-slate-200"});function Va(){ge.value=null,Y.value=null,fe.value=null;try{J==null||J.close()}catch{}We(),Mt(),Ut()}function Ba(){if(Fe.value){oa(Fe.value);return}if(Pe.value){ve(Number(Pe.value.latitude),Number(Pe.value.longitude),18);return}Te.value&&ve(Number(Te.value.latitude),Number(Te.value.longitude),18)}function Ka(){Fe.value?S.value="cables":Pe.value?S.value="points":Te.value&&(S.value="breaks"),ct("open")}function Ha(){if(Z.value){if(Fe.value){va(Fe.value);return}if(Pe.value){ga(Pe.value);return}Te.value&&ma(Te.value)}}function D(a){const e=Number(a||0);if(!e)return null;const r=It.value.get(e);return r?String(r.name||""):null}function ea(a){const e=Number(a||0);if(!e)return null;const r=It.value.get(e);if(!r)return null;const s=Ne(Number(r==null?void 0:r.latitude)),o=Ne(Number(r==null?void 0:r.longitude));return!Number.isFinite(s)||!Number.isFinite(o)?null:{lat:s,lng:o}}function z(a){const e=Number(a||0);if(!e)return null;const r=Ft.value.get(e);return r?String(r.name||""):null}function Ja(a){const e=String(a||"").toUpperCase();return e==="OPEN"?{stroke:"#dc2626",fill:"#ef4444"}:e==="IN_PROGRESS"?{stroke:"#b45309",fill:"#f59e0b"}:e==="FIXED"?{stroke:"#047857",fill:"#10b981"}:{stroke:"#64748b",fill:"#94a3b8"}}function ta(){var a;!C||!((a=window.google)!=null&&a.maps)||(We(),Mt(),Ut(),re())}function We(){var a;!C||!((a=window.google)!=null&&a.maps)||(Be(Pt),Ge.value&&(B.value||[]).forEach(e=>{const r=Array.isArray(e==null?void 0:e.path)?e.path:null;if(!r||r.length<2)return;const s=r.map(R=>({lat:Number(R==null?void 0:R.lat),lng:Number(R==null?void 0:R.lng)})).filter(R=>Number.isFinite(R.lat)&&Number.isFinite(R.lng));if(s.length<2)return;const o=Number(e==null?void 0:e.id)===Number(ge.value||0),v=Zt.value.size>0,p=Zt.value.has(Number(e==null?void 0:e.id)),d=((e==null?void 0:e.map_color)||"#2563eb").toString(),y=o?6:4,P=p?Math.max(y,6):y,F=v?p?1:.25:.9,j=new window.google.maps.Polyline({path:s,strokeColor:d,strokeWeight:P,strokeOpacity:F,clickable:!0});j.setMap(C),Pt.set(Number(e==null?void 0:e.id)||0,j);const M=D(e==null?void 0:e.from_point_id)||"-",he=D(e==null?void 0:e.to_point_id)||"-";j.addListener("click",R=>{na(e,{zoom:!1,panel:"open"}),Ot((R==null?void 0:R.latLng)||null,[`Kabel: ${(e==null?void 0:e.name)||"-"}`,e!=null&&e.code?`Kode: ${e.code}`:null,e!=null&&e.cable_type?`Tipe: ${e.cable_type}`:null,e!=null&&e.core_count?`Core: ${e.core_count}`:null,`Dari: ${M}`,`Ke: ${he}`])})}))}function Mt(){var a;!C||!((a=window.google)!=null&&a.maps)||(Be(Tt),De.value&&(H.value||[]).forEach(e=>{const r=Number(e==null?void 0:e.latitude),s=Number(e==null?void 0:e.longitude);if(!Number.isFinite(r)||!Number.isFinite(s))return;const o=Number(e==null?void 0:e.id)===Number(Y.value||0),v=new window.google.maps.Marker({position:{lat:r,lng:s},map:C,title:((e==null?void 0:e.name)||"").toString(),clickable:!0,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:o?7:6,fillColor:"#14b8a6",fillOpacity:.9,strokeColor:"#0f766e",strokeWeight:2}});Tt.set(Number(e==null?void 0:e.id)||0,v),v.addListener("click",()=>{ia(e,{zoom:!1,panel:"open"}),Ot(v.getPosition(),[`Titik: ${(e==null?void 0:e.name)||"-"}`,e!=null&&e.point_type?`Tipe: ${e.point_type}`:null,`Koordinat: ${r}, ${s}`],v)})}))}function Ut(){var a;!C||!((a=window.google)!=null&&a.maps)||(Be(St),Re.value&&(de.value||[]).forEach(e=>{const r=Number(e==null?void 0:e.latitude),s=Number(e==null?void 0:e.longitude);if(!Number.isFinite(r)||!Number.isFinite(s))return;const o=Ja(e==null?void 0:e.status),v=Number(e==null?void 0:e.id)===Number(fe.value||0),p=new window.google.maps.Marker({position:{lat:r,lng:s},map:C,title:`PUTUS: ${String((e==null?void 0:e.status)||"OPEN").toUpperCase()}`,clickable:!0,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:v?8:7,fillColor:o.fill,fillOpacity:.9,strokeColor:o.stroke,strokeWeight:2}});St.set(Number(e==null?void 0:e.id)||0,p),p.addListener("click",()=>{ua(e,{zoom:!1,panel:"open"});const d=z(e==null?void 0:e.cable_id)||(e!=null&&e.cable_id?`#${e.cable_id}`:"-"),y=D(e==null?void 0:e.point_id)||(e!=null&&e.point_id?`#${e.point_id}`:"-");Ot(p.getPosition(),[`PUTUS: ${String((e==null?void 0:e.status)||"OPEN").toUpperCase()}`,`Kabel: ${d}`,`Titik: ${y}`,e!=null&&e.severity?`Severity: ${e.severity}`:null],p)})}))}function za(a){var e,r,s;try{const o=(e=a==null?void 0:a.getPath)==null?void 0:e.call(a);if(!o||typeof o.getLength!="function")return;const v=[];for(let p=0;p<o.getLength();p+=1){const d=o.getAt(p),y=Ne((r=d==null?void 0:d.lat)==null?void 0:r.call(d)),P=Ne((s=d==null?void 0:d.lng)==null?void 0:s.call(d));!Number.isFinite(y)||!Number.isFinite(P)||v.push({lat:y,lng:P})}c.value.path=v}catch{}}function Xa(a){var s,o;if($t(),!a||!((s=window.google)!=null&&s.maps))return;const e=(o=a.getPath)==null?void 0:o.call(a);if(!e||typeof e.addListener!="function")return;const r=()=>za(a);qe.push(e.addListener("insert_at",r)),qe.push(e.addListener("set_at",r)),qe.push(e.addListener("remove_at",r)),r()}function re(){var e;if(!C||!((e=window.google)!=null&&e.maps))return;Wt();const a=(r,s,o={})=>{if(!Number.isFinite(r)||!Number.isFinite(s))return;const v=new window.google.maps.Marker({position:{lat:r,lng:s},map:C,clickable:!1,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:Number(o.scale??6),fillColor:(o.fillColor||"#38bdf8").toString(),fillOpacity:Number(o.fillOpacity??.9),strokeColor:(o.strokeColor||"#0ea5e9").toString(),strokeWeight:Number(o.strokeWeight??2)}});$e.markers.push(v)};if((oe.value||N.value==="pickPoint")&&h.value.latitude!==null&&h.value.longitude!==null){const r=Number(h.value.latitude),s=Number(h.value.longitude);Number.isFinite(r)&&Number.isFinite(s)&&a(r,s,{scale:7,strokeColor:"#0ea5e9",fillColor:"#38bdf8",fillOpacity:.85})}if((ne.value||N.value==="pickBreak")&&x.value.latitude!==null&&x.value.longitude!==null){const r=Number(x.value.latitude),s=Number(x.value.longitude);Number.isFinite(r)&&Number.isFinite(s)&&a(r,s,{scale:8,strokeColor:"#f97316",fillColor:"#fb923c",fillOpacity:.85})}if((X.value||N.value==="drawCable"||N.value==="editCable")&&Array.isArray(c.value.path)&&c.value.path.length>0){const r=N.value==="editCable",s=c.value.path.map(o=>({lat:Number(o==null?void 0:o.lat),lng:Number(o==null?void 0:o.lng)})).filter(o=>Number.isFinite(o.lat)&&Number.isFinite(o.lng));if(r||s.forEach(o=>{a(o.lat,o.lng,{scale:3,strokeColor:"#1d4ed8",fillColor:"#60a5fa",fillOpacity:.95})}),s.length>=2){const o={path:"M 0,-1 0,1",strokeOpacity:1,strokeColor:"#1d4ed8",scale:3};$e.polyline=new window.google.maps.Polyline({path:s,strokeColor:"#1d4ed8",strokeOpacity:r?.85:0,strokeWeight:r?4:0,icons:r?[]:[{icon:o,offset:"0",repeat:"12px"}],clickable:r,editable:r,map:C}),r&&Xa($e.polyline)}}}function aa(){var r;if(!C||Et||!((r=window.google)!=null&&r.maps))return;const a=new window.google.maps.LatLngBounds;let e=!1;try{Ge.value&&(B.value||[]).forEach(s=>{const o=Array.isArray(s==null?void 0:s.path)?s.path:null;!o||o.length<1||o.forEach(v=>{const p=Number(v==null?void 0:v.lat),d=Number(v==null?void 0:v.lng);!Number.isFinite(p)||!Number.isFinite(d)||(a.extend({lat:p,lng:d}),e=!0)})})}catch{}try{De.value&&(H.value||[]).forEach(s=>{const o=Number(s==null?void 0:s.latitude),v=Number(s==null?void 0:s.longitude);!Number.isFinite(o)||!Number.isFinite(v)||(a.extend({lat:o,lng:v}),e=!0)})}catch{}try{Re.value&&(de.value||[]).forEach(s=>{const o=Number(s==null?void 0:s.latitude),v=Number(s==null?void 0:s.longitude);!Number.isFinite(o)||!Number.isFinite(v)||(a.extend({lat:o,lng:v}),e=!0)})}catch{}if(e)try{C.fitBounds(a),Et=!0}catch{}}function Za(){Et=!1,aa()}function la(a){const e=String(a||"OPEN").toUpperCase();return e==="IN_PROGRESS"?"IN PROGRESS":e}function ra(a){if(!a)return"";const e=new Date(a);if(!Number.isFinite(e.getTime()))return"";const r=s=>String(s).padStart(2,"0");return`${e.getFullYear()}-${r(e.getMonth()+1)}-${r(e.getDate())}T${r(e.getHours())}:${r(e.getMinutes())}`}function ve(a,e,r=17){var s;if(!(!C||!((s=window.google)!=null&&s.maps)||!Number.isFinite(a)||!Number.isFinite(e))){try{C.panTo({lat:a,lng:e})}catch{}if(Number.isFinite(Number(r)))try{C.setZoom(Number(r))}catch{}}}function sa(){try{return window.innerWidth<1024}catch{return!1}}function ct(a){sa()&&(a==="open"&&(le.value=!0),a==="close"&&(le.value=!1))}function oa(a){var v;if(!C||!((v=window.google)!=null&&v.maps))return;const e=typeof a=="object"&&a?a:Ft.value.get(Number(a||0)),r=Array.isArray(e==null?void 0:e.path)?e.path:null;if(!r||r.length<1)return;const s=new window.google.maps.LatLngBounds;let o=!1;if(r.forEach(p=>{const d=Number(p==null?void 0:p.lat),y=Number(p==null?void 0:p.lng);!Number.isFinite(d)||!Number.isFinite(y)||(s.extend({lat:d,lng:y}),o=!0)}),!!o)try{C.fitBounds(s,60)}catch{try{C.fitBounds(s)}catch{}}}function na(a,e={}){ge.value=(a==null?void 0:a.id)??null,Y.value=null,fe.value=null,S.value="cables",We(),e.zoom!==!1&&oa(a),e.panel&&ct(e.panel)}function ia(a,e={}){Y.value=(a==null?void 0:a.id)??null,ge.value=null,fe.value=null,S.value="points",Mt(),e.zoom!==!1&&ve(Number(a==null?void 0:a.latitude),Number(a==null?void 0:a.longitude),17),e.panel&&ct(e.panel)}function ua(a,e={}){fe.value=(a==null?void 0:a.id)??null,ge.value=null,Y.value=null,S.value="breaks",Ut(),e.zoom!==!1&&ve(Number(a==null?void 0:a.latitude),Number(a==null?void 0:a.longitude),17),e.panel&&ct(e.panel)}function qa(a,e){const r=Number(a==null?void 0:a.lat),s=Number(a==null?void 0:a.lng),o=Number(e==null?void 0:e.lat),v=Number(e==null?void 0:e.lng);if(!Number.isFinite(r)||!Number.isFinite(s)||!Number.isFinite(o)||!Number.isFinite(v))return 0;const p=6371e3,d=he=>Number(he)*Math.PI/180,y=d(o-r),P=d(v-s),F=Math.sin(y/2),j=Math.sin(P/2),M=F*F+Math.cos(d(r))*Math.cos(d(o))*j*j;return 2*p*Math.asin(Math.min(1,Math.sqrt(M)))}function At(a){const e=Array.isArray(a)?a:[];if(e.length<2)return 0;let r=0;for(let s=1;s<e.length;s+=1)r+=qa(e[s-1],e[s]);return r}function jt(a){const e=Number(a);if(!Number.isFinite(e)||e<=0)return"-";if(e<1e3)return`${Math.round(e)} m`;const r=e/1e3;return`${r.toFixed(r<10?2:1)} km`}function pt(){var a;return Oe.value?(b&&b.error(Oe.value),!1):!C||!((a=window.google)!=null&&a.maps)?(b&&b.error("Peta belum siap."),!1):!0}const X=f(!1),Ke=f("create"),bt=f(!1),se=f({}),Se=f(!0),Ee=f(!1),c=f({id:null,name:"",code:"",cable_type:"",core_count:"",map_color:"#2563eb",from_point_id:"",to_point_id:"",path:[],length_m:"",notes:""}),Gt=I(()=>Math.round(At(c.value.path)));function da(){c.value={id:null,name:"",code:"",cable_type:"",core_count:"",map_color:"#2563eb",from_point_id:"",to_point_id:"",path:[],length_m:"",notes:""},se.value={},Se.value=!0,Ee.value=!1}function Wa(){Q.value&&(da(),Ke.value="create",ke=[],Se.value=!0,Ee.value=!0,X.value=!0,te.value=null,A({reopen:!1}))}function va(a){if(!Z.value)return;da(),Ke.value="edit",ke=[],c.value={id:a.id,name:a.name||"",code:a.code||"",cable_type:a.cable_type||"",core_count:a.core_count??"",map_color:a.map_color||"#2563eb",from_point_id:a.from_point_id??"",to_point_id:a.to_point_id??"",path:Array.isArray(a.path)?a.path.slice():[],length_m:a.length_m??"",notes:a.notes||""},Se.value=!(c.value.length_m!==""&&c.value.length_m!==null&&c.value.length_m!==void 0),Ee.value=!1,X.value=!0,te.value=null,A({reopen:!1});const e=(c.value.path||[])[0];e&&Number.isFinite(Number(e.lat))&&Number.isFinite(Number(e.lng))&&ve(Number(e.lat),Number(e.lng),16)}function Ya(a){var o;if(!C||!((o=window.google)!=null&&o.maps))return;const e=Array.isArray(a)?a:[];if(e.length<1)return;const r=new window.google.maps.LatLngBounds;let s=!1;if(e.forEach(v=>{const p=Number(v==null?void 0:v.lat),d=Number(v==null?void 0:v.lng);!Number.isFinite(p)||!Number.isFinite(d)||(r.extend({lat:p,lng:d}),s=!0)}),!!s)try{C.fitBounds(r)}catch{}}async function ca(a={}){var P;const e=(a==null?void 0:a.force)===!0,r=Number(c.value.from_point_id||0),s=Number(c.value.to_point_id||0);if(!r||!s)return b&&b.error("Pilih Dari Titik dan Ke Titik dulu."),!1;if(r===s)return b&&b.error("Dari Titik dan Ke Titik tidak boleh sama."),!1;const o=ea(r),v=ea(s);if(!o||!v)return b&&b.error("Koordinat titik belum lengkap. Isi latitude/longitude di data Titik."),!1;const p=Array.isArray(c.value.path)&&c.value.path.length>=2;if(p&&!e||p&&e&&!confirm("Jalur sudah ada. Timpa jalur dengan jalur otomatis dari titik?"))return!1;let d=[];const y=!!ae.value;if(y&&((P=window.google)!=null&&P.maps))try{d=await Yt(o,v)}catch(F){d=[],b&&b.error((F==null?void 0:F.message)||"Gagal mengikuti jalan. Pakai garis lurus.")}return(!Array.isArray(d)||d.length<2)&&(d=[o,v]),ke=[],c.value.path=d,re(),Ya(d),Se.value=!0,c.value.length_m=Math.round(At(d)),b&&b.success(y?"Jalur otomatis dibuat (ikut jalan).":"Jalur otomatis dibuat."),!0}async function Qa(){var o,v,p;bt.value=!0,se.value={};const a={name:c.value.name,code:c.value.code||null,cable_type:c.value.cable_type||null,core_count:c.value.core_count!==""?Number(c.value.core_count):null,map_color:c.value.map_color||null,from_point_id:c.value.from_point_id!==""?Number(c.value.from_point_id):null,to_point_id:c.value.to_point_id!==""?Number(c.value.to_point_id):null,path:Array.isArray(c.value.path)&&c.value.path.length>=2?c.value.path:null,length_m:c.value.length_m!==""&&c.value.length_m!==null&&c.value.length_m!==void 0?Number(c.value.length_m):null,notes:c.value.notes||null},e=Ke.value==="edit"&&c.value.id,r=e?`/api/v1/fiber/cables/${c.value.id}`:"/api/v1/fiber/cables",s=e?"PUT":"POST";try{const d=await q(r,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!d.ok)throw d.status===422&&((o=d.data)!=null&&o.errors)?(se.value=d.data.errors,new Error(((v=d.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((p=d.data)==null?void 0:p.message)||`Gagal menyimpan kabel (HTTP ${d.status}).`);X.value=!1,A(),await K(),b&&b.success("Kabel tersimpan.")}catch(d){console.error("Fiber: saveCable failed",d),b&&b.error((d==null?void 0:d.message)||"Gagal menyimpan kabel.")}finally{bt.value=!1}}async function el(a){var r;if(!(!ue.value||!confirm(`Hapus kabel "${(a==null?void 0:a.name)||""}"?`)))try{const s=await q(`/api/v1/fiber/cables/${a.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((r=s.data)==null?void 0:r.message)||`Gagal hapus kabel (HTTP ${s.status}).`);b&&b.success("Kabel dihapus."),Number(ge.value)===Number(a.id)&&(ge.value=null),await K()}catch(s){console.error("Fiber: deleteCable failed",s),b&&b.error((s==null?void 0:s.message)||"Gagal hapus kabel.")}}function tl(){X.value&&pt()&&(te.value="cable",X.value=!1,ke=[],N.value="drawCable",re(),b&&b.info(ae.value?"Mode gambar jalur aktif (ikut jalan): klik peta untuk set titik berikutnya, lalu klik Selesai untuk kembali.":"Mode gambar jalur aktif: klik peta untuk menambah titik, lalu klik Selesai untuk kembali."))}function al(){if(!X.value||!pt())return;if((Array.isArray(c.value.path)?c.value.path:[]).length<2){b&&b.error("Jalur belum ada. Klik Gambar dulu minimal 2 titik.");return}te.value="cable",X.value=!1,N.value="editCable",re(),b&&b.info("Mode edit jalur aktif: geser titik/segmen di peta, lalu klik Selesai untuk kembali.")}function pa(){const a=Array.isArray(c.value.path)?c.value.path:[];if(a.length!==0){if(ke.length>0){const e=Number(ke.pop());Number.isFinite(e)&&e>=0?c.value.path=a.slice(0,e):(a.pop(),c.value.path=a)}else a.pop(),c.value.path=a;re()}}function Dt(){c.value.path=[],ke=[],re()}function ll(){const a=Number(Gt.value||0);if(!Number.isFinite(a)||a<=0){b&&b.error("Tidak ada jalur untuk dihitung.");return}c.value.length_m=Math.round(a),Se.value=!0,b&&b.success("Panjang kabel diisi dari jalur.")}const oe=f(!1),gt=f("create"),ft=f(!1),xe=f({}),h=f({id:null,name:"",point_type:"",latitude:null,longitude:null,address:"",notes:""});function ba(){h.value={id:null,name:"",point_type:"",latitude:null,longitude:null,address:"",notes:""},xe.value={}}function rl(){Q.value&&(ba(),gt.value="create",oe.value=!0,te.value=null,A({reopen:!1}))}function ga(a){if(!Z.value)return;ba(),gt.value="edit",h.value={id:a.id,name:a.name||"",point_type:a.point_type||"",latitude:a.latitude??null,longitude:a.longitude??null,address:a.address||"",notes:a.notes||""},oe.value=!0,te.value=null,A({reopen:!1});const e=Number(h.value.latitude),r=Number(h.value.longitude);Number.isFinite(e)&&Number.isFinite(r)&&ve(e,r,17)}function sl(){oe.value&&pt()&&(te.value="point",oe.value=!1,N.value="pickPoint",re(),b&&b.info("Klik peta untuk memilih lokasi titik."))}async function ol(){var o,v,p;ft.value=!0,xe.value={};const a={name:h.value.name,point_type:h.value.point_type||null,latitude:h.value.latitude,longitude:h.value.longitude,address:h.value.address||null,notes:h.value.notes||null},e=gt.value==="edit"&&h.value.id,r=e?`/api/v1/fiber/points/${h.value.id}`:"/api/v1/fiber/points",s=e?"PUT":"POST";try{const d=await q(r,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!d.ok)throw d.status===422&&((o=d.data)!=null&&o.errors)?(xe.value=d.data.errors,new Error(((v=d.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((p=d.data)==null?void 0:p.message)||`Gagal menyimpan titik (HTTP ${d.status}).`);oe.value=!1,A(),await K(),b&&b.success("Titik tersimpan.")}catch(d){console.error("Fiber: savePoint failed",d),b&&b.error((d==null?void 0:d.message)||"Gagal menyimpan titik.")}finally{ft.value=!1}}async function nl(a){var r;if(!(!ue.value||!confirm(`Hapus titik "${(a==null?void 0:a.name)||""}"?`)))try{const s=await q(`/api/v1/fiber/points/${a.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((r=s.data)==null?void 0:r.message)||`Gagal hapus titik (HTTP ${s.status}).`);b&&b.success("Titik dihapus."),Number(Y.value)===Number(a.id)&&(Y.value=null),await K()}catch(s){console.error("Fiber: deletePoint failed",s),b&&b.error((s==null?void 0:s.message)||"Gagal hapus titik.")}}const ne=f(!1),mt=f("create"),kt=f(!1),Me=f({}),x=f({id:null,cable_id:"",point_id:"",status:"OPEN",severity:"",reported_at:"",fixed_at:"",latitude:null,longitude:null,description:""});function fa(){x.value={id:null,cable_id:"",point_id:"",status:"OPEN",severity:"",reported_at:"",fixed_at:"",latitude:null,longitude:null,description:""},Me.value={}}function il(){Q.value&&(fa(),mt.value="create",ne.value=!0,te.value=null,A({reopen:!1}))}function ma(a){if(!Z.value)return;fa(),mt.value="edit",x.value={id:a.id,cable_id:a.cable_id??"",point_id:a.point_id??"",status:(a.status||"OPEN").toString().toUpperCase(),severity:a.severity||"",reported_at:ra(a.reported_at),fixed_at:ra(a.fixed_at),latitude:a.latitude??null,longitude:a.longitude??null,description:a.description||""},ne.value=!0,te.value=null,A({reopen:!1});const e=Number(x.value.latitude),r=Number(x.value.longitude);Number.isFinite(e)&&Number.isFinite(r)&&ve(e,r,17)}function ul(){ne.value&&pt()&&(te.value="break",ne.value=!1,N.value="pickBreak",re(),b&&b.info("Klik peta untuk memilih lokasi putus."))}async function dl(){var o,v,p;kt.value=!0,Me.value={};const a={cable_id:x.value.cable_id!==""?Number(x.value.cable_id):null,point_id:x.value.point_id!==""?Number(x.value.point_id):null,status:(x.value.status||"OPEN").toString().toUpperCase(),severity:x.value.severity||null,reported_at:x.value.reported_at||null,fixed_at:x.value.fixed_at||null,latitude:x.value.latitude,longitude:x.value.longitude,description:x.value.description||null},e=mt.value==="edit"&&x.value.id,r=e?`/api/v1/fiber/breaks/${x.value.id}`:"/api/v1/fiber/breaks",s=e?"PUT":"POST";try{const d=await q(r,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!d.ok)throw d.status===422&&((o=d.data)!=null&&o.errors)?(Me.value=d.data.errors,new Error(((v=d.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((p=d.data)==null?void 0:p.message)||`Gagal menyimpan data putus (HTTP ${d.status}).`);ne.value=!1,A(),await K(),b&&b.success("Data putus tersimpan.")}catch(d){console.error("Fiber: saveBreak failed",d),b&&b.error((d==null?void 0:d.message)||"Gagal menyimpan data putus.")}finally{kt.value=!1}}async function vl(a){var r;if(!(!ue.value||!confirm("Hapus data putus ini?")))try{const s=await q(`/api/v1/fiber/breaks/${a.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((r=s.data)==null?void 0:r.message)||`Gagal hapus data putus (HTTP ${s.status}).`);b&&b.success("Data putus dihapus."),Number(fe.value)===Number(a.id)&&(fe.value=null),await K()}catch(s){console.error("Fiber: deleteBreak failed",s),b&&b.error((s==null?void 0:s.message)||"Gagal hapus data putus.")}}const Ye=f({});function ka(a){var r;const e=String(Number(a||0));return!!((r=Ye.value)!=null&&r[e])}async function cl(a){var o,v,p;if(!Z.value||!Q.value)return;const e=String((a==null?void 0:a.status)||"OPEN").toUpperCase();if(!["OPEN","IN_PROGRESS"].includes(e)){b&&b.info("Status putus sudah bukan OPEN/IN_PROGRESS.");return}if(!confirm("Selesaikan data putus ini? Sistem akan membuat titik JOINT_CLOSURE di lokasi putus dan mengubah status menjadi FIXED."))return;const s=String(Number((a==null?void 0:a.id)||0));Ye.value={...Ye.value||{},[s]:!0};try{const d=z(a==null?void 0:a.cable_id)||(a!=null&&a.cable_id?`Kabel #${a.cable_id}`:""),y=(d?`JC - ${d}`:`Joint Closure - Break #${(a==null?void 0:a.id)||""}`).slice(0,160),P=await q(`/api/v1/fiber/breaks/${a.id}/fix`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({joint_name:y,joint_type:"JOINT_CLOSURE",joint_notes:`Auto dari data putus #${(a==null?void 0:a.id)||""}`})});if(!P.ok)throw new Error(((o=P.data)==null?void 0:o.message)||`Gagal menyelesaikan putus (HTTP ${P.status}).`);await K();const F=((p=(v=P.data)==null?void 0:v.data)==null?void 0:p.joint_point)||null,j=Number(F==null?void 0:F.latitude),M=Number(F==null?void 0:F.longitude);Number.isFinite(j)&&Number.isFinite(M)&&ve(j,M,18),b&&b.success("Data putus diselesaikan. Titik Joint Closure dibuat.")}catch(d){console.error("Fiber: fixBreakWithJoint failed",d),b&&b.error((d==null?void 0:d.message)||"Gagal menyelesaikan putus.")}finally{const d={...Ye.value||{}};delete d[s],Ye.value=d}}const Ue=f(!1),yt=f("create"),xt=f(!1),Ae=f({}),O=f({id:null,point_id:"",port_type:"OLT_PON",port_label:"",cable_id:"",core_no:"",notes:""});function ya(){O.value={id:null,point_id:"",port_type:"OLT_PON",port_label:"",cable_id:"",core_no:"",notes:""},Ae.value={}}function pl(){Q.value&&(ya(),Y.value&&(O.value.point_id=String(Y.value)),yt.value="create",Ue.value=!0)}function bl(a){Z.value&&(ya(),yt.value="edit",O.value={id:a.id,point_id:a.point_id??"",port_type:a.port_type||"OLT_PON",port_label:a.port_label||"",cable_id:a.cable_id??"",core_no:a.core_no??"",notes:a.notes||""},Ue.value=!0)}async function gl(){var o,v,p;xt.value=!0,Ae.value={};const a={point_id:O.value.point_id!==""?Number(O.value.point_id):null,port_type:(O.value.port_type||"OLT_PON").toString().toUpperCase(),port_label:O.value.port_label||"",cable_id:O.value.cable_id!==""?Number(O.value.cable_id):null,core_no:O.value.core_no!==""?Number(O.value.core_no):null,notes:O.value.notes||null},e=yt.value==="edit"&&O.value.id,r=e?`/api/v1/fiber/ports/${O.value.id}`:"/api/v1/fiber/ports",s=e?"PUT":"POST";try{const d=await q(r,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!d.ok)throw d.status===422&&((o=d.data)!=null&&o.errors)?(Ae.value=d.data.errors,new Error(((v=d.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((p=d.data)==null?void 0:p.message)||`Gagal menyimpan port (HTTP ${d.status}).`);Ue.value=!1,await K(),b&&b.success("Port tersimpan.")}catch(d){console.error("Fiber: savePort failed",d),b&&b.error((d==null?void 0:d.message)||"Gagal menyimpan port.")}finally{xt.value=!1}}async function fl(a){var r;if(!(!ue.value||!confirm(`Hapus port "${(a==null?void 0:a.port_label)||""}"?`)))try{const s=await q(`/api/v1/fiber/ports/${a.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((r=s.data)==null?void 0:r.message)||`Gagal hapus port (HTTP ${s.status}).`);b&&b.success("Port dihapus."),await K()}catch(s){console.error("Fiber: deletePort failed",s),b&&b.error((s==null?void 0:s.message)||"Gagal hapus port.")}}const Le=f(!1),_t=f("create"),ht=f(!1),_e=f({}),Qe=f(8),k=f({id:null,point_id:"",link_type:"SPLICE",from_cable_id:"",from_core_no:"",to_cable_id:"",to_core_no:"",split_group:"",outputs:[],loss_db:"",notes:""}),wt=I(()=>{const a=Array.isArray(Xe.value)?Xe.value:[],e=[],r={};return a.forEach(s=>{const o=((s==null?void 0:s.link_type)||"").toString().toUpperCase(),v=((s==null?void 0:s.split_group)||"").toString();if(o==="SPLIT"&&v){const p=`${Number(s.point_id)||0}|${v}`;r[p]||(r[p]={kind:"SPLIT_GROUP",id:s.id,point_id:s.point_id,link_type:"SPLIT",split_group:v,from_cable_id:s.from_cable_id,from_core_no:s.from_core_no,loss_db:s.loss_db??null,notes:s.notes||"",outputs:[],link_ids:[]}),r[p].outputs.push({to_cable_id:s.to_cable_id,to_core_no:s.to_core_no}),r[p].link_ids.push(s.id);return}e.push({kind:"LINK",...s||{}})}),Object.values(r).forEach(s=>{s.outputs=(s.outputs||[]).filter(o=>(o==null?void 0:o.to_cable_id)&&(o==null?void 0:o.to_core_no)),e.push(s)}),e.sort((s,o)=>{const v=Number((s==null?void 0:s.point_id)||0),p=Number((o==null?void 0:o.point_id)||0);if(v!==p)return v-p;const d=((s==null?void 0:s.link_type)||"").toString(),y=((o==null?void 0:o.link_type)||"").toString();return d.localeCompare(y)}),e}),et=I(()=>(E.value||"").toString().toLowerCase().trim()),tt=I(()=>{const a=String(S.value||"cables");return a==="cables"?"Cari kabel (nama/kode/tipe/titik)...":a==="points"?"Cari titik (nama/tipe)...":a==="ports"?"Cari port (label/tipe/kabel/titik)...":a==="links"?"Cari sambungan (titik/kabel/core)...":a==="breaks"?"Cari putus (kabel/titik/status)...":"Cari..."});function L(a,e){return(a||"").toString().toLowerCase().includes(e)}const Rt=I(()=>{const a=Array.isArray(B.value)?B.value:[],e=et.value;return e?a.filter(r=>{const s=D(r==null?void 0:r.from_point_id)||"",o=D(r==null?void 0:r.to_point_id)||"";return L(r==null?void 0:r.name,e)||L(r==null?void 0:r.code,e)||L(r==null?void 0:r.cable_type,e)||L(s,e)||L(o,e)}):a}),Vt=I(()=>{const a=Array.isArray(H.value)?H.value:[],e=et.value;return e?a.filter(r=>L(r==null?void 0:r.name,e)||L(r==null?void 0:r.point_type,e)||L(r==null?void 0:r.address,e)||L(r==null?void 0:r.notes,e)):a}),Bt=I(()=>{const a=Array.isArray(be.value)?be.value:[],e=et.value;return e?a.filter(r=>{const s=D(r==null?void 0:r.point_id)||"",o=z(r==null?void 0:r.cable_id)||"";return L(r==null?void 0:r.port_label,e)||L(r==null?void 0:r.port_type,e)||L(s,e)||L(o,e)||L(String((r==null?void 0:r.core_no)??""),e)}):a}),Kt=I(()=>{const a=Array.isArray(wt.value)?wt.value:[],e=et.value;return e?a.filter(r=>{const s=D(r==null?void 0:r.point_id)||"",o=z(r==null?void 0:r.from_cable_id)||"",v=z(r==null?void 0:r.to_cable_id)||"",p=((r==null?void 0:r.link_type)||"").toString().toUpperCase();let d="";return(r==null?void 0:r.kind)==="SPLIT_GROUP"&&(d=((r==null?void 0:r.outputs)||[]).map(y=>`${z(y==null?void 0:y.to_cable_id)||""}:${(y==null?void 0:y.to_core_no)??""}`).join(" ")),L(p,e)||L(s,e)||L(o,e)||L(v,e)||L(r==null?void 0:r.split_group,e)||L(String((r==null?void 0:r.from_core_no)??""),e)||L(String((r==null?void 0:r.to_core_no)??""),e)||L(d,e)}):a}),Ht=I(()=>{const a=Array.isArray(de.value)?de.value:[],e=et.value,r=String(ee.value||"ALL").toUpperCase();return a.filter(s=>{const o=String((s==null?void 0:s.status)||"OPEN").toUpperCase();if(r!=="ALL"&&o!==r)return!1;if(!e)return!0;const v=z(s==null?void 0:s.cable_id)||"",p=D(s==null?void 0:s.point_id)||"";return L(o,e)||L(s==null?void 0:s.severity,e)||L(v,e)||L(p,e)||L(s==null?void 0:s.description,e)})});function xa(){k.value={id:null,point_id:"",link_type:"SPLICE",from_cable_id:"",from_core_no:"",to_cable_id:"",to_core_no:"",split_group:"",outputs:[],loss_db:"",notes:""},_e.value={},Qe.value=8}function ml(a){const e=Math.max(1,Math.min(64,Number(a)||1));k.value.outputs=Array.from({length:e}).map(()=>({to_cable_id:"",to_core_no:""}))}function kl(){const a=Array.isArray(k.value.outputs)?k.value.outputs:[];a.push({to_cable_id:"",to_core_no:""}),k.value.outputs=a}function yl(a){const e=Array.isArray(k.value.outputs)?k.value.outputs:[];a<0||a>=e.length||(e.splice(a,1),k.value.outputs=e)}function xl(){Q.value&&(xa(),Y.value&&(k.value.point_id=String(Y.value)),_t.value="create",Le.value=!0)}function _l(a){if(Z.value){if(xa(),_t.value="edit",(a==null?void 0:a.kind)==="SPLIT_GROUP"){k.value={id:a.id,point_id:a.point_id??"",link_type:"SPLIT",from_cable_id:a.from_cable_id??"",from_core_no:a.from_core_no??"",to_cable_id:"",to_core_no:"",split_group:a.split_group||"",outputs:(a.outputs||[]).map(e=>({to_cable_id:e.to_cable_id??"",to_core_no:e.to_core_no??""})),loss_db:a.loss_db??"",notes:a.notes||""},Qe.value=(k.value.outputs||[]).length||8,Le.value=!0;return}k.value={id:a.id,point_id:a.point_id??"",link_type:(a.link_type||"SPLICE").toString().toUpperCase(),from_cable_id:a.from_cable_id??"",from_core_no:a.from_core_no??"",to_cable_id:a.to_cable_id??"",to_core_no:a.to_core_no??"",split_group:a.split_group||"",outputs:[],loss_db:a.loss_db??"",notes:a.notes||""},Le.value=!0}}async function hl(){var v,p,d;ht.value=!0,_e.value={};const a=(k.value.link_type||"SPLICE").toString().toUpperCase(),e={point_id:k.value.point_id!==""?Number(k.value.point_id):null,link_type:a,from_cable_id:k.value.from_cable_id!==""?Number(k.value.from_cable_id):null,from_core_no:k.value.from_core_no!==""?Number(k.value.from_core_no):null,split_group:k.value.split_group||null,loss_db:k.value.loss_db!==""?Number(k.value.loss_db):null,notes:k.value.notes||null};if(a==="SPLIT"){const y=Array.isArray(k.value.outputs)?k.value.outputs:[];e.outputs=y.map(P=>({to_cable_id:P.to_cable_id!==""?Number(P.to_cable_id):null,to_core_no:P.to_core_no!==""?Number(P.to_core_no):null})).filter(P=>P.to_cable_id&&P.to_core_no)}else e.to_cable_id=k.value.to_cable_id!==""?Number(k.value.to_cable_id):null,e.to_core_no=k.value.to_core_no!==""?Number(k.value.to_core_no):null;const r=_t.value==="edit"&&k.value.id,s=r?`/api/v1/fiber/links/${k.value.id}`:"/api/v1/fiber/links",o=r?"PUT":"POST";try{const y=await q(s,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!y.ok)throw y.status===422&&((v=y.data)!=null&&v.errors)?(_e.value=y.data.errors,new Error(((p=y.data)==null?void 0:p.message)||"Validasi gagal.")):new Error(((d=y.data)==null?void 0:d.message)||`Gagal menyimpan sambungan (HTTP ${y.status}).`);Le.value=!1,await K(),b&&b.success("Sambungan tersimpan.")}catch(y){console.error("Fiber: saveLink failed",y),b&&b.error((y==null?void 0:y.message)||"Gagal menyimpan sambungan.")}finally{ht.value=!1}}async function wl(a){var s;if(!ue.value)return;const e=(a==null?void 0:a.kind)==="SPLIT_GROUP"?`splitter "${(a==null?void 0:a.split_group)||""}"`:"sambungan ini";if(confirm(`Hapus ${e}?`))try{const o=await q(`/api/v1/fiber/links/${a.id}`,{method:"DELETE"});if(!o.ok)throw new Error(((s=o.data)==null?void 0:s.message)||`Gagal hapus sambungan (HTTP ${o.status}).`);b&&b.success("Sambungan dihapus."),await K()}catch(o){console.error("Fiber: deleteLink failed",o),b&&b.error((o==null?void 0:o.message)||"Gagal hapus sambungan.")}}const at=f(""),He=f(!1),Je=f(""),je=f(null),Cl=I(()=>(be.value||[]).filter(a=>((a==null?void 0:a.port_type)||"").toString().toUpperCase()==="OLT_PON"));function Nl(){me.value=null,Je.value="",je.value=null,vt.value=[],We()}async function Pl(){var a,e,r,s,o,v;if(at.value){He.value=!0,Je.value="",me.value=null,je.value=null,vt.value=[];try{const p=await q(`/api/v1/fiber/trace/${Number(at.value)}?stop_at_odp_out=1`);if(!p.ok)throw new Error(((a=p.data)==null?void 0:a.message)||`Gagal trace (HTTP ${p.status}).`);me.value=((e=p.data)==null?void 0:e.data)||null,vt.value=((s=(r=p.data)==null?void 0:r.data)==null?void 0:s.used_cable_ids)||[],We();const d=((v=(o=p.data)==null?void 0:o.data)==null?void 0:v.endpoints)||[];d.length>0&&(je.value=d[0]),b&&b.success("Trace selesai.")}catch(p){console.error("Fiber: runTrace failed",p),Je.value=(p==null?void 0:p.message)||"Gagal trace.",b&&b.error(Je.value)}finally{He.value=!1}}}return ce([Ge,De,Re],()=>{ta()}),ce(S,()=>{E.value=""}),ce(N,a=>{a&&(le.value=!1)}),ce(Ve,()=>{Ca(()=>qt())}),ce(X,a=>{if(!a){Ee.value=!1;return}Ke.value==="create"&&(Ee.value=!0)}),ce([()=>c.value.from_point_id,()=>c.value.to_point_id],async()=>{if(!X.value||Ke.value!=="create"||!Ee.value)return;const a=Number(c.value.from_point_id||0),e=Number(c.value.to_point_id||0);if(!a||!e||a===e)return;if(Array.isArray(c.value.path)&&c.value.path.length>=2){Ee.value=!1;return}await ca({force:!1})&&(Ee.value=!1)}),ce(()=>c.value.path,()=>{if(!Se.value)return;const a=Math.round(At(c.value.path));Number.isFinite(a)&&a>0&&(c.value.length_m=a)},{deep:!0}),ce(Ie,()=>{try{localStorage.setItem("fiber_map_style",Ie.value)}catch{}$a()}),ce(ae,()=>{try{localStorage.setItem("fiber_follow_road",ae.value?"1":"0")}catch{}}),ce(we,()=>{try{localStorage.setItem("fiber_legend_collapsed",we.value?"1":"0")}catch{}}),Sl(()=>{try{const e=localStorage.getItem("fiber_map_style");e&&Ze[e]&&(Ie.value=e)}catch{}try{const e=localStorage.getItem("fiber_follow_road");e==="0"&&(ae.value=!1),e==="1"&&(ae.value=!0)}catch{}try{const e=localStorage.getItem("fiber_legend_collapsed");e==="1"&&(we.value=!0),e==="0"&&(we.value=!1)}catch{}Oe.value="";const a=(Ct.googleMapsApiKey||"").toString().trim();if(!a){Oe.value="Google Maps API key belum di-set. Buka Pengaturan -> System -> Google Maps.",K();return}La(a).then(()=>{Ca(()=>{Oa(),qt(),K()})}).catch(e=>{console.error("Fiber: Google Maps load failed",e),Oe.value=(e==null?void 0:e.message)||"Gagal memuat Google Maps.",K()})}),El(()=>{Ia()}),(a,e)=>(i(),n(U,null,[Na(Ll($l),{title:"Kabel FO"}),Na(Fl,null,{default:Ol(()=>{var r,s,o,v,p,d,y,P,F,j,M,he,R,_a,ha;return[t("div",Ml,[t("div",Ul,[e[98]||(e[98]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Manajemen Kabel FO"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Pemetaan jalur kabel, titik sambungan, dan data putus.")],-1)),t("div",Al,[t("div",jl,[t("span",Gl,u(pe.value.cables),1),e[95]||(e[95]=t("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"kabel",-1))]),t("div",Dl,[t("span",Rl,u(pe.value.points),1),e[96]||(e[96]=t("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"titik",-1))]),t("div",Vl,[t("span",Bl,u(pe.value.breaks_open),1),e[97]||(e[97]=t("span",{class:"text-red-600/70 dark:text-red-300/70 ml-1"},"putus aktif",-1))])])]),Ct.warning?(i(),n("div",Kl,u(Ct.warning),1)):g("",!0),Xt.value?(i(),n("div",Jl,[le.value?(i(),n("div",{key:0,class:"fixed inset-0 z-[9000] bg-black/35 backdrop-blur-sm lg:hidden",onClick:e[0]||(e[0]=l=>le.value=!1)})):g("",!0),t("div",zl,[t("div",{class:T(["bg-white dark:bg-dark-800 rounded-xl shadow-card border border-gray-100 dark:border-dark-700 overflow-hidden flex flex-col lg:h-[calc(100vh-13rem)]",Ve.value?"lg:col-span-12":"lg:col-span-8"])},[t("div",Xl,[t("div",{ref_key:"mapContainer",ref:Nt,class:"absolute inset-0 w-full h-full bg-slate-100 dark:bg-slate-900"},null,512),t("div",Zl,[t("button",{class:T(["px-3 py-1.5 rounded-lg text-xs font-semibold border transition",Ge.value?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-900/30 dark:text-blue-200":"bg-white/70 dark:bg-dark-800/70 border-gray-200/70 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[1]||(e[1]=l=>Ge.value=!Ge.value)}," Kabel ("+u(pe.value.cables)+") ",3),t("button",{class:T(["px-3 py-1.5 rounded-lg text-xs font-semibold border transition",De.value?"bg-teal-50 border-teal-200 text-teal-700 dark:bg-teal-900/20 dark:border-teal-900/30 dark:text-teal-200":"bg-white/70 dark:bg-dark-800/70 border-gray-200/70 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[2]||(e[2]=l=>De.value=!De.value)}," Titik ("+u(pe.value.points)+") ",3),t("button",{class:T(["px-3 py-1.5 rounded-lg text-xs font-semibold border transition",Re.value?"bg-red-50 border-red-200 text-red-700 dark:bg-red-900/10 dark:border-red-900/30 dark:text-red-300":"bg-white/70 dark:bg-dark-800/70 border-gray-200/70 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[3]||(e[3]=l=>Re.value=!Re.value)}," Putus ("+u(pe.value.breaks_open)+") ",3)]),t("div",ql,[t("div",Wl,[e[100]||(e[100]=t("div",{class:"text-[11px] font-semibold text-gray-700 dark:text-gray-200 uppercase tracking-wide"},"Legend Peta",-1)),t("button",{class:"text-[11px] font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",onClick:e[4]||(e[4]=l=>we.value=!we.value)},u(we.value?"Tampilkan":"Ringkas"),1)]),we.value?g("",!0):(i(),n("div",Yl,[...e[101]||(e[101]=[t("div",{class:"grid grid-cols-2 gap-2 text-[11px] text-gray-600 dark:text-gray-300"},[t("div",{class:"flex items-center gap-2"},[t("span",{class:"w-5 h-1 rounded-full bg-blue-600"}),t("span",null,"Kabel")]),t("div",{class:"flex items-center gap-2"},[t("span",{class:"w-2.5 h-2.5 rounded-full border-2 border-teal-700 bg-teal-400"}),t("span",null,"Titik")]),t("div",{class:"flex items-center gap-2"},[t("span",{class:"w-2.5 h-2.5 rounded-full border-2 border-red-700 bg-red-500"}),t("span",null,"Putus OPEN")]),t("div",{class:"flex items-center gap-2"},[t("span",{class:"w-2.5 h-2.5 rounded-full border-2 border-amber-700 bg-amber-500"}),t("span",null,"IN PROGRESS")]),t("div",{class:"flex items-center gap-2"},[t("span",{class:"w-2.5 h-2.5 rounded-full border-2 border-emerald-700 bg-emerald-500"}),t("span",null,"FIXED")]),t("div",{class:"flex items-center gap-2"},[t("span",{class:"w-5 h-1 rounded-full bg-sky-700"}),t("span",null,"Trace aktif")])],-1),t("div",{class:"text-[11px] text-gray-500 dark:text-gray-400"}," Klik objek di peta untuk membuka detail cepat. ",-1)])]))]),t("div",Ql,[m(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>Ie.value=l),class:"input !py-1.5 !text-xs"},[...e[102]||(e[102]=[t("option",{value:"roadmap"},"Roadmap",-1),t("option",{value:"hybrid"},"Hybrid",-1),t("option",{value:"satellite"},"Satelit",-1)])],512),[[V,Ie.value]]),t("button",{onClick:Za,class:"btn btn-secondary !py-1.5 !text-xs"},"Fit"),t("button",{onClick:K,class:"btn btn-secondary !py-1.5 !text-xs",disabled:ze.value},"Refresh",8,er),t("button",{class:"btn btn-primary !py-1.5 !text-xs lg:hidden",onClick:e[6]||(e[6]=l=>le.value=!le.value)},u(le.value?"Tutup":"Data"),1),t("button",{class:"btn btn-secondary !py-1.5 !text-xs hidden lg:inline-flex",onClick:e[7]||(e[7]=l=>Ve.value=!Ve.value)},u(Ve.value?"Panel":"Full Map"),1)]),ye.value&&(!le.value||!sa())?(i(),n("div",{key:0,class:T(["absolute z-20 left-3 right-3 sm:left-auto sm:w-80 bg-white/95 dark:bg-dark-900/90 backdrop-blur rounded-2xl border shadow-xl p-3",[Da.value,N.value?"bottom-36":"bottom-3"]])},[t("div",tr,[t("div",ar,[t("div",{class:T(["inline-flex px-2 py-1 rounded-full text-[10px] font-bold tracking-wide",Ra.value])},u(ye.value.badge),3),t("div",lr,u(ye.value.title),1),t("div",rr,u(ye.value.subtitle),1)]),t("button",{class:"text-xs text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:Va},"Tutup")]),t("div",sr,[(i(!0),n(U,null,G(ye.value.rows,(l,$)=>(i(),n("div",{key:$,class:"flex items-start justify-between gap-2 text-xs"},[t("span",or,u(l.label),1),t("span",nr,u(l.value),1)]))),128))]),ye.value.note?(i(),n("div",ir,u(ye.value.note),1)):g("",!0),t("div",ur,[t("button",{class:"btn btn-secondary !py-1.5 !text-xs",onClick:Ba},"Zoom"),t("button",{class:"btn btn-secondary !py-1.5 !text-xs lg:hidden",onClick:Ka},"Panel"),Z.value?(i(),n("button",{key:0,class:"btn btn-primary !py-1.5 !text-xs",onClick:Ha},"Edit")):g("",!0)])],2)):g("",!0),Oe.value?(i(),n("div",dr,[t("div",vr,[e[103]||(e[103]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Peta tidak dapat dimuat",-1)),t("div",cr,u(Oe.value),1)])])):g("",!0),N.value?(i(),n("div",pr,[t("div",br,[e[104]||(e[104]=_(" Mode peta aktif: ",-1)),t("span",gr,u(N.value==="drawCable"?"gambar kabel":N.value==="editCable"?"edit jalur":N.value==="pickPoint"?"pilih titik":"pilih putus"),1)]),N.value==="editCable"?(i(),n("div",fr," Geser titik/segmen untuk merapikan jalur, lalu klik tombol Selesai. ")):N.value==="drawCable"?(i(),n("div",mr,[e[105]||(e[105]=_(" Klik peta untuk menambah titik. Mode: ",-1)),t("span",kr,u(ae.value?"Ikuti jalan":"Garis lurus"),1),e[106]||(e[106]=_(". ",-1)),Ce.value?(i(),n("span",yr,"Menghitung rute...")):g("",!0)])):(i(),n("div",xr," Klik peta untuk memilih lokasi, lalu klik tombol Selesai. ")),N.value==="drawCable"?(i(),n("label",_r,[m(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=l=>ae.value=l),disabled:Ce.value},null,8,hr),[[Pa,ae.value]]),e[107]||(e[107]=_(" Ikuti jalan ",-1))])):g("",!0),t("div",wr,[t("button",{class:"btn btn-secondary !py-1 !text-xs",onClick:A,disabled:N.value==="drawCable"&&Ce.value},"Selesai",8,Cr),N.value==="drawCable"?(i(),n("button",{key:0,class:"btn btn-secondary !py-1 !text-xs",onClick:pa,disabled:Ce.value},"Undo",8,Nr)):g("",!0),N.value==="drawCable"?(i(),n("button",{key:1,class:"btn btn-secondary !py-1 !text-xs",onClick:Dt,disabled:Ce.value},"Clear",8,Pr)):g("",!0),N.value==="editCable"?(i(),n("button",{key:2,class:"btn btn-secondary !py-1 !text-xs",onClick:Dt},"Clear")):g("",!0)])])):g("",!0)])],2),t("div",{class:T(["bg-white dark:bg-dark-800 shadow-card border border-gray-100 dark:border-dark-700 overflow-hidden flex flex-col lg:h-[calc(100vh-13rem)] fixed inset-x-0 bottom-0 z-[9001] lg:static lg:z-auto rounded-t-2xl lg:rounded-xl max-h-[calc(100vh-5rem)] lg:max-h-none transform transition-transform duration-200 ease-out lg:transform-none",[Ve.value?"lg:hidden":"lg:col-span-4",le.value?"translate-y-0 pointer-events-auto":"translate-y-full pointer-events-none lg:pointer-events-auto lg:translate-y-0"]])},[t("div",Tr,[e[109]||(e[109]=t("div",{class:"mx-auto h-1 w-10 rounded-full bg-gray-200 dark:bg-white/10"},null,-1)),t("div",Sr,[m(t("select",{"onUpdate:modelValue":e[9]||(e[9]=l=>S.value=l),class:"input !py-2 !text-xs flex-1"},[t("option",Er,"Kabel ("+u(B.value.length)+")",1),t("option",Lr,"Titik ("+u(H.value.length)+")",1),t("option",$r,"Port ("+u(be.value.length)+")",1),t("option",Or,"Sambungan ("+u(Xe.value.length)+")",1),e[108]||(e[108]=t("option",{value:"trace"},"Trace",-1)),t("option",Ir,"Putus ("+u(de.value.length)+")",1)],512),[[V,S.value]]),t("button",{class:"btn btn-secondary !py-1.5 !text-xs",onClick:e[10]||(e[10]=l=>le.value=!1)},"Tutup")])]),t("div",Fr,[t("button",{onClick:e[11]||(e[11]=l=>S.value="cables"),class:T(["px-3 py-3 text-xs font-semibold whitespace-nowrap",S.value==="cables"?"text-blue-700 dark:text-blue-300 bg-blue-50/60 dark:bg-blue-900/10":"text-gray-600 dark:text-gray-300"])}," Kabel ("+u(B.value.length)+") ",3),t("button",{onClick:e[12]||(e[12]=l=>S.value="points"),class:T(["px-3 py-3 text-xs font-semibold whitespace-nowrap",S.value==="points"?"text-teal-700 dark:text-teal-300 bg-teal-50/60 dark:bg-teal-900/10":"text-gray-600 dark:text-gray-300"])}," Titik ("+u(H.value.length)+") ",3),t("button",{onClick:e[13]||(e[13]=l=>S.value="ports"),class:T(["px-3 py-3 text-xs font-semibold whitespace-nowrap",S.value==="ports"?"text-indigo-700 dark:text-indigo-300 bg-indigo-50/60 dark:bg-indigo-900/10":"text-gray-600 dark:text-gray-300"])}," Port ("+u(be.value.length)+") ",3),t("button",{onClick:e[14]||(e[14]=l=>S.value="links"),class:T(["px-3 py-3 text-xs font-semibold whitespace-nowrap",S.value==="links"?"text-amber-700 dark:text-amber-300 bg-amber-50/60 dark:bg-amber-900/10":"text-gray-600 dark:text-gray-300"])}," Sambungan ("+u(Xe.value.length)+") ",3),t("button",{onClick:e[15]||(e[15]=l=>S.value="trace"),class:T(["px-3 py-3 text-xs font-semibold whitespace-nowrap",S.value==="trace"?"text-slate-700 dark:text-slate-200 bg-slate-50/60 dark:bg-slate-700/30":"text-gray-600 dark:text-gray-300"])}," Trace ",2),t("button",{onClick:e[16]||(e[16]=l=>S.value="breaks"),class:T(["px-3 py-3 text-xs font-semibold whitespace-nowrap",S.value==="breaks"?"text-red-700 dark:text-red-300 bg-red-50/60 dark:bg-red-900/10":"text-gray-600 dark:text-gray-300"])}," Putus ("+u(de.value.length)+") ",3)]),t("div",Mr,[ze.value?(i(),n("div",Ur,"Memuat...")):dt.value?(i(),n("div",Ar,u(dt.value),1)):S.value==="cables"?(i(),n("div",jr,[t("div",Gr,[e[110]||(e[110]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Daftar Kabel",-1)),Q.value?(i(),n("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:Wa},"Tambah")):g("",!0)]),t("div",Dr,[m(t("input",{"onUpdate:modelValue":e[17]||(e[17]=l=>E.value=l),class:"input w-full !py-2 !text-xs",placeholder:tt.value},null,8,Rr),[[w,E.value]]),E.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[18]||(e[18]=l=>E.value="")},"Clear")):g("",!0)]),E.value?(i(),n("div",Vr,[e[111]||(e[111]=_(" Hasil: ",-1)),t("span",Br,u(Rt.value.length),1),_(" / "+u(B.value.length),1)])):g("",!0),Rt.value.length===0?(i(),n("div",Kr,u(B.value.length===0?"Belum ada data kabel.":"Tidak ada hasil."),1)):(i(),n("div",Hr,[(i(!0),n(U,null,G(Rt.value,l=>(i(),n("div",{key:l.id,class:T(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-blue-200 dark:hover:border-blue-900/40 cursor-pointer",Number(ge.value)===Number(l.id)?"bg-blue-50/60 dark:bg-blue-900/10":"bg-white dark:bg-dark-800"]),onClick:$=>na(l,{panel:"close"})},[t("div",zr,[t("div",null,[t("div",Xr,u(l.name),1),t("div",Zr,[l.cable_type?(i(),n("span",qr,u(l.cable_type),1)):g("",!0),l.core_count?(i(),n("span",Wr,"| "+u(l.core_count)+" core",1)):g("",!0),l.length_m?(i(),n("span",Yr,"| "+u(jt(l.length_m)),1)):g("",!0)]),l.from_point_id||l.to_point_id?(i(),n("div",Qr,[t("div",null,[e[112]||(e[112]=_("Dari: ",-1)),t("span",es,u(D(l.from_point_id)||"-"),1)]),t("div",null,[e[113]||(e[113]=_("Ke: ",-1)),t("span",ts,u(D(l.to_point_id)||"-"),1)])])):g("",!0)]),t("div",as,[Z.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:ie($=>va(l),["stop"])},"Edit",8,ls)):g("",!0),ue.value?(i(),n("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:ie($=>el(l),["stop"])},"Hapus",8,rs)):g("",!0)])])],10,Jr))),128))]))])):S.value==="points"?(i(),n("div",ss,[t("div",os,[e[114]||(e[114]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Titik Sambungan",-1)),Q.value?(i(),n("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:rl},"Tambah")):g("",!0)]),t("div",ns,[m(t("input",{"onUpdate:modelValue":e[19]||(e[19]=l=>E.value=l),class:"input w-full !py-2 !text-xs",placeholder:tt.value},null,8,is),[[w,E.value]]),E.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[20]||(e[20]=l=>E.value="")},"Clear")):g("",!0)]),E.value?(i(),n("div",us,[e[115]||(e[115]=_(" Hasil: ",-1)),t("span",ds,u(Vt.value.length),1),_(" / "+u(H.value.length),1)])):g("",!0),Vt.value.length===0?(i(),n("div",vs,u(H.value.length===0?"Belum ada data titik.":"Tidak ada hasil."),1)):(i(),n("div",cs,[(i(!0),n(U,null,G(Vt.value,l=>(i(),n("div",{key:l.id,class:T(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-teal-200 dark:hover:border-teal-900/40 cursor-pointer",Number(Y.value)===Number(l.id)?"bg-teal-50/60 dark:bg-teal-900/10":"bg-white dark:bg-dark-800"]),onClick:$=>ia(l,{panel:"close"})},[t("div",bs,[t("div",null,[t("div",gs,u(l.name),1),t("div",fs,[l.point_type?(i(),n("span",ms,u(l.point_type),1)):g("",!0),l.latitude&&l.longitude?(i(),n("span",ks,"| "+u(l.latitude)+", "+u(l.longitude),1)):g("",!0)])]),t("div",ys,[Z.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:ie($=>ga(l),["stop"])},"Edit",8,xs)):g("",!0),ue.value?(i(),n("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:ie($=>nl(l),["stop"])},"Hapus",8,_s)):g("",!0)])])],10,ps))),128))]))])):S.value==="ports"?(i(),n("div",hs,[t("div",ws,[e[116]||(e[116]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Port (OLT/ODP)",-1)),Q.value?(i(),n("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:pl},"Tambah")):g("",!0)]),t("div",Cs,[m(t("input",{"onUpdate:modelValue":e[21]||(e[21]=l=>E.value=l),class:"input w-full !py-2 !text-xs",placeholder:tt.value},null,8,Ns),[[w,E.value]]),E.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[22]||(e[22]=l=>E.value="")},"Clear")):g("",!0)]),E.value?(i(),n("div",Ps,[e[117]||(e[117]=_(" Hasil: ",-1)),t("span",Ts,u(Bt.value.length),1),_(" / "+u(be.value.length),1)])):g("",!0),Bt.value.length===0?(i(),n("div",Ss,u(be.value.length===0?"Belum ada data port.":"Tidak ada hasil."),1)):(i(),n("div",Es,[(i(!0),n(U,null,G(Bt.value,l=>(i(),n("div",{key:l.id,class:"p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-indigo-200 dark:hover:border-indigo-900/40 bg-white dark:bg-dark-800"},[t("div",Ls,[t("div",null,[t("div",$s,u(String(l.port_type||"").toUpperCase()),1),t("div",Os,u(l.port_label||"#"+l.id),1),t("div",Is,[t("div",null,[e[118]||(e[118]=_(" Titik: ",-1)),t("span",Fs,u(D(l.point_id)||"#"+l.point_id),1)]),l.cable_id&&l.core_no?(i(),n("div",Ms,[e[119]||(e[119]=_(" Kabel: ",-1)),t("span",Us,u(z(l.cable_id)||"Kabel #"+l.cable_id),1),t("span",As,"- core "+u(l.core_no),1)])):g("",!0)])]),t("div",js,[Z.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:ie($=>bl(l),["stop"])},"Edit",8,Gs)):g("",!0),ue.value?(i(),n("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:ie($=>fl(l),["stop"])},"Hapus",8,Ds)):g("",!0)])])]))),128))]))])):S.value==="links"?(i(),n("div",Rs,[t("div",Vs,[e[120]||(e[120]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Sambungan (Splice/Split)",-1)),Q.value?(i(),n("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:xl},"Tambah")):g("",!0)]),t("div",Bs,[m(t("input",{"onUpdate:modelValue":e[23]||(e[23]=l=>E.value=l),class:"input w-full !py-2 !text-xs",placeholder:tt.value},null,8,Ks),[[w,E.value]]),E.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[24]||(e[24]=l=>E.value="")},"Clear")):g("",!0)]),E.value?(i(),n("div",Hs,[e[121]||(e[121]=_(" Hasil: ",-1)),t("span",Js,u(Kt.value.length),1),_(" / "+u(wt.value.length),1)])):g("",!0),Kt.value.length===0?(i(),n("div",zs,u(wt.value.length===0?"Belum ada data sambungan.":"Tidak ada hasil."),1)):(i(),n("div",Xs,[(i(!0),n(U,null,G(Kt.value,l=>(i(),n("div",{key:l.kind==="SPLIT_GROUP"?"g:"+l.split_group+":"+l.point_id:"l:"+l.id,class:"p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-amber-200 dark:hover:border-amber-900/40 bg-white dark:bg-dark-800"},[t("div",Zs,[t("div",qs,[t("div",Ws,[_(u(l.kind==="SPLIT_GROUP"?"SPLIT":String(l.link_type||"").toUpperCase())+" ",1),l.kind==="SPLIT_GROUP"?(i(),n("span",Ys,"- "+u((l.outputs||[]).length)+" output",1)):g("",!0)]),t("div",Qs,[e[122]||(e[122]=_(" Titik: ",-1)),t("span",eo,u(D(l.point_id)||"#"+l.point_id),1)]),t("div",to,[_(u(z(l.from_cable_id)||"Kabel #"+l.from_cable_id)+" - core "+u(l.from_core_no)+" ",1),e[123]||(e[123]=t("span",{class:"mx-1 text-gray-400"},"->",-1)),l.kind==="SPLIT_GROUP"?(i(),n("span",ao,"splitter")):(i(),n(U,{key:1},[_(u(z(l.to_cable_id)||"Kabel #"+l.to_cable_id)+" - core "+u(l.to_core_no),1)],64))]),l.kind==="SPLIT_GROUP"&&(l.outputs||[]).length?(i(),n("div",lo,[_(" Output: "+u((l.outputs||[]).slice(0,4).map($=>`${z($.to_cable_id)||"#"+$.to_cable_id}:${$.to_core_no}`).join(", ")),1),(l.outputs||[]).length>4?(i(),n("span",ro,", ...")):g("",!0)])):g("",!0),l.loss_db!==null&&l.loss_db!==void 0&&l.loss_db!==""?(i(),n("div",so,[e[124]||(e[124]=_(" Loss: ",-1)),t("span",oo,u(l.loss_db)+" dB",1)])):g("",!0)]),t("div",no,[Z.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:ie($=>_l(l),["stop"])},"Edit",8,io)):g("",!0),ue.value?(i(),n("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:ie($=>wl(l),["stop"])},"Hapus",8,uo)):g("",!0)])])]))),128))]))])):S.value==="trace"?(i(),n("div",vo,[t("div",co,[e[125]||(e[125]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Tracing End-to-End",-1)),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Nl,disabled:He.value},"Clear",8,po)]),t("div",bo,[t("div",null,[e[127]||(e[127]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Start Port (OLT_PON)",-1)),m(t("select",{"onUpdate:modelValue":e[25]||(e[25]=l=>at.value=l),class:"input w-full"},[e[126]||(e[126]=t("option",{value:""},"(pilih port)",-1)),(i(!0),n(U,null,G(Cl.value,l=>(i(),n("option",{key:l.id,value:l.id},u(D(l.point_id)||"#"+l.point_id)+" | "+u(l.port_label)+" | "+u(z(l.cable_id)||"Kabel #"+l.cable_id)+":"+u(l.core_no),9,go))),128))],512),[[V,at.value]])]),t("div",fo,[t("button",{class:"btn btn-primary !py-2 !text-xs",onClick:Pl,disabled:He.value||!at.value},u(He.value?"Tracing...":"Trace"),9,mo),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:K,disabled:ze.value||He.value},"Refresh Data",8,ko)]),Je.value?(i(),n("div",yo,u(Je.value),1)):g("",!0)]),me.value?(i(),n("div",xo,[t("div",_o,[e[128]||(e[128]=_(" Endpoint: ",-1)),t("span",ho,u((me.value.endpoints||[]).length),1),e[129]||(e[129]=t("span",{class:"mx-2"},"|",-1)),e[130]||(e[130]=_(" Visited: ",-1)),t("span",wo,u(me.value.visited_nodes||0),1),me.value.truncated?(i(),n("span",Co,"(truncated)")):g("",!0)]),(me.value.endpoints||[]).length===0?(i(),n("div",No,[...e[131]||(e[131]=[_(" Tidak ada endpoint ",-1),t("span",{class:"font-mono"},"ODP_OUT",-1),_(" terjangkau dari port ini. ",-1)])])):(i(),n("div",Po,[(i(!0),n(U,null,G(me.value.endpoints||[],(l,$)=>{var W,lt,rt,st,ot,nt,it,wa;return i(),n("div",{key:((W=l.port)==null?void 0:W.id)||$,class:T(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-slate-200 dark:hover:border-slate-700 cursor-pointer",je.value===l?"bg-slate-50/60 dark:bg-slate-700/30":"bg-white dark:bg-dark-800"]),onClick:Ji=>je.value=l},[t("div",So,u(((lt=l.point)==null?void 0:lt.name)||D((rt=l.port)==null?void 0:rt.point_id)||"-"),1),t("div",Eo,[e[132]||(e[132]=_(" Port: ",-1)),t("span",Lo,u(((st=l.port)==null?void 0:st.port_label)||"#"+((ot=l.port)==null?void 0:ot.id)),1),e[133]||(e[133]=t("span",{class:"mx-2"},"|",-1)),_(" "+u(z((nt=l.port)==null?void 0:nt.cable_id)||"Kabel #"+((it=l.port)==null?void 0:it.cable_id))+":"+u((wa=l.port)==null?void 0:wa.core_no),1)])],10,To)}),128))])),(r=je.value)!=null&&r.path?(i(),n("div",$o,[e[135]||(e[135]=t("div",{class:"text-xs font-semibold text-gray-900 dark:text-white"},"Path (ringkas)",-1)),t("div",Oo,[(i(!0),n(U,null,G(je.value.path,(l,$)=>{var W,lt,rt,st,ot,nt,it;return i(),n("div",{key:$,class:"text-xs"},[t("div",Io,[_(u($===0?"START":((W=l.edge)==null?void 0:W.type)==="CABLE"?"KABEL":"LINK "+(((lt=l.edge)==null?void 0:lt.link_type)||""))+" ",1),e[134]||(e[134]=t("span",{class:"mx-1 text-gray-400"},"|",-1)),_(" "+u(((rt=l.point)==null?void 0:rt.name)||"Titik #"+((st=l.node)==null?void 0:st.point_id)),1)]),t("div",Fo,u(((ot=l.cable)==null?void 0:ot.name)||"Kabel #"+((nt=l.node)==null?void 0:nt.cable_id))+" - core "+u((it=l.node)==null?void 0:it.core_no),1)])}),128))])])):g("",!0)])):g("",!0)])):(i(),n("div",Mo,[t("div",Uo,[e[136]||(e[136]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Data Putus",-1)),Q.value?(i(),n("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:il},"Tambah")):g("",!0)]),t("div",Ao,[m(t("input",{"onUpdate:modelValue":e[26]||(e[26]=l=>E.value=l),class:"input w-full !py-2 !text-xs",placeholder:tt.value},null,8,jo),[[w,E.value]]),E.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[27]||(e[27]=l=>E.value="")},"Clear")):g("",!0)]),t("div",Go,[t("button",{class:T(["px-3 py-1.5 rounded-full text-xs font-semibold border transition",ee.value==="ALL"?"bg-slate-900 text-white border-slate-900 dark:bg-white dark:text-slate-900 dark:border-white":"bg-white dark:bg-dark-800 border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[28]||(e[28]=l=>ee.value="ALL")}," Semua ",2),t("button",{class:T(["px-3 py-1.5 rounded-full text-xs font-semibold border transition",ee.value==="OPEN"?"bg-red-50 border-red-200 text-red-700 dark:bg-red-900/10 dark:border-red-900/30 dark:text-red-300":"bg-white dark:bg-dark-800 border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[29]||(e[29]=l=>ee.value="OPEN")}," OPEN ",2),t("button",{class:T(["px-3 py-1.5 rounded-full text-xs font-semibold border transition",ee.value==="IN_PROGRESS"?"bg-amber-50 border-amber-200 text-amber-800 dark:bg-amber-900/10 dark:border-amber-900/30 dark:text-amber-200":"bg-white dark:bg-dark-800 border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[30]||(e[30]=l=>ee.value="IN_PROGRESS")}," IN PROGRESS ",2),t("button",{class:T(["px-3 py-1.5 rounded-full text-xs font-semibold border transition",ee.value==="FIXED"?"bg-emerald-50 border-emerald-200 text-emerald-700 dark:bg-emerald-900/10 dark:border-emerald-900/30 dark:text-emerald-200":"bg-white dark:bg-dark-800 border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[31]||(e[31]=l=>ee.value="FIXED")}," FIXED ",2),t("button",{class:T(["px-3 py-1.5 rounded-full text-xs font-semibold border transition",ee.value==="CANCELLED"?"bg-slate-100 border-slate-200 text-slate-700 dark:bg-slate-700/30 dark:border-white/10 dark:text-slate-200":"bg-white dark:bg-dark-800 border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[32]||(e[32]=l=>ee.value="CANCELLED")}," CANCELLED ",2)]),E.value||ee.value!=="ALL"?(i(),n("div",Do,[e[137]||(e[137]=_(" Hasil: ",-1)),t("span",Ro,u(Ht.value.length),1),_(" / "+u(de.value.length),1)])):g("",!0),Ht.value.length===0?(i(),n("div",Vo,u(de.value.length===0?"Belum ada data putus.":"Tidak ada hasil."),1)):(i(),n("div",Bo,[(i(!0),n(U,null,G(Ht.value,l=>(i(),n("div",{key:l.id,class:T(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-red-200 dark:hover:border-red-900/40 cursor-pointer",Number(fe.value)===Number(l.id)?"bg-red-50/60 dark:bg-red-900/10":"bg-white dark:bg-dark-800"]),onClick:$=>ua(l,{panel:"close"})},[t("div",Ho,[t("div",null,[t("div",Jo,u(la(l.status)),1),t("div",zo,u(z(l.cable_id)||(l.cable_id?"Kabel #"+l.cable_id:"Tanpa kabel")),1),t("div",Xo,[t("span",null,"Titik: "+u(D(l.point_id)||"-"),1),l.severity?(i(),n("span",Zo,"| "+u(l.severity),1)):g("",!0)]),l.description?(i(),n("div",qo,u(l.description),1)):g("",!0)]),t("div",Wo,[Q.value&&Z.value&&["OPEN","IN_PROGRESS"].includes(String(l.status||"OPEN").toUpperCase())?(i(),n("button",{key:0,class:"btn btn-primary !py-1 !px-2 !text-xs",disabled:ka(l.id),onClick:ie($=>cl(l),["stop"])},u(ka(l.id)?"Memproses...":"Selesaikan"),9,Yo)):g("",!0),Z.value?(i(),n("button",{key:1,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:ie($=>ma(l),["stop"])},"Edit",8,Qo)):g("",!0),ue.value?(i(),n("button",{key:2,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:ie($=>vl(l),["stop"])},"Hapus",8,en)):g("",!0)])])],10,Ko))),128))]))]))])],2)])])):(i(),n("div",Hl,[...e[99]||(e[99]=[t("div",{class:"text-gray-900 dark:text-white font-semibold"},"Tidak punya akses",-1),t("div",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},[_(" Butuh permission "),t("code",{class:"px-1 py-0.5 bg-gray-100 dark:bg-dark-700 rounded"},"view fiber"),_(". ")],-1)])]))]),X.value?(i(),n("div",{key:0,class:T(["fixed inset-0 z-[10000] flex items-center justify-center p-4",N.value?"pointer-events-none":""])},[t("div",{class:T(["absolute inset-0 bg-black/40",N.value?"pointer-events-none opacity-20":""]),onClick:e[33]||(e[33]=l=>{X.value=!1,A()})},null,2),t("div",tn,[t("div",an,[t("div",ln,u(Ke.value==="edit"?"Edit Kabel":"Tambah Kabel"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[34]||(e[34]=l=>{X.value=!1,A()})},"Tutup")]),t("div",rn,[t("div",sn,[t("div",null,[e[138]||(e[138]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Nama",-1)),m(t("input",{"onUpdate:modelValue":e[35]||(e[35]=l=>c.value.name=l),class:"input w-full",placeholder:"Feeder ODC-POP A"},null,512),[[w,c.value.name]]),se.value.name?(i(),n("div",on,u((s=se.value.name)==null?void 0:s[0]),1)):g("",!0)]),t("div",null,[e[139]||(e[139]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kode (opsional)",-1)),m(t("input",{"onUpdate:modelValue":e[36]||(e[36]=l=>c.value.code=l),class:"input w-full",placeholder:"FO-001"},null,512),[[w,c.value.code]]),se.value.code?(i(),n("div",nn,u((o=se.value.code)==null?void 0:o[0]),1)):g("",!0)]),t("div",null,[e[140]||(e[140]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),m(t("input",{"onUpdate:modelValue":e[37]||(e[37]=l=>c.value.cable_type=l),class:"input w-full",placeholder:"FEEDER / DISTRIBUTION / DROP"},null,512),[[w,c.value.cable_type]]),se.value.cable_type?(i(),n("div",un,u((v=se.value.cable_type)==null?void 0:v[0]),1)):g("",!0)]),t("div",null,[e[141]||(e[141]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Core",-1)),m(t("input",{"onUpdate:modelValue":e[38]||(e[38]=l=>c.value.core_count=l),type:"number",min:"1",class:"input w-full",placeholder:"12"},null,512),[[w,c.value.core_count]]),se.value.core_count?(i(),n("div",dn,u((p=se.value.core_count)==null?void 0:p[0]),1)):g("",!0)]),t("div",vn,[e[143]||(e[143]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Panjang (meter)",-1)),t("div",cn,[m(t("input",{"onUpdate:modelValue":e[39]||(e[39]=l=>c.value.length_m=l),type:"number",min:"0",class:"input w-full sm:flex-1",placeholder:"(opsional)",onInput:e[40]||(e[40]=l=>Se.value=!1)},null,544),[[w,c.value.length_m]]),t("button",{class:"btn btn-secondary shrink-0 !py-2 !text-xs",onClick:ll},"Hitung dari jalur")]),t("div",pn,[e[142]||(e[142]=_(" Estimasi dari jalur: ",-1)),t("span",bn,u(jt(Gt.value)),1),t("span",gn,"("+u(Gt.value)+" m)",1),Se.value?(i(),n("span",fn,"[auto]")):g("",!0)])]),t("div",null,[e[145]||(e[145]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Dari Titik",-1)),m(t("select",{"onUpdate:modelValue":e[41]||(e[41]=l=>c.value.from_point_id=l),class:"input w-full"},[e[144]||(e[144]=t("option",{value:""},"(kosong)",-1)),(i(!0),n(U,null,G(H.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,mn))),128))],512),[[V,c.value.from_point_id]])]),t("div",null,[e[147]||(e[147]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Ke Titik",-1)),m(t("select",{"onUpdate:modelValue":e[42]||(e[42]=l=>c.value.to_point_id=l),class:"input w-full"},[e[146]||(e[146]=t("option",{value:""},"(kosong)",-1)),(i(!0),n(U,null,G(H.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,kn))),128))],512),[[V,c.value.to_point_id]])]),t("div",yn,[e[148]||(e[148]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Warna Jalur",-1)),t("div",xn,[m(t("input",{"onUpdate:modelValue":e[43]||(e[43]=l=>c.value.map_color=l),type:"color",class:"h-10 w-14 rounded border border-gray-200 dark:border-dark-700 bg-transparent"},null,512),[[w,c.value.map_color]]),m(t("input",{"onUpdate:modelValue":e[44]||(e[44]=l=>c.value.map_color=l),class:"input flex-1",placeholder:"#2563eb"},null,512),[[w,c.value.map_color]])])]),t("div",_n,[e[149]||(e[149]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),m(t("textarea",{"onUpdate:modelValue":e[45]||(e[45]=l=>c.value.notes=l),class:"input w-full min-h-[80px]",placeholder:"Keterangan kabel..."},null,512),[[w,c.value.notes]])])]),t("div",hn,[t("div",wn,[t("div",null,[e[150]||(e[150]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Jalur di Peta",-1)),t("div",Cn,"Titik: "+u(Array.isArray(c.value.path)?c.value.path.length:0),1)]),t("div",Nn,[t("label",Pn,[m(t("input",{type:"checkbox","onUpdate:modelValue":e[46]||(e[46]=l=>ae.value=l)},null,512),[[Pa,ae.value]]),e[151]||(e[151]=_(" Ikuti jalan ",-1))]),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:e[47]||(e[47]=l=>ca({force:!0})),disabled:!c.value.from_point_id||!c.value.to_point_id}," Auto ",8,Tn),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:tl},"Gambar"),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:al,disabled:!c.value.path||c.value.path.length<2},"Edit",8,Sn),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:pa,disabled:!c.value.path||c.value.path.length===0},"Undo",8,En),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Dt,disabled:!c.value.path||c.value.path.length===0},"Clear",8,Ln)])]),e[152]||(e[152]=t("div",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},[_(" Tips: mode "),t("span",{class:"font-semibold"},"Ikuti jalan"),_(" memakai Google Directions. Jika gagal/limit, otomatis fallback ke garis lurus. Jalur bisa dirapikan lewat tombol "),t("span",{class:"font-semibold"},"Edit"),_(". ")],-1))])]),t("div",$n,[t("button",{class:"btn btn-secondary",onClick:e[48]||(e[48]=l=>{X.value=!1,A()})},"Batal"),t("button",{class:"btn btn-primary",disabled:bt.value,onClick:Qa},u(bt.value?"Menyimpan...":"Simpan"),9,On)])])],2)):g("",!0),oe.value?(i(),n("div",{key:1,class:T(["fixed inset-0 z-[10000] flex items-center justify-center p-4",N.value?"pointer-events-none":""])},[t("div",{class:T(["absolute inset-0 bg-black/40",N.value?"pointer-events-none opacity-20":""]),onClick:e[49]||(e[49]=l=>{oe.value=!1,A()})},null,2),t("div",In,[t("div",Fn,[t("div",Mn,u(gt.value==="edit"?"Edit Titik":"Tambah Titik"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[50]||(e[50]=l=>{oe.value=!1,A()})},"Tutup")]),t("div",Un,[t("div",null,[e[153]||(e[153]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Nama",-1)),m(t("input",{"onUpdate:modelValue":e[51]||(e[51]=l=>h.value.name=l),class:"input w-full",placeholder:"ODP-01 / Joint A"},null,512),[[w,h.value.name]]),xe.value.name?(i(),n("div",An,u((d=xe.value.name)==null?void 0:d[0]),1)):g("",!0)]),t("div",null,[e[154]||(e[154]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),m(t("input",{"onUpdate:modelValue":e[52]||(e[52]=l=>h.value.point_type=l),class:"input w-full",placeholder:"ODP / ODC / JOINT / HANDHOLE"},null,512),[[w,h.value.point_type]])]),t("div",jn,[t("div",null,[e[155]||(e[155]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Latitude",-1)),m(t("input",{"onUpdate:modelValue":e[53]||(e[53]=l=>h.value.latitude=l),class:"input w-full",placeholder:"-6.2"},null,512),[[w,h.value.latitude]]),xe.value.latitude?(i(),n("div",Gn,u((y=xe.value.latitude)==null?void 0:y[0]),1)):g("",!0)]),t("div",null,[e[156]||(e[156]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Longitude",-1)),m(t("input",{"onUpdate:modelValue":e[54]||(e[54]=l=>h.value.longitude=l),class:"input w-full",placeholder:"106.8"},null,512),[[w,h.value.longitude]]),xe.value.longitude?(i(),n("div",Dn,u((P=xe.value.longitude)==null?void 0:P[0]),1)):g("",!0)])]),t("div",Rn,[t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:sl},"Pilih dari peta"),h.value.latitude&&h.value.longitude?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[55]||(e[55]=l=>ve(Number(h.value.latitude),Number(h.value.longitude),18))},"Zoom")):g("",!0)]),t("div",null,[e[157]||(e[157]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Alamat",-1)),m(t("input",{"onUpdate:modelValue":e[56]||(e[56]=l=>h.value.address=l),class:"input w-full",placeholder:"(opsional)"},null,512),[[w,h.value.address]])]),t("div",null,[e[158]||(e[158]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),m(t("textarea",{"onUpdate:modelValue":e[57]||(e[57]=l=>h.value.notes=l),class:"input w-full min-h-[80px]",placeholder:"(opsional)"},null,512),[[w,h.value.notes]])])]),t("div",Vn,[t("button",{class:"btn btn-secondary",onClick:e[58]||(e[58]=l=>{oe.value=!1,A()})},"Batal"),t("button",{class:"btn btn-primary",disabled:ft.value,onClick:ol},u(ft.value?"Menyimpan...":"Simpan"),9,Bn)])])],2)):g("",!0),ne.value?(i(),n("div",{key:2,class:T(["fixed inset-0 z-[10000] flex items-center justify-center p-4",N.value?"pointer-events-none":""])},[t("div",{class:T(["absolute inset-0 bg-black/40",N.value?"pointer-events-none opacity-20":""]),onClick:e[59]||(e[59]=l=>{ne.value=!1,A()})},null,2),t("div",Kn,[t("div",Hn,[t("div",Jn,u(mt.value==="edit"?"Edit Data Putus":"Tambah Data Putus"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[60]||(e[60]=l=>{ne.value=!1,A()})},"Tutup")]),t("div",zn,[t("div",null,[e[160]||(e[160]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kabel",-1)),m(t("select",{"onUpdate:modelValue":e[61]||(e[61]=l=>x.value.cable_id=l),class:"input w-full"},[e[159]||(e[159]=t("option",{value:""},"(kosong)",-1)),(i(!0),n(U,null,G(B.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,Xn))),128))],512),[[V,x.value.cable_id]])]),t("div",null,[e[162]||(e[162]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik (opsional)",-1)),m(t("select",{"onUpdate:modelValue":e[62]||(e[62]=l=>x.value.point_id=l),class:"input w-full"},[e[161]||(e[161]=t("option",{value:""},"(kosong)",-1)),(i(!0),n(U,null,G(H.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,Zn))),128))],512),[[V,x.value.point_id]])]),t("div",qn,[t("div",null,[e[164]||(e[164]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Status",-1)),m(t("select",{"onUpdate:modelValue":e[63]||(e[63]=l=>x.value.status=l),class:"input w-full"},[...e[163]||(e[163]=[t("option",{value:"OPEN"},"OPEN",-1),t("option",{value:"IN_PROGRESS"},"IN_PROGRESS",-1),t("option",{value:"FIXED"},"FIXED",-1),t("option",{value:"CANCELLED"},"CANCELLED",-1)])],512),[[V,x.value.status]])]),t("div",null,[e[166]||(e[166]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Severity",-1)),m(t("select",{"onUpdate:modelValue":e[64]||(e[64]=l=>x.value.severity=l),class:"input w-full"},[...e[165]||(e[165]=[t("option",{value:""},"(kosong)",-1),t("option",{value:"MINOR"},"MINOR",-1),t("option",{value:"MAJOR"},"MAJOR",-1),t("option",{value:"CRITICAL"},"CRITICAL",-1)])],512),[[V,x.value.severity]])])]),t("div",Wn,[t("div",null,[e[167]||(e[167]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Dilaporkan",-1)),m(t("input",{"onUpdate:modelValue":e[65]||(e[65]=l=>x.value.reported_at=l),type:"datetime-local",class:"input w-full"},null,512),[[w,x.value.reported_at]])]),t("div",null,[e[168]||(e[168]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Fixed At",-1)),m(t("input",{"onUpdate:modelValue":e[66]||(e[66]=l=>x.value.fixed_at=l),type:"datetime-local",class:"input w-full",disabled:String(x.value.status).toUpperCase()!=="FIXED"},null,8,Yn),[[w,x.value.fixed_at]])])]),t("div",Qn,[t("div",null,[e[169]||(e[169]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Latitude",-1)),m(t("input",{"onUpdate:modelValue":e[67]||(e[67]=l=>x.value.latitude=l),class:"input w-full",placeholder:"-6.2"},null,512),[[w,x.value.latitude]]),Me.value.latitude?(i(),n("div",ei,u((F=Me.value.latitude)==null?void 0:F[0]),1)):g("",!0)]),t("div",null,[e[170]||(e[170]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Longitude",-1)),m(t("input",{"onUpdate:modelValue":e[68]||(e[68]=l=>x.value.longitude=l),class:"input w-full",placeholder:"106.8"},null,512),[[w,x.value.longitude]]),Me.value.longitude?(i(),n("div",ti,u((j=Me.value.longitude)==null?void 0:j[0]),1)):g("",!0)])]),t("div",ai,[t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:ul},"Pilih dari peta"),x.value.latitude&&x.value.longitude?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[69]||(e[69]=l=>ve(Number(x.value.latitude),Number(x.value.longitude),18))},"Zoom")):g("",!0)]),t("div",null,[e[171]||(e[171]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),m(t("textarea",{"onUpdate:modelValue":e[70]||(e[70]=l=>x.value.description=l),class:"input w-full min-h-[90px]",placeholder:"Keterangan kejadian putus..."},null,512),[[w,x.value.description]])])]),t("div",li,[t("button",{class:"btn btn-secondary",onClick:e[71]||(e[71]=l=>{ne.value=!1,A()})},"Batal"),t("button",{class:"btn btn-primary",disabled:kt.value,onClick:dl},u(kt.value?"Menyimpan...":"Simpan"),9,ri)])])],2)):g("",!0),Ue.value?(i(),n("div",si,[t("div",{class:"absolute inset-0 bg-black/40",onClick:e[72]||(e[72]=l=>Ue.value=!1)}),t("div",oi,[t("div",ni,[t("div",ii,u(yt.value==="edit"?"Edit Port":"Tambah Port"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[73]||(e[73]=l=>Ue.value=!1)},"Tutup")]),t("div",ui,[t("div",null,[e[173]||(e[173]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik",-1)),m(t("select",{"onUpdate:modelValue":e[74]||(e[74]=l=>O.value.point_id=l),class:"input w-full"},[e[172]||(e[172]=t("option",{value:""},"(pilih titik)",-1)),(i(!0),n(U,null,G(H.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,di))),128))],512),[[V,O.value.point_id]]),Ae.value.point_id?(i(),n("div",vi,u((M=Ae.value.point_id)==null?void 0:M[0]),1)):g("",!0)]),t("div",ci,[t("div",null,[e[175]||(e[175]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),m(t("select",{"onUpdate:modelValue":e[75]||(e[75]=l=>O.value.port_type=l),class:"input w-full"},[...e[174]||(e[174]=[t("option",{value:"OLT_PON"},"OLT_PON",-1),t("option",{value:"ODP_OUT"},"ODP_OUT",-1)])],512),[[V,O.value.port_type]])]),t("div",null,[e[176]||(e[176]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Label",-1)),m(t("input",{"onUpdate:modelValue":e[76]||(e[76]=l=>O.value.port_label=l),class:"input w-full",placeholder:"PON 1/1/1 / OUT 1"},null,512),[[w,O.value.port_label]]),Ae.value.port_label?(i(),n("div",pi,u((he=Ae.value.port_label)==null?void 0:he[0]),1)):g("",!0)])]),t("div",bi,[t("div",null,[e[178]||(e[178]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kabel",-1)),m(t("select",{"onUpdate:modelValue":e[77]||(e[77]=l=>O.value.cable_id=l),class:"input w-full"},[e[177]||(e[177]=t("option",{value:""},"(pilih kabel)",-1)),(i(!0),n(U,null,G(B.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,gi))),128))],512),[[V,O.value.cable_id]])]),t("div",null,[e[179]||(e[179]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Core",-1)),m(t("input",{"onUpdate:modelValue":e[78]||(e[78]=l=>O.value.core_no=l),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[w,O.value.core_no]])])]),t("div",null,[e[180]||(e[180]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),m(t("textarea",{"onUpdate:modelValue":e[79]||(e[79]=l=>O.value.notes=l),class:"input w-full min-h-[90px]",placeholder:"(opsional)"},null,512),[[w,O.value.notes]])])]),t("div",fi,[t("button",{class:"btn btn-secondary",onClick:e[80]||(e[80]=l=>Ue.value=!1)},"Batal"),t("button",{class:"btn btn-primary",disabled:xt.value,onClick:gl},u(xt.value?"Menyimpan...":"Simpan"),9,mi)])])])):g("",!0),Le.value?(i(),n("div",ki,[t("div",{class:"absolute inset-0 bg-black/40",onClick:e[81]||(e[81]=l=>Le.value=!1)}),t("div",yi,[t("div",xi,[t("div",_i,u(_t.value==="edit"?"Edit Sambungan":"Tambah Sambungan"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[82]||(e[82]=l=>Le.value=!1)},"Tutup")]),t("div",hi,[t("div",null,[e[182]||(e[182]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik",-1)),m(t("select",{"onUpdate:modelValue":e[83]||(e[83]=l=>k.value.point_id=l),class:"input w-full"},[e[181]||(e[181]=t("option",{value:""},"(pilih titik)",-1)),(i(!0),n(U,null,G(H.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,wi))),128))],512),[[V,k.value.point_id]]),_e.value.point_id?(i(),n("div",Ci,u((R=_e.value.point_id)==null?void 0:R[0]),1)):g("",!0)]),t("div",Ni,[t("div",null,[e[184]||(e[184]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),m(t("select",{"onUpdate:modelValue":e[84]||(e[84]=l=>k.value.link_type=l),class:"input w-full"},[...e[183]||(e[183]=[t("option",{value:"SPLICE"},"SPLICE",-1),t("option",{value:"PATCH"},"PATCH",-1),t("option",{value:"SPLIT"},"SPLIT",-1)])],512),[[V,k.value.link_type]])]),t("div",null,[e[185]||(e[185]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Loss (dB)",-1)),m(t("input",{"onUpdate:modelValue":e[85]||(e[85]=l=>k.value.loss_db=l),class:"input w-full",placeholder:"0.20"},null,512),[[w,k.value.loss_db]])])]),t("div",Pi,[t("div",null,[e[187]||(e[187]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"From Cable",-1)),m(t("select",{"onUpdate:modelValue":e[86]||(e[86]=l=>k.value.from_cable_id=l),class:"input w-full"},[e[186]||(e[186]=t("option",{value:""},"(pilih kabel)",-1)),(i(!0),n(U,null,G(B.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,Ti))),128))],512),[[V,k.value.from_cable_id]]),_e.value.from_cable_id?(i(),n("div",Si,u((_a=_e.value.from_cable_id)==null?void 0:_a[0]),1)):g("",!0)]),t("div",null,[e[188]||(e[188]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"From Core",-1)),m(t("input",{"onUpdate:modelValue":e[87]||(e[87]=l=>k.value.from_core_no=l),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[w,k.value.from_core_no]]),_e.value.from_core_no?(i(),n("div",Ei,u((ha=_e.value.from_core_no)==null?void 0:ha[0]),1)):g("",!0)])]),String(k.value.link_type).toUpperCase()!=="SPLIT"?(i(),n("div",Li,[t("div",null,[e[190]||(e[190]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"To Cable",-1)),m(t("select",{"onUpdate:modelValue":e[88]||(e[88]=l=>k.value.to_cable_id=l),class:"input w-full"},[e[189]||(e[189]=t("option",{value:""},"(pilih kabel)",-1)),(i(!0),n(U,null,G(B.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,$i))),128))],512),[[V,k.value.to_cable_id]])]),t("div",null,[e[191]||(e[191]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"To Core",-1)),m(t("input",{"onUpdate:modelValue":e[89]||(e[89]=l=>k.value.to_core_no=l),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[w,k.value.to_core_no]])])])):(i(),n("div",Oi,[t("div",Ii,[t("div",null,[e[192]||(e[192]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Splitter Group (opsional)",-1)),m(t("input",{"onUpdate:modelValue":e[90]||(e[90]=l=>k.value.split_group=l),class:"input w-full",placeholder:"ODP-01 1:8"},null,512),[[w,k.value.split_group]])]),t("div",null,[e[193]||(e[193]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Jumlah Output",-1)),t("div",Fi,[m(t("input",{"onUpdate:modelValue":e[91]||(e[91]=l=>Qe.value=l),type:"number",min:"1",max:"64",class:"input w-full"},null,512),[[w,Qe.value]]),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:e[92]||(e[92]=l=>ml(Qe.value))},"Buat"),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:kl},"Tambah")])])]),(k.value.outputs||[]).length===0?(i(),n("div",Mi,[...e[194]||(e[194]=[_(" Output masih kosong. Klik ",-1),t("span",{class:"font-semibold"},"Buat",-1),_(" untuk generate baris output. ",-1)])])):(i(),n("div",Ui,[(i(!0),n(U,null,G(k.value.outputs,(l,$)=>(i(),n("div",{key:$,class:"grid grid-cols-12 gap-2 items-center"},[t("div",Ai,[m(t("select",{"onUpdate:modelValue":W=>l.to_cable_id=W,class:"input w-full"},[e[195]||(e[195]=t("option",{value:""},"(kabel output)",-1)),(i(!0),n(U,null,G(B.value,W=>(i(),n("option",{key:W.id,value:W.id},u(W.name),9,Gi))),128))],8,ji),[[V,l.to_cable_id]])]),t("div",Di,[m(t("input",{"onUpdate:modelValue":W=>l.to_core_no=W,type:"number",min:"1",class:"input w-full",placeholder:"core"},null,8,Ri),[[w,l.to_core_no]])]),t("div",Vi,[t("button",{class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:W=>yl($)},"Hapus",8,Bi)])]))),128))]))])),t("div",null,[e[196]||(e[196]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),m(t("textarea",{"onUpdate:modelValue":e[93]||(e[93]=l=>k.value.notes=l),class:"input w-full min-h-[90px]",placeholder:"(opsional)"},null,512),[[w,k.value.notes]])])]),t("div",Ki,[t("button",{class:"btn btn-secondary",onClick:e[94]||(e[94]=l=>Le.value=!1)},"Batal"),t("button",{class:"btn btn-primary",disabled:ht.value,onClick:hl},u(ht.value?"Menyimpan...":"Simpan"),9,Hi)])])])):g("",!0)]}),_:1})],64))}};export{Zi as default};
