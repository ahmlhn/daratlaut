import{o as M,c as n,a as A,u as F,h as G,m as J,b as e,t as l,f as v,q as W,v as b,j as r,F as _,s as k,x as $,e as C,n as j,d as D,r as c}from"./app-hPBQb67R.js";import{_ as R}from"./AdminLayout-DYq9Z4Xx.js";const q={class:"p-6"},z={class:"flex justify-between items-center mb-6"},Y={class:"grid grid-cols-2 md:grid-cols-6 gap-4 mb-6"},Q={class:"card p-4 text-center"},X={class:"text-2xl font-bold"},Z={class:"card p-4 text-center"},tt={class:"text-2xl font-bold text-blue-600"},et={class:"card p-4 text-center"},st={class:"text-2xl font-bold text-yellow-600"},at={class:"card p-4 text-center"},ot={class:"text-2xl font-bold text-purple-600"},lt={class:"card p-4 text-center"},nt={class:"text-2xl font-bold text-green-600"},rt={class:"card p-4 text-center"},ut={class:"text-2xl font-bold text-gray-600"},it={class:"flex flex-wrap gap-3 mb-4"},dt=["value"],ct={class:"card overflow-hidden"},pt={class:"min-w-full text-sm"},mt={key:0},vt={key:1},xt={class:"px-4 py-3 font-medium"},gt={class:"px-4 py-3"},ft=["href"],bt={class:"px-4 py-3 max-w-xs truncate"},yt={class:"px-4 py-3"},_t={class:"px-4 py-3 text-gray-500"},ht={class:"px-4 py-3"},wt={class:"flex gap-1"},kt=["onClick"],Ct=["onClick"],Et=["onClick"],St={key:0,class:"flex justify-center gap-2 mt-4"},Lt=["onClick"],Nt={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Tt={class:"bg-white rounded-lg shadow-xl w-full max-w-lg mx-4"},At={class:"p-4 border-b"},$t={class:"text-lg font-semibold"},jt={class:"p-4 space-y-4"},Dt={class:"grid grid-cols-2 gap-4"},Vt=["value"],Pt={class:"p-4 border-t flex justify-end gap-3"},N="noci_leads_page_cache_v1",Ut=10*60*1e3,x="/api/v1/leads",Bt={__name:"Index",setup(Ot){const g=c([]),d=c({total:0,new:0,contacted:0,interested:0,converted:0,lost:0}),E=c(!1),p=c({total:0,per_page:20,current_page:1,last_page:1}),i=c({search:"",status:""}),f=c({}),h=c(!1),y=c(null),o=c({customer_name:"",customer_phone:"",customer_address:"",notes:"",status:"NEW",source:""});function S(){try{const a={cachedAt:Date.now(),leads:Array.isArray(g.value)?g.value:[],stats:d.value||{},pagination:p.value||{},filters:i.value||{},statuses:f.value||{}};sessionStorage.setItem(N,JSON.stringify(a))}catch{}}function V(){try{const a=sessionStorage.getItem(N);if(!a)return!1;const t=JSON.parse(a),s=Number((t==null?void 0:t.cachedAt)||0);return!s||Date.now()-s>Ut?(sessionStorage.removeItem(N),!1):(Array.isArray(t==null?void 0:t.leads)&&(g.value=t.leads),t!=null&&t.stats&&typeof t.stats=="object"&&(d.value=t.stats),t!=null&&t.pagination&&typeof t.pagination=="object"&&(p.value={total:Number(t.pagination.total||0),per_page:Number(t.pagination.per_page||20),current_page:Number(t.pagination.current_page||1),last_page:Number(t.pagination.last_page||1)}),t!=null&&t.filters&&typeof t.filters=="object"&&(i.value={search:String(t.filters.search||""),status:String(t.filters.status||"")}),t!=null&&t.statuses&&typeof t.statuses=="object"&&(f.value=t.statuses),!0)}catch{return!1}}async function m(a={}){const t=!!(a&&typeof a=="object"&&a.silent===!0);t||(E.value=!0);try{const s=new URLSearchParams;i.value.search&&s.append("search",i.value.search),i.value.status&&s.append("status",i.value.status),s.append("page",p.value.current_page);const L=await(await fetch(`${x}?${s}`)).json();L.status==="ok"&&(g.value=L.data,p.value=L.pagination,S())}catch(s){console.error("Failed to load leads:",s)}t||(E.value=!1)}async function w(){try{const t=await(await fetch(`${x}/stats`)).json();t.status==="ok"&&(d.value=t.data,S())}catch(a){console.error("Failed to load stats:",a)}}async function P(){try{const t=await(await fetch(`${x}/statuses`)).json();t.status==="ok"&&(f.value=t.data,S())}catch(a){console.error("Failed to load statuses:",a)}}function T(a=null){y.value=a,a?o.value={customer_name:a.customer_name,customer_phone:a.customer_phone,customer_address:a.customer_address||"",notes:a.notes||"",status:a.status,source:a.source||""}:o.value={customer_name:"",customer_phone:"",customer_address:"",notes:"",status:"NEW",source:"manual"},h.value=!0}async function U(){try{const a=y.value?`${x}/${y.value.id}`:x,t=y.value?"PUT":"POST",u=await(await fetch(a,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(o.value)})).json();u.status==="ok"?(h.value=!1,await m(),await w()):alert(u.message||"Gagal menyimpan")}catch(a){alert("Error: "+a.message)}}async function O(a){if(confirm(`Hapus lead "${a.customer_name}"?`))try{const s=await(await fetch(`${x}/${a.id}`,{method:"DELETE"})).json();s.status==="ok"?(await m(),await w()):alert(s.message||"Gagal menghapus")}catch(t){alert("Error: "+t.message)}}async function H(a){if(confirm(`Konversi "${a.customer_name}" ke pasang baru?`))try{const s=await(await fetch(`${x}/${a.id}/convert`,{method:"POST"})).json();s.status==="ok"?(alert("Lead berhasil dikonversi ke pasang baru"),await m(),await w()):alert(s.message||"Gagal mengkonversi")}catch(t){alert("Error: "+t.message)}}function I(a){return{NEW:"bg-blue-100 text-blue-800",CONTACTED:"bg-yellow-100 text-yellow-800",INTERESTED:"bg-purple-100 text-purple-800",CONVERTED:"bg-green-100 text-green-800",LOST:"bg-gray-100 text-gray-800"}[a]||"bg-gray-100 text-gray-800"}function B(a){return f.value[a]||a}function K(a){return a?new Date(a).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}return M(()=>{const a=V();P(),w(),m({silent:a})}),(a,t)=>(r(),n(_,null,[A(F(G),{title:"Leads"}),A(R,null,{default:J(()=>[e("div",q,[e("div",z,[t[10]||(t[10]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-800"},"Leads"),e("p",{class:"text-gray-600"},"Kelola prospek calon pelanggan")],-1)),e("button",{onClick:t[0]||(t[0]=s=>T()),class:"btn btn-primary"},"+ Tambah Lead")]),e("div",Y,[e("div",Q,[e("div",X,l(d.value.total),1),t[11]||(t[11]=e("div",{class:"text-sm text-gray-500"},"Total",-1))]),e("div",Z,[e("div",tt,l(d.value.new),1),t[12]||(t[12]=e("div",{class:"text-sm text-gray-500"},"Baru",-1))]),e("div",et,[e("div",st,l(d.value.contacted),1),t[13]||(t[13]=e("div",{class:"text-sm text-gray-500"},"Dihubungi",-1))]),e("div",at,[e("div",ot,l(d.value.interested),1),t[14]||(t[14]=e("div",{class:"text-sm text-gray-500"},"Tertarik",-1))]),e("div",lt,[e("div",nt,l(d.value.converted),1),t[15]||(t[15]=e("div",{class:"text-sm text-gray-500"},"Jadi",-1))]),e("div",rt,[e("div",ut,l(d.value.lost),1),t[16]||(t[16]=e("div",{class:"text-sm text-gray-500"},"Tidak Jadi",-1))])]),e("div",it,[v(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>i.value.search=s),type:"text",placeholder:"Cari nama/HP...",class:"input flex-1",onKeyup:W(m,["enter"])},null,544),[[b,i.value.search]]),v(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>i.value.status=s),class:"input",onChange:m},[t[17]||(t[17]=e("option",{value:""},"Semua Status",-1)),(r(!0),n(_,null,k(f.value,(s,u)=>(r(),n("option",{key:u,value:u},l(s),9,dt))),128))],544),[[$,i.value.status]]),e("button",{onClick:m,class:"btn bg-gray-100"},"Cari")]),e("div",ct,[e("table",pt,[t[20]||(t[20]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left"},"Nama"),e("th",{class:"px-4 py-3 text-left"},"No. HP"),e("th",{class:"px-4 py-3 text-left"},"Alamat"),e("th",{class:"px-4 py-3 text-left"},"Status"),e("th",{class:"px-4 py-3 text-left"},"Terakhir Aktif"),e("th",{class:"px-4 py-3 text-left"},"Aksi")])],-1)),e("tbody",null,[E.value?(r(),n("tr",mt,[...t[18]||(t[18]=[e("td",{colspan:"6",class:"text-center py-8 text-gray-500"},"Loading...",-1)])])):g.value.length===0?(r(),n("tr",vt,[...t[19]||(t[19]=[e("td",{colspan:"6",class:"text-center py-8 text-gray-500"},"Tidak ada data",-1)])])):C("",!0),(r(!0),n(_,null,k(g.value,s=>(r(),n("tr",{key:s.id,class:"border-b hover:bg-gray-50"},[e("td",xt,l(s.customer_name),1),e("td",gt,[e("a",{href:"https://wa.me/"+s.customer_phone,target:"_blank",class:"text-green-600 hover:underline"},l(s.customer_phone),9,ft)]),e("td",bt,l(s.customer_address||"-"),1),e("td",yt,[e("span",{class:j(["px-2 py-1 rounded text-xs font-medium",I(s.status)])},l(B(s.status)),3)]),e("td",_t,l(K(s.last_seen)),1),e("td",ht,[e("div",wt,[e("button",{onClick:u=>T(s),class:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200"}," Edit ",8,kt),s.status!=="CONVERTED"?(r(),n("button",{key:0,onClick:u=>H(s),class:"text-xs px-2 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200"}," Konversi ",8,Ct)):C("",!0),e("button",{onClick:u=>O(s),class:"text-xs px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200"}," Hapus ",8,Et)])])]))),128))])])]),p.value.last_page>1?(r(),n("div",St,[(r(!0),n(_,null,k(p.value.last_page,s=>(r(),n("button",{key:s,onClick:u=>{p.value.current_page=s,m()},class:j(["px-3 py-1 rounded",s===p.value.current_page?"bg-primary-500 text-white":"bg-gray-100 hover:bg-gray-200"])},l(s),11,Lt))),128))])):C("",!0)]),h.value?(r(),n("div",Nt,[e("div",Tt,[e("div",At,[e("h3",$t,l(y.value?"Edit Lead":"Tambah Lead"),1)]),e("div",jt,[e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium mb-1"},[D("Nama "),e("span",{class:"text-red-500"},"*")],-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.customer_name=s),type:"text",class:"input w-full",required:""},null,512),[[b,o.value.customer_name]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium mb-1"},[D("No. HP "),e("span",{class:"text-red-500"},"*")],-1)),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.customer_phone=s),type:"text",class:"input w-full",placeholder:"08xx...",required:""},null,512),[[b,o.value.customer_phone]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium mb-1"},"Alamat",-1)),v(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.customer_address=s),class:"input w-full",rows:"2"},null,512),[[b,o.value.customer_address]])]),e("div",Dt,[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium mb-1"},"Status",-1)),v(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.value.status=s),class:"input w-full"},[(r(!0),n(_,null,k(f.value,(s,u)=>(r(),n("option",{key:u,value:u},l(s),9,Vt))),128))],512),[[$,o.value.status]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium mb-1"},"Sumber",-1)),v(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.value.source=s),type:"text",class:"input w-full",placeholder:"WA, Website, dll"},null,512),[[b,o.value.source]])])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium mb-1"},"Catatan",-1)),v(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=s=>o.value.notes=s),class:"input w-full",rows:"3"},null,512),[[b,o.value.notes]])])]),e("div",Pt,[e("button",{onClick:t[9]||(t[9]=s=>h.value=!1),class:"btn bg-gray-100"},"Batal"),e("button",{onClick:U,class:"btn btn-primary"},"Simpan")])])])):C("",!0)]),_:1})],64))}};export{Bt as default};
