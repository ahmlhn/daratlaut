import{C as Da,E as $e,o as Ra,G as Ba,D as Ka,c as r,a as Ht,u as Ha,h as Ja,m as za,b as t,t as d,f as y,x as A,j as n,e as g,d as h,i as Xe,n as V,F as L,s as $,w as oe,v as C,r as m,y as re,z as Wa}from"./app-BmDFFHGf.js";import{_ as Xa}from"./AdminLayout-NJ_5wE1c.js";const qa={class:"space-y-4 animate-fade-in"},Za={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3 bg-white dark:bg-dark-800 p-5 rounded-xl shadow-card border border-gray-100 dark:border-dark-700"},Ya={class:"flex flex-wrap items-center gap-2"},Qa={class:"px-3 py-2 rounded-lg bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 text-xs"},el={class:"font-semibold text-gray-900 dark:text-white"},tl={class:"px-3 py-2 rounded-lg bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 text-xs"},al={class:"font-semibold text-gray-900 dark:text-white"},ll={class:"px-3 py-2 rounded-lg bg-red-50/60 dark:bg-red-900/10 border border-red-200/60 dark:border-red-900/30 text-xs"},sl={class:"font-semibold text-red-700 dark:text-red-300"},ol={class:"hidden lg:flex items-center gap-2 ml-2"},rl=["disabled"],nl={key:0,class:"bg-amber-50 dark:bg-amber-900/10 border border-amber-200 dark:border-amber-900/30 text-amber-800 dark:text-amber-200 rounded-xl p-4 text-sm"},il={key:1,class:"bg-white dark:bg-dark-800 border border-gray-100 dark:border-dark-700 rounded-xl p-6"},ul={key:2,class:"grid grid-cols-1 lg:grid-cols-12 gap-4"},dl={class:"lg:col-span-8 bg-white dark:bg-dark-800 rounded-xl shadow-card border border-gray-100 dark:border-dark-700 overflow-hidden"},pl={class:"flex flex-wrap items-center gap-2 p-3 border-b border-gray-100 dark:border-dark-700"},vl={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},cl={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},bl={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},gl={class:"ml-auto flex items-center gap-2 lg:hidden"},ml=["disabled"],fl={class:"relative"},yl={key:0,class:"absolute inset-0 z-10 flex items-center justify-center p-6 bg-white/85 dark:bg-dark-900/70 backdrop-blur"},kl={class:"max-w-md text-center"},xl={class:"mt-1 text-xs text-gray-600 dark:text-gray-300"},_l={key:1,class:"absolute bottom-3 left-3 right-3 lg:right-auto lg:max-w-md bg-white/90 dark:bg-dark-900/80 backdrop-blur border border-gray-200 dark:border-white/10 rounded-xl p-3 text-xs text-gray-700 dark:text-gray-200 shadow-lg"},hl={class:"font-semibold"},wl={class:"uppercase"},Cl={key:0,class:"text-gray-600 dark:text-gray-300 mt-1"},Nl={key:1,class:"text-gray-600 dark:text-gray-300 mt-1"},Pl={class:"font-semibold"},Tl={key:0,class:"ml-1 text-blue-700 dark:text-blue-300"},Sl={key:2,class:"text-gray-600 dark:text-gray-300 mt-1"},El={key:3,class:"mt-2 flex items-center gap-2 text-xs text-gray-700 dark:text-gray-200"},Ll=["disabled"],Ml={class:"mt-2 flex items-center gap-2"},Ol=["disabled"],$l=["disabled"],Ul=["disabled"],Fl={class:"lg:col-span-4 bg-white dark:bg-dark-800 rounded-xl shadow-card border border-gray-100 dark:border-dark-700 overflow-hidden"},Il={class:"flex items-center gap-1 border-b border-gray-100 dark:border-dark-700 overflow-x-auto"},Al={class:"p-4"},jl={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Vl={key:1,class:"text-sm text-red-600 dark:text-red-300"},Gl={key:2,class:"space-y-3"},Dl={class:"flex items-center justify-between"},Rl={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Bl={key:1,class:"space-y-2 max-h-[420px] lg:max-h-[calc(100vh-18rem)] overflow-auto pr-1"},Kl=["onClick"],Hl={class:"flex items-start justify-between gap-2"},Jl={class:"text-sm font-semibold text-gray-900 dark:text-white"},zl={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},Wl={key:0},Xl={key:1,class:"ml-2"},ql={key:2,class:"ml-2"},Zl={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Yl={class:"font-medium text-gray-700 dark:text-gray-200"},Ql={class:"font-medium text-gray-700 dark:text-gray-200"},es={class:"flex items-center gap-1 shrink-0"},ts=["onClick"],as=["onClick"],ls={key:3,class:"space-y-3"},ss={class:"flex items-center justify-between"},os={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},rs={key:1,class:"space-y-2 max-h-[420px] lg:max-h-[calc(100vh-18rem)] overflow-auto pr-1"},ns=["onClick"],is={class:"flex items-start justify-between gap-2"},us={class:"text-sm font-semibold text-gray-900 dark:text-white"},ds={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},ps={key:0},vs={key:1,class:"ml-2"},cs={class:"flex items-center gap-1 shrink-0"},bs=["onClick"],gs=["onClick"],ms={key:4,class:"space-y-3"},fs={class:"flex items-center justify-between"},ys={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},ks={key:1,class:"space-y-2 max-h-[420px] lg:max-h-[calc(100vh-18rem)] overflow-auto pr-1"},xs={class:"flex items-start justify-between gap-2"},_s={class:"text-xs font-bold text-indigo-700 dark:text-indigo-300"},hs={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1"},ws={class:"text-xs text-gray-500 dark:text-gray-400 mt-1 space-y-0.5"},Cs={class:"font-medium text-gray-700 dark:text-gray-200"},Ns={key:0},Ps={class:"font-medium text-gray-700 dark:text-gray-200"},Ts={class:"ml-1"},Ss={class:"flex items-center gap-1 shrink-0"},Es=["onClick"],Ls=["onClick"],Ms={key:5,class:"space-y-3"},Os={class:"flex items-center justify-between"},$s={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Us={key:1,class:"space-y-2 max-h-[420px] lg:max-h-[calc(100vh-18rem)] overflow-auto pr-1"},Fs={class:"flex items-start justify-between gap-2"},Is={class:"min-w-0"},As={class:"text-xs font-bold text-amber-700 dark:text-amber-300"},js={key:0,class:"ml-1"},Vs={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Gs={class:"font-medium text-gray-700 dark:text-gray-200"},Ds={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1 truncate"},Rs={key:0,class:"text-gray-700 dark:text-gray-200"},Bs={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-2"},Ks={key:0},Hs={key:1,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Js={class:"font-medium text-gray-700 dark:text-gray-200"},zs={class:"flex items-center gap-1 shrink-0"},Ws=["onClick"],Xs=["onClick"],qs={key:6,class:"space-y-3"},Zs={class:"flex items-center justify-between"},Ys=["disabled"],Qs={class:"space-y-2"},eo=["value"],to={class:"flex items-center gap-2"},ao=["disabled"],lo=["disabled"],so={key:0,class:"text-xs text-red-600 dark:text-red-300"},oo={key:0,class:"space-y-3"},ro={class:"text-xs text-gray-500 dark:text-gray-400"},no={class:"font-semibold text-gray-800 dark:text-gray-200"},io={class:"font-semibold text-gray-800 dark:text-gray-200"},uo={key:0,class:"ml-2 text-amber-700 dark:text-amber-300"},po={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},vo={key:1,class:"space-y-2 max-h-[260px] overflow-auto pr-1"},co=["onClick"],bo={class:"text-sm font-semibold text-gray-900 dark:text-white"},go={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},mo={class:"font-medium text-gray-700 dark:text-gray-200"},fo={key:2,class:"rounded-xl border border-gray-100 dark:border-dark-700 p-3 bg-gray-50/40 dark:bg-dark-900/30"},yo={class:"mt-2 space-y-1 max-h-[220px] overflow-auto pr-1"},ko={class:"font-medium text-gray-900 dark:text-white"},xo={class:"text-gray-600 dark:text-gray-300"},_o={key:7,class:"space-y-3"},ho={class:"flex items-center justify-between"},wo={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Co={key:1,class:"space-y-2 max-h-[420px] lg:max-h-[calc(100vh-18rem)] overflow-auto pr-1"},No=["onClick"],Po={class:"flex items-start justify-between gap-2"},To={class:"text-xs font-bold"},So={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1"},Eo={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},Lo={key:0,class:"ml-2"},Mo={key:0,class:"text-xs text-gray-600 dark:text-gray-300 mt-1 line-clamp-2"},Oo={class:"flex items-center gap-1 shrink-0"},$o=["onClick"],Uo=["onClick"],Fo={class:"relative pointer-events-auto w-full max-w-2xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden"},Io={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Ao={class:"font-semibold text-gray-900 dark:text-white"},jo={class:"p-4 space-y-3"},Vo={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Go={key:0,class:"text-xs text-red-600 mt-1"},Do={key:0,class:"text-xs text-red-600 mt-1"},Ro={key:0,class:"text-xs text-red-600 mt-1"},Bo={key:0,class:"text-xs text-red-600 mt-1"},Ko={class:"md:col-span-2"},Ho={class:"flex flex-col sm:flex-row gap-2"},Jo={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},zo={class:"font-medium text-gray-700 dark:text-gray-200"},Wo={class:"ml-2"},Xo={key:0,class:"ml-2"},qo=["value"],Zo=["value"],Yo={class:"md:col-span-2"},Qo={class:"flex items-center gap-2"},er={class:"md:col-span-2"},tr={class:"rounded-xl border border-gray-100 dark:border-dark-700 p-3"},ar={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-2"},lr={class:"text-xs text-gray-500 dark:text-gray-400"},sr={class:"flex flex-wrap items-center gap-2"},or={class:"flex items-center gap-2 text-xs text-gray-700 dark:text-gray-200 px-3 py-2 rounded-xl border border-gray-200/70 dark:border-white/10 bg-white/70 dark:bg-dark-900/40"},rr=["disabled"],nr=["disabled"],ir=["disabled"],ur=["disabled"],dr={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},pr=["disabled"],vr={class:"relative pointer-events-auto w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden"},cr={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},br={class:"font-semibold text-gray-900 dark:text-white"},gr={class:"p-4 space-y-3"},mr={key:0,class:"text-xs text-red-600 mt-1"},fr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},yr={key:0,class:"text-xs text-red-600 mt-1"},kr={key:0,class:"text-xs text-red-600 mt-1"},xr={class:"flex items-center gap-2"},_r={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},hr=["disabled"],wr={class:"relative pointer-events-auto w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden"},Cr={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Nr={class:"font-semibold text-gray-900 dark:text-white"},Pr={class:"p-4 space-y-3"},Tr=["value"],Sr=["value"],Er={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Lr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Mr=["disabled"],Or={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},$r={key:0,class:"text-xs text-red-600 mt-1"},Ur={key:0,class:"text-xs text-red-600 mt-1"},Fr={class:"flex items-center gap-2"},Ir={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},Ar=["disabled"],jr={key:3,class:"fixed inset-0 z-[10000] flex items-center justify-center p-4"},Vr={class:"relative w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden"},Gr={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Dr={class:"font-semibold text-gray-900 dark:text-white"},Rr={class:"p-4 space-y-3"},Br=["value"],Kr={key:0,class:"text-xs text-red-600 mt-1"},Hr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Jr={key:0,class:"text-xs text-red-600 mt-1"},zr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Wr=["value"],Xr={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},qr=["disabled"],Zr={key:4,class:"fixed inset-0 z-[10000] flex items-center justify-center p-4"},Yr={class:"relative w-full max-w-2xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden"},Qr={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},en={class:"font-semibold text-gray-900 dark:text-white"},tn={class:"p-4 space-y-3"},an=["value"],ln={key:0,class:"text-xs text-red-600 mt-1"},sn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},on={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},rn=["value"],nn={key:0,class:"text-xs text-red-600 mt-1"},un={key:0,class:"text-xs text-red-600 mt-1"},dn={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},pn=["value"],vn={key:1,class:"space-y-3 rounded-xl border border-gray-100 dark:border-dark-700 p-3"},cn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},bn={class:"flex items-center gap-2"},gn={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},mn={key:1,class:"space-y-2 max-h-[260px] overflow-auto pr-1"},fn={class:"col-span-7"},yn=["onUpdate:modelValue"],kn=["value"],xn={class:"col-span-3"},_n=["onUpdate:modelValue"],hn={class:"col-span-2 flex items-center justify-end"},wn=["onClick"],Cn={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},Nn=["disabled"],En={__name:"Index",props:{tenantId:{type:Number,default:0},warning:{type:String,default:null},googleMapsApiKey:{type:String,default:""}},setup(Jt){const c=Da("toast"),dt=Jt,wt=Wa(),Ct=re(()=>{var l,e;return((e=(l=wt.props.auth)==null?void 0:l.user)==null?void 0:e.permissions)||[]}),zt=re(()=>{var l,e;return(((e=(l=wt.props.auth)==null?void 0:l.user)==null?void 0:e.role)||"").toString().toLowerCase().trim()});function Wt(l){const e=(l||"").toString().toLowerCase().trim();return e==="svp lapangan"?"svp_lapangan":e}function qe(l){const e=Wt(zt.value);return["admin","owner"].includes(e)||Ct.value.includes("manage fiber")?!0:Ct.value.includes(l)}const Nt=re(()=>qe("view fiber")),Q=re(()=>qe("create fiber")),ee=re(()=>qe("edit fiber")),te=re(()=>qe("delete fiber")),Pe=m(!1),Ze=m(""),Te=m({cables:0,points:0,breaks_total:0,breaks_open:0}),H=m([]),B=m([]),Se=m([]),Ue=m([]),Ye=m([]),M=m("cables"),Fe=m(!0),Ie=m(!0),Ae=m(!0),ae=m(null),D=m(null),le=m(null),ne=m(null),Qe=m([]),Pt=re(()=>{const l=new Set;return(Qe.value||[]).forEach(e=>{const o=Number(e);Number.isFinite(o)&&o>0&&l.add(o)}),l});async function K(l,e={}){const o=await fetch(l,{credentials:"same-origin",headers:{Accept:"application/json",...e.headers||{}},...e}),s=await o.text();let i=null;try{i=s?JSON.parse(s):null}catch{i=null}return{ok:o.ok,status:o.status,data:i,text:s}}async function j(){var l,e,o,s,i,v,b,u,x,T,U,F;if(Nt.value){Pe.value=!0,Ze.value="";try{const[O,ve]=await Promise.all([K("/api/v1/fiber/map-data"),K("/api/v1/fiber/summary")]);if(!O.ok){const I=((l=O.data)==null?void 0:l.message)||`Gagal memuat data fiber (HTTP ${O.status}).`;throw new Error(I)}ve.ok?Te.value=((e=ve.data)==null?void 0:e.data)||Te.value:Te.value={cables:0,points:0,breaks_total:0,breaks_open:0},H.value=((s=(o=O.data)==null?void 0:o.data)==null?void 0:s.cables)||[],B.value=((v=(i=O.data)==null?void 0:i.data)==null?void 0:v.points)||[],Se.value=((u=(b=O.data)==null?void 0:b.data)==null?void 0:u.breaks)||[],Ue.value=((T=(x=O.data)==null?void 0:x.data)==null?void 0:T.ports)||[],Ye.value=((F=(U=O.data)==null?void 0:U.data)==null?void 0:F.links)||[],Mt(),ra()}catch(O){console.error("Fiber: loadAll failed",O),Ze.value=O&&O.message?O.message:"Gagal memuat data fiber."}finally{Pe.value=!1}}}const pt=m(null);let N=null,J=null,vt=new Map,ct=new Map,bt=new Map,ke={markers:[],polyline:null},Tt=!1;const xe=m(""),ie=m("roadmap"),je={roadmap:{label:"Roadmap",mapTypeId:"roadmap"},satellite:{label:"Satelit",mapTypeId:"satellite"},hybrid:{label:"Hybrid",mapTypeId:"hybrid"}};function Xt(l){var o;const e=(l||"").toString().trim();return e?(o=window.google)!=null&&o.maps?Promise.resolve():(window.__fiberGoogleMapsPromise||(window.__fiberGoogleMapsPromise=new Promise((s,i)=>{const v=document.createElement("script"),b=new URLSearchParams({key:e,v:"weekly"});v.src=`https://maps.googleapis.com/maps/api/js?${b.toString()}`,v.async=!0,v.defer=!0,v.onload=()=>s(),v.onerror=()=>i(new Error("Gagal memuat Google Maps. Cek API key/koneksi.")),document.head.appendChild(v)})),window.__fiberGoogleMapsPromise):Promise.reject(new Error("Google Maps API key belum di-set."))}function qt(){var e;if(!N||!((e=window.google)!=null&&e.maps))return;const l=je[ie.value]||je.roadmap;try{N.setMapTypeId(l.mapTypeId)}catch{}}function St(){var l;mt();try{(ke.markers||[]).forEach(e=>{try{e.setMap(null)}catch{}})}catch{}ke.markers=[];try{(l=ke.polyline)==null||l.setMap(null)}catch{}ke.polyline=null}function Ee(l){try{Array.from(l.values()).forEach(e=>{try{e.setMap(null)}catch{}})}catch{}try{l.clear()}catch{}}function Zt(){var e;if(!((e=window.google)!=null&&e.maps)||!pt.value)return;const l=je[ie.value]||je.roadmap;N=new window.google.maps.Map(pt.value,{center:{lat:-2.5489,lng:118.0149},zoom:5,mapTypeId:l.mapTypeId,clickableIcons:!1,fullscreenControl:!1,streetViewControl:!1,mapTypeControl:!1}),J=new window.google.maps.InfoWindow,N.addListener("click",ta)}function Yt(){var l;if(!((l=window.google)!=null&&l.maps)){N=null,J=null;return}try{window.google.maps.event.clearInstanceListeners(N)}catch{}try{J==null||J.close()}catch{}St(),Ee(vt),Ee(ct),Ee(bt),N=null,J=null}const w=m(null),z=m(null),W=m(!0),ce=m(!1);let ue=[],gt=null,Ve=[];function Qt(l){var e,o,s,i;if(l){try{if(typeof l.remove=="function"){l.remove();return}}catch{}try{(i=(s=(o=(e=window.google)==null?void 0:e.maps)==null?void 0:o.event)==null?void 0:s.removeListener)==null||i.call(s,l)}catch{}}}function mt(){try{(Ve||[]).forEach(l=>Qt(l))}catch{}Ve=[]}function be(l){const e=Number(l);return Number.isFinite(e)?Math.round(e*1e7)/1e7:null}function ea(){var l;return(l=window.google)!=null&&l.maps?(gt||(gt=new window.google.maps.DirectionsService),gt):null}async function Et(l,e){const o=ea();if(!o)throw new Error("Google Maps Directions belum siap.");const s={origin:l,destination:e,travelMode:window.google.maps.TravelMode.DRIVING};return new Promise((i,v)=>{try{o.route(s,(b,u)=>{var U;if(u!=="OK"||!((U=b==null?void 0:b.routes)!=null&&U[0])){v(new Error(`Gagal ambil rute jalan (${u||"UNKNOWN"}).`));return}const T=(b.routes[0].overview_path||[]).map(F=>({lat:be(F.lat()),lng:be(F.lng())})).filter(F=>Number.isFinite(F.lat)&&Number.isFinite(F.lng));i(T)})}catch(b){v(b)}})}async function ta(l){if(!(l!=null&&l.latLng))return;const e=be(l.latLng.lat()),o=be(l.latLng.lng());if(w.value==="pickPoint"){_.value.latitude=e,_.value.longitude=o,c&&c.success("Lokasi titik dipilih dari peta."),E();return}if(w.value==="pickBreak"){k.value.latitude=e,k.value.longitude=o,c&&c.success("Lokasi putus dipilih dari peta."),E();return}if(w.value==="drawCable"){const s=Array.isArray(p.value.path)?p.value.path:[];if(!Number.isFinite(e)||!Number.isFinite(o))return;if(s.length<1||!W.value){ue.push(s.length),s.push({lat:e,lng:o}),p.value.path=s,X();return}if(ce.value)return;ue.push(s.length),ce.value=!0;try{const i=s[s.length-1],v=await Et({lat:Number(i==null?void 0:i.lat),lng:Number(i==null?void 0:i.lng)},{lat:e,lng:o});if(Array.isArray(v)&&v.length>=2){const b=v.slice(1);p.value.path=s.concat(b)}else s.push({lat:e,lng:o}),p.value.path=s}catch(i){s.push({lat:e,lng:o}),p.value.path=s,c&&c.error((i==null?void 0:i.message)||"Gagal mengikuti jalan. Pakai garis lurus.")}finally{ce.value=!1,X()}}}function E(l={}){const e=(l==null?void 0:l.reopen)!==!1,o=e?z.value:null;mt(),w.value=null,z.value=null,e&&o&&(o==="cable"&&(G.value=!0),o==="point"&&(Z.value=!0),o==="break"&&(Y.value=!0)),X()}function aa(l){const e=document.createElement("div");return e.className="text-sm",(l||[]).forEach(o=>{const s=document.createElement("div");s.textContent=String(o??""),e.appendChild(s)}),e}function ft(l,e,o=null){if(!N||!J)return;const s=(e||[]).filter(Boolean);if(!(s.length<1)){try{J.close()}catch{}J.setContent(aa(s));try{if(o){J.open({map:N,anchor:o});return}l&&J.setPosition(l),J.open({map:N})}catch{}}}function se(l){const e=Number(l||0);if(!e)return null;const o=(B.value||[]).find(s=>Number(s==null?void 0:s.id)===e);return o?String(o.name||""):null}function Lt(l){const e=Number(l||0);if(!e)return null;const o=(B.value||[]).find(v=>Number(v==null?void 0:v.id)===e);if(!o)return null;const s=be(Number(o==null?void 0:o.latitude)),i=be(Number(o==null?void 0:o.longitude));return!Number.isFinite(s)||!Number.isFinite(i)?null:{lat:s,lng:i}}function ge(l){const e=Number(l||0);if(!e)return null;const o=(H.value||[]).find(s=>Number(s==null?void 0:s.id)===e);return o?String(o.name||""):null}function la(l){const e=String(l||"").toUpperCase();return e==="OPEN"?{stroke:"#dc2626",fill:"#ef4444"}:e==="IN_PROGRESS"?{stroke:"#b45309",fill:"#f59e0b"}:e==="FIXED"?{stroke:"#047857",fill:"#10b981"}:{stroke:"#64748b",fill:"#94a3b8"}}function Mt(){var l;!N||!((l=window.google)!=null&&l.maps)||(Ge(),yt(),kt(),X())}function Ge(){var l;!N||!((l=window.google)!=null&&l.maps)||(Ee(vt),Fe.value&&(H.value||[]).forEach(e=>{const o=Array.isArray(e==null?void 0:e.path)?e.path:null;if(!o||o.length<2)return;const s=o.map(I=>({lat:Number(I==null?void 0:I.lat),lng:Number(I==null?void 0:I.lng)})).filter(I=>Number.isFinite(I.lat)&&Number.isFinite(I.lng));if(s.length<2)return;const i=Number(e==null?void 0:e.id)===Number(ae.value||0),v=Pt.value.size>0,b=Pt.value.has(Number(e==null?void 0:e.id)),u=((e==null?void 0:e.map_color)||"#2563eb").toString(),x=i?6:4,T=b?Math.max(x,6):x,U=v?b?1:.25:.9,F=new window.google.maps.Polyline({path:s,strokeColor:u,strokeWeight:T,strokeOpacity:U,clickable:!0});F.setMap(N),vt.set(Number(e==null?void 0:e.id)||0,F);const O=se(e==null?void 0:e.from_point_id)||"-",ve=se(e==null?void 0:e.to_point_id)||"-";F.addListener("click",I=>{ae.value=e.id,D.value=null,le.value=null,M.value="cables",Ge(),ft((I==null?void 0:I.latLng)||null,[`Kabel: ${(e==null?void 0:e.name)||"-"}`,e!=null&&e.code?`Kode: ${e.code}`:null,e!=null&&e.cable_type?`Tipe: ${e.cable_type}`:null,e!=null&&e.core_count?`Core: ${e.core_count}`:null,`Dari: ${O}`,`Ke: ${ve}`])})}))}function yt(){var l;!N||!((l=window.google)!=null&&l.maps)||(Ee(ct),Ie.value&&(B.value||[]).forEach(e=>{const o=Number(e==null?void 0:e.latitude),s=Number(e==null?void 0:e.longitude);if(!Number.isFinite(o)||!Number.isFinite(s))return;const i=Number(e==null?void 0:e.id)===Number(D.value||0),v=new window.google.maps.Marker({position:{lat:o,lng:s},map:N,title:((e==null?void 0:e.name)||"").toString(),clickable:!0,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:i?7:6,fillColor:"#14b8a6",fillOpacity:.9,strokeColor:"#0f766e",strokeWeight:2}});ct.set(Number(e==null?void 0:e.id)||0,v),v.addListener("click",()=>{D.value=e.id,ae.value=null,le.value=null,M.value="points",yt(),ft(v.getPosition(),[`Titik: ${(e==null?void 0:e.name)||"-"}`,e!=null&&e.point_type?`Tipe: ${e.point_type}`:null,`Koordinat: ${o}, ${s}`],v)})}))}function kt(){var l;!N||!((l=window.google)!=null&&l.maps)||(Ee(bt),Ae.value&&(Se.value||[]).forEach(e=>{const o=Number(e==null?void 0:e.latitude),s=Number(e==null?void 0:e.longitude);if(!Number.isFinite(o)||!Number.isFinite(s))return;const i=la(e==null?void 0:e.status),v=Number(e==null?void 0:e.id)===Number(le.value||0),b=new window.google.maps.Marker({position:{lat:o,lng:s},map:N,title:`PUTUS: ${String((e==null?void 0:e.status)||"OPEN").toUpperCase()}`,clickable:!0,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:v?8:7,fillColor:i.fill,fillOpacity:.9,strokeColor:i.stroke,strokeWeight:2}});bt.set(Number(e==null?void 0:e.id)||0,b),b.addListener("click",()=>{le.value=e.id,ae.value=null,D.value=null,M.value="breaks",kt();const u=ge(e==null?void 0:e.cable_id)||(e!=null&&e.cable_id?`#${e.cable_id}`:"-"),x=se(e==null?void 0:e.point_id)||(e!=null&&e.point_id?`#${e.point_id}`:"-");ft(b.getPosition(),[`PUTUS: ${String((e==null?void 0:e.status)||"OPEN").toUpperCase()}`,`Kabel: ${u}`,`Titik: ${x}`,e!=null&&e.severity?`Severity: ${e.severity}`:null],b)})}))}function sa(l){var e,o,s;try{const i=(e=l==null?void 0:l.getPath)==null?void 0:e.call(l);if(!i||typeof i.getLength!="function")return;const v=[];for(let b=0;b<i.getLength();b+=1){const u=i.getAt(b),x=be((o=u==null?void 0:u.lat)==null?void 0:o.call(u)),T=be((s=u==null?void 0:u.lng)==null?void 0:s.call(u));!Number.isFinite(x)||!Number.isFinite(T)||v.push({lat:x,lng:T})}p.value.path=v}catch{}}function oa(l){var s,i;if(mt(),!l||!((s=window.google)!=null&&s.maps))return;const e=(i=l.getPath)==null?void 0:i.call(l);if(!e||typeof e.addListener!="function")return;const o=()=>sa(l);Ve.push(e.addListener("insert_at",o)),Ve.push(e.addListener("set_at",o)),Ve.push(e.addListener("remove_at",o)),o()}function X(){var e;if(!N||!((e=window.google)!=null&&e.maps))return;St();const l=(o,s,i={})=>{if(!Number.isFinite(o)||!Number.isFinite(s))return;const v=new window.google.maps.Marker({position:{lat:o,lng:s},map:N,clickable:!1,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:Number(i.scale??6),fillColor:(i.fillColor||"#38bdf8").toString(),fillOpacity:Number(i.fillOpacity??.9),strokeColor:(i.strokeColor||"#0ea5e9").toString(),strokeWeight:Number(i.strokeWeight??2)}});ke.markers.push(v)};if((Z.value||w.value==="pickPoint")&&_.value.latitude!==null&&_.value.longitude!==null){const o=Number(_.value.latitude),s=Number(_.value.longitude);Number.isFinite(o)&&Number.isFinite(s)&&l(o,s,{scale:7,strokeColor:"#0ea5e9",fillColor:"#38bdf8",fillOpacity:.85})}if((Y.value||w.value==="pickBreak")&&k.value.latitude!==null&&k.value.longitude!==null){const o=Number(k.value.latitude),s=Number(k.value.longitude);Number.isFinite(o)&&Number.isFinite(s)&&l(o,s,{scale:8,strokeColor:"#f97316",fillColor:"#fb923c",fillOpacity:.85})}if((G.value||w.value==="drawCable"||w.value==="editCable")&&Array.isArray(p.value.path)&&p.value.path.length>0){const o=w.value==="editCable",s=p.value.path.map(i=>({lat:Number(i==null?void 0:i.lat),lng:Number(i==null?void 0:i.lng)})).filter(i=>Number.isFinite(i.lat)&&Number.isFinite(i.lng));if(o||s.forEach(i=>{l(i.lat,i.lng,{scale:3,strokeColor:"#1d4ed8",fillColor:"#60a5fa",fillOpacity:.95})}),s.length>=2){const i={path:"M 0,-1 0,1",strokeOpacity:1,strokeColor:"#1d4ed8",scale:3};ke.polyline=new window.google.maps.Polyline({path:s,strokeColor:"#1d4ed8",strokeOpacity:o?.85:0,strokeWeight:o?4:0,icons:o?[]:[{icon:i,offset:"0",repeat:"12px"}],clickable:o,editable:o,map:N}),o&&oa(ke.polyline)}}}function ra(){var o;if(!N||Tt||!((o=window.google)!=null&&o.maps))return;const l=new window.google.maps.LatLngBounds;let e=!1;try{Fe.value&&(H.value||[]).forEach(s=>{const i=Array.isArray(s==null?void 0:s.path)?s.path:null;!i||i.length<1||i.forEach(v=>{const b=Number(v==null?void 0:v.lat),u=Number(v==null?void 0:v.lng);!Number.isFinite(b)||!Number.isFinite(u)||(l.extend({lat:b,lng:u}),e=!0)})})}catch{}try{Ie.value&&(B.value||[]).forEach(s=>{const i=Number(s==null?void 0:s.latitude),v=Number(s==null?void 0:s.longitude);!Number.isFinite(i)||!Number.isFinite(v)||(l.extend({lat:i,lng:v}),e=!0)})}catch{}try{Ae.value&&(Se.value||[]).forEach(s=>{const i=Number(s==null?void 0:s.latitude),v=Number(s==null?void 0:s.longitude);!Number.isFinite(i)||!Number.isFinite(v)||(l.extend({lat:i,lng:v}),e=!0)})}catch{}if(e)try{N.fitBounds(l),Tt=!0}catch{}}function na(l){const e=String(l||"OPEN").toUpperCase();return e==="IN_PROGRESS"?"IN PROGRESS":e}function Ot(l){if(!l)return"";const e=new Date(l);if(!Number.isFinite(e.getTime()))return"";const o=s=>String(s).padStart(2,"0");return`${e.getFullYear()}-${o(e.getMonth()+1)}-${o(e.getDate())}T${o(e.getHours())}:${o(e.getMinutes())}`}function _e(l,e,o=17){var s;if(!(!N||!((s=window.google)!=null&&s.maps)||!Number.isFinite(l)||!Number.isFinite(e))){try{N.panTo({lat:l,lng:e})}catch{}if(Number.isFinite(Number(o)))try{N.setZoom(Number(o))}catch{}}}function ia(l,e){const o=Number(l==null?void 0:l.lat),s=Number(l==null?void 0:l.lng),i=Number(e==null?void 0:e.lat),v=Number(e==null?void 0:e.lng);if(!Number.isFinite(o)||!Number.isFinite(s)||!Number.isFinite(i)||!Number.isFinite(v))return 0;const b=6371e3,u=ve=>Number(ve)*Math.PI/180,x=u(i-o),T=u(v-s),U=Math.sin(x/2),F=Math.sin(T/2),O=U*U+Math.cos(u(o))*Math.cos(u(i))*F*F;return 2*b*Math.asin(Math.min(1,Math.sqrt(O)))}function xt(l){const e=Array.isArray(l)?l:[];if(e.length<2)return 0;let o=0;for(let s=1;s<e.length;s+=1)o+=ia(e[s-1],e[s]);return o}function $t(l){const e=Number(l);if(!Number.isFinite(e)||e<=0)return"-";if(e<1e3)return`${Math.round(e)} m`;const o=e/1e3;return`${o.toFixed(o<10?2:1)} km`}function et(){var l;return xe.value?(c&&c.error(xe.value),!1):!N||!((l=window.google)!=null&&l.maps)?(c&&c.error("Peta belum siap."),!1):!0}const G=m(!1),Le=m("create"),tt=m(!1),q=m({}),me=m(!0),fe=m(!1),p=m({id:null,name:"",code:"",cable_type:"",core_count:"",map_color:"#2563eb",from_point_id:"",to_point_id:"",path:[],length_m:"",notes:""}),_t=re(()=>Math.round(xt(p.value.path)));function Ut(){p.value={id:null,name:"",code:"",cable_type:"",core_count:"",map_color:"#2563eb",from_point_id:"",to_point_id:"",path:[],length_m:"",notes:""},q.value={},me.value=!0,fe.value=!1}function ua(){Q.value&&(Ut(),Le.value="create",ue=[],me.value=!0,fe.value=!0,G.value=!0,z.value=null,E({reopen:!1}))}function da(l){if(!ee.value)return;Ut(),Le.value="edit",ue=[],p.value={id:l.id,name:l.name||"",code:l.code||"",cable_type:l.cable_type||"",core_count:l.core_count??"",map_color:l.map_color||"#2563eb",from_point_id:l.from_point_id??"",to_point_id:l.to_point_id??"",path:Array.isArray(l.path)?l.path.slice():[],length_m:l.length_m??"",notes:l.notes||""},me.value=!(p.value.length_m!==""&&p.value.length_m!==null&&p.value.length_m!==void 0),fe.value=!1,G.value=!0,z.value=null,E({reopen:!1});const e=(p.value.path||[])[0];e&&Number.isFinite(Number(e.lat))&&Number.isFinite(Number(e.lng))&&_e(Number(e.lat),Number(e.lng),16)}function pa(l){var i;if(!N||!((i=window.google)!=null&&i.maps))return;const e=Array.isArray(l)?l:[];if(e.length<1)return;const o=new window.google.maps.LatLngBounds;let s=!1;if(e.forEach(v=>{const b=Number(v==null?void 0:v.lat),u=Number(v==null?void 0:v.lng);!Number.isFinite(b)||!Number.isFinite(u)||(o.extend({lat:b,lng:u}),s=!0)}),!!s)try{N.fitBounds(o)}catch{}}async function Ft(l={}){var T;const e=(l==null?void 0:l.force)===!0,o=Number(p.value.from_point_id||0),s=Number(p.value.to_point_id||0);if(!o||!s)return c&&c.error("Pilih Dari Titik dan Ke Titik dulu."),!1;if(o===s)return c&&c.error("Dari Titik dan Ke Titik tidak boleh sama."),!1;const i=Lt(o),v=Lt(s);if(!i||!v)return c&&c.error("Koordinat titik belum lengkap. Isi latitude/longitude di data Titik."),!1;const b=Array.isArray(p.value.path)&&p.value.path.length>=2;if(b&&!e||b&&e&&!confirm("Jalur sudah ada. Timpa jalur dengan jalur otomatis dari titik?"))return!1;let u=[];const x=!!W.value;if(x&&((T=window.google)!=null&&T.maps))try{u=await Et(i,v)}catch(U){u=[],c&&c.error((U==null?void 0:U.message)||"Gagal mengikuti jalan. Pakai garis lurus.")}return(!Array.isArray(u)||u.length<2)&&(u=[i,v]),ue=[],p.value.path=u,X(),pa(u),me.value=!0,p.value.length_m=Math.round(xt(u)),c&&c.success(x?"Jalur otomatis dibuat (ikut jalan).":"Jalur otomatis dibuat."),!0}async function va(){var i,v,b;tt.value=!0,q.value={};const l={name:p.value.name,code:p.value.code||null,cable_type:p.value.cable_type||null,core_count:p.value.core_count!==""?Number(p.value.core_count):null,map_color:p.value.map_color||null,from_point_id:p.value.from_point_id!==""?Number(p.value.from_point_id):null,to_point_id:p.value.to_point_id!==""?Number(p.value.to_point_id):null,path:Array.isArray(p.value.path)&&p.value.path.length>=2?p.value.path:null,length_m:p.value.length_m!==""&&p.value.length_m!==null&&p.value.length_m!==void 0?Number(p.value.length_m):null,notes:p.value.notes||null},e=Le.value==="edit"&&p.value.id,o=e?`/api/v1/fiber/cables/${p.value.id}`:"/api/v1/fiber/cables",s=e?"PUT":"POST";try{const u=await K(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(q.value=u.data.errors,new Error(((v=u.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((b=u.data)==null?void 0:b.message)||`Gagal menyimpan kabel (HTTP ${u.status}).`);G.value=!1,E(),await j(),c&&c.success("Kabel tersimpan.")}catch(u){console.error("Fiber: saveCable failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan kabel.")}finally{tt.value=!1}}async function ca(l){var o;if(!(!te.value||!confirm(`Hapus kabel "${(l==null?void 0:l.name)||""}"?`)))try{const s=await K(`/api/v1/fiber/cables/${l.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus kabel (HTTP ${s.status}).`);c&&c.success("Kabel dihapus."),Number(ae.value)===Number(l.id)&&(ae.value=null),await j()}catch(s){console.error("Fiber: deleteCable failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus kabel.")}}function ba(){G.value&&et()&&(z.value="cable",G.value=!1,ue=[],w.value="drawCable",X(),c&&c.info(W.value?"Mode gambar jalur aktif (ikut jalan): klik peta untuk set titik berikutnya, lalu klik Selesai untuk kembali.":"Mode gambar jalur aktif: klik peta untuk menambah titik, lalu klik Selesai untuk kembali."))}function ga(){if(!G.value||!et())return;if((Array.isArray(p.value.path)?p.value.path:[]).length<2){c&&c.error("Jalur belum ada. Klik Gambar dulu minimal 2 titik.");return}z.value="cable",G.value=!1,w.value="editCable",X(),c&&c.info("Mode edit jalur aktif: geser titik/segmen di peta, lalu klik Selesai untuk kembali.")}function It(){const l=Array.isArray(p.value.path)?p.value.path:[];if(l.length!==0){if(ue.length>0){const e=Number(ue.pop());Number.isFinite(e)&&e>=0?p.value.path=l.slice(0,e):(l.pop(),p.value.path=l)}else l.pop(),p.value.path=l;X()}}function ht(){p.value.path=[],ue=[],X()}function ma(){const l=Number(_t.value||0);if(!Number.isFinite(l)||l<=0){c&&c.error("Tidak ada jalur untuk dihitung.");return}p.value.length_m=Math.round(l),me.value=!0,c&&c.success("Panjang kabel diisi dari jalur.")}const Z=m(!1),at=m("create"),lt=m(!1),de=m({}),_=m({id:null,name:"",point_type:"",latitude:null,longitude:null,address:"",notes:""});function At(){_.value={id:null,name:"",point_type:"",latitude:null,longitude:null,address:"",notes:""},de.value={}}function fa(){Q.value&&(At(),at.value="create",Z.value=!0,z.value=null,E({reopen:!1}))}function ya(l){if(!ee.value)return;At(),at.value="edit",_.value={id:l.id,name:l.name||"",point_type:l.point_type||"",latitude:l.latitude??null,longitude:l.longitude??null,address:l.address||"",notes:l.notes||""},Z.value=!0,z.value=null,E({reopen:!1});const e=Number(_.value.latitude),o=Number(_.value.longitude);Number.isFinite(e)&&Number.isFinite(o)&&_e(e,o,17)}function ka(){Z.value&&et()&&(z.value="point",Z.value=!1,w.value="pickPoint",X(),c&&c.info("Klik peta untuk memilih lokasi titik."))}async function xa(){var i,v,b;lt.value=!0,de.value={};const l={name:_.value.name,point_type:_.value.point_type||null,latitude:_.value.latitude,longitude:_.value.longitude,address:_.value.address||null,notes:_.value.notes||null},e=at.value==="edit"&&_.value.id,o=e?`/api/v1/fiber/points/${_.value.id}`:"/api/v1/fiber/points",s=e?"PUT":"POST";try{const u=await K(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(de.value=u.data.errors,new Error(((v=u.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((b=u.data)==null?void 0:b.message)||`Gagal menyimpan titik (HTTP ${u.status}).`);Z.value=!1,E(),await j(),c&&c.success("Titik tersimpan.")}catch(u){console.error("Fiber: savePoint failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan titik.")}finally{lt.value=!1}}async function _a(l){var o;if(!(!te.value||!confirm(`Hapus titik "${(l==null?void 0:l.name)||""}"?`)))try{const s=await K(`/api/v1/fiber/points/${l.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus titik (HTTP ${s.status}).`);c&&c.success("Titik dihapus."),Number(D.value)===Number(l.id)&&(D.value=null),await j()}catch(s){console.error("Fiber: deletePoint failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus titik.")}}const Y=m(!1),st=m("create"),ot=m(!1),he=m({}),k=m({id:null,cable_id:"",point_id:"",status:"OPEN",severity:"",reported_at:"",fixed_at:"",latitude:null,longitude:null,description:""});function jt(){k.value={id:null,cable_id:"",point_id:"",status:"OPEN",severity:"",reported_at:"",fixed_at:"",latitude:null,longitude:null,description:""},he.value={}}function ha(){Q.value&&(jt(),st.value="create",Y.value=!0,z.value=null,E({reopen:!1}))}function wa(l){if(!ee.value)return;jt(),st.value="edit",k.value={id:l.id,cable_id:l.cable_id??"",point_id:l.point_id??"",status:(l.status||"OPEN").toString().toUpperCase(),severity:l.severity||"",reported_at:Ot(l.reported_at),fixed_at:Ot(l.fixed_at),latitude:l.latitude??null,longitude:l.longitude??null,description:l.description||""},Y.value=!0,z.value=null,E({reopen:!1});const e=Number(k.value.latitude),o=Number(k.value.longitude);Number.isFinite(e)&&Number.isFinite(o)&&_e(e,o,17)}function Ca(){Y.value&&et()&&(z.value="break",Y.value=!1,w.value="pickBreak",X(),c&&c.info("Klik peta untuk memilih lokasi putus."))}async function Na(){var i,v,b;ot.value=!0,he.value={};const l={cable_id:k.value.cable_id!==""?Number(k.value.cable_id):null,point_id:k.value.point_id!==""?Number(k.value.point_id):null,status:(k.value.status||"OPEN").toString().toUpperCase(),severity:k.value.severity||null,reported_at:k.value.reported_at||null,fixed_at:k.value.fixed_at||null,latitude:k.value.latitude,longitude:k.value.longitude,description:k.value.description||null},e=st.value==="edit"&&k.value.id,o=e?`/api/v1/fiber/breaks/${k.value.id}`:"/api/v1/fiber/breaks",s=e?"PUT":"POST";try{const u=await K(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(he.value=u.data.errors,new Error(((v=u.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((b=u.data)==null?void 0:b.message)||`Gagal menyimpan data putus (HTTP ${u.status}).`);Y.value=!1,E(),await j(),c&&c.success("Data putus tersimpan.")}catch(u){console.error("Fiber: saveBreak failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan data putus.")}finally{ot.value=!1}}async function Pa(l){var o;if(!(!te.value||!confirm("Hapus data putus ini?")))try{const s=await K(`/api/v1/fiber/breaks/${l.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus data putus (HTTP ${s.status}).`);c&&c.success("Data putus dihapus."),Number(le.value)===Number(l.id)&&(le.value=null),await j()}catch(s){console.error("Fiber: deleteBreak failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus data putus.")}}const we=m(!1),rt=m("create"),nt=m(!1),Ce=m({}),P=m({id:null,point_id:"",port_type:"OLT_PON",port_label:"",cable_id:"",core_no:"",notes:""});function Vt(){P.value={id:null,point_id:"",port_type:"OLT_PON",port_label:"",cable_id:"",core_no:"",notes:""},Ce.value={}}function Ta(){Q.value&&(Vt(),D.value&&(P.value.point_id=String(D.value)),rt.value="create",we.value=!0)}function Sa(l){ee.value&&(Vt(),rt.value="edit",P.value={id:l.id,point_id:l.point_id??"",port_type:l.port_type||"OLT_PON",port_label:l.port_label||"",cable_id:l.cable_id??"",core_no:l.core_no??"",notes:l.notes||""},we.value=!0)}async function Ea(){var i,v,b;nt.value=!0,Ce.value={};const l={point_id:P.value.point_id!==""?Number(P.value.point_id):null,port_type:(P.value.port_type||"OLT_PON").toString().toUpperCase(),port_label:P.value.port_label||"",cable_id:P.value.cable_id!==""?Number(P.value.cable_id):null,core_no:P.value.core_no!==""?Number(P.value.core_no):null,notes:P.value.notes||null},e=rt.value==="edit"&&P.value.id,o=e?`/api/v1/fiber/ports/${P.value.id}`:"/api/v1/fiber/ports",s=e?"PUT":"POST";try{const u=await K(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(Ce.value=u.data.errors,new Error(((v=u.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((b=u.data)==null?void 0:b.message)||`Gagal menyimpan port (HTTP ${u.status}).`);we.value=!1,await j(),c&&c.success("Port tersimpan.")}catch(u){console.error("Fiber: savePort failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan port.")}finally{nt.value=!1}}async function La(l){var o;if(!(!te.value||!confirm(`Hapus port "${(l==null?void 0:l.port_label)||""}"?`)))try{const s=await K(`/api/v1/fiber/ports/${l.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus port (HTTP ${s.status}).`);c&&c.success("Port dihapus."),await j()}catch(s){console.error("Fiber: deletePort failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus port.")}}const ye=m(!1),it=m("create"),ut=m(!1),pe=m({}),De=m(8),f=m({id:null,point_id:"",link_type:"SPLICE",from_cable_id:"",from_core_no:"",to_cable_id:"",to_core_no:"",split_group:"",outputs:[],loss_db:"",notes:""}),Gt=re(()=>{const l=Array.isArray(Ye.value)?Ye.value:[],e=[],o={};return l.forEach(s=>{const i=((s==null?void 0:s.link_type)||"").toString().toUpperCase(),v=((s==null?void 0:s.split_group)||"").toString();if(i==="SPLIT"&&v){const b=`${Number(s.point_id)||0}|${v}`;o[b]||(o[b]={kind:"SPLIT_GROUP",id:s.id,point_id:s.point_id,link_type:"SPLIT",split_group:v,from_cable_id:s.from_cable_id,from_core_no:s.from_core_no,loss_db:s.loss_db??null,notes:s.notes||"",outputs:[],link_ids:[]}),o[b].outputs.push({to_cable_id:s.to_cable_id,to_core_no:s.to_core_no}),o[b].link_ids.push(s.id);return}e.push({kind:"LINK",...s||{}})}),Object.values(o).forEach(s=>{s.outputs=(s.outputs||[]).filter(i=>(i==null?void 0:i.to_cable_id)&&(i==null?void 0:i.to_core_no)),e.push(s)}),e.sort((s,i)=>{const v=Number((s==null?void 0:s.point_id)||0),b=Number((i==null?void 0:i.point_id)||0);if(v!==b)return v-b;const u=((s==null?void 0:s.link_type)||"").toString(),x=((i==null?void 0:i.link_type)||"").toString();return u.localeCompare(x)}),e});function Dt(){f.value={id:null,point_id:"",link_type:"SPLICE",from_cable_id:"",from_core_no:"",to_cable_id:"",to_core_no:"",split_group:"",outputs:[],loss_db:"",notes:""},pe.value={},De.value=8}function Ma(l){const e=Math.max(1,Math.min(64,Number(l)||1));f.value.outputs=Array.from({length:e}).map(()=>({to_cable_id:"",to_core_no:""}))}function Oa(){const l=Array.isArray(f.value.outputs)?f.value.outputs:[];l.push({to_cable_id:"",to_core_no:""}),f.value.outputs=l}function $a(l){const e=Array.isArray(f.value.outputs)?f.value.outputs:[];l<0||l>=e.length||(e.splice(l,1),f.value.outputs=e)}function Ua(){Q.value&&(Dt(),D.value&&(f.value.point_id=String(D.value)),it.value="create",ye.value=!0)}function Fa(l){if(ee.value){if(Dt(),it.value="edit",(l==null?void 0:l.kind)==="SPLIT_GROUP"){f.value={id:l.id,point_id:l.point_id??"",link_type:"SPLIT",from_cable_id:l.from_cable_id??"",from_core_no:l.from_core_no??"",to_cable_id:"",to_core_no:"",split_group:l.split_group||"",outputs:(l.outputs||[]).map(e=>({to_cable_id:e.to_cable_id??"",to_core_no:e.to_core_no??""})),loss_db:l.loss_db??"",notes:l.notes||""},De.value=(f.value.outputs||[]).length||8,ye.value=!0;return}f.value={id:l.id,point_id:l.point_id??"",link_type:(l.link_type||"SPLICE").toString().toUpperCase(),from_cable_id:l.from_cable_id??"",from_core_no:l.from_core_no??"",to_cable_id:l.to_cable_id??"",to_core_no:l.to_core_no??"",split_group:l.split_group||"",outputs:[],loss_db:l.loss_db??"",notes:l.notes||""},ye.value=!0}}async function Ia(){var v,b,u;ut.value=!0,pe.value={};const l=(f.value.link_type||"SPLICE").toString().toUpperCase(),e={point_id:f.value.point_id!==""?Number(f.value.point_id):null,link_type:l,from_cable_id:f.value.from_cable_id!==""?Number(f.value.from_cable_id):null,from_core_no:f.value.from_core_no!==""?Number(f.value.from_core_no):null,split_group:f.value.split_group||null,loss_db:f.value.loss_db!==""?Number(f.value.loss_db):null,notes:f.value.notes||null};if(l==="SPLIT"){const x=Array.isArray(f.value.outputs)?f.value.outputs:[];e.outputs=x.map(T=>({to_cable_id:T.to_cable_id!==""?Number(T.to_cable_id):null,to_core_no:T.to_core_no!==""?Number(T.to_core_no):null})).filter(T=>T.to_cable_id&&T.to_core_no)}else e.to_cable_id=f.value.to_cable_id!==""?Number(f.value.to_cable_id):null,e.to_core_no=f.value.to_core_no!==""?Number(f.value.to_core_no):null;const o=it.value==="edit"&&f.value.id,s=o?`/api/v1/fiber/links/${f.value.id}`:"/api/v1/fiber/links",i=o?"PUT":"POST";try{const x=await K(s,{method:i,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!x.ok)throw x.status===422&&((v=x.data)!=null&&v.errors)?(pe.value=x.data.errors,new Error(((b=x.data)==null?void 0:b.message)||"Validasi gagal.")):new Error(((u=x.data)==null?void 0:u.message)||`Gagal menyimpan sambungan (HTTP ${x.status}).`);ye.value=!1,await j(),c&&c.success("Sambungan tersimpan.")}catch(x){console.error("Fiber: saveLink failed",x),c&&c.error((x==null?void 0:x.message)||"Gagal menyimpan sambungan.")}finally{ut.value=!1}}async function Aa(l){var s;if(!te.value)return;const e=(l==null?void 0:l.kind)==="SPLIT_GROUP"?`splitter "${(l==null?void 0:l.split_group)||""}"`:"sambungan ini";if(confirm(`Hapus ${e}?`))try{const i=await K(`/api/v1/fiber/links/${l.id}`,{method:"DELETE"});if(!i.ok)throw new Error(((s=i.data)==null?void 0:s.message)||`Gagal hapus sambungan (HTTP ${i.status}).`);c&&c.success("Sambungan dihapus."),await j()}catch(i){console.error("Fiber: deleteLink failed",i),c&&c.error((i==null?void 0:i.message)||"Gagal hapus sambungan.")}}const Re=m(""),Me=m(!1),Oe=m(""),Ne=m(null),ja=re(()=>(Ue.value||[]).filter(l=>((l==null?void 0:l.port_type)||"").toString().toUpperCase()==="OLT_PON"));function Va(){ne.value=null,Oe.value="",Ne.value=null,Qe.value=[],Ge()}async function Ga(){var l,e,o,s,i,v;if(Re.value){Me.value=!0,Oe.value="",ne.value=null,Ne.value=null,Qe.value=[];try{const b=await K(`/api/v1/fiber/trace/${Number(Re.value)}?stop_at_odp_out=1`);if(!b.ok)throw new Error(((l=b.data)==null?void 0:l.message)||`Gagal trace (HTTP ${b.status}).`);ne.value=((e=b.data)==null?void 0:e.data)||null,Qe.value=((s=(o=b.data)==null?void 0:o.data)==null?void 0:s.used_cable_ids)||[],Ge();const u=((v=(i=b.data)==null?void 0:i.data)==null?void 0:v.endpoints)||[];u.length>0&&(Ne.value=u[0]),c&&c.success("Trace selesai.")}catch(b){console.error("Fiber: runTrace failed",b),Oe.value=(b==null?void 0:b.message)||"Gagal trace.",c&&c.error(Oe.value)}finally{Me.value=!1}}}return $e([Fe,Ie,Ae],()=>{Mt()}),$e(G,l=>{if(!l){fe.value=!1;return}Le.value==="create"&&(fe.value=!0)}),$e([()=>p.value.from_point_id,()=>p.value.to_point_id],async()=>{if(!G.value||Le.value!=="create"||!fe.value)return;const l=Number(p.value.from_point_id||0),e=Number(p.value.to_point_id||0);if(!l||!e||l===e)return;if(Array.isArray(p.value.path)&&p.value.path.length>=2){fe.value=!1;return}await Ft({force:!1})&&(fe.value=!1)}),$e(()=>p.value.path,()=>{if(!me.value)return;const l=Math.round(xt(p.value.path));Number.isFinite(l)&&l>0&&(p.value.length_m=l)},{deep:!0}),$e(ie,()=>{try{localStorage.setItem("fiber_map_style",ie.value)}catch{}qt()}),$e(W,()=>{try{localStorage.setItem("fiber_follow_road",W.value?"1":"0")}catch{}}),Ra(()=>{try{const e=localStorage.getItem("fiber_map_style");e&&je[e]&&(ie.value=e)}catch{}try{const e=localStorage.getItem("fiber_follow_road");e==="0"&&(W.value=!1),e==="1"&&(W.value=!0)}catch{}xe.value="";const l=(dt.googleMapsApiKey||"").toString().trim();if(!l){xe.value="Google Maps API key belum di-set. Buka Pengaturan -> System -> Google Maps.",j();return}Xt(l).then(()=>{Ba(()=>{Zt(),j()})}).catch(e=>{console.error("Fiber: Google Maps load failed",e),xe.value=(e==null?void 0:e.message)||"Gagal memuat Google Maps.",j()})}),Ka(()=>{Yt()}),(l,e)=>(n(),r(L,null,[Ht(Ha(Ja),{title:"Kabel FO"}),Ht(Xa,null,{default:za(()=>{var o,s,i,v,b,u,x,T,U,F,O,ve,I,Rt,Bt;return[t("div",qa,[t("div",Za,[e[79]||(e[79]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Manajemen Kabel FO"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Pemetaan jalur kabel, titik sambungan, dan data putus.")],-1)),t("div",Ya,[t("div",Qa,[t("span",el,d(Te.value.cables),1),e[75]||(e[75]=t("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"kabel",-1))]),t("div",tl,[t("span",al,d(Te.value.points),1),e[76]||(e[76]=t("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"titik",-1))]),t("div",ll,[t("span",sl,d(Te.value.breaks_open),1),e[77]||(e[77]=t("span",{class:"text-red-600/70 dark:text-red-300/70 ml-1"},"putus aktif",-1))]),t("div",ol,[y(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>ie.value=a),class:"input !py-2 !text-xs"},[...e[78]||(e[78]=[t("option",{value:"roadmap"},"Roadmap",-1),t("option",{value:"hybrid"},"Hybrid",-1),t("option",{value:"satellite"},"Satelit",-1)])],512),[[A,ie.value]]),t("button",{onClick:j,class:"btn btn-secondary !py-2 !text-xs",disabled:Pe.value},"Refresh",8,rl)])])]),dt.warning?(n(),r("div",nl,d(dt.warning),1)):g("",!0),Nt.value?(n(),r("div",ul,[t("div",dl,[t("div",pl,[t("label",vl,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>Fe.value=a)},null,512),[[Xe,Fe.value]]),e[81]||(e[81]=h(" Kabel ",-1))]),t("label",cl,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=a=>Ie.value=a)},null,512),[[Xe,Ie.value]]),e[82]||(e[82]=h(" Titik ",-1))]),t("label",bl,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>Ae.value=a)},null,512),[[Xe,Ae.value]]),e[83]||(e[83]=h(" Putus ",-1))]),t("div",gl,[y(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>ie.value=a),class:"input !py-2 !text-xs"},[...e[84]||(e[84]=[t("option",{value:"roadmap"},"Roadmap",-1),t("option",{value:"hybrid"},"Hybrid",-1),t("option",{value:"satellite"},"Satelit",-1)])],512),[[A,ie.value]]),t("button",{onClick:j,class:"btn btn-secondary !py-2 !text-xs",disabled:Pe.value},"Refresh",8,ml)])]),t("div",fl,[t("div",{ref_key:"mapContainer",ref:pt,class:"w-full h-[420px] lg:h-[calc(100vh-13rem)] bg-slate-100 dark:bg-slate-900"},null,512),xe.value?(n(),r("div",yl,[t("div",kl,[e[85]||(e[85]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Peta tidak dapat dimuat",-1)),t("div",xl,d(xe.value),1)])])):g("",!0),w.value?(n(),r("div",_l,[t("div",hl,[e[86]||(e[86]=h(" Mode peta aktif: ",-1)),t("span",wl,d(w.value==="drawCable"?"gambar kabel":w.value==="editCable"?"edit jalur":w.value==="pickPoint"?"pilih titik":"pilih putus"),1)]),w.value==="editCable"?(n(),r("div",Cl," Geser titik/segmen untuk merapikan jalur, lalu klik tombol Selesai. ")):w.value==="drawCable"?(n(),r("div",Nl,[e[87]||(e[87]=h(" Klik peta untuk menambah titik. Mode: ",-1)),t("span",Pl,d(W.value?"Ikuti jalan":"Garis lurus"),1),e[88]||(e[88]=h(". ",-1)),ce.value?(n(),r("span",Tl,"Menghitung rute...")):g("",!0)])):(n(),r("div",Sl," Klik peta untuk memilih lokasi, lalu klik tombol Selesai. ")),w.value==="drawCable"?(n(),r("label",El,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=a=>W.value=a),disabled:ce.value},null,8,Ll),[[Xe,W.value]]),e[89]||(e[89]=h(" Ikuti jalan ",-1))])):g("",!0),t("div",Ml,[t("button",{class:"btn btn-secondary !py-1 !text-xs",onClick:E,disabled:w.value==="drawCable"&&ce.value},"Selesai",8,Ol),w.value==="drawCable"?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !text-xs",onClick:It,disabled:ce.value},"Undo",8,$l)):g("",!0),w.value==="drawCable"?(n(),r("button",{key:1,class:"btn btn-secondary !py-1 !text-xs",onClick:ht,disabled:ce.value},"Clear",8,Ul)):g("",!0),w.value==="editCable"?(n(),r("button",{key:2,class:"btn btn-secondary !py-1 !text-xs",onClick:ht},"Clear")):g("",!0)])])):g("",!0)])]),t("div",Fl,[t("div",Il,[t("button",{onClick:e[6]||(e[6]=a=>M.value="cables"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",M.value==="cables"?"text-blue-700 dark:text-blue-300 bg-blue-50/60 dark:bg-blue-900/10":"text-gray-600 dark:text-gray-300"])}," Kabel ("+d(H.value.length)+") ",3),t("button",{onClick:e[7]||(e[7]=a=>M.value="points"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",M.value==="points"?"text-teal-700 dark:text-teal-300 bg-teal-50/60 dark:bg-teal-900/10":"text-gray-600 dark:text-gray-300"])}," Titik ("+d(B.value.length)+") ",3),t("button",{onClick:e[8]||(e[8]=a=>M.value="ports"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",M.value==="ports"?"text-indigo-700 dark:text-indigo-300 bg-indigo-50/60 dark:bg-indigo-900/10":"text-gray-600 dark:text-gray-300"])}," Port ("+d(Ue.value.length)+") ",3),t("button",{onClick:e[9]||(e[9]=a=>M.value="links"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",M.value==="links"?"text-amber-700 dark:text-amber-300 bg-amber-50/60 dark:bg-amber-900/10":"text-gray-600 dark:text-gray-300"])}," Sambungan ("+d(Ye.value.length)+") ",3),t("button",{onClick:e[10]||(e[10]=a=>M.value="trace"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",M.value==="trace"?"text-slate-700 dark:text-slate-200 bg-slate-50/60 dark:bg-slate-700/30":"text-gray-600 dark:text-gray-300"])}," Trace ",2),t("button",{onClick:e[11]||(e[11]=a=>M.value="breaks"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",M.value==="breaks"?"text-red-700 dark:text-red-300 bg-red-50/60 dark:bg-red-900/10":"text-gray-600 dark:text-gray-300"])}," Putus ("+d(Se.value.length)+") ",3)]),t("div",Al,[Pe.value?(n(),r("div",jl,"Memuat...")):Ze.value?(n(),r("div",Vl,d(Ze.value),1)):M.value==="cables"?(n(),r("div",Gl,[t("div",Dl,[e[90]||(e[90]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Daftar Kabel",-1)),Q.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:ua},"Tambah")):g("",!0)]),H.value.length===0?(n(),r("div",Rl,"Belum ada data kabel.")):(n(),r("div",Bl,[(n(!0),r(L,null,$(H.value,a=>(n(),r("div",{key:a.id,class:V(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-blue-200 dark:hover:border-blue-900/40 cursor-pointer",Number(ae.value)===Number(a.id)?"bg-blue-50/60 dark:bg-blue-900/10":"bg-white dark:bg-dark-800"]),onClick:S=>{ae.value=a.id,D.value=null,le.value=null,Ge()}},[t("div",Hl,[t("div",null,[t("div",Jl,d(a.name),1),t("div",zl,[a.cable_type?(n(),r("span",Wl,d(a.cable_type),1)):g("",!0),a.core_count?(n(),r("span",Xl,"| "+d(a.core_count)+" core",1)):g("",!0),a.length_m?(n(),r("span",ql,"| "+d($t(a.length_m)),1)):g("",!0)]),a.from_point_id||a.to_point_id?(n(),r("div",Zl,[t("div",null,[e[91]||(e[91]=h("Dari: ",-1)),t("span",Yl,d(se(a.from_point_id)||"-"),1)]),t("div",null,[e[92]||(e[92]=h("Ke: ",-1)),t("span",Ql,d(se(a.to_point_id)||"-"),1)])])):g("",!0)]),t("div",es,[ee.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:oe(S=>da(a),["stop"])},"Edit",8,ts)):g("",!0),te.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:oe(S=>ca(a),["stop"])},"Hapus",8,as)):g("",!0)])])],10,Kl))),128))]))])):M.value==="points"?(n(),r("div",ls,[t("div",ss,[e[93]||(e[93]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Titik Sambungan",-1)),Q.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:fa},"Tambah")):g("",!0)]),B.value.length===0?(n(),r("div",os,"Belum ada data titik.")):(n(),r("div",rs,[(n(!0),r(L,null,$(B.value,a=>(n(),r("div",{key:a.id,class:V(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-teal-200 dark:hover:border-teal-900/40 cursor-pointer",Number(D.value)===Number(a.id)?"bg-teal-50/60 dark:bg-teal-900/10":"bg-white dark:bg-dark-800"]),onClick:S=>{D.value=a.id,ae.value=null,le.value=null,yt(),_e(Number(a.latitude),Number(a.longitude),17)}},[t("div",is,[t("div",null,[t("div",us,d(a.name),1),t("div",ds,[a.point_type?(n(),r("span",ps,d(a.point_type),1)):g("",!0),a.latitude&&a.longitude?(n(),r("span",vs,"| "+d(a.latitude)+", "+d(a.longitude),1)):g("",!0)])]),t("div",cs,[ee.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:oe(S=>ya(a),["stop"])},"Edit",8,bs)):g("",!0),te.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:oe(S=>_a(a),["stop"])},"Hapus",8,gs)):g("",!0)])])],10,ns))),128))]))])):M.value==="ports"?(n(),r("div",ms,[t("div",fs,[e[94]||(e[94]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Port (OLT/ODP)",-1)),Q.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:Ta},"Tambah")):g("",!0)]),Ue.value.length===0?(n(),r("div",ys,"Belum ada data port.")):(n(),r("div",ks,[(n(!0),r(L,null,$(Ue.value,a=>(n(),r("div",{key:a.id,class:"p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-indigo-200 dark:hover:border-indigo-900/40 bg-white dark:bg-dark-800"},[t("div",xs,[t("div",null,[t("div",_s,d(String(a.port_type||"").toUpperCase()),1),t("div",hs,d(a.port_label||"#"+a.id),1),t("div",ws,[t("div",null,[e[95]||(e[95]=h(" Titik: ",-1)),t("span",Cs,d(se(a.point_id)||"#"+a.point_id),1)]),a.cable_id&&a.core_no?(n(),r("div",Ns,[e[96]||(e[96]=h(" Kabel: ",-1)),t("span",Ps,d(ge(a.cable_id)||"Kabel #"+a.cable_id),1),t("span",Ts,"- core "+d(a.core_no),1)])):g("",!0)])]),t("div",Ss,[ee.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:oe(S=>Sa(a),["stop"])},"Edit",8,Es)):g("",!0),te.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:oe(S=>La(a),["stop"])},"Hapus",8,Ls)):g("",!0)])])]))),128))]))])):M.value==="links"?(n(),r("div",Ms,[t("div",Os,[e[97]||(e[97]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Sambungan (Splice/Split)",-1)),Q.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:Ua},"Tambah")):g("",!0)]),Gt.value.length===0?(n(),r("div",$s,"Belum ada data sambungan.")):(n(),r("div",Us,[(n(!0),r(L,null,$(Gt.value,a=>(n(),r("div",{key:a.kind==="SPLIT_GROUP"?"g:"+a.split_group+":"+a.point_id:"l:"+a.id,class:"p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-amber-200 dark:hover:border-amber-900/40 bg-white dark:bg-dark-800"},[t("div",Fs,[t("div",Is,[t("div",As,[h(d(a.kind==="SPLIT_GROUP"?"SPLIT":String(a.link_type||"").toUpperCase())+" ",1),a.kind==="SPLIT_GROUP"?(n(),r("span",js,"- "+d((a.outputs||[]).length)+" output",1)):g("",!0)]),t("div",Vs,[e[98]||(e[98]=h(" Titik: ",-1)),t("span",Gs,d(se(a.point_id)||"#"+a.point_id),1)]),t("div",Ds,[h(d(ge(a.from_cable_id)||"Kabel #"+a.from_cable_id)+" - core "+d(a.from_core_no)+" ",1),e[99]||(e[99]=t("span",{class:"mx-1 text-gray-400"},"->",-1)),a.kind==="SPLIT_GROUP"?(n(),r("span",Rs,"splitter")):(n(),r(L,{key:1},[h(d(ge(a.to_cable_id)||"Kabel #"+a.to_cable_id)+" - core "+d(a.to_core_no),1)],64))]),a.kind==="SPLIT_GROUP"&&(a.outputs||[]).length?(n(),r("div",Bs,[h(" Output: "+d((a.outputs||[]).slice(0,4).map(S=>`${ge(S.to_cable_id)||"#"+S.to_cable_id}:${S.to_core_no}`).join(", ")),1),(a.outputs||[]).length>4?(n(),r("span",Ks,", ...")):g("",!0)])):g("",!0),a.loss_db!==null&&a.loss_db!==void 0&&a.loss_db!==""?(n(),r("div",Hs,[e[100]||(e[100]=h(" Loss: ",-1)),t("span",Js,d(a.loss_db)+" dB",1)])):g("",!0)]),t("div",zs,[ee.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:oe(S=>Fa(a),["stop"])},"Edit",8,Ws)):g("",!0),te.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:oe(S=>Aa(a),["stop"])},"Hapus",8,Xs)):g("",!0)])])]))),128))]))])):M.value==="trace"?(n(),r("div",qs,[t("div",Zs,[e[101]||(e[101]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Tracing End-to-End",-1)),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Va,disabled:Me.value},"Clear",8,Ys)]),t("div",Qs,[t("div",null,[e[103]||(e[103]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Start Port (OLT_PON)",-1)),y(t("select",{"onUpdate:modelValue":e[12]||(e[12]=a=>Re.value=a),class:"input w-full"},[e[102]||(e[102]=t("option",{value:""},"(pilih port)",-1)),(n(!0),r(L,null,$(ja.value,a=>(n(),r("option",{key:a.id,value:a.id},d(se(a.point_id)||"#"+a.point_id)+" | "+d(a.port_label)+" | "+d(ge(a.cable_id)||"Kabel #"+a.cable_id)+":"+d(a.core_no),9,eo))),128))],512),[[A,Re.value]])]),t("div",to,[t("button",{class:"btn btn-primary !py-2 !text-xs",onClick:Ga,disabled:Me.value||!Re.value},d(Me.value?"Tracing...":"Trace"),9,ao),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:j,disabled:Pe.value||Me.value},"Refresh Data",8,lo)]),Oe.value?(n(),r("div",so,d(Oe.value),1)):g("",!0)]),ne.value?(n(),r("div",oo,[t("div",ro,[e[104]||(e[104]=h(" Endpoint: ",-1)),t("span",no,d((ne.value.endpoints||[]).length),1),e[105]||(e[105]=t("span",{class:"mx-2"},"|",-1)),e[106]||(e[106]=h(" Visited: ",-1)),t("span",io,d(ne.value.visited_nodes||0),1),ne.value.truncated?(n(),r("span",uo,"(truncated)")):g("",!0)]),(ne.value.endpoints||[]).length===0?(n(),r("div",po,[...e[107]||(e[107]=[h(" Tidak ada endpoint ",-1),t("span",{class:"font-mono"},"ODP_OUT",-1),h(" terjangkau dari port ini. ",-1)])])):(n(),r("div",vo,[(n(!0),r(L,null,$(ne.value.endpoints||[],(a,S)=>{var R,Be,Ke,He,Je,ze,We,Kt;return n(),r("div",{key:((R=a.port)==null?void 0:R.id)||S,class:V(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-slate-200 dark:hover:border-slate-700 cursor-pointer",Ne.value===a?"bg-slate-50/60 dark:bg-slate-700/30":"bg-white dark:bg-dark-800"]),onClick:Pn=>Ne.value=a},[t("div",bo,d(((Be=a.point)==null?void 0:Be.name)||se((Ke=a.port)==null?void 0:Ke.point_id)||"-"),1),t("div",go,[e[108]||(e[108]=h(" Port: ",-1)),t("span",mo,d(((He=a.port)==null?void 0:He.port_label)||"#"+((Je=a.port)==null?void 0:Je.id)),1),e[109]||(e[109]=t("span",{class:"mx-2"},"|",-1)),h(" "+d(ge((ze=a.port)==null?void 0:ze.cable_id)||"Kabel #"+((We=a.port)==null?void 0:We.cable_id))+":"+d((Kt=a.port)==null?void 0:Kt.core_no),1)])],10,co)}),128))])),(o=Ne.value)!=null&&o.path?(n(),r("div",fo,[e[111]||(e[111]=t("div",{class:"text-xs font-semibold text-gray-900 dark:text-white"},"Path (ringkas)",-1)),t("div",yo,[(n(!0),r(L,null,$(Ne.value.path,(a,S)=>{var R,Be,Ke,He,Je,ze,We;return n(),r("div",{key:S,class:"text-xs"},[t("div",ko,[h(d(S===0?"START":((R=a.edge)==null?void 0:R.type)==="CABLE"?"KABEL":"LINK "+(((Be=a.edge)==null?void 0:Be.link_type)||""))+" ",1),e[110]||(e[110]=t("span",{class:"mx-1 text-gray-400"},"|",-1)),h(" "+d(((Ke=a.point)==null?void 0:Ke.name)||"Titik #"+((He=a.node)==null?void 0:He.point_id)),1)]),t("div",xo,d(((Je=a.cable)==null?void 0:Je.name)||"Kabel #"+((ze=a.node)==null?void 0:ze.cable_id))+" - core "+d((We=a.node)==null?void 0:We.core_no),1)])}),128))])])):g("",!0)])):g("",!0)])):(n(),r("div",_o,[t("div",ho,[e[112]||(e[112]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Data Putus",-1)),Q.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:ha},"Tambah")):g("",!0)]),Se.value.length===0?(n(),r("div",wo,"Belum ada data putus.")):(n(),r("div",Co,[(n(!0),r(L,null,$(Se.value,a=>(n(),r("div",{key:a.id,class:V(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-red-200 dark:hover:border-red-900/40 cursor-pointer",Number(le.value)===Number(a.id)?"bg-red-50/60 dark:bg-red-900/10":"bg-white dark:bg-dark-800"]),onClick:S=>{le.value=a.id,ae.value=null,D.value=null,kt(),_e(Number(a.latitude),Number(a.longitude),17)}},[t("div",Po,[t("div",null,[t("div",To,d(na(a.status)),1),t("div",So,d(ge(a.cable_id)||(a.cable_id?"Kabel #"+a.cable_id:"Tanpa kabel")),1),t("div",Eo,[t("span",null,"Titik: "+d(se(a.point_id)||"-"),1),a.severity?(n(),r("span",Lo,"| "+d(a.severity),1)):g("",!0)]),a.description?(n(),r("div",Mo,d(a.description),1)):g("",!0)]),t("div",Oo,[ee.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:oe(S=>wa(a),["stop"])},"Edit",8,$o)):g("",!0),te.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:oe(S=>Pa(a),["stop"])},"Hapus",8,Uo)):g("",!0)])])],10,No))),128))]))]))])])])):(n(),r("div",il,[...e[80]||(e[80]=[t("div",{class:"text-gray-900 dark:text-white font-semibold"},"Tidak punya akses",-1),t("div",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},[h(" Butuh permission "),t("code",{class:"px-1 py-0.5 bg-gray-100 dark:bg-dark-700 rounded"},"view fiber"),h(". ")],-1)])]))]),G.value?(n(),r("div",{key:0,class:V(["fixed inset-0 z-[10000] flex items-center justify-center p-4",w.value?"pointer-events-none":""])},[t("div",{class:V(["absolute inset-0 bg-black/40",w.value?"pointer-events-none opacity-20":""]),onClick:e[13]||(e[13]=a=>{G.value=!1,E()})},null,2),t("div",Fo,[t("div",Io,[t("div",Ao,d(Le.value==="edit"?"Edit Kabel":"Tambah Kabel"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[14]||(e[14]=a=>{G.value=!1,E()})},"Tutup")]),t("div",jo,[t("div",Vo,[t("div",null,[e[113]||(e[113]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Nama",-1)),y(t("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>p.value.name=a),class:"input w-full",placeholder:"Feeder ODC-POP A"},null,512),[[C,p.value.name]]),q.value.name?(n(),r("div",Go,d((s=q.value.name)==null?void 0:s[0]),1)):g("",!0)]),t("div",null,[e[114]||(e[114]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kode (opsional)",-1)),y(t("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>p.value.code=a),class:"input w-full",placeholder:"FO-001"},null,512),[[C,p.value.code]]),q.value.code?(n(),r("div",Do,d((i=q.value.code)==null?void 0:i[0]),1)):g("",!0)]),t("div",null,[e[115]||(e[115]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(t("input",{"onUpdate:modelValue":e[17]||(e[17]=a=>p.value.cable_type=a),class:"input w-full",placeholder:"FEEDER / DISTRIBUTION / DROP"},null,512),[[C,p.value.cable_type]]),q.value.cable_type?(n(),r("div",Ro,d((v=q.value.cable_type)==null?void 0:v[0]),1)):g("",!0)]),t("div",null,[e[116]||(e[116]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Core",-1)),y(t("input",{"onUpdate:modelValue":e[18]||(e[18]=a=>p.value.core_count=a),type:"number",min:"1",class:"input w-full",placeholder:"12"},null,512),[[C,p.value.core_count]]),q.value.core_count?(n(),r("div",Bo,d((b=q.value.core_count)==null?void 0:b[0]),1)):g("",!0)]),t("div",Ko,[e[118]||(e[118]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Panjang (meter)",-1)),t("div",Ho,[y(t("input",{"onUpdate:modelValue":e[19]||(e[19]=a=>p.value.length_m=a),type:"number",min:"0",class:"input w-full sm:flex-1",placeholder:"(opsional)",onInput:e[20]||(e[20]=a=>me.value=!1)},null,544),[[C,p.value.length_m]]),t("button",{class:"btn btn-secondary shrink-0 !py-2 !text-xs",onClick:ma},"Hitung dari jalur")]),t("div",Jo,[e[117]||(e[117]=h(" Estimasi dari jalur: ",-1)),t("span",zo,d($t(_t.value)),1),t("span",Wo,"("+d(_t.value)+" m)",1),me.value?(n(),r("span",Xo,"[auto]")):g("",!0)])]),t("div",null,[e[120]||(e[120]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Dari Titik",-1)),y(t("select",{"onUpdate:modelValue":e[21]||(e[21]=a=>p.value.from_point_id=a),class:"input w-full"},[e[119]||(e[119]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(L,null,$(B.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,qo))),128))],512),[[A,p.value.from_point_id]])]),t("div",null,[e[122]||(e[122]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Ke Titik",-1)),y(t("select",{"onUpdate:modelValue":e[22]||(e[22]=a=>p.value.to_point_id=a),class:"input w-full"},[e[121]||(e[121]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(L,null,$(B.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,Zo))),128))],512),[[A,p.value.to_point_id]])]),t("div",Yo,[e[123]||(e[123]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Warna Jalur",-1)),t("div",Qo,[y(t("input",{"onUpdate:modelValue":e[23]||(e[23]=a=>p.value.map_color=a),type:"color",class:"h-10 w-14 rounded border border-gray-200 dark:border-dark-700 bg-transparent"},null,512),[[C,p.value.map_color]]),y(t("input",{"onUpdate:modelValue":e[24]||(e[24]=a=>p.value.map_color=a),class:"input flex-1",placeholder:"#2563eb"},null,512),[[C,p.value.map_color]])])]),t("div",er,[e[124]||(e[124]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(t("textarea",{"onUpdate:modelValue":e[25]||(e[25]=a=>p.value.notes=a),class:"input w-full min-h-[80px]",placeholder:"Keterangan kabel..."},null,512),[[C,p.value.notes]])])]),t("div",tr,[t("div",ar,[t("div",null,[e[125]||(e[125]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Jalur di Peta",-1)),t("div",lr,"Titik: "+d(Array.isArray(p.value.path)?p.value.path.length:0),1)]),t("div",sr,[t("label",or,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[26]||(e[26]=a=>W.value=a)},null,512),[[Xe,W.value]]),e[126]||(e[126]=h(" Ikuti jalan ",-1))]),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:e[27]||(e[27]=a=>Ft({force:!0})),disabled:!p.value.from_point_id||!p.value.to_point_id}," Auto ",8,rr),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:ba},"Gambar"),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:ga,disabled:!p.value.path||p.value.path.length<2},"Edit",8,nr),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:It,disabled:!p.value.path||p.value.path.length===0},"Undo",8,ir),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:ht,disabled:!p.value.path||p.value.path.length===0},"Clear",8,ur)])]),e[127]||(e[127]=t("div",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},[h(" Tips: mode "),t("span",{class:"font-semibold"},"Ikuti jalan"),h(" memakai Google Directions. Jika gagal/limit, otomatis fallback ke garis lurus. Jalur bisa dirapikan lewat tombol "),t("span",{class:"font-semibold"},"Edit"),h(". ")],-1))])]),t("div",dr,[t("button",{class:"btn btn-secondary",onClick:e[28]||(e[28]=a=>{G.value=!1,E()})},"Batal"),t("button",{class:"btn btn-primary",disabled:tt.value,onClick:va},d(tt.value?"Menyimpan...":"Simpan"),9,pr)])])],2)):g("",!0),Z.value?(n(),r("div",{key:1,class:V(["fixed inset-0 z-[10000] flex items-center justify-center p-4",w.value?"pointer-events-none":""])},[t("div",{class:V(["absolute inset-0 bg-black/40",w.value?"pointer-events-none opacity-20":""]),onClick:e[29]||(e[29]=a=>{Z.value=!1,E()})},null,2),t("div",vr,[t("div",cr,[t("div",br,d(at.value==="edit"?"Edit Titik":"Tambah Titik"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[30]||(e[30]=a=>{Z.value=!1,E()})},"Tutup")]),t("div",gr,[t("div",null,[e[128]||(e[128]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Nama",-1)),y(t("input",{"onUpdate:modelValue":e[31]||(e[31]=a=>_.value.name=a),class:"input w-full",placeholder:"ODP-01 / Joint A"},null,512),[[C,_.value.name]]),de.value.name?(n(),r("div",mr,d((u=de.value.name)==null?void 0:u[0]),1)):g("",!0)]),t("div",null,[e[129]||(e[129]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(t("input",{"onUpdate:modelValue":e[32]||(e[32]=a=>_.value.point_type=a),class:"input w-full",placeholder:"ODP / ODC / JOINT / HANDHOLE"},null,512),[[C,_.value.point_type]])]),t("div",fr,[t("div",null,[e[130]||(e[130]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Latitude",-1)),y(t("input",{"onUpdate:modelValue":e[33]||(e[33]=a=>_.value.latitude=a),class:"input w-full",placeholder:"-6.2"},null,512),[[C,_.value.latitude]]),de.value.latitude?(n(),r("div",yr,d((x=de.value.latitude)==null?void 0:x[0]),1)):g("",!0)]),t("div",null,[e[131]||(e[131]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Longitude",-1)),y(t("input",{"onUpdate:modelValue":e[34]||(e[34]=a=>_.value.longitude=a),class:"input w-full",placeholder:"106.8"},null,512),[[C,_.value.longitude]]),de.value.longitude?(n(),r("div",kr,d((T=de.value.longitude)==null?void 0:T[0]),1)):g("",!0)])]),t("div",xr,[t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:ka},"Pilih dari peta"),_.value.latitude&&_.value.longitude?(n(),r("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[35]||(e[35]=a=>_e(Number(_.value.latitude),Number(_.value.longitude),18))},"Zoom")):g("",!0)]),t("div",null,[e[132]||(e[132]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Alamat",-1)),y(t("input",{"onUpdate:modelValue":e[36]||(e[36]=a=>_.value.address=a),class:"input w-full",placeholder:"(opsional)"},null,512),[[C,_.value.address]])]),t("div",null,[e[133]||(e[133]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(t("textarea",{"onUpdate:modelValue":e[37]||(e[37]=a=>_.value.notes=a),class:"input w-full min-h-[80px]",placeholder:"(opsional)"},null,512),[[C,_.value.notes]])])]),t("div",_r,[t("button",{class:"btn btn-secondary",onClick:e[38]||(e[38]=a=>{Z.value=!1,E()})},"Batal"),t("button",{class:"btn btn-primary",disabled:lt.value,onClick:xa},d(lt.value?"Menyimpan...":"Simpan"),9,hr)])])],2)):g("",!0),Y.value?(n(),r("div",{key:2,class:V(["fixed inset-0 z-[10000] flex items-center justify-center p-4",w.value?"pointer-events-none":""])},[t("div",{class:V(["absolute inset-0 bg-black/40",w.value?"pointer-events-none opacity-20":""]),onClick:e[39]||(e[39]=a=>{Y.value=!1,E()})},null,2),t("div",wr,[t("div",Cr,[t("div",Nr,d(st.value==="edit"?"Edit Data Putus":"Tambah Data Putus"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[40]||(e[40]=a=>{Y.value=!1,E()})},"Tutup")]),t("div",Pr,[t("div",null,[e[135]||(e[135]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kabel",-1)),y(t("select",{"onUpdate:modelValue":e[41]||(e[41]=a=>k.value.cable_id=a),class:"input w-full"},[e[134]||(e[134]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(L,null,$(H.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,Tr))),128))],512),[[A,k.value.cable_id]])]),t("div",null,[e[137]||(e[137]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik (opsional)",-1)),y(t("select",{"onUpdate:modelValue":e[42]||(e[42]=a=>k.value.point_id=a),class:"input w-full"},[e[136]||(e[136]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(L,null,$(B.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,Sr))),128))],512),[[A,k.value.point_id]])]),t("div",Er,[t("div",null,[e[139]||(e[139]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Status",-1)),y(t("select",{"onUpdate:modelValue":e[43]||(e[43]=a=>k.value.status=a),class:"input w-full"},[...e[138]||(e[138]=[t("option",{value:"OPEN"},"OPEN",-1),t("option",{value:"IN_PROGRESS"},"IN_PROGRESS",-1),t("option",{value:"FIXED"},"FIXED",-1),t("option",{value:"CANCELLED"},"CANCELLED",-1)])],512),[[A,k.value.status]])]),t("div",null,[e[141]||(e[141]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Severity",-1)),y(t("select",{"onUpdate:modelValue":e[44]||(e[44]=a=>k.value.severity=a),class:"input w-full"},[...e[140]||(e[140]=[t("option",{value:""},"(kosong)",-1),t("option",{value:"MINOR"},"MINOR",-1),t("option",{value:"MAJOR"},"MAJOR",-1),t("option",{value:"CRITICAL"},"CRITICAL",-1)])],512),[[A,k.value.severity]])])]),t("div",Lr,[t("div",null,[e[142]||(e[142]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Dilaporkan",-1)),y(t("input",{"onUpdate:modelValue":e[45]||(e[45]=a=>k.value.reported_at=a),type:"datetime-local",class:"input w-full"},null,512),[[C,k.value.reported_at]])]),t("div",null,[e[143]||(e[143]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Fixed At",-1)),y(t("input",{"onUpdate:modelValue":e[46]||(e[46]=a=>k.value.fixed_at=a),type:"datetime-local",class:"input w-full",disabled:String(k.value.status).toUpperCase()!=="FIXED"},null,8,Mr),[[C,k.value.fixed_at]])])]),t("div",Or,[t("div",null,[e[144]||(e[144]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Latitude",-1)),y(t("input",{"onUpdate:modelValue":e[47]||(e[47]=a=>k.value.latitude=a),class:"input w-full",placeholder:"-6.2"},null,512),[[C,k.value.latitude]]),he.value.latitude?(n(),r("div",$r,d((U=he.value.latitude)==null?void 0:U[0]),1)):g("",!0)]),t("div",null,[e[145]||(e[145]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Longitude",-1)),y(t("input",{"onUpdate:modelValue":e[48]||(e[48]=a=>k.value.longitude=a),class:"input w-full",placeholder:"106.8"},null,512),[[C,k.value.longitude]]),he.value.longitude?(n(),r("div",Ur,d((F=he.value.longitude)==null?void 0:F[0]),1)):g("",!0)])]),t("div",Fr,[t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Ca},"Pilih dari peta"),k.value.latitude&&k.value.longitude?(n(),r("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[49]||(e[49]=a=>_e(Number(k.value.latitude),Number(k.value.longitude),18))},"Zoom")):g("",!0)]),t("div",null,[e[146]||(e[146]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(t("textarea",{"onUpdate:modelValue":e[50]||(e[50]=a=>k.value.description=a),class:"input w-full min-h-[90px]",placeholder:"Keterangan kejadian putus..."},null,512),[[C,k.value.description]])])]),t("div",Ir,[t("button",{class:"btn btn-secondary",onClick:e[51]||(e[51]=a=>{Y.value=!1,E()})},"Batal"),t("button",{class:"btn btn-primary",disabled:ot.value,onClick:Na},d(ot.value?"Menyimpan...":"Simpan"),9,Ar)])])],2)):g("",!0),we.value?(n(),r("div",jr,[t("div",{class:"absolute inset-0 bg-black/40",onClick:e[52]||(e[52]=a=>we.value=!1)}),t("div",Vr,[t("div",Gr,[t("div",Dr,d(rt.value==="edit"?"Edit Port":"Tambah Port"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[53]||(e[53]=a=>we.value=!1)},"Tutup")]),t("div",Rr,[t("div",null,[e[148]||(e[148]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik",-1)),y(t("select",{"onUpdate:modelValue":e[54]||(e[54]=a=>P.value.point_id=a),class:"input w-full"},[e[147]||(e[147]=t("option",{value:""},"(pilih titik)",-1)),(n(!0),r(L,null,$(B.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,Br))),128))],512),[[A,P.value.point_id]]),Ce.value.point_id?(n(),r("div",Kr,d((O=Ce.value.point_id)==null?void 0:O[0]),1)):g("",!0)]),t("div",Hr,[t("div",null,[e[150]||(e[150]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(t("select",{"onUpdate:modelValue":e[55]||(e[55]=a=>P.value.port_type=a),class:"input w-full"},[...e[149]||(e[149]=[t("option",{value:"OLT_PON"},"OLT_PON",-1),t("option",{value:"ODP_OUT"},"ODP_OUT",-1)])],512),[[A,P.value.port_type]])]),t("div",null,[e[151]||(e[151]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Label",-1)),y(t("input",{"onUpdate:modelValue":e[56]||(e[56]=a=>P.value.port_label=a),class:"input w-full",placeholder:"PON 1/1/1 / OUT 1"},null,512),[[C,P.value.port_label]]),Ce.value.port_label?(n(),r("div",Jr,d((ve=Ce.value.port_label)==null?void 0:ve[0]),1)):g("",!0)])]),t("div",zr,[t("div",null,[e[153]||(e[153]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kabel",-1)),y(t("select",{"onUpdate:modelValue":e[57]||(e[57]=a=>P.value.cable_id=a),class:"input w-full"},[e[152]||(e[152]=t("option",{value:""},"(pilih kabel)",-1)),(n(!0),r(L,null,$(H.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,Wr))),128))],512),[[A,P.value.cable_id]])]),t("div",null,[e[154]||(e[154]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Core",-1)),y(t("input",{"onUpdate:modelValue":e[58]||(e[58]=a=>P.value.core_no=a),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[C,P.value.core_no]])])]),t("div",null,[e[155]||(e[155]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(t("textarea",{"onUpdate:modelValue":e[59]||(e[59]=a=>P.value.notes=a),class:"input w-full min-h-[90px]",placeholder:"(opsional)"},null,512),[[C,P.value.notes]])])]),t("div",Xr,[t("button",{class:"btn btn-secondary",onClick:e[60]||(e[60]=a=>we.value=!1)},"Batal"),t("button",{class:"btn btn-primary",disabled:nt.value,onClick:Ea},d(nt.value?"Menyimpan...":"Simpan"),9,qr)])])])):g("",!0),ye.value?(n(),r("div",Zr,[t("div",{class:"absolute inset-0 bg-black/40",onClick:e[61]||(e[61]=a=>ye.value=!1)}),t("div",Yr,[t("div",Qr,[t("div",en,d(it.value==="edit"?"Edit Sambungan":"Tambah Sambungan"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[62]||(e[62]=a=>ye.value=!1)},"Tutup")]),t("div",tn,[t("div",null,[e[157]||(e[157]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik",-1)),y(t("select",{"onUpdate:modelValue":e[63]||(e[63]=a=>f.value.point_id=a),class:"input w-full"},[e[156]||(e[156]=t("option",{value:""},"(pilih titik)",-1)),(n(!0),r(L,null,$(B.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,an))),128))],512),[[A,f.value.point_id]]),pe.value.point_id?(n(),r("div",ln,d((I=pe.value.point_id)==null?void 0:I[0]),1)):g("",!0)]),t("div",sn,[t("div",null,[e[159]||(e[159]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(t("select",{"onUpdate:modelValue":e[64]||(e[64]=a=>f.value.link_type=a),class:"input w-full"},[...e[158]||(e[158]=[t("option",{value:"SPLICE"},"SPLICE",-1),t("option",{value:"PATCH"},"PATCH",-1),t("option",{value:"SPLIT"},"SPLIT",-1)])],512),[[A,f.value.link_type]])]),t("div",null,[e[160]||(e[160]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Loss (dB)",-1)),y(t("input",{"onUpdate:modelValue":e[65]||(e[65]=a=>f.value.loss_db=a),class:"input w-full",placeholder:"0.20"},null,512),[[C,f.value.loss_db]])])]),t("div",on,[t("div",null,[e[162]||(e[162]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"From Cable",-1)),y(t("select",{"onUpdate:modelValue":e[66]||(e[66]=a=>f.value.from_cable_id=a),class:"input w-full"},[e[161]||(e[161]=t("option",{value:""},"(pilih kabel)",-1)),(n(!0),r(L,null,$(H.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,rn))),128))],512),[[A,f.value.from_cable_id]]),pe.value.from_cable_id?(n(),r("div",nn,d((Rt=pe.value.from_cable_id)==null?void 0:Rt[0]),1)):g("",!0)]),t("div",null,[e[163]||(e[163]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"From Core",-1)),y(t("input",{"onUpdate:modelValue":e[67]||(e[67]=a=>f.value.from_core_no=a),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[C,f.value.from_core_no]]),pe.value.from_core_no?(n(),r("div",un,d((Bt=pe.value.from_core_no)==null?void 0:Bt[0]),1)):g("",!0)])]),String(f.value.link_type).toUpperCase()!=="SPLIT"?(n(),r("div",dn,[t("div",null,[e[165]||(e[165]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"To Cable",-1)),y(t("select",{"onUpdate:modelValue":e[68]||(e[68]=a=>f.value.to_cable_id=a),class:"input w-full"},[e[164]||(e[164]=t("option",{value:""},"(pilih kabel)",-1)),(n(!0),r(L,null,$(H.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,pn))),128))],512),[[A,f.value.to_cable_id]])]),t("div",null,[e[166]||(e[166]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"To Core",-1)),y(t("input",{"onUpdate:modelValue":e[69]||(e[69]=a=>f.value.to_core_no=a),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[C,f.value.to_core_no]])])])):(n(),r("div",vn,[t("div",cn,[t("div",null,[e[167]||(e[167]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Splitter Group (opsional)",-1)),y(t("input",{"onUpdate:modelValue":e[70]||(e[70]=a=>f.value.split_group=a),class:"input w-full",placeholder:"ODP-01 1:8"},null,512),[[C,f.value.split_group]])]),t("div",null,[e[168]||(e[168]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Jumlah Output",-1)),t("div",bn,[y(t("input",{"onUpdate:modelValue":e[71]||(e[71]=a=>De.value=a),type:"number",min:"1",max:"64",class:"input w-full"},null,512),[[C,De.value]]),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:e[72]||(e[72]=a=>Ma(De.value))},"Buat"),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Oa},"Tambah")])])]),(f.value.outputs||[]).length===0?(n(),r("div",gn,[...e[169]||(e[169]=[h(" Output masih kosong. Klik ",-1),t("span",{class:"font-semibold"},"Buat",-1),h(" untuk generate baris output. ",-1)])])):(n(),r("div",mn,[(n(!0),r(L,null,$(f.value.outputs,(a,S)=>(n(),r("div",{key:S,class:"grid grid-cols-12 gap-2 items-center"},[t("div",fn,[y(t("select",{"onUpdate:modelValue":R=>a.to_cable_id=R,class:"input w-full"},[e[170]||(e[170]=t("option",{value:""},"(kabel output)",-1)),(n(!0),r(L,null,$(H.value,R=>(n(),r("option",{key:R.id,value:R.id},d(R.name),9,kn))),128))],8,yn),[[A,a.to_cable_id]])]),t("div",xn,[y(t("input",{"onUpdate:modelValue":R=>a.to_core_no=R,type:"number",min:"1",class:"input w-full",placeholder:"core"},null,8,_n),[[C,a.to_core_no]])]),t("div",hn,[t("button",{class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:R=>$a(S)},"Hapus",8,wn)])]))),128))]))])),t("div",null,[e[171]||(e[171]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(t("textarea",{"onUpdate:modelValue":e[73]||(e[73]=a=>f.value.notes=a),class:"input w-full min-h-[90px]",placeholder:"(opsional)"},null,512),[[C,f.value.notes]])])]),t("div",Cn,[t("button",{class:"btn btn-secondary",onClick:e[74]||(e[74]=a=>ye.value=!1)},"Batal"),t("button",{class:"btn btn-primary",disabled:ut.value,onClick:Ia},d(ut.value?"Menyimpan...":"Simpan"),9,Nn)])])])):g("",!0)]}),_:1})],64))}};export{En as default};
