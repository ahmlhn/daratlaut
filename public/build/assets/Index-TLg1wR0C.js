import{r as i,o as U,c as n,a as P,u as A,h as N,m as O,b as t,f as S,v as C,j as l,t as o,e as $,F as u,s as m,J as T,y as j}from"./app--4A5_vJn.js";import{_ as G}from"./AdminLayout-4k71Has-.js";const H={class:"p-6"},J={class:"flex justify-between items-center mb-6"},z={class:"flex gap-3"},Y={key:0,class:"flex items-center justify-center py-20"},q={key:1},K={key:0,class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},Q={class:"card p-4"},W={class:"text-2xl font-bold"},X={class:"text-xs text-green-600"},Z={class:"card p-4"},tt={class:"text-2xl font-bold text-green-600"},st={class:"text-xs text-gray-500"},et={class:"card p-4"},at={class:"text-2xl font-bold text-yellow-600"},ot={class:"text-xs text-red-600"},nt={class:"card p-4"},lt={class:"text-2xl font-bold"},dt={class:"text-xs text-gray-500"},rt={class:"grid md:grid-cols-2 gap-6 mb-6"},it={class:"card p-4"},ct={class:"h-48 flex items-end gap-1"},ut={class:"text-xs text-gray-500 mt-1 rotate-[-45deg] origin-top-left whitespace-nowrap"},pt={class:"card p-4"},mt={class:"h-48 flex items-end gap-1"},vt={class:"text-xs text-gray-500 mt-1 rotate-[-45deg] origin-top-left whitespace-nowrap"},xt={class:"grid md:grid-cols-2 gap-6 mb-6"},yt={class:"card p-4"},_t={class:"min-w-full text-sm"},ht={class:"px-3 py-2"},gt={class:"px-3 py-2 text-right"},ft={class:"px-3 py-2 text-right"},bt={class:"card p-4"},wt={class:"min-w-full text-sm"},kt={class:"px-3 py-2"},Pt={class:"px-3 py-2 text-right"},St={class:"card p-4 mb-6"},Ct={class:"min-w-full text-sm"},$t={class:"px-3 py-2"},Tt={class:"px-3 py-2"},jt={class:"px-3 py-2 text-right font-medium"},Ft={key:1,class:"grid md:grid-cols-2 gap-6 mb-6"},It={class:"card p-4"},Rt={class:"space-y-2"},Dt={class:"font-medium"},Lt={class:"card p-4"},Mt={class:"space-y-2"},Vt={class:"font-medium"},Bt={class:"card p-4"},Et={class:"flex flex-wrap gap-3"},p="/api/v1/reports",Ot={__name:"Index",setup(Ut){const x=i(!1),d=i({start_date:new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0],end_date:new Date().toISOString().split("T")[0]}),r=i(null),y=i([]),_=i([]),v=i(null),f=i([]),b=i([]),w=i([]);function h(a){return new Intl.NumberFormat("id-ID").format(a||0)}async function F(){try{const a=new URLSearchParams({start_date:d.value.start_date,end_date:d.value.end_date}),e=await(await fetch(`${p}/summary?${a}`)).json();e.status==="ok"&&(r.value=e.data)}catch(a){console.error("Failed to load summary:",a)}}async function I(){try{const s=await(await fetch(`${p}/revenue-chart?months=12`)).json();s.status==="ok"&&(y.value=s.data)}catch(a){console.error("Failed to load revenue chart:",a)}}async function R(){try{const s=await(await fetch(`${p}/customer-growth?months=12`)).json();s.status==="ok"&&(_.value=s.data)}catch(a){console.error("Failed to load customer growth:",a)}}async function D(){try{const a=new URLSearchParams({start_date:d.value.start_date,end_date:d.value.end_date}),e=await(await fetch(`${p}/installation-stats?${a}`)).json();e.status==="ok"&&(v.value=e.data)}catch(a){console.error("Failed to load installation stats:",a)}}async function L(){try{const a=new URLSearchParams({start_date:d.value.start_date,end_date:d.value.end_date}),e=await(await fetch(`${p}/payment-methods?${a}`)).json();e.status==="ok"&&(f.value=e.data)}catch(a){console.error("Failed to load payment methods:",a)}}async function M(){try{const s=await(await fetch(`${p}/plan-popularity`)).json();s.status==="ok"&&(b.value=s.data)}catch(a){console.error("Failed to load plan popularity:",a)}}async function V(){try{const s=await(await fetch(`${p}/top-customers?limit=10`)).json();s.status==="ok"&&(w.value=s.data)}catch(a){console.error("Failed to load top customers:",a)}}async function k(){x.value=!0,await Promise.all([F(),I(),R(),D(),L(),M(),V()]),x.value=!1}function g(a){const s=new URLSearchParams({type:a,start_date:d.value.start_date,end_date:d.value.end_date});window.open(`${p}/export?${s}`,"_blank")}const B=j(()=>Math.max(...y.value.map(a=>a.revenue),1)),E=j(()=>Math.max(..._.value.map(a=>a.count),1));return U(()=>{k()}),(a,s)=>(l(),n(u,null,[P(A(N),{title:"Laporan & Analitik"}),P(G,null,{default:O(()=>[t("div",H,[t("div",J,[s[5]||(s[5]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-800"},"Laporan & Analitik"),t("p",{class:"text-gray-600"},"Statistik dan analisis bisnis")],-1)),t("div",z,[S(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>d.value.start_date=e),type:"date",class:"input"},null,512),[[C,d.value.start_date]]),S(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>d.value.end_date=e),type:"date",class:"input"},null,512),[[C,d.value.end_date]]),t("button",{onClick:k,class:"btn btn-primary"},"Refresh")])]),x.value?(l(),n("div",Y,[...s[6]||(s[6]=[t("div",{class:"text-gray-500"},"Loading...",-1)])])):(l(),n("div",q,[r.value?(l(),n("div",K,[t("div",Q,[s[7]||(s[7]=t("div",{class:"text-sm text-gray-500"},"Total Pelanggan",-1)),t("div",W,o(r.value.customers.total),1),t("div",X,o(r.value.customers.active)+" aktif",1)]),t("div",Z,[s[8]||(s[8]=t("div",{class:"text-sm text-gray-500"},"Total Pendapatan",-1)),t("div",tt,"Rp "+o(h(r.value.revenue.total)),1),t("div",st,o(r.value.revenue.paid_invoices)+" invoice lunas",1)]),t("div",et,[s[9]||(s[9]=t("div",{class:"text-sm text-gray-500"},"Invoice Pending",-1)),t("div",at,o(r.value.revenue.open_invoices),1),t("div",ot,o(r.value.revenue.overdue_invoices)+" overdue",1)]),t("div",nt,[s[10]||(s[10]=t("div",{class:"text-sm text-gray-500"},"Pasang Baru",-1)),t("div",lt,o(r.value.installations.completed),1),t("div",dt,o(r.value.installations.pending)+" pending",1)])])):$("",!0),t("div",rt,[t("div",it,[s[11]||(s[11]=t("h3",{class:"font-semibold mb-4"},"Pendapatan 12 Bulan Terakhir",-1)),t("div",ct,[(l(!0),n(u,null,m(y.value,(e,c)=>(l(),n("div",{key:c,class:"flex-1 flex flex-col items-center"},[t("div",{class:"w-full bg-primary-500 rounded-t transition-all",style:T({height:e.revenue/B.value*100+"%",minHeight:"4px"})},null,4),t("div",ut,o(e.month.split(" ")[0]),1)]))),128))])]),t("div",pt,[s[12]||(s[12]=t("h3",{class:"font-semibold mb-4"},"Pertumbuhan Pelanggan",-1)),t("div",mt,[(l(!0),n(u,null,m(_.value,(e,c)=>(l(),n("div",{key:c,class:"flex-1 flex flex-col items-center"},[t("div",{class:"w-full bg-green-500 rounded-t transition-all",style:T({height:e.count/E.value*100+"%",minHeight:"4px"})},null,4),t("div",vt,o(e.month.split(" ")[0]),1)]))),128))])])]),t("div",xt,[t("div",yt,[s[14]||(s[14]=t("h3",{class:"font-semibold mb-4"},"Metode Pembayaran",-1)),t("table",_t,[s[13]||(s[13]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left"},"Metode"),t("th",{class:"px-3 py-2 text-right"},"Jumlah"),t("th",{class:"px-3 py-2 text-right"},"Total")])],-1)),t("tbody",null,[(l(!0),n(u,null,m(f.value,e=>(l(),n("tr",{key:e.payment_method,class:"border-b"},[t("td",ht,o(e.payment_method||"Lainnya"),1),t("td",gt,o(e.count),1),t("td",ft,"Rp "+o(h(e.total)),1)]))),128))])])]),t("div",bt,[s[16]||(s[16]=t("h3",{class:"font-semibold mb-4"},"Paket Terpopuler",-1)),t("table",wt,[s[15]||(s[15]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left"},"Paket"),t("th",{class:"px-3 py-2 text-right"},"Pelanggan")])],-1)),t("tbody",null,[(l(!0),n(u,null,m(b.value,e=>(l(),n("tr",{key:e.name,class:"border-b"},[t("td",kt,o(e.name),1),t("td",Pt,o(e.count),1)]))),128))])])])]),t("div",St,[s[18]||(s[18]=t("h3",{class:"font-semibold mb-4"},"Top 10 Pelanggan (Total Pembayaran)",-1)),t("table",Ct,[s[17]||(s[17]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left"},"#"),t("th",{class:"px-3 py-2 text-left"},"Nama"),t("th",{class:"px-3 py-2 text-right"},"Total Bayar")])],-1)),t("tbody",null,[(l(!0),n(u,null,m(w.value,(e,c)=>(l(),n("tr",{key:e.id,class:"border-b"},[t("td",$t,o(c+1),1),t("td",Tt,o(e.name),1),t("td",jt,"Rp "+o(h(e.total_paid)),1)]))),128))])])]),v.value?(l(),n("div",Ft,[t("div",It,[s[19]||(s[19]=t("h3",{class:"font-semibold mb-4"},"Status Instalasi",-1)),t("div",Rt,[(l(!0),n(u,null,m(v.value.by_status,(e,c)=>(l(),n("div",{key:c,class:"flex justify-between py-2 border-b"},[t("span",null,o(c),1),t("span",Dt,o(e),1)]))),128))])]),t("div",Lt,[s[20]||(s[20]=t("h3",{class:"font-semibold mb-4"},"Instalasi per POP (Top 10)",-1)),t("div",Mt,[(l(!0),n(u,null,m(v.value.by_pop,e=>(l(),n("div",{key:e.pop,class:"flex justify-between py-2 border-b"},[t("span",null,o(e.pop||"Tidak ada POP"),1),t("span",Vt,o(e.count),1)]))),128))])])])):$("",!0),t("div",Bt,[s[21]||(s[21]=t("h3",{class:"font-semibold mb-4"},"Export Data",-1)),t("div",Et,[t("button",{onClick:s[2]||(s[2]=e=>g("payments")),class:"btn bg-green-100 text-green-700 hover:bg-green-200"}," ðŸ“Š Export Pembayaran (CSV) "),t("button",{onClick:s[3]||(s[3]=e=>g("customers")),class:"btn bg-blue-100 text-blue-700 hover:bg-blue-200"}," ðŸ‘¥ Export Pelanggan (CSV) "),t("button",{onClick:s[4]||(s[4]=e=>g("invoices")),class:"btn bg-purple-100 text-purple-700 hover:bg-purple-200"}," ðŸ“„ Export Invoice (CSV) ")])])]))])]),_:1})],64))}};export{Ot as default};
