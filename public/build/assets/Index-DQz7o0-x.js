import{o as ae,A as b,c as r,a as H,u as se,h as le,m as ne,b as e,t as n,d as oe,f as d,q as z,v as m,j as o,F as P,s as M,x as V,e as f,n as re,B as ie,T as de,w as ue,r as p,y as G}from"./app-CSktj_Z2.js";import{_ as pe}from"./AdminLayout-C-4Iczwe.js";const me={class:"space-y-6"},ve={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},xe={class:"text-2xl font-semibold text-gray-900"},ce={class:"grid grid-cols-2 gap-4 md:grid-cols-4"},ge={class:"card flex items-center gap-3"},ye={class:"text-xl font-semibold text-gray-900 dark:text-white"},fe={class:"card flex items-center gap-3"},be={class:"text-xl font-semibold text-gray-900 dark:text-white"},ke={class:"card flex items-center gap-3"},_e={class:"text-xl font-semibold text-gray-900 dark:text-white"},we={class:"card flex items-center gap-3"},he={class:"text-xl font-semibold text-gray-900 dark:text-white"},Ce={class:"card"},Pe={class:"grid grid-cols-1 gap-3 md:grid-cols-6"},Se={class:"md:col-span-2"},Ne=["value"],Ue=["value"],Te={key:0,class:"card text-center py-8"},Ie={key:1,class:"card overflow-hidden !p-0"},Fe={class:"min-w-full divide-y divide-gray-200"},Me={class:"divide-y divide-gray-200 dark:divide-white/10 bg-white dark:bg-dark-900"},Ve={key:0},Ae={class:"whitespace-nowrap px-6 py-4 text-sm font-medium text-primary-600"},Ke={class:"whitespace-nowrap px-6 py-4"},je={class:"text-sm text-gray-900"},Be={key:0,class:"text-xs text-gray-500"},$e={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},Oe={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},De={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},Ee={class:"whitespace-nowrap px-6 py-4"},Le={class:"whitespace-nowrap px-6 py-4 text-right text-sm space-x-2"},qe=["onClick"],He=["onClick"],ze={key:0,class:"flex items-center justify-between border-t border-gray-200 dark:border-white/10 bg-white dark:bg-dark-900 px-4 py-3 sm:px-6"},Ge={class:"text-sm text-gray-700 dark:text-gray-300"},Re={class:"flex gap-2"},Je=["disabled"],Qe={class:"px-3 py-2 text-sm"},We=["disabled"],Xe={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Ye={class:"flex min-h-screen items-center justify-center p-4"},Ze={class:"relative w-full max-w-2xl rounded-lg bg-white dark:bg-dark-900 shadow-xl"},et={class:"flex items-center justify-between border-b border-gray-200 dark:border-white/10 px-6 py-4"},tt={class:"text-lg font-semibold text-gray-900 dark:text-white"},at={class:"grid gap-4 sm:grid-cols-2"},st={key:0,class:"mt-1 text-sm text-red-600"},lt={key:0,class:"mt-1 text-sm text-red-600"},nt={key:0,class:"mt-1 text-sm text-red-600"},ot=["value"],rt={class:"sm:col-span-2"},it={class:"sm:col-span-2"},dt={class:"mt-6 flex justify-end gap-3"},ut=["disabled"],pt={key:0},mt={key:1},ct={__name:"Index",props:{tenantId:{type:Number,default:1}},setup(R){const k=R,A=p([]),S=p([]),_=p({total:0,active:0,suspended:0,inactive:0}),K=p(!0),N=p(""),c=p(""),U=p(""),T=p(""),u=p({current_page:1,last_page:1,total:0,from:0,to:0});ae(()=>{const t=new URLSearchParams(window.location.search).get("status");t&&(c.value=t),h(),j(),Q()});const g=p(!1),w=p("create"),I=p(!1),v=p({}),l=p({id:null,customer_code:"",full_name:"",phone:"",email:"",address:"",plan_id:"",pop_name:"",odp_name:"",billing_day:1,grace_days:7,service_status:"AKTIF",notes:""}),B=()=>{l.value={id:null,customer_code:"",full_name:"",phone:"",email:"",address:"",plan_id:"",pop_name:"",odp_name:"",billing_day:1,grace_days:7,service_status:"AKTIF",notes:""},v.value={}},J=[{value:"",label:"Semua Status"},{value:"AKTIF",label:"Aktif"},{value:"SUSPEND",label:"Suspend"},{value:"NONAKTIF",label:"Nonaktif"}],$=G(()=>c.value==="AKTIF"?"Pelanggan Aktif":c.value==="SUSPEND"?"Pelanggan Suspend":c.value==="NONAKTIF"?"Pelanggan Nonaktif":"Semua Pelanggan"),h=async(s=1)=>{var t,a,i,F,D,E,L,q;K.value=!0;try{const y={page:s,per_page:20,tenant_id:k.tenantId};N.value&&(y.q=N.value),c.value&&(y.status=c.value),U.value&&(y.plan_id=U.value),T.value&&(y.pop_name=T.value);const x=await b.get("/api/v1/customers",{params:y});A.value=x.data.data||[],u.value={current_page:((t=x.data.meta)==null?void 0:t.current_page)||1,last_page:((a=x.data.meta)==null?void 0:a.last_page)||1,total:((i=x.data.meta)==null?void 0:i.total)||0,from:(((F=x.data.meta)==null?void 0:F.current_page)-1)*((D=x.data.meta)==null?void 0:D.per_page)+1,to:Math.min(((E=x.data.meta)==null?void 0:E.current_page)*((L=x.data.meta)==null?void 0:L.per_page),(q=x.data.meta)==null?void 0:q.total)}}catch(y){console.error("Failed to load customers:",y)}finally{K.value=!1}},j=async()=>{try{const s=await b.get("/api/v1/customers/stats",{params:{tenant_id:k.tenantId}});_.value={total:s.data.total||0,active:s.data.active||0,suspended:s.data.suspended||0,inactive:s.data.inactive||0}}catch(s){console.error("Failed to load customer stats:",s)}},Q=async()=>{try{const s=await b.get("/api/v1/plans",{params:{tenant_id:k.tenantId,active:1}});S.value=s.data.data||[]}catch(s){console.error("Failed to load plans:",s),S.value=[]}},C=()=>h(1),O=s=>h(s),W=()=>{B(),w.value="create";const s=Date.now().toString().slice(-6);l.value.customer_code=`CUST-${s}`,g.value=!0},X=s=>{B(),w.value="edit",l.value={id:s.id,customer_code:s.customer_code,full_name:s.full_name,phone:s.phone||"",email:s.email||"",address:s.address||"",plan_id:s.plan_id||"",pop_name:s.pop_name||"",odp_name:s.odp_name||"",billing_day:s.billing_day||1,grace_days:s.grace_days||7,service_status:s.service_status||"AKTIF",notes:s.notes||""},g.value=!0},Y=async()=>{var s,t,a;I.value=!0,v.value={};try{const i={...l.value,tenant_id:k.tenantId,plan_id:l.value.plan_id||null};w.value==="create"?await b.post("/api/v1/customers",i):await b.put(`/api/v1/customers/${l.value.id}`,i),g.value=!1,h(u.value.current_page),j()}catch(i){((s=i.response)==null?void 0:s.status)===422?v.value=i.response.data.errors||{}:alert("Gagal menyimpan: "+(((a=(t=i.response)==null?void 0:t.data)==null?void 0:a.message)||i.message))}finally{I.value=!1}},Z=async s=>{var t,a;if(confirm(`Hapus pelanggan "${s.full_name}"?`))try{await b.delete(`/api/v1/customers/${s.id}?tenant_id=${k.tenantId}`),h(u.value.current_page),j()}catch(i){alert("Gagal menghapus: "+(((a=(t=i.response)==null?void 0:t.data)==null?void 0:a.message)||i.message))}},ee=s=>{switch(s){case"AKTIF":return"bg-emerald-100 text-emerald-700";case"SUSPEND":return"bg-amber-100 text-amber-700";case"NONAKTIF":return"bg-slate-200 text-slate-700";default:return"bg-gray-100 text-gray-700"}},te=G(()=>w.value==="create"?"Tambah Customer":"Edit Customer");return(s,t)=>(o(),r(P,null,[H(se(le),{title:$.value},null,8,["title"]),H(pe,null,{default:ne(()=>[e("div",me,[e("div",ve,[e("div",null,[e("h1",xe,n($.value),1),t[21]||(t[21]=e("p",{class:"mt-1 text-sm text-gray-500"},"Kelola data pelanggan",-1))]),e("button",{onClick:W,class:"btn btn-primary"},[...t[22]||(t[22]=[e("svg",{class:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),oe(" Tambah Customer ",-1)])])]),e("div",ce,[e("div",ge,[t[24]||(t[24]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-primary-100 text-primary-600 dark:bg-primary-500/20 dark:text-primary-300"},[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197"})])],-1)),e("div",null,[t[23]||(t[23]=e("p",{class:"text-xs font-medium text-gray-500 dark:text-gray-400"},"Total User",-1)),e("p",ye,n(_.value.total),1)])]),e("div",fe,[t[26]||(t[26]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-300"},[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),e("div",null,[t[25]||(t[25]=e("p",{class:"text-xs font-medium text-gray-500 dark:text-gray-400"},"User Aktif",-1)),e("p",be,n(_.value.active),1)])]),e("div",ke,[t[28]||(t[28]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-amber-100 text-amber-600 dark:bg-amber-500/20 dark:text-amber-300"},[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3"})])],-1)),e("div",null,[t[27]||(t[27]=e("p",{class:"text-xs font-medium text-gray-500 dark:text-gray-400"},"User Suspend",-1)),e("p",_e,n(_.value.suspended),1)])]),e("div",we,[t[30]||(t[30]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-rose-100 text-rose-600 dark:bg-rose-500/20 dark:text-rose-300"},[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1)),e("div",null,[t[29]||(t[29]=e("p",{class:"text-xs font-medium text-gray-500 dark:text-gray-400"},"User Nonaktif",-1)),e("p",he,n(_.value.inactive),1)])])]),e("div",Ce,[e("div",Pe,[e("div",Se,[d(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>N.value=a),onKeyup:z(C,["enter"]),type:"search",placeholder:"Cari nama, kode, profile, POP...",class:"input"},null,544),[[m,N.value]])]),d(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>c.value=a),onChange:C,class:"input"},[(o(),r(P,null,M(J,a=>e("option",{key:a.value,value:a.value},n(a.label),9,Ne)),64))],544),[[V,c.value]]),d(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>U.value=a),onChange:C,class:"input"},[t[31]||(t[31]=e("option",{value:""},"Semua Paket",-1)),(o(!0),r(P,null,M(S.value,a=>(o(),r("option",{key:a.id,value:a.id},n(a.name),9,Ue))),128))],544),[[V,U.value]]),d(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>T.value=a),onKeyup:z(C,["enter"]),type:"text",placeholder:"POP",class:"input"},null,544),[[m,T.value]]),e("button",{onClick:C,class:"btn btn-primary"},"Cari")])]),K.value?(o(),r("div",Te,[...t[32]||(t[32]=[e("div",{class:"animate-spin h-8 w-8 border-4 border-primary-500 border-t-transparent rounded-full mx-auto"},null,-1),e("p",{class:"mt-2 text-gray-500"},"Memuat data...",-1)])])):(o(),r("div",Ie,[e("table",Fe,[t[34]||(t[34]=e("thead",{class:"bg-gray-50 dark:bg-dark-800"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Kode"),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Nama"),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Paket"),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"POP"),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Tgl Invoice"),e("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Status"),e("th",{class:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500"},"Aksi")])],-1)),e("tbody",Me,[A.value.length===0?(o(),r("tr",Ve,[...t[33]||(t[33]=[e("td",{colspan:"7",class:"px-6 py-8 text-center text-gray-500"},"Belum ada data customer.",-1)])])):f("",!0),(o(!0),r(P,null,M(A.value,a=>{var i;return o(),r("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-dark-800"},[e("td",Ae,n(a.customer_code),1),e("td",Ke,[e("div",je,n(a.full_name),1),a.phone?(o(),r("div",Be,n(a.phone),1)):f("",!0)]),e("td",$e,n(((i=a.plan)==null?void 0:i.name)||"-"),1),e("td",Oe,n(a.pop_name||"-"),1),e("td",De,"Tgl "+n(a.billing_day||1),1),e("td",Ee,[e("span",{class:re(["inline-flex rounded-full px-2 py-1 text-xs font-medium",ee(a.service_status)])},n(a.service_status),3)]),e("td",Le,[e("button",{onClick:F=>X(a),class:"text-primary-600 hover:text-primary-900"},"Edit",8,qe),e("button",{onClick:F=>Z(a),class:"text-red-600 hover:text-red-900"},"Hapus",8,He)])])}),128))])]),u.value.last_page>1?(o(),r("div",ze,[e("div",Ge," Menampilkan "+n(u.value.from)+"-"+n(u.value.to)+" dari "+n(u.value.total)+" data ",1),e("div",Re,[e("button",{onClick:t[4]||(t[4]=a=>O(u.value.current_page-1)),disabled:u.value.current_page===1,class:"btn btn-secondary text-sm disabled:opacity-50"},"Prev",8,Je),e("span",Qe,n(u.value.current_page)+" / "+n(u.value.last_page),1),e("button",{onClick:t[5]||(t[5]=a=>O(u.value.current_page+1)),disabled:u.value.current_page===u.value.last_page,class:"btn btn-secondary text-sm disabled:opacity-50"},"Next",8,We)])])):f("",!0)]))]),(o(),ie(de,{to:"body"},[g.value?(o(),r("div",Xe,[e("div",Ye,[e("div",{class:"fixed inset-0 bg-black/50",onClick:t[6]||(t[6]=a=>g.value=!1)}),e("div",Ze,[e("div",et,[e("h3",tt,n(te.value),1),e("button",{onClick:t[7]||(t[7]=a=>g.value=!1),class:"text-gray-400 hover:text-gray-500 dark:hover:text-gray-300"},[...t[35]||(t[35]=[e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:ue(Y,["prevent"]),class:"p-6"},[e("div",at,[e("div",null,[t[36]||(t[36]=e("label",{class:"block text-sm font-medium text-gray-700"},"Kode Customer *",-1)),d(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>l.value.customer_code=a),type:"text",class:"input mt-1",required:""},null,512),[[m,l.value.customer_code]]),v.value.customer_code?(o(),r("p",st,n(v.value.customer_code[0]),1)):f("",!0)]),e("div",null,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium text-gray-700"},"Nama Lengkap *",-1)),d(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>l.value.full_name=a),type:"text",class:"input mt-1",required:""},null,512),[[m,l.value.full_name]]),v.value.full_name?(o(),r("p",lt,n(v.value.full_name[0]),1)):f("",!0)]),e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium text-gray-700"},"No. Telepon",-1)),d(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>l.value.phone=a),type:"text",class:"input mt-1",placeholder:"08xxxxxxxxxx"},null,512),[[m,l.value.phone]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-gray-700"},"Email",-1)),d(e("input",{"onUpdate:modelValue":t[11]||(t[11]=a=>l.value.email=a),type:"email",class:"input mt-1"},null,512),[[m,l.value.email]]),v.value.email?(o(),r("p",nt,n(v.value.email[0]),1)):f("",!0)]),e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-gray-700"},"Paket Layanan",-1)),d(e("select",{"onUpdate:modelValue":t[12]||(t[12]=a=>l.value.plan_id=a),class:"input mt-1"},[t[40]||(t[40]=e("option",{value:""},"-- Pilih Paket --",-1)),(o(!0),r(P,null,M(S.value,a=>(o(),r("option",{key:a.id,value:a.id},n(a.name)+" - Rp "+n(a.price.toLocaleString("id-ID")),9,ot))),128))],512),[[V,l.value.plan_id]])]),e("div",null,[t[43]||(t[43]=e("label",{class:"block text-sm font-medium text-gray-700"},"Status",-1)),d(e("select",{"onUpdate:modelValue":t[13]||(t[13]=a=>l.value.service_status=a),class:"input mt-1"},[...t[42]||(t[42]=[e("option",{value:"AKTIF"},"Aktif",-1),e("option",{value:"SUSPEND"},"Suspend",-1),e("option",{value:"NONAKTIF"},"Nonaktif",-1)])],512),[[V,l.value.service_status]])]),e("div",null,[t[44]||(t[44]=e("label",{class:"block text-sm font-medium text-gray-700"},"POP",-1)),d(e("input",{"onUpdate:modelValue":t[14]||(t[14]=a=>l.value.pop_name=a),type:"text",class:"input mt-1",placeholder:"Nama POP"},null,512),[[m,l.value.pop_name]])]),e("div",null,[t[45]||(t[45]=e("label",{class:"block text-sm font-medium text-gray-700"},"ODP",-1)),d(e("input",{"onUpdate:modelValue":t[15]||(t[15]=a=>l.value.odp_name=a),type:"text",class:"input mt-1",placeholder:"Nama ODP"},null,512),[[m,l.value.odp_name]])]),e("div",null,[t[46]||(t[46]=e("label",{class:"block text-sm font-medium text-gray-700"},"Tanggal Invoice",-1)),d(e("input",{"onUpdate:modelValue":t[16]||(t[16]=a=>l.value.billing_day=a),type:"number",min:"1",max:"28",class:"input mt-1"},null,512),[[m,l.value.billing_day,void 0,{number:!0}]])]),e("div",null,[t[47]||(t[47]=e("label",{class:"block text-sm font-medium text-gray-700"},"Masa Tenggang (hari)",-1)),d(e("input",{"onUpdate:modelValue":t[17]||(t[17]=a=>l.value.grace_days=a),type:"number",min:"0",class:"input mt-1"},null,512),[[m,l.value.grace_days,void 0,{number:!0}]])]),e("div",rt,[t[48]||(t[48]=e("label",{class:"block text-sm font-medium text-gray-700"},"Alamat",-1)),d(e("textarea",{"onUpdate:modelValue":t[18]||(t[18]=a=>l.value.address=a),rows:"2",class:"input mt-1"},null,512),[[m,l.value.address]])]),e("div",it,[t[49]||(t[49]=e("label",{class:"block text-sm font-medium text-gray-700"},"Catatan",-1)),d(e("textarea",{"onUpdate:modelValue":t[19]||(t[19]=a=>l.value.notes=a),rows:"2",class:"input mt-1"},null,512),[[m,l.value.notes]])])]),e("div",dt,[e("button",{type:"button",onClick:t[20]||(t[20]=a=>g.value=!1),class:"btn btn-secondary"},"Batal"),e("button",{type:"submit",disabled:I.value,class:"btn btn-primary"},[I.value?(o(),r("span",pt,"Menyimpan...")):(o(),r("span",mt,n(w.value==="create"?"Simpan":"Update"),1))],8,ut)])],32)])])])):f("",!0)]))]),_:1})],64))}};export{ct as default};
