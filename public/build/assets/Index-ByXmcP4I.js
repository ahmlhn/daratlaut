import{o as P,c as o,a as w,u as R,h as N,m as A,b as e,d as F,j as r,e as m,F as p,s as y,t as i,B as S,T as V,f as M,v as O,r as c,y as z}from"./app-Ci7n3qCe.js";import{_ as D}from"./AdminLayout-BTf2uWiW.js";const H={class:"space-y-6"},L={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},G={key:0,class:"col-span-full text-center py-10 text-gray-500"},I={class:"flex items-center justify-between mb-4"},K={class:"text-lg font-bold text-gray-900 dark:text-white capitalize"},U={class:"text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-1 rounded-full"},J={class:"flex flex-wrap gap-2 mb-4"},q={key:0,class:"text-xs text-gray-400"},Q={key:1,class:"text-xs text-gray-400 italic"},W={class:"flex justify-end gap-2 pt-4 border-t border-gray-100 dark:border-gray-700 mt-auto"},X=["onClick"],Y=["onClick"],Z={key:0,class:"fixed inset-0 z-[100] overflow-y-auto"},ee={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},se={class:"inline-block align-bottom bg-white dark:bg-dark-900 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full relative z-10"},te={class:"bg-white dark:bg-dark-900 px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ae={class:"flex justify-between items-center mb-5"},re={class:"text-lg leading-6 font-medium text-gray-900 dark:text-white"},oe={class:"space-y-4"},ne=["disabled"],le={key:0,class:"text-xs text-yellow-600 mt-1"},ie={class:"h-96 overflow-y-auto custom-scrollbar border border-gray-200 dark:border-gray-700 rounded-md p-4"},de={class:"text-sm font-bold text-gray-900 dark:text-white uppercase tracking-wider mb-2 border-b border-gray-100 dark:border-gray-800 pb-1"},ue={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2"},ce=["checked","onChange"],me={class:"text-sm text-gray-700 dark:text-gray-300"},pe={class:"bg-gray-50 dark:bg-dark-800 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},ge=["disabled"],g="/api/v1",ve={__name:"Index",setup(fe){const h=c([]),k=c([]),b=c(!1),d=c(!1),u=c(!1),f=c(!1),n=c({id:null,name:"",permissions:[]});async function v(){b.value=!0;try{const t=await fetch(`${g}/roles`);h.value=await t.json()}catch(t){console.error("Error loading roles:",t)}finally{b.value=!1}}async function _(){try{const t=await fetch(`${g}/permissions`);k.value=await t.json()}catch(t){console.error("Error loading permissions:",t)}}function j(){u.value=!1,n.value={id:null,name:"",permissions:[]},d.value=!0}function C(t){u.value=!0,n.value={id:t.id,name:t.name,permissions:t.permissions.map(s=>s.name)},d.value=!0}async function $(){f.value=!0;try{const t=u.value?`${g}/roles/${n.value.id}`:`${g}/roles`,s=u.value?"PUT":"POST",a=await fetch(t,{method:s,headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(n.value)});if(a.ok)d.value=!1,v();else{const l=await a.json();alert(l.message||"Gagal menyimpan role")}}catch(t){console.error("Error saving role:",t),alert("Terjadi kesalahan sistem")}finally{f.value=!1}}async function E(t){if(confirm(`Hapus role ${t.name}?`))try{const s=await fetch(`${g}/roles/${t.id}`,{method:"DELETE",headers:{Accept:"application/json"}});if(s.ok)v();else{const a=await s.json();alert(a.message||"Gagal menghapus role")}}catch(s){console.error("Error deleting role:",s)}}const T=z(()=>{const t={};return k.value.forEach(s=>{const a=s.name.split(" "),l=a.length>1?a.slice(1).join(" "):"Other";t[l]||(t[l]=[]),t[l].push(s)}),t});function B(t){const s=n.value.permissions.indexOf(t);s===-1?n.value.permissions.push(t):n.value.permissions.splice(s,1)}return P(()=>{v(),_()}),(t,s)=>(r(),o(p,null,[w(R(N),{title:"Kelola Role"}),w(D,null,{default:A(()=>[e("div",H,[e("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},[s[5]||(s[5]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Kelola Role & Permission"),e("p",{class:"text-gray-500 dark:text-gray-400 text-sm"},"Atur hak akses pengguna dalam sistem")],-1)),e("button",{onClick:j,class:"btn btn-primary"},[...s[4]||(s[4]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),F(" Tambah Role ",-1)])])]),e("div",L,[b.value?(r(),o("div",G," Loading roles... ")):m("",!0),(r(!0),o(p,null,y(h.value,a=>(r(),o("div",{key:a.id,class:"card p-6 flex flex-col justify-between hover:shadow-md transition-shadow dark:bg-dark-800"},[e("div",null,[e("div",I,[e("h3",K,i(a.name),1),e("span",U,i(a.permissions.length)+" Permissions ",1)]),e("div",J,[(r(!0),o(p,null,y(a.permissions.slice(0,5),l=>(r(),o("span",{key:l.id,class:"text-xs px-2 py-0.5 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded border border-blue-100 dark:border-blue-800"},i(l.name),1))),128)),a.permissions.length>5?(r(),o("span",q," +"+i(a.permissions.length-5)+" lainnya... ",1)):m("",!0),a.permissions.length===0?(r(),o("span",Q," Belum ada permission ")):m("",!0)])]),e("div",W,[e("button",{onClick:l=>C(a),class:"text-sm text-primary-600 hover:text-primary-800 font-medium p-2 hover:bg-primary-50 dark:hover:bg-primary-900/10 rounded"}," Edit Akses ",8,X),["admin","owner"].includes(a.name)?m("",!0):(r(),o("button",{key:0,onClick:l=>E(a),class:"text-sm text-red-600 hover:text-red-800 font-medium p-2 hover:bg-red-50 dark:hover:bg-red-900/10 rounded"}," Hapus ",8,Y))])]))),128))])]),(r(),S(V,{to:"body"},[d.value?(r(),o("div",Z,[e("div",ee,[e("div",{class:"fixed inset-0 transition-opacity","aria-hidden":"true",onClick:s[0]||(s[0]=a=>d.value=!1)},[...s[6]||(s[6]=[e("div",{class:"absolute inset-0 bg-gray-500 opacity-75"},null,-1)])]),s[10]||(s[10]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",se,[e("div",te,[e("div",ae,[e("h3",re,i(u.value?"Edit Role: "+n.value.name:"Tambah Role Baru"),1),e("button",{onClick:s[1]||(s[1]=a=>d.value=!1),class:"text-gray-400 hover:text-gray-500"},[...s[7]||(s[7]=[e("span",{class:"text-2xl"},"×",-1)])])]),e("div",oe,[e("div",null,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nama Role",-1)),M(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>n.value.name=a),type:"text",class:"input w-full mt-1",placeholder:"Contoh: staff_gudang",disabled:u.value&&["admin","owner"].includes(n.value.name)},null,8,ne),[[O,n.value.name]]),u.value&&["admin","owner"].includes(n.value.name)?(r(),o("p",le," Nama role sistem tidak bisa diubah. ")):m("",!0)]),e("div",null,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Permissions",-1)),e("div",ie,[(r(!0),o(p,null,y(T.value,(a,l)=>(r(),o("div",{key:l,class:"mb-6"},[e("h4",de,i(l),1),e("div",ue,[(r(!0),o(p,null,y(a,x=>(r(),o("label",{key:x.id,class:"flex items-center space-x-2 cursor-pointer p-2 hover:bg-gray-50 dark:hover:bg-dark-800 rounded"},[e("input",{type:"checkbox",checked:n.value.permissions.includes(x.name),onChange:xe=>B(x.name),class:"rounded text-primary-600 focus:ring-primary-500"},null,40,ce),e("span",me,i(x.name),1)]))),128))])]))),128))])])])]),e("div",pe,[e("button",{onClick:$,disabled:f.value,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm"},i(f.value?"Menyimpan...":"Simpan"),9,ge),e("button",{onClick:s[3]||(s[3]=a=>d.value=!1),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-dark-900 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-dark-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Batal ")])])])])):m("",!0)]))]),_:1})],64))}};export{ve as default};
