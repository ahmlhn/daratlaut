import{r as p,o as X,E as Y,c as l,a as H,u as Z,h as tt,m as et,b as e,t as i,d as y,n as M,j as s,e as u,f as d,F as c,s as S,x as f,v,B as z,T as E,w as W}from"./app-BWVIO8XE.js";import{_ as at}from"./AdminLayout-CCHPB13B.js";const st={class:"space-y-6"},lt={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},nt={class:"text-sm text-gray-500 dark:text-gray-400"},ot={class:"bg-white dark:bg-gray-800 rounded-xl p-1 flex gap-1 shadow-sm border border-gray-200 dark:border-gray-700"},rt={key:0,class:"ml-2 px-2 py-0.5 bg-red-500 text-white text-xs rounded-full"},it={key:0,class:"ml-2 px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full"},dt={class:"flex flex-col sm:flex-row gap-3"},ut=["value"],pt={class:"relative flex-1"},gt={key:0,class:"flex justify-center py-12"},vt={key:1,class:"space-y-3"},xt=["onClick"],yt={class:"flex items-start justify-between gap-4"},mt={class:"flex-1 min-w-0"},kt={class:"flex items-center gap-2 mb-1"},bt={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},ct={class:"font-semibold text-gray-900 dark:text-white truncate"},ft={class:"text-sm text-gray-500 dark:text-gray-400 truncate"},wt={class:"flex items-center gap-4 mt-2 text-xs text-gray-500 dark:text-gray-400"},ht={key:0},Ct={key:1,class:"text-green-600 dark:text-green-400 font-semibold"},Pt={key:2,class:"text-center py-16"},St={class:"bg-white dark:bg-gray-800 w-full max-w-lg rounded-2xl shadow-2xl max-h-[90vh] flex flex-col"},Tt={key:0,class:"p-6 overflow-y-auto flex-1 space-y-4"},jt={class:"flex items-center gap-2"},Mt={key:0,class:"text-sm text-gray-500"},_t={class:"text-xl font-bold text-gray-900 dark:text-white"},Bt={class:"text-gray-600 dark:text-gray-400"},Dt={class:"grid grid-cols-2 gap-4 text-sm"},Vt={class:"font-medium"},It={class:"font-medium"},Ut={class:"font-medium text-green-600"},$t={class:"font-medium"},Nt={class:"col-span-2"},Ft={class:"font-medium"},Rt={key:0,class:"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},Ot={class:"text-sm text-gray-700 dark:text-gray-300"},Lt={class:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 grid grid-cols-2 gap-3"},qt={class:"bg-white dark:bg-gray-800 w-full max-w-lg rounded-2xl shadow-2xl max-h-[95vh] flex flex-col"},At={class:"p-6 overflow-y-auto flex-1 space-y-4"},Ht={class:"space-y-3"},zt={class:"grid grid-cols-2 gap-3"},Et=["value"],Wt={class:"space-y-3"},Gt={class:"grid grid-cols-2 gap-3"},Jt=["value"],Kt=["value"],Qt={class:"space-y-3"},w="/api/v1",te={__name:"Index",props:{techName:{type:String,default:"Teknisi"},techPop:{type:String,default:""},techRole:{type:String,default:"teknisi"},initialFilters:{type:Object,default:()=>({})}},setup(N){const k=N,_=p([]),h=p({all:0,mine:0}),B=p([]),D=p([]),V=p(!1),C=p(k.initialFilters.tab||"all"),x=p({pop:k.initialFilters.pop||"",status:k.initialFilters.status||"",q:k.initialFilters.q||""}),I=p(!1),U=p(!1),o=p(null),F=p([]),n=p({nama:"",wa:"",alamat:"",pop:"",paket:"",harga:"",sales_1:"",sales_2:"",sales_3:"",teknisi_1:"",teknisi_2:"",teknisi_3:"",teknisi_4:"",tanggal:new Date().toISOString().split("T")[0],koordinat:"",catatan:""}),R={Baru:"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300",Survey:"bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300",Proses:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",Pending:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300",Selesai:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",Batal:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300",Req_Batal:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"};async function b(){V.value=!0;try{const r=new URLSearchParams({tab:C.value,tech_name:k.techName,...x.value}),g=await(await fetch(`${w}/teknisi/tasks?${r}`)).json();_.value=g.data||[],h.value=g.counts||{all:0,mine:0}}catch(r){console.error("Failed to load tasks:",r)}finally{V.value=!1}}async function G(){try{const[r,t]=await Promise.all([fetch(`${w}/teknisi/pops`),fetch(`${w}/teknisi/technicians`)]),g=await r.json(),m=await t.json();B.value=g.data||[],D.value=m.data||[]}catch(r){console.error("Failed to load dropdowns:",r)}}async function J(r){o.value=r,I.value=!0;try{const g=await(await fetch(`${w}/teknisi/tasks/${r.id}`)).json();F.value=g.logs||[]}catch(t){console.error("Failed to load task detail:",t)}}function T(){I.value=!1,o.value=null,F.value=[]}function K(){U.value=!0,n.value={nama:"",wa:"",alamat:"",pop:k.techPop||"",paket:"",harga:"",sales_1:"",sales_2:"",sales_3:"",teknisi_1:"",teknisi_2:"",teknisi_3:"",teknisi_4:"",tanggal:new Date().toISOString().split("T")[0],koordinat:"",catatan:""}}function j(){U.value=!1}async function Q(){try{const t=await(await fetch(`${w}/teknisi/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.value)})).json();t.success?(alert("Pasang baru berhasil disimpan!"),j(),b()):alert(t.message||"Gagal menyimpan")}catch(r){alert("Error: "+r.message)}}async function $(r,t,g={}){try{const P=await(await fetch(`${w}/teknisi/tasks/${r}/status`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t,...g})})).json();P.success?(T(),b()):alert(P.message||"Gagal update status")}catch(m){alert("Error: "+m.message)}}function O(r){C.value=r,b()}function L(r){return r?new Date(r).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"}):"-"}function q(r){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r||0)}return X(()=>{b(),G()}),Y([C,x],()=>b(),{deep:!0}),(r,t)=>(s(),l(c,null,[H(Z(tt),{title:"Dashboard Teknisi"}),H(at,null,{default:et(()=>{var g,m,P,A;return[e("div",st,[e("div",lt,[e("div",null,[t[20]||(t[20]=e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Dashboard Teknisi",-1)),e("p",nt,"Halo, "+i(N.techName),1)]),e("button",{onClick:K,class:"btn btn-primary flex items-center gap-2"},[...t[21]||(t[21]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),y(" Input Pasang Baru ",-1)])])]),e("div",ot,[e("button",{onClick:t[0]||(t[0]=a=>O("all")),class:M(["flex-1 py-3 rounded-lg font-semibold text-sm transition-all",C.value==="all"?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"])},[t[22]||(t[22]=y(" Semua Tugas ",-1)),h.value.all>0?(s(),l("span",rt,i(h.value.all),1)):u("",!0)],2),e("button",{onClick:t[1]||(t[1]=a=>O("mine")),class:M(["flex-1 py-3 rounded-lg font-semibold text-sm transition-all",C.value==="mine"?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"])},[t[23]||(t[23]=y(" Tugas Saya ",-1)),h.value.mine>0?(s(),l("span",it,i(h.value.mine),1)):u("",!0)],2)]),e("div",dt,[d(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>x.value.pop=a),class:"input flex-1"},[t[24]||(t[24]=e("option",{value:""},"Semua Area",-1)),(s(!0),l(c,null,S(B.value,a=>(s(),l("option",{key:a.id,value:a.name},i(a.name),9,ut))),128))],512),[[f,x.value.pop]]),d(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>x.value.status=a),class:"input w-full sm:w-40"},[...t[25]||(t[25]=[e("option",{value:""},"Semua Status",-1),e("option",{value:"Proses"},"Proses",-1),e("option",{value:"Pending"},"Pending",-1),e("option",{value:"Req_Batal"},"Req Batal",-1)])],512),[[f,x.value.status]]),e("div",pt,[d(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>x.value.q=a),type:"text",placeholder:"Cari nama / alamat...",class:"input w-full pl-10"},null,512),[[v,x.value.q]]),t[26]||(t[26]=e("svg",{class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),e("button",{onClick:b,class:"btn btn-secondary"},[...t[27]||(t[27]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])]),V.value?(s(),l("div",gt,[...t[28]||(t[28]=[e("div",{class:"animate-spin rounded-full h-10 w-10 border-4 border-primary-500 border-t-transparent"},null,-1)])])):_.value.length>0?(s(),l("div",vt,[(s(!0),l(c,null,S(_.value,a=>(s(),l("div",{key:a.id,onClick:Xt=>J(a),class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 cursor-pointer hover:shadow-md transition-shadow"},[e("div",yt,[e("div",mt,[e("div",kt,[e("span",{class:M(["px-2 py-0.5 rounded-full text-xs font-semibold",R[a.status]||"bg-gray-100 text-gray-800"])},i(a.status),3),a.pop?(s(),l("span",bt,i(a.pop),1)):u("",!0)]),e("h3",ct,i(a.nama),1),e("p",ft,i(a.alamat),1),e("div",wt,[a.tanggal?(s(),l("span",ht,"ðŸ“… "+i(L(a.tanggal)),1)):u("",!0),a.harga?(s(),l("span",Ct,i(q(a.harga)),1)):u("",!0)])]),t[29]||(t[29]=e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])],8,xt))),128))])):(s(),l("div",Pt,[...t[30]||(t[30]=[e("div",{class:"w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4"},[e("svg",{class:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1),e("h3",{class:"text-gray-600 dark:text-gray-300 font-semibold"},"Tidak ada tugas",-1)])]))]),(s(),z(E,{to:"body"},[I.value?(s(),l("div",{key:0,class:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:W(T,["self"])},[e("div",St,[e("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between"},[t[32]||(t[32]=e("h3",{class:"text-lg font-bold text-gray-900 dark:text-white"},"Detail Tugas",-1)),e("button",{onClick:T,class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"},[...t[31]||(t[31]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),o.value?(s(),l("div",Tt,[e("div",jt,[e("span",{class:M(["px-3 py-1 rounded-full text-sm font-semibold",R[o.value.status]])},i(o.value.status),3),o.value.pop?(s(),l("span",Mt,i(o.value.pop),1)):u("",!0)]),e("div",null,[e("h4",_t,i(o.value.nama),1),e("p",Bt,i(o.value.alamat),1)]),e("div",Dt,[e("div",null,[t[33]||(t[33]=e("span",{class:"text-gray-500"},"WhatsApp:",-1)),t[34]||(t[34]=y()),e("span",Vt,i(o.value.wa||"-"),1)]),e("div",null,[t[35]||(t[35]=e("span",{class:"text-gray-500"},"Paket:",-1)),t[36]||(t[36]=y()),e("span",It,i(o.value.paket||"-"),1)]),e("div",null,[t[37]||(t[37]=e("span",{class:"text-gray-500"},"Harga:",-1)),t[38]||(t[38]=y()),e("span",Ut,i(q(o.value.harga)),1)]),e("div",null,[t[39]||(t[39]=e("span",{class:"text-gray-500"},"Tanggal:",-1)),t[40]||(t[40]=y()),e("span",$t,i(L(o.value.tanggal)),1)]),e("div",Nt,[t[41]||(t[41]=e("span",{class:"text-gray-500"},"Teknisi:",-1)),t[42]||(t[42]=y()),e("span",Ft,i(o.value.teknisi||"-"),1)])]),o.value.catatan?(s(),l("div",Rt,[t[43]||(t[43]=e("span",{class:"text-xs text-gray-500 uppercase"},"Catatan:",-1)),e("p",Ot,i(o.value.catatan),1)])):u("",!0)])):u("",!0),e("div",Lt,[((g=o.value)==null?void 0:g.status)==="Baru"||((m=o.value)==null?void 0:m.status)==="Survey"?(s(),l("button",{key:0,onClick:t[5]||(t[5]=a=>$(o.value.id,"Proses")),class:"btn btn-primary"}," Mulai Proses ")):u("",!0),((P=o.value)==null?void 0:P.status)==="Proses"?(s(),l("button",{key:1,onClick:t[6]||(t[6]=a=>$(o.value.id,"Selesai")),class:"btn btn-success"}," Lapor Selesai ")):u("",!0),((A=o.value)==null?void 0:A.status)==="Proses"?(s(),l("button",{key:2,onClick:t[7]||(t[7]=a=>$(o.value.id,"Pending")),class:"btn btn-warning"}," Pending ")):u("",!0),e("button",{onClick:T,class:"btn btn-secondary"},"Tutup")])])])):u("",!0)])),(s(),z(E,{to:"body"},[U.value?(s(),l("div",{key:0,class:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:W(j,["self"])},[e("div",qt,[e("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gray-900 text-white rounded-t-2xl"},[t[45]||(t[45]=e("h3",{class:"text-lg font-bold"},"Input Pasang Baru",-1)),e("button",{onClick:j,class:"p-2 hover:bg-white/10 rounded-full"},[...t[44]||(t[44]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",At,[e("div",Ht,[t[48]||(t[48]=e("h4",{class:"text-xs font-bold text-blue-600 uppercase border-b pb-2"},"Data Pelanggan",-1)),d(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>n.value.nama=a),type:"text",placeholder:"Nama Pelanggan *",class:"input w-full"},null,512),[[v,n.value.nama]]),d(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>n.value.wa=a),type:"tel",placeholder:"WhatsApp (08xxxxxxxxxx) *",class:"input w-full"},null,512),[[v,n.value.wa]]),d(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=a=>n.value.alamat=a),rows:"2",placeholder:"Alamat Lengkap *",class:"input w-full"},null,512),[[v,n.value.alamat]]),e("div",zt,[d(e("select",{"onUpdate:modelValue":t[11]||(t[11]=a=>n.value.pop=a),class:"input"},[t[46]||(t[46]=e("option",{value:""},"Pilih POP *",-1)),(s(!0),l(c,null,S(B.value,a=>(s(),l("option",{key:a.id,value:a.name},i(a.name),9,Et))),128))],512),[[f,n.value.pop]]),d(e("select",{"onUpdate:modelValue":t[12]||(t[12]=a=>n.value.paket=a),class:"input"},[...t[47]||(t[47]=[e("option",{value:""},"Pilih Paket",-1),e("option",null,"Standar - 10 Mbps",-1),e("option",null,"Premium - 15 Mbps",-1),e("option",null,"Wide - 20 Mbps",-1),e("option",null,"PRO - 50 Mbps",-1)])],512),[[f,n.value.paket]])]),d(e("input",{"onUpdate:modelValue":t[13]||(t[13]=a=>n.value.harga=a),type:"number",placeholder:"Harga (Rp)",class:"input w-full"},null,512),[[v,n.value.harga]])]),e("div",Wt,[t[51]||(t[51]=e("h4",{class:"text-xs font-bold text-blue-600 uppercase border-b pb-2"},"Tim & Sales",-1)),d(e("input",{"onUpdate:modelValue":t[14]||(t[14]=a=>n.value.sales_1=a),type:"text",placeholder:"Sales 1",class:"input w-full"},null,512),[[v,n.value.sales_1]]),e("div",Gt,[d(e("select",{"onUpdate:modelValue":t[15]||(t[15]=a=>n.value.teknisi_1=a),class:"input"},[t[49]||(t[49]=e("option",{value:""},"Teknisi 1",-1)),(s(!0),l(c,null,S(D.value,a=>(s(),l("option",{key:a.id,value:a.name},i(a.name),9,Jt))),128))],512),[[f,n.value.teknisi_1]]),d(e("select",{"onUpdate:modelValue":t[16]||(t[16]=a=>n.value.teknisi_2=a),class:"input"},[t[50]||(t[50]=e("option",{value:""},"Teknisi 2",-1)),(s(!0),l(c,null,S(D.value,a=>(s(),l("option",{key:a.id,value:a.name},i(a.name),9,Kt))),128))],512),[[f,n.value.teknisi_2]])])]),e("div",Qt,[t[52]||(t[52]=e("h4",{class:"text-xs font-bold text-blue-600 uppercase border-b pb-2"},"Info Tambahan",-1)),d(e("input",{"onUpdate:modelValue":t[17]||(t[17]=a=>n.value.tanggal=a),type:"date",class:"input w-full"},null,512),[[v,n.value.tanggal]]),d(e("input",{"onUpdate:modelValue":t[18]||(t[18]=a=>n.value.koordinat=a),type:"text",placeholder:"Koordinat (lat,lng)",class:"input w-full"},null,512),[[v,n.value.koordinat]]),d(e("textarea",{"onUpdate:modelValue":t[19]||(t[19]=a=>n.value.catatan=a),rows:"2",placeholder:"Catatan...",class:"input w-full"},null,512),[[v,n.value.catatan]])])]),e("div",{class:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 grid grid-cols-2 gap-3"},[e("button",{onClick:j,class:"btn btn-secondary"},"Batal"),e("button",{onClick:Q,class:"btn btn-primary"},"Simpan")])])])):u("",!0)]))]}),_:1})],64))}};export{te as default};
