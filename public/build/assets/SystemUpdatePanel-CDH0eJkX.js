import{C as Ze,E as Q,H as we,o as Ve,c as r,b as t,K as le,d as w,t as d,e as v,n as k,a as ne,F as Ke,s as Je,J as re,f as ie,v as _e,i as Ye,r as P,y,j as i}from"./app-Dp4saQWW.js";import{_ as oe}from"./LoadingSpinner-DFBIyhqA.js";const We={class:"space-y-6"},qe={class:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between"},Qe={key:0,class:"min-w-0"},Xe={key:0,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},et={class:"font-semibold"},tt={key:0,class:"ml-2"},at={class:"font-mono font-semibold"},st={key:1,class:"ml-2"},lt={class:"flex flex-wrap items-center gap-2"},nt=["disabled"],rt={key:0,class:"mr-2"},it={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ot={class:"lg:col-span-2 space-y-6"},dt={class:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between"},ut={class:"text-sm text-gray-600 dark:text-gray-300 mt-1"},ct={key:0,class:"mt-3 text-sm rounded-xl border border-amber-200 bg-amber-50 text-amber-900 dark:border-amber-500/20 dark:bg-amber-500/10 dark:text-amber-200 p-3"},pt={key:1,class:"mt-3 text-sm rounded-xl border border-red-200 bg-red-50 text-red-900 dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 p-3 whitespace-pre-line"},vt={class:"flex flex-col items-end gap-2"},bt={class:"inline-flex rounded-xl border border-gray-200 dark:border-white/10 bg-white/60 dark:bg-dark-950/60 p-1"},gt=["disabled"],mt=["disabled"],ft={key:0,class:"mr-2"},xt={key:0,class:"text-xs text-gray-500 dark:text-gray-400 text-right max-w-xs"},kt={key:0,class:"mt-4 flex flex-wrap items-center gap-2"},yt=["disabled"],ht=["disabled"],wt={key:1,class:"mt-5 grid grid-cols-2 sm:grid-cols-5 gap-3"},_t={key:0,class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},Pt={key:1,class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},St={key:2},Ct={class:"sm:text-center"},Tt={class:"text-sm sm:text-xs font-semibold text-gray-900 dark:text-white"},zt={key:2,class:"mt-4"},Ut={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},Lt={class:"h-2 bg-gray-100 dark:bg-white/10 rounded-full overflow-hidden mt-2"},jt={key:3,class:"mt-4"},Rt={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},Dt={class:"h-2 bg-gray-100 dark:bg-white/10 rounded-full overflow-hidden mt-2"},Gt={class:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm"},Nt={class:"flex items-center justify-between sm:block"},At={class:"flex items-center justify-between sm:block"},Bt={class:"flex items-center justify-between sm:block"},Et={class:"mt-1 font-semibold text-gray-900 dark:text-white"},Mt={key:0,class:"mt-2 text-xs text-amber-700 dark:text-amber-300"},Ht={key:1,class:"mt-1 text-xs text-amber-700 dark:text-amber-300"},$t={class:"flex items-start justify-between gap-4"},It={class:"flex items-center gap-2"},Ft=["disabled"],Ot={key:0,class:"mt-4 text-sm rounded-xl border border-amber-200 bg-amber-50 text-amber-900 dark:border-amber-500/20 dark:bg-amber-500/10 dark:text-amber-200 p-3"},Zt={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-700 dark:text-gray-300"},Vt={class:"mt-1 font-semibold"},Kt={key:0},Jt={key:1,class:"text-amber-700 dark:text-amber-300"},Yt={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Wt={class:"font-mono font-semibold"},qt={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Qt={class:"font-mono font-semibold"},Xt={class:"font-mono font-semibold"},ea={class:"mt-1 font-semibold"},ta={key:0,class:"text-emerald-700 dark:text-emerald-300"},aa={key:1,class:"text-amber-700 dark:text-amber-300"},sa={class:"flex items-start justify-between gap-3"},la=["disabled"],na={class:"mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3"},ra=["disabled"],ia={class:"flex items-start justify-between gap-4"},oa={class:"min-w-0"},da={class:"mt-1 text-sm font-semibold text-gray-900 dark:text-white"},ua={class:"font-mono"},ca={class:"ml-2 text-gray-600 dark:text-gray-300 truncate"},pa={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},va={key:1,class:"mt-3"},ba={class:"mt-1 text-xs text-gray-600 dark:text-gray-300 space-y-1"},ga={class:"font-mono"},ma={key:0},fa={class:"font-mono"},xa={key:0,class:"ml-2 text-gray-500 dark:text-gray-400"},ka={key:1,class:"text-amber-700 dark:text-amber-300"},ya={key:2},ha={class:"font-mono"},wa={key:0,class:"ml-2 text-gray-500 dark:text-gray-400"},_a={class:"text-right text-xs whitespace-nowrap"},Pa={key:0,class:"font-bold text-emerald-700 dark:text-emerald-300"},Sa={key:1,class:"font-bold text-amber-700 dark:text-amber-300"},Ca={key:2,class:"font-bold text-emerald-700 dark:text-emerald-300"},Ta={key:3,class:"font-bold text-amber-700 dark:text-amber-300"},za={key:4,class:"font-bold text-gray-500 dark:text-gray-400"},Ua={class:"mt-4 space-y-3"},La={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400 truncate"},ja={class:"font-semibold"},Ra={key:0,class:"ml-2"},Da={class:"flex flex-wrap gap-2"},Ga=["disabled"],Na={key:0,class:"mr-2"},Aa=["disabled"],Ba={key:1,class:"h-2 bg-gray-100 dark:bg-white/10 rounded-full overflow-hidden"},Ea={class:"space-y-6"},Ma={class:"flex items-center justify-between gap-3"},Ha={class:"flex items-center gap-2"},$a={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300 select-none"},Ia={class:"text-[11px] leading-relaxed text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},Fa={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Oa={class:"mt-4 grid grid-cols-2 gap-3 text-sm"},Za={class:"mt-1 font-semibold text-gray-900 dark:text-white"},Va={class:"mt-1 font-semibold text-gray-900 dark:text-white"},Ka={class:"mt-1 font-semibold text-gray-900 dark:text-white"},Ja={class:"mt-1 font-semibold text-gray-900 dark:text-white"},Ya={class:"rounded-xl border border-red-200 bg-red-50 dark:border-red-500/20 dark:bg-red-500/10 p-5"},Wa={class:"flex items-start justify-between gap-3"},qa={key:0,class:"mt-3 space-y-2"},Qa={class:"grid grid-cols-1 sm:grid-cols-3 gap-2"},Xa=["disabled"],as={__name:"SystemUpdatePanel",props:{embedded:{type:Boolean,default:!1}},setup(de){const Pe=de,X=Ze("toast",null);function b(a,e){const l=X==null?void 0:X[a];if(typeof l=="function")return l(e);alert(e)}const O=P(!0),H=P(!1),Z=P(0),T=P(!1),g=P(null),ee=P(null),R=P(null),A=P(!1),J=P(""),f=P(null),ue=P(null),D=P("zip"),ce=P(!1),L=P(!1),B=P(!1),Y=P(!0),V=P(!1),W=P("");function G(a){if(!a)return;const e=g.value;e&&!a.config&&e.config&&(a.config=e.config),e&&!a.github&&e.github&&(a.github=e.github),e&&!a.installed&&e.installed&&(a.installed=e.installed),e&&!a.log_tail&&e.log_tail&&(a.log_tail=e.log_tail),g.value=a}const x=y(()=>{var a;return((a=g.value)==null?void 0:a.stage)||"idle"}),q=y(()=>{var a;return((a=g.value)==null?void 0:a.error)||""}),_=y(()=>{var a;return((a=g.value)==null?void 0:a.config)||{}}),p=y(()=>{var a;return((a=g.value)==null?void 0:a.github)||{}}),E=y(()=>{var a;return((a=g.value)==null?void 0:a.installed)||null}),$=y(()=>{var a;return((a=g.value)==null?void 0:a.package)||null});function Se(a){if(!a)return"";try{return new Date(a).toLocaleString()}catch{return String(a)}}function Ce(a){const e=Number(a);if(!Number.isFinite(e)||e<=0)return"";const l=e/1024/1024;return l<1024?`${Math.round(l)} MB`:`${(l/1024).toFixed(1)} GB`}const M=y(()=>{var c;const a=(c=g.value)==null?void 0:c.manifest;if(!a||!a.total_files)return null;const e=Number(a.total_files)||0,l=Number(a.index)||0,n=Number(a.copied)||0,o=Number(a.skipped)||0,s=e>0?Math.min(100,Math.round(l/e*100)):0;return{total:e,idx:l,copied:n,skipped:o,pct:s}}),I=y(()=>{var o;const a=(o=g.value)==null?void 0:o.finalize;if(!a||!Array.isArray(a.commands))return null;const e=a.commands.length,l=Number(a.index)||0,n=e>0?Math.min(100,Math.round(l/e*100)):0;return{total:e,idx:l,pct:n}}),Te=y(()=>({idle:"Idle",uploaded:"Paket sudah diunggah (belum diproses)",ready:"Siap (manifest siap)",copying:"Menyalin file update",finalize:"Finalisasi (artisan tasks)",done:"Selesai",error:"Error"})[x.value]||x.value),pe=y(()=>{const a=x.value;return a==="done"?{text:"DONE",klass:"bg-emerald-100 text-emerald-800 dark:bg-emerald-500/20 dark:text-emerald-300"}:a==="error"?{text:"ERROR",klass:"bg-red-100 text-red-800 dark:bg-red-500/20 dark:text-red-300"}:["copying","finalize"].includes(a)?{text:"RUNNING",klass:"bg-blue-100 text-blue-800 dark:bg-blue-500/20 dark:text-blue-300"}:["ready","uploaded"].includes(a)?{text:"READY",klass:"bg-amber-100 text-amber-800 dark:bg-amber-500/20 dark:text-amber-300"}:{text:"IDLE",klass:"bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-200"}}),z=y(()=>O.value||H.value||T.value||A.value),K=y(()=>Pe.embedded?"rounded-xl border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-dark-900/40 p-5":"rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-dark-950 shadow-sm p-5"),N=y(()=>"rounded-xl border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-dark-900/40 p-4"),ze=y(()=>{var a;return!((a=_.value)!=null&&a.enabled)||z.value||!$.value?!1:["uploaded","error","ready","copying","finalize","done"].includes(x.value)}),Ue=y(()=>{var a;return!((a=_.value)!=null&&a.enabled)||z.value?!1:["uploaded","ready","copying","finalize","error"].includes(x.value)}),te=y(()=>{var e,l;const a=x.value;return["uploaded","ready","copying","finalize"].includes(a)?!0:a==="error"?!!($.value||(e=g.value)!=null&&e.manifest||(l=g.value)!=null&&l.finalize):!1}),Le=y(()=>{var a,e,l,n;return!((a=_.value)!=null&&a.enabled)||z.value?!1:te.value?!0:D.value==="github"?!!((e=p.value)!=null&&e.enabled&&((l=p.value)!=null&&l.configured)&&((n=p.value)!=null&&n.token_present)):!!R.value}),je=y(()=>T.value?"Memproses...":x.value==="error"?"Coba Lagi":["ready","copying","finalize"].includes(x.value)?"Lanjutkan":x.value==="done"&&D.value==="github"?"Update Lagi":"Mulai Update"),ve=y(()=>{var a,e,l,n,o,s,c,u;return(a=_.value)!=null&&a.enabled?z.value?"":te.value?`${(e=$.value)!=null&&e.filename?`Paket: ${$.value.filename}`:"Ada update yang belum selesai."} Klik untuk melanjutkan.`:D.value==="github"?(l=p.value)!=null&&l.enabled?(n=p.value)!=null&&n.configured?(o=p.value)!=null&&o.token_present?"Akan download paket build dari GitHub Release lalu apply otomatis.":"Token GitHub belum ada. Simpan token dulu.":"Repo GitHub belum diset di .env server.":"GitHub update dinonaktifkan di server.":R.value?`Siap: ${((u=R.value)==null?void 0:u.name)||"package.zip"}`:(s=_.value)!=null&&s.allow_download&&((c=_.value)!=null&&c.package_url_set)?'Pilih file ZIP, atau gunakan "Download dari URL".':"Pilih file ZIP untuk memulai.":"Fitur update dinonaktifkan di server."});function be(a){D.value=a,ce.value=!0}function Re(){var l,n,o,s,c;return String(((l=E.value)==null?void 0:l.source)||"").toLowerCase().startsWith("github")||String(((n=$.value)==null?void 0:n.source)||"").toLowerCase().startsWith("github")||(o=p.value)!=null&&o.enabled&&((s=p.value)!=null&&s.configured)&&((c=p.value)!=null&&c.token_present)?"github":"zip"}Q(()=>{var a,e,l,n,o;return[(a=E.value)==null?void 0:a.source,(e=$.value)==null?void 0:e.source,(l=p.value)==null?void 0:l.enabled,(n=p.value)==null?void 0:n.configured,(o=p.value)==null?void 0:o.token_present]},()=>{ce.value||(D.value=Re())},{immediate:!0});const De=y(()=>{var n;const a=[{id:"package",label:"Paket"},{id:"prepare",label:"Prepare"},{id:"copy",label:"Copy"},{id:"finalize",label:"Finalize"},{id:"done",label:"Selesai"}],e=x.value;let l=0;return e==="idle"?l=0:e==="uploaded"?l=1:e==="ready"||e==="copying"?l=2:e==="finalize"?l=3:e==="done"?l=4:e==="error"&&(I.value?l=3:M.value||(n=g.value)!=null&&n.manifest?l=2:l=1),a.map((o,s)=>{const c=e==="error",u=e==="done"||s<l?"done":s===l?c?"error":"current":"upcoming";return{...o,index:s+1,status:u}})});async function S(){var a,e,l,n,o,s,c;O.value=!0;try{const u=await window.axios.get("/system-update/status");g.value=((e=(a=u==null?void 0:u.data)==null?void 0:a.data)==null?void 0:e.data)||((l=u==null?void 0:u.data)==null?void 0:l.data)||null}catch(u){g.value={stage:"error",error:((o=(n=u==null?void 0:u.response)==null?void 0:n.data)==null?void 0:o.message)||(u==null?void 0:u.message)||"Failed to load status",config:(s=g.value)==null?void 0:s.config,github:(c=g.value)==null?void 0:c.github}}finally{O.value=!1}}async function ge(){var e,l,n,o,s,c,u;const a=R.value||((l=(e=ee.value)==null?void 0:e.files)==null?void 0:l[0]);if(!a)return b("warning","Pilih file ZIP dulu.");H.value=!0,Z.value=0;try{const h=new FormData;h.append("package",a);const U=await window.axios.post("/system-update/upload",h,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:j=>{j!=null&&j.total&&(Z.value=Math.round(j.loaded/j.total*100))}});G(((o=(n=U==null?void 0:U.data)==null?void 0:n.data)==null?void 0:o.data)||((s=U==null?void 0:U.data)==null?void 0:s.data)||null),Z.value=100,b("success","Paket ZIP berhasil diunggah.")}catch(h){b("error",((u=(c=h==null?void 0:h.response)==null?void 0:c.data)==null?void 0:u.message)||(h==null?void 0:h.message)||"Upload gagal")}finally{H.value=!1,await S()}}async function Ge(){var a,e,l,n,o;T.value=!0;try{const s=await window.axios.post("/system-update/download");G(((e=(a=s==null?void 0:s.data)==null?void 0:a.data)==null?void 0:e.data)||((l=s==null?void 0:s.data)==null?void 0:l.data)||null),b("success","Download paket update selesai.")}catch(s){b("error",((o=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:o.message)||(s==null?void 0:s.message)||"Download gagal")}finally{T.value=!1,await S()}}async function Ne(){var a,e,l,n,o;T.value=!0;try{const s=await window.axios.post("/system-update/start");G(((e=(a=s==null?void 0:s.data)==null?void 0:a.data)==null?void 0:e.data)||((l=s==null?void 0:s.data)==null?void 0:l.data)||null),b("info","Prepare berhasil. Siap jalankan update.")}catch(s){b("error",((o=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:o.message)||(s==null?void 0:s.message)||"Prepare gagal")}finally{T.value=!1,await S()}}function Ae(a){return new Promise(e=>setTimeout(e,a))}async function me(){var e,l,n;let a=0;for(;T.value&&a<2e3&&(a++,await S(),!(x.value==="done"||x.value==="error"||x.value==="idle"||!["ready","copying","finalize"].includes(x.value)));){const o=await window.axios.post("/system-update/step");G(((l=(e=o==null?void 0:o.data)==null?void 0:e.data)==null?void 0:l.data)||((n=o==null?void 0:o.data)==null?void 0:n.data)||null),await Ae(200)}}async function ae(a={}){var l,n,o,s,c;const e=!!a.autoPrepare;T.value=!0;try{if(await S(),x.value==="uploaded"||x.value==="error"&&e&&$.value){if(!e&&!confirm("Jalankan Prepare sekarang?"))return;const u=await window.axios.post("/system-update/start");G(((n=(l=u==null?void 0:u.data)==null?void 0:l.data)==null?void 0:n.data)||((o=u==null?void 0:u.data)==null?void 0:o.data)||null)}await me(),await S(),x.value==="done"?b("success","Update selesai."):x.value==="error"&&b("error",q.value||"Update gagal.")}catch(u){b("error",((c=(s=u==null?void 0:u.response)==null?void 0:s.data)==null?void 0:c.message)||(u==null?void 0:u.message)||"Update gagal")}finally{T.value=!1,await S()}}async function Be(){var a,e,l,n,o;T.value=!0;try{const s=await window.axios.post("/system-update/reset");G(((e=(a=s==null?void 0:s.data)==null?void 0:a.data)==null?void 0:e.data)||((l=s==null?void 0:s.data)==null?void 0:l.data)||null),f.value=null,W.value="",V.value=!1,b("info","State update di-reset.")}catch(s){b("error",((o=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:o.message)||(s==null?void 0:s.message)||"Reset gagal")}finally{T.value=!1,await S()}}async function Ee(){var e,l,n,o,s;const a=(J.value||"").trim();if(!a)return b("warning","Isi token dulu.");A.value=!0;try{const c=await window.axios.post("/system-update/github/token",{token:a});G(((l=(e=c==null?void 0:c.data)==null?void 0:e.data)==null?void 0:l.data)||((n=c==null?void 0:c.data)==null?void 0:n.data)||null),J.value="",b("success","Token GitHub tersimpan.")}catch(c){b("error",((s=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:s.message)||(c==null?void 0:c.message)||"Gagal menyimpan token")}finally{A.value=!1,await S()}}async function Me(){var a,e,l,n,o;if(confirm("Hapus token GitHub yang disimpan di server (file-based)?")){A.value=!0;try{const s=await window.axios.post("/system-update/github/token/clear");G(((e=(a=s==null?void 0:s.data)==null?void 0:a.data)==null?void 0:e.data)||((l=s==null?void 0:s.data)==null?void 0:l.data)||null),b("info","Token GitHub dihapus.")}catch(s){b("error",((o=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:o.message)||(s==null?void 0:s.message)||"Gagal menghapus token")}finally{A.value=!1,await S()}}}async function He(){var a,e,l;A.value=!0;try{const n=await window.axios.post("/system-update/github/check");f.value=((a=n==null?void 0:n.data)==null?void 0:a.data)||null}catch(n){f.value=null,b("error",((l=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:l.message)||(n==null?void 0:n.message)||"Gagal cek update GitHub")}finally{A.value=!1}}async function $e(a={}){var s,c,u,h,U,j,m,fe,xe,ke,ye,he;const e=!!a.skipConfirm,l=(s=p.value)!=null&&s.owner&&((c=p.value)!=null&&c.repo)?`${p.value.owner}/${p.value.repo}`:"(repo belum diset)",n=((u=p.value)==null?void 0:u.release_tag)||"panel-main-latest",o=((h=p.value)==null?void 0:h.release_asset)||"update-package.zip";if(!e){const C=[`Sistem akan download paket build dari GitHub Release (${l} tag ${n}).`,`Asset: ${o}`,"","Lanjutkan?"].join(`
`);if(!confirm(C))return}T.value=!0;try{const C=await window.axios.post("/system-update/github/download");G(((j=(U=C==null?void 0:C.data)==null?void 0:U.data)==null?void 0:j.data)||((m=C==null?void 0:C.data)==null?void 0:m.data)||null);const F=await window.axios.post("/system-update/start");G(((xe=(fe=F==null?void 0:F.data)==null?void 0:fe.data)==null?void 0:xe.data)||((ke=F==null?void 0:F.data)==null?void 0:ke.data)||null),await me(),await S(),x.value==="done"?b("success","Update GitHub selesai."):x.value==="error"&&b("error",q.value||"Update GitHub gagal.")}catch(C){b("error",((he=(ye=C==null?void 0:C.response)==null?void 0:ye.data)==null?void 0:he.message)||(C==null?void 0:C.message)||"Update GitHub gagal")}finally{T.value=!1,await S()}}function se(){const a=ue.value;a&&(a.scrollTop=a.scrollHeight)}async function Ie(){var a;try{const e=(((a=g.value)==null?void 0:a.log_tail)||[]).join(`
`);if(!e)return b("warning","Log masih kosong.");await navigator.clipboard.writeText(e),b("success","Log disalin ke clipboard.")}catch{b("error","Gagal menyalin log (clipboard tidak tersedia).")}}Q(()=>{var a;return(((a=g.value)==null?void 0:a.log_tail)||[]).length},async()=>{!B.value||!Y.value||(await we(),se())}),Q(()=>x.value,a=>{a==="error"&&(B.value=!0)}),Q(()=>B.value,async a=>{a&&(await we(),se())});function Fe(a){var e,l;R.value=((l=(e=a==null?void 0:a.target)==null?void 0:e.files)==null?void 0:l[0])||null}async function Oe(){var e,l,n,o,s,c,u,h;if(!((e=_.value)!=null&&e.enabled))return b("warning","Fitur update dinonaktifkan di server.");if(z.value)return;if(await S(),te.value){await ae({autoPrepare:!0});return}if(D.value==="github"){if(!((l=p.value)!=null&&l.enabled))return b("warning","GitHub update dinonaktifkan di server.");if(!((n=p.value)!=null&&n.configured))return b("warning","Repo GitHub belum diset di server.");if(!((o=p.value)!=null&&o.token_present))return b("warning","Token GitHub belum ada. Simpan token dulu.");await $e({skipConfirm:!0});return}if(!(R.value||((c=(s=ee.value)==null?void 0:s.files)==null?void 0:c[0])))return b("warning",(u=_.value)!=null&&u.allow_download&&((h=_.value)!=null&&h.package_url_set)?'Pilih file ZIP atau gunakan "Download dari URL".':"Pilih file ZIP dulu.");await ge(),await ae({autoPrepare:!0})}return Ve(()=>{S()}),(a,e)=>{var l,n,o,s,c,u,h,U,j;return i(),r("div",We,[t("div",qe,[de.embedded?v("",!0):(i(),r("div",Qe,[e[11]||(e[11]=le('<h1 class="text-2xl font-black text-gray-900 dark:text-white">Update Sistem</h1><p class="text-sm text-gray-500 dark:text-gray-400 mt-1"> Update lewat panel tanpa <span class="font-semibold">git pull</span> / <span class="font-semibold">composer</span>. Saran: gunakan paket build (sudah termasuk <span class="font-semibold">vendor</span> dan <span class="font-semibold">public/build</span>). </p>',2)),(l=E.value)!=null&&l.source?(i(),r("div",Xe,[e[10]||(e[10]=w(" Installed: ",-1)),t("span",et,d(E.value.source),1),(n=E.value.github)!=null&&n.sha?(i(),r("span",tt,[e[9]||(e[9]=w(" sha ",-1)),t("span",at,d((E.value.github.sha||"").slice(0,7)),1)])):v("",!0),E.value.installed_at?(i(),r("span",st," at "+d(Se(E.value.installed_at)),1)):v("",!0)])):v("",!0)])),t("div",lt,[t("span",{class:k(["px-2.5 py-1 rounded-full text-xs font-black tracking-wider",pe.value.klass])},d(pe.value.text),3),t("button",{onClick:S,class:"btn btn-secondary",disabled:z.value,type:"button"},[O.value?(i(),r("span",rt,[ne(oe,{size:"sm"})])):v("",!0),e[12]||(e[12]=w(" Refresh ",-1))],8,nt),t("button",{onClick:e[0]||(e[0]=m=>L.value=!L.value),class:"btn btn-secondary",type:"button"},d(L.value?"Tutup Detail":"Detail"),1)])]),t("div",it,[t("div",ot,[t("div",{class:k(K.value)},[t("div",dt,[t("div",null,[e[15]||(e[15]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Progress",-1)),t("p",ut,[e[13]||(e[13]=t("span",{class:"font-semibold"},"Stage:",-1)),w(" "+d(Te.value),1)]),!O.value&&g.value&&!_.value.enabled?(i(),r("div",ct,[...e[14]||(e[14]=[w(" Fitur update dinonaktifkan di server. Set ",-1),t("span",{class:"font-mono font-semibold"},"SYSTEM_UPDATE_ENABLED=true",-1),w(". ",-1)])])):v("",!0),q.value?(i(),r("div",pt,d(q.value),1)):v("",!0)]),t("div",vt,[t("div",bt,[t("button",{type:"button",onClick:e[1]||(e[1]=m=>be("zip")),class:k(["px-3 py-1.5 text-xs font-bold rounded-lg transition",D.value==="zip"?"bg-white dark:bg-dark-950 shadow-sm text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"])}," ZIP ",2),t("button",{type:"button",onClick:e[2]||(e[2]=m=>be("github")),disabled:!p.value.enabled,class:k(["px-3 py-1.5 text-xs font-bold rounded-lg transition",p.value.enabled?"":"opacity-50 cursor-not-allowed",D.value==="github"?"bg-white dark:bg-dark-950 shadow-sm text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"])}," GitHub ",10,gt)]),t("button",{onClick:Oe,class:"btn btn-primary",disabled:!Le.value,type:"button"},[T.value?(i(),r("span",ft,[ne(oe,{size:"sm",color:"primary"})])):v("",!0),w(" "+d(je.value),1)],8,mt),ve.value?(i(),r("div",xt,d(ve.value),1)):v("",!0)])]),L.value?(i(),r("div",kt,[t("button",{onClick:Ne,class:"btn btn-secondary px-3 py-2 text-xs",disabled:!ze.value,type:"button"}," Prepare ",8,yt),t("button",{onClick:e[3]||(e[3]=m=>ae({autoPrepare:!0})),class:"btn btn-secondary px-3 py-2 text-xs",disabled:!Ue.value,type:"button"}," Run Steps ",8,ht)])):v("",!0),L.value?(i(),r("div",wt,[(i(!0),r(Ke,null,Je(De.value,m=>(i(),r("div",{key:m.id,class:"flex items-center gap-3 sm:flex-col sm:items-center sm:gap-2"},[t("div",{class:k(["h-9 w-9 rounded-full flex items-center justify-center text-sm font-black border",m.status==="done"?"bg-emerald-600 text-white border-emerald-600":"",m.status==="current"?"bg-primary-600 text-white border-primary-600":"",m.status==="upcoming"?"bg-gray-100 text-gray-700 border-gray-200 dark:bg-white/5 dark:text-gray-200 dark:border-white/10":"",m.status==="error"?"bg-red-600 text-white border-red-600":""])},[m.status==="done"?(i(),r("svg",_t,[...e[16]||(e[16]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):m.status==="error"?(i(),r("svg",Pt,[...e[17]||(e[17]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v4m0 4h.01M10.29 3.86l-8.02 13.9A2 2 0 004 20h16a2 2 0 001.73-3.24l-8.02-13.9a2 2 0 00-3.46 0z"},null,-1)])])):(i(),r("span",St,d(m.index),1))],2),t("div",Ct,[t("div",Tt,d(m.label),1)])]))),128))])):v("",!0),M.value?(i(),r("div",zt,[t("div",Ut,[t("span",null,"Copy "+d(M.value.idx)+"/"+d(M.value.total)+" (copied "+d(M.value.copied)+", skipped "+d(M.value.skipped)+")",1),t("span",null,d(M.value.pct)+"%",1)]),t("div",Lt,[t("div",{class:"h-full bg-gradient-to-r from-primary-600 to-primary-500",style:re({width:`${M.value.pct}%`})},null,4)])])):v("",!0),I.value?(i(),r("div",jt,[t("div",Rt,[t("span",null,"Finalize "+d(I.value.idx)+"/"+d(I.value.total),1),t("span",null,d(I.value.pct)+"%",1)]),t("div",Dt,[t("div",{class:"h-full bg-gradient-to-r from-emerald-600 to-emerald-500",style:re({width:`${I.value.pct}%`})},null,4)])])):v("",!0),L.value&&((o=g.value)!=null&&o.manifest)?(i(),r("div",{key:4,class:k(["mt-5",N.value])},[t("div",Gt,[t("div",Nt,[e[18]||(e[18]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"vendor",-1)),t("div",{class:k(["mt-1 font-semibold",g.value.manifest.vendor_included?"text-emerald-700 dark:text-emerald-300":"text-amber-700 dark:text-amber-300"])},d(g.value.manifest.vendor_included?"included":"NOT included"),3)]),t("div",At,[e[19]||(e[19]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"public/build",-1)),t("div",{class:k(["mt-1 font-semibold",g.value.manifest.build_included?"text-emerald-700 dark:text-emerald-300":"text-amber-700 dark:text-amber-300"])},d(g.value.manifest.build_included?"included":"NOT included"),3)]),t("div",Bt,[e[20]||(e[20]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"excluded",-1)),t("div",Et,d(g.value.manifest.excluded_count||0),1)])]),e[23]||(e[23]=le('<div class="mt-3 text-xs text-gray-500 dark:text-gray-400"> Tidak menimpa: <span class="font-semibold">.env</span>, <span class="font-semibold">storage/</span>, <span class="font-semibold">bootstrap/cache</span>, <span class="font-semibold">public/storage</span>, <span class="font-semibold">public/uploads</span>. </div>',1)),g.value.manifest.vendor_included?v("",!0):(i(),r("div",Mt,[...e[21]||(e[21]=[w(" Paket tidak mengandung ",-1),t("span",{class:"font-semibold"},"vendor/",-1),w(". Sistem mempertahankan vendor yang ada. Jika ada perubahan dependency, update bisa gagal. ",-1)])])),g.value.manifest.build_included?v("",!0):(i(),r("div",Ht,[...e[22]||(e[22]=[w(" Paket tidak mengandung ",-1),t("span",{class:"font-semibold"},"public/build",-1),w(". Sistem mempertahankan build yang ada. Jika ada perubahan frontend, UI bisa tidak update. ",-1)])]))],2)):v("",!0)],2),D.value==="github"?(i(),r("div",{key:0,class:k(K.value)},[t("div",$t,[e[24]||(e[24]=t("div",null,[t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"GitHub (main)"),t("p",{class:"text-sm text-gray-600 dark:text-gray-300 mt-1"}," Ambil paket build dari GitHub Release, lalu apply otomatis. ")],-1)),t("div",It,[t("button",{onClick:He,class:"btn btn-secondary px-3 py-2 text-xs",disabled:z.value||!p.value.enabled||!p.value.configured||!p.value.token_present,type:"button"}," Cek ",8,Ft)])]),p.value.enabled?v("",!0):(i(),r("div",Ot," GitHub update dinonaktifkan (server config). ")),t("div",Zt,[t("div",{class:k(N.value)},[e[29]||(e[29]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Repo",-1)),t("div",Vt,[p.value.configured?(i(),r("span",Kt,d(p.value.owner)+"/"+d(p.value.repo),1)):(i(),r("span",Jt,"Belum diset di .env"))]),t("div",Yt,[e[25]||(e[25]=w(" Branch: ",-1)),t("span",Wt,d(p.value.branch||"main"),1)]),t("div",qt,[e[26]||(e[26]=w(" Tag: ",-1)),t("span",Qt,d(p.value.release_tag||"panel-main-latest"),1),e[27]||(e[27]=t("span",{class:"mx-2"},"|",-1)),e[28]||(e[28]=w(" Asset: ",-1)),t("span",Xt,d(p.value.release_asset||"update-package.zip"),1)])],2),t("div",{class:k(N.value)},[e[30]||(e[30]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Token",-1)),t("div",ea,[p.value.token_present?(i(),r("span",ta," Ada ("+d(p.value.token_hint||"****")+") ",1)):(i(),r("span",aa,"Belum ada"))]),e[31]||(e[31]=t("div",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},[w(" Saran: Fine-grained PAT, akses "),t("span",{class:"font-semibold"},"Contents: Read"),w(" untuk repo ini saja. ")],-1))],2)]),L.value||!p.value.token_present?(i(),r("div",{key:1,class:k(["mt-4",N.value])},[t("div",sa,[e[32]||(e[32]=t("div",null,[t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Simpan Token"),t("div",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Token disimpan di server (file-based, encrypted). ")],-1)),L.value&&p.value.token_present?(i(),r("button",{key:0,onClick:Me,class:"btn btn-danger px-3 py-2 text-xs",disabled:z.value||A.value||!p.value.enabled,type:"button"}," Hapus ",8,la)):v("",!0)]),t("div",na,[ie(t("input",{"onUpdate:modelValue":e[4]||(e[4]=m=>J.value=m),type:"password",class:"input sm:col-span-2",placeholder:"Fine-grained PAT (read-only)"},null,512),[[_e,J.value]]),t("button",{onClick:Ee,class:"btn btn-secondary px-3 py-2 text-xs",disabled:z.value||A.value||!p.value.enabled,type:"button"}," Simpan ",8,ra)])],2)):v("",!0),(s=f.value)!=null&&s.latest?(i(),r("div",{key:2,class:k(["mt-4",N.value])},[t("div",ia,[t("div",oa,[e[37]||(e[37]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Latest",-1)),t("div",da,[t("span",ua,d(f.value.latest.short),1),t("span",ca,d(f.value.latest.message),1)]),f.value.latest.date?(i(),r("div",pa,d(f.value.latest.date),1)):v("",!0),f.value.built?(i(),r("div",va,[e[36]||(e[36]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Built Artifact",-1)),t("div",ba,[t("div",null,[e[33]||(e[33]=t("span",{class:"font-semibold"},"tag:",-1)),t("span",ga,d(((c=f.value.built.release)==null?void 0:c.tag)||"-"),1)]),(u=f.value.built.meta)!=null&&u.short?(i(),r("div",ma,[e[34]||(e[34]=t("span",{class:"font-semibold"},"sha:",-1)),t("span",fa,d(f.value.built.meta.short),1),f.value.built.meta.built_at?(i(),r("span",xa,d(f.value.built.meta.built_at),1)):v("",!0)])):(i(),r("div",ka," Metadata build tidak terbaca (body release tidak berisi JSON meta). ")),(h=f.value.built.asset)!=null&&h.name?(i(),r("div",ya,[e[35]||(e[35]=t("span",{class:"font-semibold"},"asset:",-1)),t("span",ha,d(f.value.built.asset.name),1),typeof f.value.built.asset.size=="number"?(i(),r("span",wa," ("+d(Math.round(f.value.built.asset.size/1024/1024))+" MB) ",1)):v("",!0)])):v("",!0)])])):v("",!0)]),t("div",_a,[f.value.build_ready===!0?(i(),r("div",Pa,"BUILD READY")):f.value.build_ready===!1?(i(),r("div",Sa,"BUILD PENDING")):v("",!0),f.value.update_available===!1?(i(),r("div",Ca,"UP TO DATE")):f.value.update_available===!0?(i(),r("div",Ta,"UPDATE AVAILABLE")):(i(),r("div",za,"UNKNOWN"))])])],2)):v("",!0)],2)):v("",!0),D.value==="zip"?(i(),r("div",{key:1,class:k(K.value)},[e[40]||(e[40]=t("div",null,[t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Paket ZIP"),t("p",{class:"text-sm text-gray-600 dark:text-gray-300 mt-1"}," Upload paket update manual (ZIP). Cocok untuk hosting tanpa akses git/composer. ")],-1)),t("div",Ua,[t("input",{ref_key:"fileRef",ref:ee,type:"file",accept:".zip",class:"block w-full text-sm text-gray-700 dark:text-gray-300",onChange:Fe},null,544),(U=R.value)!=null&&U.name?(i(),r("div",La,[e[38]||(e[38]=w(" Selected: ",-1)),t("span",ja,d(R.value.name),1),R.value.size?(i(),r("span",Ra,"("+d(Ce(R.value.size))+")",1)):v("",!0)])):v("",!0),t("div",Da,[L.value?(i(),r("button",{key:0,onClick:ge,class:"btn btn-secondary",disabled:H.value||z.value||!_.value.enabled,type:"button"},[H.value?(i(),r("span",Na,[ne(oe,{size:"sm"})])):v("",!0),w(" "+d(H.value?`Uploading ${Z.value}%`:"Upload saja"),1)],8,Ga)):v("",!0),_.value.allow_download&&_.value.package_url_set?(i(),r("button",{key:1,onClick:Ge,class:"btn btn-secondary",disabled:z.value||!_.value.enabled,type:"button"}," Download dari URL ",8,Aa)):v("",!0)]),H.value?(i(),r("div",Ba,[t("div",{class:"h-full bg-gradient-to-r from-primary-600 to-primary-500",style:re({width:`${Z.value}%`})},null,4)])):v("",!0),L.value?(i(),r("div",{key:2,class:k(N.value)},[...e[39]||(e[39]=[le('<div class="text-xs text-gray-500 dark:text-gray-400"> Tidak menimpa: <span class="font-semibold">.env</span>, <span class="font-semibold">storage/</span>, <span class="font-semibold">bootstrap/cache</span>, <span class="font-semibold">public/storage</span>, <span class="font-semibold">public/uploads</span>. </div>',1)])],2)):v("",!0)])],2)):v("",!0)]),t("div",Ea,[t("div",{class:k(K.value)},[t("div",Ma,[e[42]||(e[42]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Log",-1)),t("div",Ha,[t("button",{onClick:e[5]||(e[5]=m=>B.value=!B.value),class:"btn btn-secondary px-3 py-2 text-xs",type:"button"},d(B.value?"Tutup":"Lihat"),1),t("button",{onClick:Ie,class:"btn btn-secondary px-3 py-2 text-xs",type:"button"}," Copy "),B.value&&!Y.value?(i(),r("button",{key:0,onClick:se,class:"btn btn-secondary px-3 py-2 text-xs",type:"button"}," Ke bawah ")):v("",!0),t("label",$a,[ie(t("input",{"onUpdate:modelValue":e[6]||(e[6]=m=>Y.value=m),type:"checkbox",class:"rounded border-gray-300 dark:border-white/20"},null,512),[[Ye,Y.value]]),e[41]||(e[41]=w(" Auto-follow ",-1))])])]),B.value?(i(),r("div",{key:0,ref_key:"logBoxRef",ref:ue,class:"mt-3 h-80 overflow-auto rounded-xl border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-black/20 p-3"},[t("pre",Ia,d((((j=g.value)==null?void 0:j.log_tail)||[]).join(`
`)),1)],512)):(i(),r("div",Fa," Log disembunyikan. Akan terbuka otomatis saat terjadi error. "))],2),L.value?(i(),r("div",{key:0,class:k(K.value)},[e[47]||(e[47]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Konfigurasi",-1)),t("div",Oa,[t("div",{class:k(N.value)},[e[43]||(e[43]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Enabled",-1)),t("div",Za,d(_.value.enabled?"YES":"NO"),1)],2),t("div",{class:k(N.value)},[e[44]||(e[44]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Chunk size",-1)),t("div",Va,d(_.value.chunk_size),1)],2),t("div",{class:k(N.value)},[e[45]||(e[45]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Max package",-1)),t("div",Ka,d(_.value.max_package_mb)+" MB",1)],2),t("div",{class:k(N.value)},[e[46]||(e[46]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Download",-1)),t("div",Ja,d(_.value.allow_download?"YES":"NO"),1)],2)])],2)):v("",!0)])]),t("div",Ya,[t("div",Wa,[e[48]||(e[48]=t("div",null,[t("h3",{class:"text-base font-semibold text-red-900 dark:text-red-200"},"Danger Zone"),t("p",{class:"mt-1 text-xs text-red-800 dark:text-red-200"}," Reset hanya menghapus state/workdir update (paket ZIP tetap ada). Gunakan jika update macet atau state corrupt. ")],-1)),t("button",{onClick:e[7]||(e[7]=m=>V.value=!V.value),class:"btn btn-secondary px-3 py-2 text-xs",type:"button"},d(V.value?"Tutup":"Buka"),1)]),V.value?(i(),r("div",qa,[e[49]||(e[49]=t("div",{class:"text-xs text-red-800 dark:text-red-200"},"Ketik RESET untuk mengaktifkan tombol reset.",-1)),t("div",Qa,[ie(t("input",{"onUpdate:modelValue":e[8]||(e[8]=m=>W.value=m),class:"input sm:col-span-2",placeholder:"Ketik RESET"},null,512),[[_e,W.value]]),t("button",{onClick:Be,class:"btn btn-danger",disabled:z.value||W.value!=="RESET",type:"button"}," Reset Update ",8,Xa)])])):v("",!0)])])}}};export{as as default};
