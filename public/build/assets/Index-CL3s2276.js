import{C as Wa,E as _e,G as qt,o as Xa,D as qa,c as r,a as Zt,u as Za,h as Ya,m as Qa,b as t,t as d,f as y,x as G,j as n,e as g,d as h,n as A,i as Ye,F as M,s as U,w as te,v as P,r as m,y as re,z as el}from"./app-Babio-Hg.js";import{_ as tl}from"./AdminLayout-D4cKWswb.js";const al={class:"space-y-4 animate-fade-in"},ll={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3 bg-white dark:bg-dark-800 p-5 rounded-xl shadow-card border border-gray-100 dark:border-dark-700"},sl={class:"flex flex-wrap items-center gap-2"},ol={class:"px-3 py-2 rounded-lg bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 text-xs"},rl={class:"font-semibold text-gray-900 dark:text-white"},nl={class:"px-3 py-2 rounded-lg bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 text-xs"},il={class:"font-semibold text-gray-900 dark:text-white"},ul={class:"px-3 py-2 rounded-lg bg-red-50/60 dark:bg-red-900/10 border border-red-200/60 dark:border-red-900/30 text-xs"},dl={class:"font-semibold text-red-700 dark:text-red-300"},pl={class:"hidden lg:flex items-center gap-2 ml-2"},vl=["disabled"],cl={key:0,class:"bg-amber-50 dark:bg-amber-900/10 border border-amber-200 dark:border-amber-900/30 text-amber-800 dark:text-amber-200 rounded-xl p-4 text-sm"},bl={key:1,class:"bg-white dark:bg-dark-800 border border-gray-100 dark:border-dark-700 rounded-xl p-6"},gl={key:2,class:"relative"},ml={class:"grid grid-cols-1 lg:grid-cols-12 gap-4"},fl={class:"flex flex-wrap items-center gap-2 p-3 border-b border-gray-100 dark:border-dark-700"},yl={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},kl={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},xl={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},_l={class:"ml-auto flex items-center gap-2 lg:hidden"},hl=["disabled"],wl={class:"relative flex-1 min-h-[420px] lg:min-h-0"},Cl={key:0,class:"absolute inset-0 z-10 flex items-center justify-center p-6 bg-white/85 dark:bg-dark-900/70 backdrop-blur"},Nl={class:"max-w-md text-center"},Pl={class:"mt-1 text-xs text-gray-600 dark:text-gray-300"},Tl={key:1,class:"absolute bottom-3 left-3 right-3 lg:right-auto lg:max-w-md bg-white/90 dark:bg-dark-900/80 backdrop-blur border border-gray-200 dark:border-white/10 rounded-xl p-3 text-xs text-gray-700 dark:text-gray-200 shadow-lg"},Sl={class:"font-semibold"},El={class:"uppercase"},Ll={key:0,class:"text-gray-600 dark:text-gray-300 mt-1"},Ol={key:1,class:"text-gray-600 dark:text-gray-300 mt-1"},$l={class:"font-semibold"},Ml={key:0,class:"ml-1 text-blue-700 dark:text-blue-300"},Fl={key:2,class:"text-gray-600 dark:text-gray-300 mt-1"},Ul={key:3,class:"mt-2 flex items-center gap-2 text-xs text-gray-700 dark:text-gray-200"},Il=["disabled"],Al={class:"mt-2 flex items-center gap-2"},jl=["disabled"],Gl=["disabled"],Vl=["disabled"],Rl={class:"lg:hidden px-4 pt-2 pb-3 border-b border-gray-100 dark:border-dark-700"},Dl={class:"mt-2 flex items-center justify-between"},Bl={class:"flex items-center gap-1 border-b border-gray-100 dark:border-dark-700 overflow-x-auto"},Kl={class:"p-4 overflow-y-auto flex-1 min-h-0"},Hl={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Jl={key:1,class:"text-sm text-red-600 dark:text-red-300"},zl={key:2,class:"space-y-3"},Wl={class:"flex items-center justify-between"},Xl={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},ql={key:1,class:"space-y-2 pr-1"},Zl=["onClick"],Yl={class:"flex items-start justify-between gap-2"},Ql={class:"text-sm font-semibold text-gray-900 dark:text-white"},es={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},ts={key:0},as={key:1,class:"ml-2"},ls={key:2,class:"ml-2"},ss={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},os={class:"font-medium text-gray-700 dark:text-gray-200"},rs={class:"font-medium text-gray-700 dark:text-gray-200"},ns={class:"flex items-center gap-1 shrink-0"},is=["onClick"],us=["onClick"],ds={key:3,class:"space-y-3"},ps={class:"flex items-center justify-between"},vs={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},cs={key:1,class:"space-y-2 pr-1"},bs=["onClick"],gs={class:"flex items-start justify-between gap-2"},ms={class:"text-sm font-semibold text-gray-900 dark:text-white"},fs={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},ys={key:0},ks={key:1,class:"ml-2"},xs={class:"flex items-center gap-1 shrink-0"},_s=["onClick"],hs=["onClick"],ws={key:4,class:"space-y-3"},Cs={class:"flex items-center justify-between"},Ns={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Ps={key:1,class:"space-y-2 pr-1"},Ts={class:"flex items-start justify-between gap-2"},Ss={class:"text-xs font-bold text-indigo-700 dark:text-indigo-300"},Es={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1"},Ls={class:"text-xs text-gray-500 dark:text-gray-400 mt-1 space-y-0.5"},Os={class:"font-medium text-gray-700 dark:text-gray-200"},$s={key:0},Ms={class:"font-medium text-gray-700 dark:text-gray-200"},Fs={class:"ml-1"},Us={class:"flex items-center gap-1 shrink-0"},Is=["onClick"],As=["onClick"],js={key:5,class:"space-y-3"},Gs={class:"flex items-center justify-between"},Vs={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Rs={key:1,class:"space-y-2 pr-1"},Ds={class:"flex items-start justify-between gap-2"},Bs={class:"min-w-0"},Ks={class:"text-xs font-bold text-amber-700 dark:text-amber-300"},Hs={key:0,class:"ml-1"},Js={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},zs={class:"font-medium text-gray-700 dark:text-gray-200"},Ws={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1 truncate"},Xs={key:0,class:"text-gray-700 dark:text-gray-200"},qs={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-2"},Zs={key:0},Ys={key:1,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Qs={class:"font-medium text-gray-700 dark:text-gray-200"},eo={class:"flex items-center gap-1 shrink-0"},to=["onClick"],ao=["onClick"],lo={key:6,class:"space-y-3"},so={class:"flex items-center justify-between"},oo=["disabled"],ro={class:"space-y-2"},no=["value"],io={class:"flex items-center gap-2"},uo=["disabled"],po=["disabled"],vo={key:0,class:"text-xs text-red-600 dark:text-red-300"},co={key:0,class:"space-y-3"},bo={class:"text-xs text-gray-500 dark:text-gray-400"},go={class:"font-semibold text-gray-800 dark:text-gray-200"},mo={class:"font-semibold text-gray-800 dark:text-gray-200"},fo={key:0,class:"ml-2 text-amber-700 dark:text-amber-300"},yo={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},ko={key:1,class:"space-y-2 max-h-[260px] overflow-auto pr-1"},xo=["onClick"],_o={class:"text-sm font-semibold text-gray-900 dark:text-white"},ho={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},wo={class:"font-medium text-gray-700 dark:text-gray-200"},Co={key:2,class:"rounded-xl border border-gray-100 dark:border-dark-700 p-3 bg-gray-50/40 dark:bg-dark-900/30"},No={class:"mt-2 space-y-1 max-h-[220px] overflow-auto pr-1"},Po={class:"font-medium text-gray-900 dark:text-white"},To={class:"text-gray-600 dark:text-gray-300"},So={key:7,class:"space-y-3"},Eo={class:"flex items-center justify-between"},Lo={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Oo={key:1,class:"space-y-2 pr-1"},$o=["onClick"],Mo={class:"flex items-start justify-between gap-2"},Fo={class:"text-xs font-bold"},Uo={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1"},Io={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},Ao={key:0,class:"ml-2"},jo={key:0,class:"text-xs text-gray-600 dark:text-gray-300 mt-1 line-clamp-2"},Go={class:"flex items-center gap-1 shrink-0"},Vo=["disabled","onClick"],Ro=["onClick"],Do=["onClick"],Bo={class:"relative pointer-events-auto w-full max-w-2xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},Ko={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Ho={class:"font-semibold text-gray-900 dark:text-white"},Jo={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},zo={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Wo={key:0,class:"text-xs text-red-600 mt-1"},Xo={key:0,class:"text-xs text-red-600 mt-1"},qo={key:0,class:"text-xs text-red-600 mt-1"},Zo={key:0,class:"text-xs text-red-600 mt-1"},Yo={class:"md:col-span-2"},Qo={class:"flex flex-col sm:flex-row gap-2"},er={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},tr={class:"font-medium text-gray-700 dark:text-gray-200"},ar={class:"ml-2"},lr={key:0,class:"ml-2"},sr=["value"],or=["value"],rr={class:"md:col-span-2"},nr={class:"flex items-center gap-2"},ir={class:"md:col-span-2"},ur={class:"rounded-xl border border-gray-100 dark:border-dark-700 p-3"},dr={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-2"},pr={class:"text-xs text-gray-500 dark:text-gray-400"},vr={class:"flex flex-wrap items-center gap-2"},cr={class:"flex items-center gap-2 text-xs text-gray-700 dark:text-gray-200 px-3 py-2 rounded-xl border border-gray-200/70 dark:border-white/10 bg-white/70 dark:bg-dark-900/40"},br=["disabled"],gr=["disabled"],mr=["disabled"],fr=["disabled"],yr={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},kr=["disabled"],xr={class:"relative pointer-events-auto w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},_r={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},hr={class:"font-semibold text-gray-900 dark:text-white"},wr={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},Cr={key:0,class:"text-xs text-red-600 mt-1"},Nr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Pr={key:0,class:"text-xs text-red-600 mt-1"},Tr={key:0,class:"text-xs text-red-600 mt-1"},Sr={class:"flex items-center gap-2"},Er={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},Lr=["disabled"],Or={class:"relative pointer-events-auto w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},$r={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Mr={class:"font-semibold text-gray-900 dark:text-white"},Fr={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},Ur=["value"],Ir=["value"],Ar={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},jr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Gr=["disabled"],Vr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Rr={key:0,class:"text-xs text-red-600 mt-1"},Dr={key:0,class:"text-xs text-red-600 mt-1"},Br={class:"flex items-center gap-2"},Kr={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},Hr=["disabled"],Jr={key:3,class:"fixed inset-0 z-[10000] flex items-center justify-center p-4"},zr={class:"relative w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},Wr={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Xr={class:"font-semibold text-gray-900 dark:text-white"},qr={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},Zr=["value"],Yr={key:0,class:"text-xs text-red-600 mt-1"},Qr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},en={key:0,class:"text-xs text-red-600 mt-1"},tn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},an=["value"],ln={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},sn=["disabled"],on={key:4,class:"fixed inset-0 z-[10000] flex items-center justify-center p-4"},rn={class:"relative w-full max-w-2xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},nn={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},un={class:"font-semibold text-gray-900 dark:text-white"},dn={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},pn=["value"],vn={key:0,class:"text-xs text-red-600 mt-1"},cn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},bn={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},gn=["value"],mn={key:0,class:"text-xs text-red-600 mt-1"},fn={key:0,class:"text-xs text-red-600 mt-1"},yn={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},kn=["value"],xn={key:1,class:"space-y-3 rounded-xl border border-gray-100 dark:border-dark-700 p-3"},_n={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},hn={class:"flex items-center gap-2"},wn={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},Cn={key:1,class:"space-y-2 max-h-[260px] overflow-auto pr-1"},Nn={class:"col-span-7"},Pn=["onUpdate:modelValue"],Tn=["value"],Sn={class:"col-span-3"},En=["onUpdate:modelValue"],Ln={class:"col-span-2 flex items-center justify-end"},On=["onClick"],$n={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},Mn=["disabled"],An={__name:"Index",props:{tenantId:{type:Number,default:0},warning:{type:String,default:null},googleMapsApiKey:{type:String,default:""}},setup(Yt){const c=Wa("toast"),ct=Yt,Pt=el(),Tt=re(()=>{var a,e;return((e=(a=Pt.props.auth)==null?void 0:a.user)==null?void 0:e.permissions)||[]}),Qt=re(()=>{var a,e;return(((e=(a=Pt.props.auth)==null?void 0:a.user)==null?void 0:e.role)||"").toString().toLowerCase().trim()});function ea(a){const e=(a||"").toString().toLowerCase().trim();return e==="svp lapangan"?"svp_lapangan":e}function Qe(a){const e=ea(Qt.value);return["admin","owner"].includes(e)||Tt.value.includes("manage fiber")?!0:Tt.value.includes(a)}const St=re(()=>Qe("view fiber")),H=re(()=>Qe("create fiber")),J=re(()=>Qe("edit fiber")),ae=re(()=>Qe("delete fiber")),Se=m(!1),et=m(""),Ee=m({cables:0,points:0,breaks_total:0,breaks_open:0}),z=m([]),K=m([]),Le=m([]),Ie=m([]),tt=m([]),F=m("cables"),Ae=m(!0),je=m(!0),Ge=m(!0),le=m(null),R=m(null),se=m(null),Oe=m(!1),be=m(!1),ne=m(null),at=m([]),Et=re(()=>{const a=new Set;return(at.value||[]).forEach(e=>{const o=Number(e);Number.isFinite(o)&&o>0&&a.add(o)}),a});async function D(a,e={}){const o=await fetch(a,{credentials:"same-origin",headers:{Accept:"application/json",...e.headers||{}},...e}),s=await o.text();let i=null;try{i=s?JSON.parse(s):null}catch{i=null}return{ok:o.ok,status:o.status,data:i,text:s}}async function j(){var a,e,o,s,i,p,b,u,x,N,S,$;if(St.value){Se.value=!0,et.value="";try{const[L,ce]=await Promise.all([D("/api/v1/fiber/map-data"),D("/api/v1/fiber/summary")]);if(!L.ok){const I=((a=L.data)==null?void 0:a.message)||`Gagal memuat data fiber (HTTP ${L.status}).`;throw new Error(I)}ce.ok?Ee.value=((e=ce.data)==null?void 0:e.data)||Ee.value:Ee.value={cables:0,points:0,breaks_total:0,breaks_open:0},z.value=((s=(o=L.data)==null?void 0:o.data)==null?void 0:s.cables)||[],K.value=((p=(i=L.data)==null?void 0:i.data)==null?void 0:p.points)||[],Le.value=((u=(b=L.data)==null?void 0:b.data)==null?void 0:u.breaks)||[],Ie.value=((N=(x=L.data)==null?void 0:x.data)==null?void 0:N.ports)||[],tt.value=(($=(S=L.data)==null?void 0:S.data)==null?void 0:$.links)||[],Ut(),va()}catch(L){console.error("Fiber: loadAll failed",L),et.value=L&&L.message?L.message:"Gagal memuat data fiber."}finally{Se.value=!1}}}const bt=m(null);let C=null,W=null,gt=new Map,mt=new Map,ft=new Map,he={markers:[],polyline:null},Lt=!1;const we=m(""),ie=m("roadmap"),Ve={roadmap:{label:"Roadmap",mapTypeId:"roadmap"},satellite:{label:"Satelit",mapTypeId:"satellite"},hybrid:{label:"Hybrid",mapTypeId:"hybrid"}};function ta(a){var o;const e=(a||"").toString().trim();return e?(o=window.google)!=null&&o.maps?Promise.resolve():(window.__fiberGoogleMapsPromise||(window.__fiberGoogleMapsPromise=new Promise((s,i)=>{const p=document.createElement("script"),b=new URLSearchParams({key:e,v:"weekly"});p.src=`https://maps.googleapis.com/maps/api/js?${b.toString()}`,p.async=!0,p.defer=!0,p.onload=()=>s(),p.onerror=()=>i(new Error("Gagal memuat Google Maps. Cek API key/koneksi.")),document.head.appendChild(p)})),window.__fiberGoogleMapsPromise):Promise.reject(new Error("Google Maps API key belum di-set."))}function aa(){var e;if(!C||!((e=window.google)!=null&&e.maps))return;const a=Ve[ie.value]||Ve.roadmap;try{C.setMapTypeId(a.mapTypeId)}catch{}}function Ot(){var a;if(!(!C||!((a=window.google)!=null&&a.maps)))try{window.google.maps.event.trigger(C,"resize")}catch{}}function $t(){var a;kt();try{(he.markers||[]).forEach(e=>{try{e.setMap(null)}catch{}})}catch{}he.markers=[];try{(a=he.polyline)==null||a.setMap(null)}catch{}he.polyline=null}function $e(a){try{Array.from(a.values()).forEach(e=>{try{e.setMap(null)}catch{}})}catch{}try{a.clear()}catch{}}function la(){var e;if(!((e=window.google)!=null&&e.maps)||!bt.value)return;const a=Ve[ie.value]||Ve.roadmap;C=new window.google.maps.Map(bt.value,{center:{lat:-2.5489,lng:118.0149},zoom:5,mapTypeId:a.mapTypeId,clickableIcons:!1,fullscreenControl:!1,streetViewControl:!1,mapTypeControl:!1}),W=new window.google.maps.InfoWindow,C.addListener("click",na)}function sa(){var a;if(!((a=window.google)!=null&&a.maps)){C=null,W=null;return}try{window.google.maps.event.clearInstanceListeners(C)}catch{}try{W==null||W.close()}catch{}$t(),$e(gt),$e(mt),$e(ft),C=null,W=null}const w=m(null),X=m(null),q=m(!0),ge=m(!1);let ue=[],yt=null,Re=[];function oa(a){var e,o,s,i;if(a){try{if(typeof a.remove=="function"){a.remove();return}}catch{}try{(i=(s=(o=(e=window.google)==null?void 0:e.maps)==null?void 0:o.event)==null?void 0:s.removeListener)==null||i.call(s,a)}catch{}}}function kt(){try{(Re||[]).forEach(a=>oa(a))}catch{}Re=[]}function me(a){const e=Number(a);return Number.isFinite(e)?Math.round(e*1e7)/1e7:null}function ra(){var a;return(a=window.google)!=null&&a.maps?(yt||(yt=new window.google.maps.DirectionsService),yt):null}async function Mt(a,e){const o=ra();if(!o)throw new Error("Google Maps Directions belum siap.");const s={origin:a,destination:e,travelMode:window.google.maps.TravelMode.DRIVING};return new Promise((i,p)=>{try{o.route(s,(b,u)=>{var S;if(u!=="OK"||!((S=b==null?void 0:b.routes)!=null&&S[0])){p(new Error(`Gagal ambil rute jalan (${u||"UNKNOWN"}).`));return}const N=(b.routes[0].overview_path||[]).map($=>({lat:me($.lat()),lng:me($.lng())})).filter($=>Number.isFinite($.lat)&&Number.isFinite($.lng));i(N)})}catch(b){p(b)}})}async function na(a){if(!(a!=null&&a.latLng))return;const e=me(a.latLng.lat()),o=me(a.latLng.lng());if(w.value==="pickPoint"){_.value.latitude=e,_.value.longitude=o,c&&c.success("Lokasi titik dipilih dari peta."),O();return}if(w.value==="pickBreak"){k.value.latitude=e,k.value.longitude=o,c&&c.success("Lokasi putus dipilih dari peta."),O();return}if(w.value==="drawCable"){const s=Array.isArray(v.value.path)?v.value.path:[];if(!Number.isFinite(e)||!Number.isFinite(o))return;if(s.length<1||!q.value){ue.push(s.length),s.push({lat:e,lng:o}),v.value.path=s,Z();return}if(ge.value)return;ue.push(s.length),ge.value=!0;try{const i=s[s.length-1],p=await Mt({lat:Number(i==null?void 0:i.lat),lng:Number(i==null?void 0:i.lng)},{lat:e,lng:o});if(Array.isArray(p)&&p.length>=2){const b=p.slice(1);v.value.path=s.concat(b)}else s.push({lat:e,lng:o}),v.value.path=s}catch(i){s.push({lat:e,lng:o}),v.value.path=s,c&&c.error((i==null?void 0:i.message)||"Gagal mengikuti jalan. Pakai garis lurus.")}finally{ge.value=!1,Z()}}}function O(a={}){const e=(a==null?void 0:a.reopen)!==!1,o=e?X.value:null;kt(),w.value=null,X.value=null,e&&o&&(o==="cable"&&(V.value=!0),o==="point"&&(Q.value=!0),o==="break"&&(ee.value=!0)),Z()}function ia(a){const e=document.createElement("div");return e.className="text-sm",(a||[]).forEach(o=>{const s=document.createElement("div");s.textContent=String(o??""),e.appendChild(s)}),e}function xt(a,e,o=null){if(!C||!W)return;const s=(e||[]).filter(Boolean);if(!(s.length<1)){try{W.close()}catch{}W.setContent(ia(s));try{if(o){W.open({map:C,anchor:o});return}a&&W.setPosition(a),W.open({map:C})}catch{}}}function oe(a){const e=Number(a||0);if(!e)return null;const o=(K.value||[]).find(s=>Number(s==null?void 0:s.id)===e);return o?String(o.name||""):null}function Ft(a){const e=Number(a||0);if(!e)return null;const o=(K.value||[]).find(p=>Number(p==null?void 0:p.id)===e);if(!o)return null;const s=me(Number(o==null?void 0:o.latitude)),i=me(Number(o==null?void 0:o.longitude));return!Number.isFinite(s)||!Number.isFinite(i)?null:{lat:s,lng:i}}function de(a){const e=Number(a||0);if(!e)return null;const o=(z.value||[]).find(s=>Number(s==null?void 0:s.id)===e);return o?String(o.name||""):null}function ua(a){const e=String(a||"").toUpperCase();return e==="OPEN"?{stroke:"#dc2626",fill:"#ef4444"}:e==="IN_PROGRESS"?{stroke:"#b45309",fill:"#f59e0b"}:e==="FIXED"?{stroke:"#047857",fill:"#10b981"}:{stroke:"#64748b",fill:"#94a3b8"}}function Ut(){var a;!C||!((a=window.google)!=null&&a.maps)||(De(),_t(),ht(),Z())}function De(){var a;!C||!((a=window.google)!=null&&a.maps)||($e(gt),Ae.value&&(z.value||[]).forEach(e=>{const o=Array.isArray(e==null?void 0:e.path)?e.path:null;if(!o||o.length<2)return;const s=o.map(I=>({lat:Number(I==null?void 0:I.lat),lng:Number(I==null?void 0:I.lng)})).filter(I=>Number.isFinite(I.lat)&&Number.isFinite(I.lng));if(s.length<2)return;const i=Number(e==null?void 0:e.id)===Number(le.value||0),p=Et.value.size>0,b=Et.value.has(Number(e==null?void 0:e.id)),u=((e==null?void 0:e.map_color)||"#2563eb").toString(),x=i?6:4,N=b?Math.max(x,6):x,S=p?b?1:.25:.9,$=new window.google.maps.Polyline({path:s,strokeColor:u,strokeWeight:N,strokeOpacity:S,clickable:!0});$.setMap(C),gt.set(Number(e==null?void 0:e.id)||0,$);const L=oe(e==null?void 0:e.from_point_id)||"-",ce=oe(e==null?void 0:e.to_point_id)||"-";$.addListener("click",I=>{le.value=e.id,R.value=null,se.value=null,F.value="cables",De(),xt((I==null?void 0:I.latLng)||null,[`Kabel: ${(e==null?void 0:e.name)||"-"}`,e!=null&&e.code?`Kode: ${e.code}`:null,e!=null&&e.cable_type?`Tipe: ${e.cable_type}`:null,e!=null&&e.core_count?`Core: ${e.core_count}`:null,`Dari: ${L}`,`Ke: ${ce}`])})}))}function _t(){var a;!C||!((a=window.google)!=null&&a.maps)||($e(mt),je.value&&(K.value||[]).forEach(e=>{const o=Number(e==null?void 0:e.latitude),s=Number(e==null?void 0:e.longitude);if(!Number.isFinite(o)||!Number.isFinite(s))return;const i=Number(e==null?void 0:e.id)===Number(R.value||0),p=new window.google.maps.Marker({position:{lat:o,lng:s},map:C,title:((e==null?void 0:e.name)||"").toString(),clickable:!0,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:i?7:6,fillColor:"#14b8a6",fillOpacity:.9,strokeColor:"#0f766e",strokeWeight:2}});mt.set(Number(e==null?void 0:e.id)||0,p),p.addListener("click",()=>{R.value=e.id,le.value=null,se.value=null,F.value="points",_t(),xt(p.getPosition(),[`Titik: ${(e==null?void 0:e.name)||"-"}`,e!=null&&e.point_type?`Tipe: ${e.point_type}`:null,`Koordinat: ${o}, ${s}`],p)})}))}function ht(){var a;!C||!((a=window.google)!=null&&a.maps)||($e(ft),Ge.value&&(Le.value||[]).forEach(e=>{const o=Number(e==null?void 0:e.latitude),s=Number(e==null?void 0:e.longitude);if(!Number.isFinite(o)||!Number.isFinite(s))return;const i=ua(e==null?void 0:e.status),p=Number(e==null?void 0:e.id)===Number(se.value||0),b=new window.google.maps.Marker({position:{lat:o,lng:s},map:C,title:`PUTUS: ${String((e==null?void 0:e.status)||"OPEN").toUpperCase()}`,clickable:!0,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:p?8:7,fillColor:i.fill,fillOpacity:.9,strokeColor:i.stroke,strokeWeight:2}});ft.set(Number(e==null?void 0:e.id)||0,b),b.addListener("click",()=>{se.value=e.id,le.value=null,R.value=null,F.value="breaks",ht();const u=de(e==null?void 0:e.cable_id)||(e!=null&&e.cable_id?`#${e.cable_id}`:"-"),x=oe(e==null?void 0:e.point_id)||(e!=null&&e.point_id?`#${e.point_id}`:"-");xt(b.getPosition(),[`PUTUS: ${String((e==null?void 0:e.status)||"OPEN").toUpperCase()}`,`Kabel: ${u}`,`Titik: ${x}`,e!=null&&e.severity?`Severity: ${e.severity}`:null],b)})}))}function da(a){var e,o,s;try{const i=(e=a==null?void 0:a.getPath)==null?void 0:e.call(a);if(!i||typeof i.getLength!="function")return;const p=[];for(let b=0;b<i.getLength();b+=1){const u=i.getAt(b),x=me((o=u==null?void 0:u.lat)==null?void 0:o.call(u)),N=me((s=u==null?void 0:u.lng)==null?void 0:s.call(u));!Number.isFinite(x)||!Number.isFinite(N)||p.push({lat:x,lng:N})}v.value.path=p}catch{}}function pa(a){var s,i;if(kt(),!a||!((s=window.google)!=null&&s.maps))return;const e=(i=a.getPath)==null?void 0:i.call(a);if(!e||typeof e.addListener!="function")return;const o=()=>da(a);Re.push(e.addListener("insert_at",o)),Re.push(e.addListener("set_at",o)),Re.push(e.addListener("remove_at",o)),o()}function Z(){var e;if(!C||!((e=window.google)!=null&&e.maps))return;$t();const a=(o,s,i={})=>{if(!Number.isFinite(o)||!Number.isFinite(s))return;const p=new window.google.maps.Marker({position:{lat:o,lng:s},map:C,clickable:!1,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:Number(i.scale??6),fillColor:(i.fillColor||"#38bdf8").toString(),fillOpacity:Number(i.fillOpacity??.9),strokeColor:(i.strokeColor||"#0ea5e9").toString(),strokeWeight:Number(i.strokeWeight??2)}});he.markers.push(p)};if((Q.value||w.value==="pickPoint")&&_.value.latitude!==null&&_.value.longitude!==null){const o=Number(_.value.latitude),s=Number(_.value.longitude);Number.isFinite(o)&&Number.isFinite(s)&&a(o,s,{scale:7,strokeColor:"#0ea5e9",fillColor:"#38bdf8",fillOpacity:.85})}if((ee.value||w.value==="pickBreak")&&k.value.latitude!==null&&k.value.longitude!==null){const o=Number(k.value.latitude),s=Number(k.value.longitude);Number.isFinite(o)&&Number.isFinite(s)&&a(o,s,{scale:8,strokeColor:"#f97316",fillColor:"#fb923c",fillOpacity:.85})}if((V.value||w.value==="drawCable"||w.value==="editCable")&&Array.isArray(v.value.path)&&v.value.path.length>0){const o=w.value==="editCable",s=v.value.path.map(i=>({lat:Number(i==null?void 0:i.lat),lng:Number(i==null?void 0:i.lng)})).filter(i=>Number.isFinite(i.lat)&&Number.isFinite(i.lng));if(o||s.forEach(i=>{a(i.lat,i.lng,{scale:3,strokeColor:"#1d4ed8",fillColor:"#60a5fa",fillOpacity:.95})}),s.length>=2){const i={path:"M 0,-1 0,1",strokeOpacity:1,strokeColor:"#1d4ed8",scale:3};he.polyline=new window.google.maps.Polyline({path:s,strokeColor:"#1d4ed8",strokeOpacity:o?.85:0,strokeWeight:o?4:0,icons:o?[]:[{icon:i,offset:"0",repeat:"12px"}],clickable:o,editable:o,map:C}),o&&pa(he.polyline)}}}function va(){var o;if(!C||Lt||!((o=window.google)!=null&&o.maps))return;const a=new window.google.maps.LatLngBounds;let e=!1;try{Ae.value&&(z.value||[]).forEach(s=>{const i=Array.isArray(s==null?void 0:s.path)?s.path:null;!i||i.length<1||i.forEach(p=>{const b=Number(p==null?void 0:p.lat),u=Number(p==null?void 0:p.lng);!Number.isFinite(b)||!Number.isFinite(u)||(a.extend({lat:b,lng:u}),e=!0)})})}catch{}try{je.value&&(K.value||[]).forEach(s=>{const i=Number(s==null?void 0:s.latitude),p=Number(s==null?void 0:s.longitude);!Number.isFinite(i)||!Number.isFinite(p)||(a.extend({lat:i,lng:p}),e=!0)})}catch{}try{Ge.value&&(Le.value||[]).forEach(s=>{const i=Number(s==null?void 0:s.latitude),p=Number(s==null?void 0:s.longitude);!Number.isFinite(i)||!Number.isFinite(p)||(a.extend({lat:i,lng:p}),e=!0)})}catch{}if(e)try{C.fitBounds(a),Lt=!0}catch{}}function ca(a){const e=String(a||"OPEN").toUpperCase();return e==="IN_PROGRESS"?"IN PROGRESS":e}function It(a){if(!a)return"";const e=new Date(a);if(!Number.isFinite(e.getTime()))return"";const o=s=>String(s).padStart(2,"0");return`${e.getFullYear()}-${o(e.getMonth()+1)}-${o(e.getDate())}T${o(e.getHours())}:${o(e.getMinutes())}`}function fe(a,e,o=17){var s;if(!(!C||!((s=window.google)!=null&&s.maps)||!Number.isFinite(a)||!Number.isFinite(e))){try{C.panTo({lat:a,lng:e})}catch{}if(Number.isFinite(Number(o)))try{C.setZoom(Number(o))}catch{}}}function ba(a,e){const o=Number(a==null?void 0:a.lat),s=Number(a==null?void 0:a.lng),i=Number(e==null?void 0:e.lat),p=Number(e==null?void 0:e.lng);if(!Number.isFinite(o)||!Number.isFinite(s)||!Number.isFinite(i)||!Number.isFinite(p))return 0;const b=6371e3,u=ce=>Number(ce)*Math.PI/180,x=u(i-o),N=u(p-s),S=Math.sin(x/2),$=Math.sin(N/2),L=S*S+Math.cos(u(o))*Math.cos(u(i))*$*$;return 2*b*Math.asin(Math.min(1,Math.sqrt(L)))}function wt(a){const e=Array.isArray(a)?a:[];if(e.length<2)return 0;let o=0;for(let s=1;s<e.length;s+=1)o+=ba(e[s-1],e[s]);return o}function At(a){const e=Number(a);if(!Number.isFinite(e)||e<=0)return"-";if(e<1e3)return`${Math.round(e)} m`;const o=e/1e3;return`${o.toFixed(o<10?2:1)} km`}function lt(){var a;return we.value?(c&&c.error(we.value),!1):!C||!((a=window.google)!=null&&a.maps)?(c&&c.error("Peta belum siap."),!1):!0}const V=m(!1),Me=m("create"),st=m(!1),Y=m({}),ye=m(!0),ke=m(!1),v=m({id:null,name:"",code:"",cable_type:"",core_count:"",map_color:"#2563eb",from_point_id:"",to_point_id:"",path:[],length_m:"",notes:""}),Ct=re(()=>Math.round(wt(v.value.path)));function jt(){v.value={id:null,name:"",code:"",cable_type:"",core_count:"",map_color:"#2563eb",from_point_id:"",to_point_id:"",path:[],length_m:"",notes:""},Y.value={},ye.value=!0,ke.value=!1}function ga(){H.value&&(jt(),Me.value="create",ue=[],ye.value=!0,ke.value=!0,V.value=!0,X.value=null,O({reopen:!1}))}function ma(a){if(!J.value)return;jt(),Me.value="edit",ue=[],v.value={id:a.id,name:a.name||"",code:a.code||"",cable_type:a.cable_type||"",core_count:a.core_count??"",map_color:a.map_color||"#2563eb",from_point_id:a.from_point_id??"",to_point_id:a.to_point_id??"",path:Array.isArray(a.path)?a.path.slice():[],length_m:a.length_m??"",notes:a.notes||""},ye.value=!(v.value.length_m!==""&&v.value.length_m!==null&&v.value.length_m!==void 0),ke.value=!1,V.value=!0,X.value=null,O({reopen:!1});const e=(v.value.path||[])[0];e&&Number.isFinite(Number(e.lat))&&Number.isFinite(Number(e.lng))&&fe(Number(e.lat),Number(e.lng),16)}function fa(a){var i;if(!C||!((i=window.google)!=null&&i.maps))return;const e=Array.isArray(a)?a:[];if(e.length<1)return;const o=new window.google.maps.LatLngBounds;let s=!1;if(e.forEach(p=>{const b=Number(p==null?void 0:p.lat),u=Number(p==null?void 0:p.lng);!Number.isFinite(b)||!Number.isFinite(u)||(o.extend({lat:b,lng:u}),s=!0)}),!!s)try{C.fitBounds(o)}catch{}}async function Gt(a={}){var N;const e=(a==null?void 0:a.force)===!0,o=Number(v.value.from_point_id||0),s=Number(v.value.to_point_id||0);if(!o||!s)return c&&c.error("Pilih Dari Titik dan Ke Titik dulu."),!1;if(o===s)return c&&c.error("Dari Titik dan Ke Titik tidak boleh sama."),!1;const i=Ft(o),p=Ft(s);if(!i||!p)return c&&c.error("Koordinat titik belum lengkap. Isi latitude/longitude di data Titik."),!1;const b=Array.isArray(v.value.path)&&v.value.path.length>=2;if(b&&!e||b&&e&&!confirm("Jalur sudah ada. Timpa jalur dengan jalur otomatis dari titik?"))return!1;let u=[];const x=!!q.value;if(x&&((N=window.google)!=null&&N.maps))try{u=await Mt(i,p)}catch(S){u=[],c&&c.error((S==null?void 0:S.message)||"Gagal mengikuti jalan. Pakai garis lurus.")}return(!Array.isArray(u)||u.length<2)&&(u=[i,p]),ue=[],v.value.path=u,Z(),fa(u),ye.value=!0,v.value.length_m=Math.round(wt(u)),c&&c.success(x?"Jalur otomatis dibuat (ikut jalan).":"Jalur otomatis dibuat."),!0}async function ya(){var i,p,b;st.value=!0,Y.value={};const a={name:v.value.name,code:v.value.code||null,cable_type:v.value.cable_type||null,core_count:v.value.core_count!==""?Number(v.value.core_count):null,map_color:v.value.map_color||null,from_point_id:v.value.from_point_id!==""?Number(v.value.from_point_id):null,to_point_id:v.value.to_point_id!==""?Number(v.value.to_point_id):null,path:Array.isArray(v.value.path)&&v.value.path.length>=2?v.value.path:null,length_m:v.value.length_m!==""&&v.value.length_m!==null&&v.value.length_m!==void 0?Number(v.value.length_m):null,notes:v.value.notes||null},e=Me.value==="edit"&&v.value.id,o=e?`/api/v1/fiber/cables/${v.value.id}`:"/api/v1/fiber/cables",s=e?"PUT":"POST";try{const u=await D(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(Y.value=u.data.errors,new Error(((p=u.data)==null?void 0:p.message)||"Validasi gagal.")):new Error(((b=u.data)==null?void 0:b.message)||`Gagal menyimpan kabel (HTTP ${u.status}).`);V.value=!1,O(),await j(),c&&c.success("Kabel tersimpan.")}catch(u){console.error("Fiber: saveCable failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan kabel.")}finally{st.value=!1}}async function ka(a){var o;if(!(!ae.value||!confirm(`Hapus kabel "${(a==null?void 0:a.name)||""}"?`)))try{const s=await D(`/api/v1/fiber/cables/${a.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus kabel (HTTP ${s.status}).`);c&&c.success("Kabel dihapus."),Number(le.value)===Number(a.id)&&(le.value=null),await j()}catch(s){console.error("Fiber: deleteCable failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus kabel.")}}function xa(){V.value&&lt()&&(X.value="cable",V.value=!1,ue=[],w.value="drawCable",Z(),c&&c.info(q.value?"Mode gambar jalur aktif (ikut jalan): klik peta untuk set titik berikutnya, lalu klik Selesai untuk kembali.":"Mode gambar jalur aktif: klik peta untuk menambah titik, lalu klik Selesai untuk kembali."))}function _a(){if(!V.value||!lt())return;if((Array.isArray(v.value.path)?v.value.path:[]).length<2){c&&c.error("Jalur belum ada. Klik Gambar dulu minimal 2 titik.");return}X.value="cable",V.value=!1,w.value="editCable",Z(),c&&c.info("Mode edit jalur aktif: geser titik/segmen di peta, lalu klik Selesai untuk kembali.")}function Vt(){const a=Array.isArray(v.value.path)?v.value.path:[];if(a.length!==0){if(ue.length>0){const e=Number(ue.pop());Number.isFinite(e)&&e>=0?v.value.path=a.slice(0,e):(a.pop(),v.value.path=a)}else a.pop(),v.value.path=a;Z()}}function Nt(){v.value.path=[],ue=[],Z()}function ha(){const a=Number(Ct.value||0);if(!Number.isFinite(a)||a<=0){c&&c.error("Tidak ada jalur untuk dihitung.");return}v.value.length_m=Math.round(a),ye.value=!0,c&&c.success("Panjang kabel diisi dari jalur.")}const Q=m(!1),ot=m("create"),rt=m(!1),pe=m({}),_=m({id:null,name:"",point_type:"",latitude:null,longitude:null,address:"",notes:""});function Rt(){_.value={id:null,name:"",point_type:"",latitude:null,longitude:null,address:"",notes:""},pe.value={}}function wa(){H.value&&(Rt(),ot.value="create",Q.value=!0,X.value=null,O({reopen:!1}))}function Ca(a){if(!J.value)return;Rt(),ot.value="edit",_.value={id:a.id,name:a.name||"",point_type:a.point_type||"",latitude:a.latitude??null,longitude:a.longitude??null,address:a.address||"",notes:a.notes||""},Q.value=!0,X.value=null,O({reopen:!1});const e=Number(_.value.latitude),o=Number(_.value.longitude);Number.isFinite(e)&&Number.isFinite(o)&&fe(e,o,17)}function Na(){Q.value&&lt()&&(X.value="point",Q.value=!1,w.value="pickPoint",Z(),c&&c.info("Klik peta untuk memilih lokasi titik."))}async function Pa(){var i,p,b;rt.value=!0,pe.value={};const a={name:_.value.name,point_type:_.value.point_type||null,latitude:_.value.latitude,longitude:_.value.longitude,address:_.value.address||null,notes:_.value.notes||null},e=ot.value==="edit"&&_.value.id,o=e?`/api/v1/fiber/points/${_.value.id}`:"/api/v1/fiber/points",s=e?"PUT":"POST";try{const u=await D(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(pe.value=u.data.errors,new Error(((p=u.data)==null?void 0:p.message)||"Validasi gagal.")):new Error(((b=u.data)==null?void 0:b.message)||`Gagal menyimpan titik (HTTP ${u.status}).`);Q.value=!1,O(),await j(),c&&c.success("Titik tersimpan.")}catch(u){console.error("Fiber: savePoint failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan titik.")}finally{rt.value=!1}}async function Ta(a){var o;if(!(!ae.value||!confirm(`Hapus titik "${(a==null?void 0:a.name)||""}"?`)))try{const s=await D(`/api/v1/fiber/points/${a.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus titik (HTTP ${s.status}).`);c&&c.success("Titik dihapus."),Number(R.value)===Number(a.id)&&(R.value=null),await j()}catch(s){console.error("Fiber: deletePoint failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus titik.")}}const ee=m(!1),nt=m("create"),it=m(!1),Ce=m({}),k=m({id:null,cable_id:"",point_id:"",status:"OPEN",severity:"",reported_at:"",fixed_at:"",latitude:null,longitude:null,description:""});function Dt(){k.value={id:null,cable_id:"",point_id:"",status:"OPEN",severity:"",reported_at:"",fixed_at:"",latitude:null,longitude:null,description:""},Ce.value={}}function Sa(){H.value&&(Dt(),nt.value="create",ee.value=!0,X.value=null,O({reopen:!1}))}function Ea(a){if(!J.value)return;Dt(),nt.value="edit",k.value={id:a.id,cable_id:a.cable_id??"",point_id:a.point_id??"",status:(a.status||"OPEN").toString().toUpperCase(),severity:a.severity||"",reported_at:It(a.reported_at),fixed_at:It(a.fixed_at),latitude:a.latitude??null,longitude:a.longitude??null,description:a.description||""},ee.value=!0,X.value=null,O({reopen:!1});const e=Number(k.value.latitude),o=Number(k.value.longitude);Number.isFinite(e)&&Number.isFinite(o)&&fe(e,o,17)}function La(){ee.value&&lt()&&(X.value="break",ee.value=!1,w.value="pickBreak",Z(),c&&c.info("Klik peta untuk memilih lokasi putus."))}async function Oa(){var i,p,b;it.value=!0,Ce.value={};const a={cable_id:k.value.cable_id!==""?Number(k.value.cable_id):null,point_id:k.value.point_id!==""?Number(k.value.point_id):null,status:(k.value.status||"OPEN").toString().toUpperCase(),severity:k.value.severity||null,reported_at:k.value.reported_at||null,fixed_at:k.value.fixed_at||null,latitude:k.value.latitude,longitude:k.value.longitude,description:k.value.description||null},e=nt.value==="edit"&&k.value.id,o=e?`/api/v1/fiber/breaks/${k.value.id}`:"/api/v1/fiber/breaks",s=e?"PUT":"POST";try{const u=await D(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(Ce.value=u.data.errors,new Error(((p=u.data)==null?void 0:p.message)||"Validasi gagal.")):new Error(((b=u.data)==null?void 0:b.message)||`Gagal menyimpan data putus (HTTP ${u.status}).`);ee.value=!1,O(),await j(),c&&c.success("Data putus tersimpan.")}catch(u){console.error("Fiber: saveBreak failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan data putus.")}finally{it.value=!1}}async function $a(a){var o;if(!(!ae.value||!confirm("Hapus data putus ini?")))try{const s=await D(`/api/v1/fiber/breaks/${a.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus data putus (HTTP ${s.status}).`);c&&c.success("Data putus dihapus."),Number(se.value)===Number(a.id)&&(se.value=null),await j()}catch(s){console.error("Fiber: deleteBreak failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus data putus.")}}const Be=m({});function Bt(a){var o;const e=String(Number(a||0));return!!((o=Be.value)!=null&&o[e])}async function Ma(a){var i,p,b;if(!J.value||!H.value)return;const e=String((a==null?void 0:a.status)||"OPEN").toUpperCase();if(!["OPEN","IN_PROGRESS"].includes(e)){c&&c.info("Status putus sudah bukan OPEN/IN_PROGRESS.");return}if(!confirm("Selesaikan data putus ini? Sistem akan membuat titik JOINT_CLOSURE di lokasi putus dan mengubah status menjadi FIXED."))return;const s=String(Number((a==null?void 0:a.id)||0));Be.value={...Be.value||{},[s]:!0};try{const u=de(a==null?void 0:a.cable_id)||(a!=null&&a.cable_id?`Kabel #${a.cable_id}`:""),x=(u?`JC - ${u}`:`Joint Closure - Break #${(a==null?void 0:a.id)||""}`).slice(0,160),N=await D(`/api/v1/fiber/breaks/${a.id}/fix`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({joint_name:x,joint_type:"JOINT_CLOSURE",joint_notes:`Auto dari data putus #${(a==null?void 0:a.id)||""}`})});if(!N.ok)throw new Error(((i=N.data)==null?void 0:i.message)||`Gagal menyelesaikan putus (HTTP ${N.status}).`);await j();const S=((b=(p=N.data)==null?void 0:p.data)==null?void 0:b.joint_point)||null,$=Number(S==null?void 0:S.latitude),L=Number(S==null?void 0:S.longitude);Number.isFinite($)&&Number.isFinite(L)&&fe($,L,18),c&&c.success("Data putus diselesaikan. Titik Joint Closure dibuat.")}catch(u){console.error("Fiber: fixBreakWithJoint failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyelesaikan putus.")}finally{const u={...Be.value||{}};delete u[s],Be.value=u}}const Ne=m(!1),ut=m("create"),dt=m(!1),Pe=m({}),T=m({id:null,point_id:"",port_type:"OLT_PON",port_label:"",cable_id:"",core_no:"",notes:""});function Kt(){T.value={id:null,point_id:"",port_type:"OLT_PON",port_label:"",cable_id:"",core_no:"",notes:""},Pe.value={}}function Fa(){H.value&&(Kt(),R.value&&(T.value.point_id=String(R.value)),ut.value="create",Ne.value=!0)}function Ua(a){J.value&&(Kt(),ut.value="edit",T.value={id:a.id,point_id:a.point_id??"",port_type:a.port_type||"OLT_PON",port_label:a.port_label||"",cable_id:a.cable_id??"",core_no:a.core_no??"",notes:a.notes||""},Ne.value=!0)}async function Ia(){var i,p,b;dt.value=!0,Pe.value={};const a={point_id:T.value.point_id!==""?Number(T.value.point_id):null,port_type:(T.value.port_type||"OLT_PON").toString().toUpperCase(),port_label:T.value.port_label||"",cable_id:T.value.cable_id!==""?Number(T.value.cable_id):null,core_no:T.value.core_no!==""?Number(T.value.core_no):null,notes:T.value.notes||null},e=ut.value==="edit"&&T.value.id,o=e?`/api/v1/fiber/ports/${T.value.id}`:"/api/v1/fiber/ports",s=e?"PUT":"POST";try{const u=await D(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(Pe.value=u.data.errors,new Error(((p=u.data)==null?void 0:p.message)||"Validasi gagal.")):new Error(((b=u.data)==null?void 0:b.message)||`Gagal menyimpan port (HTTP ${u.status}).`);Ne.value=!1,await j(),c&&c.success("Port tersimpan.")}catch(u){console.error("Fiber: savePort failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan port.")}finally{dt.value=!1}}async function Aa(a){var o;if(!(!ae.value||!confirm(`Hapus port "${(a==null?void 0:a.port_label)||""}"?`)))try{const s=await D(`/api/v1/fiber/ports/${a.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus port (HTTP ${s.status}).`);c&&c.success("Port dihapus."),await j()}catch(s){console.error("Fiber: deletePort failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus port.")}}const xe=m(!1),pt=m("create"),vt=m(!1),ve=m({}),Ke=m(8),f=m({id:null,point_id:"",link_type:"SPLICE",from_cable_id:"",from_core_no:"",to_cable_id:"",to_core_no:"",split_group:"",outputs:[],loss_db:"",notes:""}),Ht=re(()=>{const a=Array.isArray(tt.value)?tt.value:[],e=[],o={};return a.forEach(s=>{const i=((s==null?void 0:s.link_type)||"").toString().toUpperCase(),p=((s==null?void 0:s.split_group)||"").toString();if(i==="SPLIT"&&p){const b=`${Number(s.point_id)||0}|${p}`;o[b]||(o[b]={kind:"SPLIT_GROUP",id:s.id,point_id:s.point_id,link_type:"SPLIT",split_group:p,from_cable_id:s.from_cable_id,from_core_no:s.from_core_no,loss_db:s.loss_db??null,notes:s.notes||"",outputs:[],link_ids:[]}),o[b].outputs.push({to_cable_id:s.to_cable_id,to_core_no:s.to_core_no}),o[b].link_ids.push(s.id);return}e.push({kind:"LINK",...s||{}})}),Object.values(o).forEach(s=>{s.outputs=(s.outputs||[]).filter(i=>(i==null?void 0:i.to_cable_id)&&(i==null?void 0:i.to_core_no)),e.push(s)}),e.sort((s,i)=>{const p=Number((s==null?void 0:s.point_id)||0),b=Number((i==null?void 0:i.point_id)||0);if(p!==b)return p-b;const u=((s==null?void 0:s.link_type)||"").toString(),x=((i==null?void 0:i.link_type)||"").toString();return u.localeCompare(x)}),e});function Jt(){f.value={id:null,point_id:"",link_type:"SPLICE",from_cable_id:"",from_core_no:"",to_cable_id:"",to_core_no:"",split_group:"",outputs:[],loss_db:"",notes:""},ve.value={},Ke.value=8}function ja(a){const e=Math.max(1,Math.min(64,Number(a)||1));f.value.outputs=Array.from({length:e}).map(()=>({to_cable_id:"",to_core_no:""}))}function Ga(){const a=Array.isArray(f.value.outputs)?f.value.outputs:[];a.push({to_cable_id:"",to_core_no:""}),f.value.outputs=a}function Va(a){const e=Array.isArray(f.value.outputs)?f.value.outputs:[];a<0||a>=e.length||(e.splice(a,1),f.value.outputs=e)}function Ra(){H.value&&(Jt(),R.value&&(f.value.point_id=String(R.value)),pt.value="create",xe.value=!0)}function Da(a){if(J.value){if(Jt(),pt.value="edit",(a==null?void 0:a.kind)==="SPLIT_GROUP"){f.value={id:a.id,point_id:a.point_id??"",link_type:"SPLIT",from_cable_id:a.from_cable_id??"",from_core_no:a.from_core_no??"",to_cable_id:"",to_core_no:"",split_group:a.split_group||"",outputs:(a.outputs||[]).map(e=>({to_cable_id:e.to_cable_id??"",to_core_no:e.to_core_no??""})),loss_db:a.loss_db??"",notes:a.notes||""},Ke.value=(f.value.outputs||[]).length||8,xe.value=!0;return}f.value={id:a.id,point_id:a.point_id??"",link_type:(a.link_type||"SPLICE").toString().toUpperCase(),from_cable_id:a.from_cable_id??"",from_core_no:a.from_core_no??"",to_cable_id:a.to_cable_id??"",to_core_no:a.to_core_no??"",split_group:a.split_group||"",outputs:[],loss_db:a.loss_db??"",notes:a.notes||""},xe.value=!0}}async function Ba(){var p,b,u;vt.value=!0,ve.value={};const a=(f.value.link_type||"SPLICE").toString().toUpperCase(),e={point_id:f.value.point_id!==""?Number(f.value.point_id):null,link_type:a,from_cable_id:f.value.from_cable_id!==""?Number(f.value.from_cable_id):null,from_core_no:f.value.from_core_no!==""?Number(f.value.from_core_no):null,split_group:f.value.split_group||null,loss_db:f.value.loss_db!==""?Number(f.value.loss_db):null,notes:f.value.notes||null};if(a==="SPLIT"){const x=Array.isArray(f.value.outputs)?f.value.outputs:[];e.outputs=x.map(N=>({to_cable_id:N.to_cable_id!==""?Number(N.to_cable_id):null,to_core_no:N.to_core_no!==""?Number(N.to_core_no):null})).filter(N=>N.to_cable_id&&N.to_core_no)}else e.to_cable_id=f.value.to_cable_id!==""?Number(f.value.to_cable_id):null,e.to_core_no=f.value.to_core_no!==""?Number(f.value.to_core_no):null;const o=pt.value==="edit"&&f.value.id,s=o?`/api/v1/fiber/links/${f.value.id}`:"/api/v1/fiber/links",i=o?"PUT":"POST";try{const x=await D(s,{method:i,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!x.ok)throw x.status===422&&((p=x.data)!=null&&p.errors)?(ve.value=x.data.errors,new Error(((b=x.data)==null?void 0:b.message)||"Validasi gagal.")):new Error(((u=x.data)==null?void 0:u.message)||`Gagal menyimpan sambungan (HTTP ${x.status}).`);xe.value=!1,await j(),c&&c.success("Sambungan tersimpan.")}catch(x){console.error("Fiber: saveLink failed",x),c&&c.error((x==null?void 0:x.message)||"Gagal menyimpan sambungan.")}finally{vt.value=!1}}async function Ka(a){var s;if(!ae.value)return;const e=(a==null?void 0:a.kind)==="SPLIT_GROUP"?`splitter "${(a==null?void 0:a.split_group)||""}"`:"sambungan ini";if(confirm(`Hapus ${e}?`))try{const i=await D(`/api/v1/fiber/links/${a.id}`,{method:"DELETE"});if(!i.ok)throw new Error(((s=i.data)==null?void 0:s.message)||`Gagal hapus sambungan (HTTP ${i.status}).`);c&&c.success("Sambungan dihapus."),await j()}catch(i){console.error("Fiber: deleteLink failed",i),c&&c.error((i==null?void 0:i.message)||"Gagal hapus sambungan.")}}const He=m(""),Fe=m(!1),Ue=m(""),Te=m(null),Ha=re(()=>(Ie.value||[]).filter(a=>((a==null?void 0:a.port_type)||"").toString().toUpperCase()==="OLT_PON"));function Ja(){ne.value=null,Ue.value="",Te.value=null,at.value=[],De()}async function za(){var a,e,o,s,i,p;if(He.value){Fe.value=!0,Ue.value="",ne.value=null,Te.value=null,at.value=[];try{const b=await D(`/api/v1/fiber/trace/${Number(He.value)}?stop_at_odp_out=1`);if(!b.ok)throw new Error(((a=b.data)==null?void 0:a.message)||`Gagal trace (HTTP ${b.status}).`);ne.value=((e=b.data)==null?void 0:e.data)||null,at.value=((s=(o=b.data)==null?void 0:o.data)==null?void 0:s.used_cable_ids)||[],De();const u=((p=(i=b.data)==null?void 0:i.data)==null?void 0:p.endpoints)||[];u.length>0&&(Te.value=u[0]),c&&c.success("Trace selesai.")}catch(b){console.error("Fiber: runTrace failed",b),Ue.value=(b==null?void 0:b.message)||"Gagal trace.",c&&c.error(Ue.value)}finally{Fe.value=!1}}}return _e([Ae,je,Ge],()=>{Ut()}),_e(w,a=>{a&&(be.value=!1)}),_e(Oe,()=>{qt(()=>Ot())}),_e(V,a=>{if(!a){ke.value=!1;return}Me.value==="create"&&(ke.value=!0)}),_e([()=>v.value.from_point_id,()=>v.value.to_point_id],async()=>{if(!V.value||Me.value!=="create"||!ke.value)return;const a=Number(v.value.from_point_id||0),e=Number(v.value.to_point_id||0);if(!a||!e||a===e)return;if(Array.isArray(v.value.path)&&v.value.path.length>=2){ke.value=!1;return}await Gt({force:!1})&&(ke.value=!1)}),_e(()=>v.value.path,()=>{if(!ye.value)return;const a=Math.round(wt(v.value.path));Number.isFinite(a)&&a>0&&(v.value.length_m=a)},{deep:!0}),_e(ie,()=>{try{localStorage.setItem("fiber_map_style",ie.value)}catch{}aa()}),_e(q,()=>{try{localStorage.setItem("fiber_follow_road",q.value?"1":"0")}catch{}}),Xa(()=>{try{const e=localStorage.getItem("fiber_map_style");e&&Ve[e]&&(ie.value=e)}catch{}try{const e=localStorage.getItem("fiber_follow_road");e==="0"&&(q.value=!1),e==="1"&&(q.value=!0)}catch{}we.value="";const a=(ct.googleMapsApiKey||"").toString().trim();if(!a){we.value="Google Maps API key belum di-set. Buka Pengaturan -> System -> Google Maps.",j();return}ta(a).then(()=>{qt(()=>{la(),Ot(),j()})}).catch(e=>{console.error("Fiber: Google Maps load failed",e),we.value=(e==null?void 0:e.message)||"Gagal memuat Google Maps.",j()})}),qa(()=>{sa()}),(a,e)=>(n(),r(M,null,[Zt(Za(Ya),{title:"Kabel FO"}),Zt(tl,null,{default:Qa(()=>{var o,s,i,p,b,u,x,N,S,$,L,ce,I,zt,Wt;return[t("div",al,[t("div",ll,[e[83]||(e[83]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Manajemen Kabel FO"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Pemetaan jalur kabel, titik sambungan, dan data putus.")],-1)),t("div",sl,[t("div",ol,[t("span",rl,d(Ee.value.cables),1),e[79]||(e[79]=t("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"kabel",-1))]),t("div",nl,[t("span",il,d(Ee.value.points),1),e[80]||(e[80]=t("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"titik",-1))]),t("div",ul,[t("span",dl,d(Ee.value.breaks_open),1),e[81]||(e[81]=t("span",{class:"text-red-600/70 dark:text-red-300/70 ml-1"},"putus aktif",-1))]),t("div",pl,[y(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>ie.value=l),class:"input !py-2 !text-xs"},[...e[82]||(e[82]=[t("option",{value:"roadmap"},"Roadmap",-1),t("option",{value:"hybrid"},"Hybrid",-1),t("option",{value:"satellite"},"Satelit",-1)])],512),[[G,ie.value]]),t("button",{onClick:j,class:"btn btn-secondary !py-2 !text-xs",disabled:Se.value},"Refresh",8,vl),t("button",{onClick:e[1]||(e[1]=l=>Oe.value=!Oe.value),class:"btn btn-secondary !py-2 !text-xs"},d(Oe.value?"Tampilkan Panel":"Full Map"),1)])])]),ct.warning?(n(),r("div",cl,d(ct.warning),1)):g("",!0),St.value?(n(),r("div",gl,[be.value?(n(),r("div",{key:0,class:"fixed inset-0 z-[9000] bg-black/35 backdrop-blur-sm lg:hidden",onClick:e[2]||(e[2]=l=>be.value=!1)})):g("",!0),t("div",ml,[t("div",{class:A(["bg-white dark:bg-dark-800 rounded-xl shadow-card border border-gray-100 dark:border-dark-700 overflow-hidden flex flex-col lg:h-[calc(100vh-13rem)]",Oe.value?"lg:col-span-12":"lg:col-span-8"])},[t("div",fl,[t("label",yl,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=l=>Ae.value=l)},null,512),[[Ye,Ae.value]]),e[85]||(e[85]=h(" Kabel ",-1))]),t("label",kl,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>je.value=l)},null,512),[[Ye,je.value]]),e[86]||(e[86]=h(" Titik ",-1))]),t("label",xl,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>Ge.value=l)},null,512),[[Ye,Ge.value]]),e[87]||(e[87]=h(" Putus ",-1))]),t("div",_l,[y(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>ie.value=l),class:"input !py-2 !text-xs"},[...e[88]||(e[88]=[t("option",{value:"roadmap"},"Roadmap",-1),t("option",{value:"hybrid"},"Hybrid",-1),t("option",{value:"satellite"},"Satelit",-1)])],512),[[G,ie.value]]),t("button",{onClick:j,class:"btn btn-secondary !py-2 !text-xs",disabled:Se.value},"Refresh",8,hl),t("button",{onClick:e[7]||(e[7]=l=>be.value=!be.value),class:"btn btn-primary !py-2 !text-xs"},d(be.value?"Tutup":"Data"),1)])]),t("div",wl,[t("div",{ref_key:"mapContainer",ref:bt,class:"absolute inset-0 w-full h-full bg-slate-100 dark:bg-slate-900"},null,512),we.value?(n(),r("div",Cl,[t("div",Nl,[e[89]||(e[89]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Peta tidak dapat dimuat",-1)),t("div",Pl,d(we.value),1)])])):g("",!0),w.value?(n(),r("div",Tl,[t("div",Sl,[e[90]||(e[90]=h(" Mode peta aktif: ",-1)),t("span",El,d(w.value==="drawCable"?"gambar kabel":w.value==="editCable"?"edit jalur":w.value==="pickPoint"?"pilih titik":"pilih putus"),1)]),w.value==="editCable"?(n(),r("div",Ll," Geser titik/segmen untuk merapikan jalur, lalu klik tombol Selesai. ")):w.value==="drawCable"?(n(),r("div",Ol,[e[91]||(e[91]=h(" Klik peta untuk menambah titik. Mode: ",-1)),t("span",$l,d(q.value?"Ikuti jalan":"Garis lurus"),1),e[92]||(e[92]=h(". ",-1)),ge.value?(n(),r("span",Ml,"Menghitung rute...")):g("",!0)])):(n(),r("div",Fl," Klik peta untuk memilih lokasi, lalu klik tombol Selesai. ")),w.value==="drawCable"?(n(),r("label",Ul,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=l=>q.value=l),disabled:ge.value},null,8,Il),[[Ye,q.value]]),e[93]||(e[93]=h(" Ikuti jalan ",-1))])):g("",!0),t("div",Al,[t("button",{class:"btn btn-secondary !py-1 !text-xs",onClick:O,disabled:w.value==="drawCable"&&ge.value},"Selesai",8,jl),w.value==="drawCable"?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !text-xs",onClick:Vt,disabled:ge.value},"Undo",8,Gl)):g("",!0),w.value==="drawCable"?(n(),r("button",{key:1,class:"btn btn-secondary !py-1 !text-xs",onClick:Nt,disabled:ge.value},"Clear",8,Vl)):g("",!0),w.value==="editCable"?(n(),r("button",{key:2,class:"btn btn-secondary !py-1 !text-xs",onClick:Nt},"Clear")):g("",!0)])])):g("",!0)])],2),t("div",{class:A(["bg-white dark:bg-dark-800 shadow-card border border-gray-100 dark:border-dark-700 overflow-hidden flex flex-col lg:h-[calc(100vh-13rem)] fixed inset-x-0 bottom-0 z-[9001] lg:static lg:z-auto rounded-t-2xl lg:rounded-xl max-h-[calc(100vh-5rem)] lg:max-h-none transform transition-transform duration-200 ease-out lg:transform-none",[Oe.value?"lg:hidden":"lg:col-span-4",be.value?"translate-y-0 pointer-events-auto":"translate-y-full pointer-events-none lg:pointer-events-auto lg:translate-y-0"]])},[t("div",Rl,[e[95]||(e[95]=t("div",{class:"mx-auto h-1 w-10 rounded-full bg-gray-200 dark:bg-white/10"},null,-1)),t("div",Dl,[e[94]||(e[94]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Data Fiber",-1)),t("button",{class:"btn btn-secondary !py-1.5 !text-xs",onClick:e[9]||(e[9]=l=>be.value=!1)},"Tutup")])]),t("div",Bl,[t("button",{onClick:e[10]||(e[10]=l=>F.value="cables"),class:A(["px-3 py-3 text-xs font-semibold whitespace-nowrap",F.value==="cables"?"text-blue-700 dark:text-blue-300 bg-blue-50/60 dark:bg-blue-900/10":"text-gray-600 dark:text-gray-300"])}," Kabel ("+d(z.value.length)+") ",3),t("button",{onClick:e[11]||(e[11]=l=>F.value="points"),class:A(["px-3 py-3 text-xs font-semibold whitespace-nowrap",F.value==="points"?"text-teal-700 dark:text-teal-300 bg-teal-50/60 dark:bg-teal-900/10":"text-gray-600 dark:text-gray-300"])}," Titik ("+d(K.value.length)+") ",3),t("button",{onClick:e[12]||(e[12]=l=>F.value="ports"),class:A(["px-3 py-3 text-xs font-semibold whitespace-nowrap",F.value==="ports"?"text-indigo-700 dark:text-indigo-300 bg-indigo-50/60 dark:bg-indigo-900/10":"text-gray-600 dark:text-gray-300"])}," Port ("+d(Ie.value.length)+") ",3),t("button",{onClick:e[13]||(e[13]=l=>F.value="links"),class:A(["px-3 py-3 text-xs font-semibold whitespace-nowrap",F.value==="links"?"text-amber-700 dark:text-amber-300 bg-amber-50/60 dark:bg-amber-900/10":"text-gray-600 dark:text-gray-300"])}," Sambungan ("+d(tt.value.length)+") ",3),t("button",{onClick:e[14]||(e[14]=l=>F.value="trace"),class:A(["px-3 py-3 text-xs font-semibold whitespace-nowrap",F.value==="trace"?"text-slate-700 dark:text-slate-200 bg-slate-50/60 dark:bg-slate-700/30":"text-gray-600 dark:text-gray-300"])}," Trace ",2),t("button",{onClick:e[15]||(e[15]=l=>F.value="breaks"),class:A(["px-3 py-3 text-xs font-semibold whitespace-nowrap",F.value==="breaks"?"text-red-700 dark:text-red-300 bg-red-50/60 dark:bg-red-900/10":"text-gray-600 dark:text-gray-300"])}," Putus ("+d(Le.value.length)+") ",3)]),t("div",Kl,[Se.value?(n(),r("div",Hl,"Memuat...")):et.value?(n(),r("div",Jl,d(et.value),1)):F.value==="cables"?(n(),r("div",zl,[t("div",Wl,[e[96]||(e[96]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Daftar Kabel",-1)),H.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:ga},"Tambah")):g("",!0)]),z.value.length===0?(n(),r("div",Xl,"Belum ada data kabel.")):(n(),r("div",ql,[(n(!0),r(M,null,U(z.value,l=>(n(),r("div",{key:l.id,class:A(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-blue-200 dark:hover:border-blue-900/40 cursor-pointer",Number(le.value)===Number(l.id)?"bg-blue-50/60 dark:bg-blue-900/10":"bg-white dark:bg-dark-800"]),onClick:E=>{le.value=l.id,R.value=null,se.value=null,De()}},[t("div",Yl,[t("div",null,[t("div",Ql,d(l.name),1),t("div",es,[l.cable_type?(n(),r("span",ts,d(l.cable_type),1)):g("",!0),l.core_count?(n(),r("span",as,"| "+d(l.core_count)+" core",1)):g("",!0),l.length_m?(n(),r("span",ls,"| "+d(At(l.length_m)),1)):g("",!0)]),l.from_point_id||l.to_point_id?(n(),r("div",ss,[t("div",null,[e[97]||(e[97]=h("Dari: ",-1)),t("span",os,d(oe(l.from_point_id)||"-"),1)]),t("div",null,[e[98]||(e[98]=h("Ke: ",-1)),t("span",rs,d(oe(l.to_point_id)||"-"),1)])])):g("",!0)]),t("div",ns,[J.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:te(E=>ma(l),["stop"])},"Edit",8,is)):g("",!0),ae.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:te(E=>ka(l),["stop"])},"Hapus",8,us)):g("",!0)])])],10,Zl))),128))]))])):F.value==="points"?(n(),r("div",ds,[t("div",ps,[e[99]||(e[99]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Titik Sambungan",-1)),H.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:wa},"Tambah")):g("",!0)]),K.value.length===0?(n(),r("div",vs,"Belum ada data titik.")):(n(),r("div",cs,[(n(!0),r(M,null,U(K.value,l=>(n(),r("div",{key:l.id,class:A(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-teal-200 dark:hover:border-teal-900/40 cursor-pointer",Number(R.value)===Number(l.id)?"bg-teal-50/60 dark:bg-teal-900/10":"bg-white dark:bg-dark-800"]),onClick:E=>{R.value=l.id,le.value=null,se.value=null,_t(),fe(Number(l.latitude),Number(l.longitude),17)}},[t("div",gs,[t("div",null,[t("div",ms,d(l.name),1),t("div",fs,[l.point_type?(n(),r("span",ys,d(l.point_type),1)):g("",!0),l.latitude&&l.longitude?(n(),r("span",ks,"| "+d(l.latitude)+", "+d(l.longitude),1)):g("",!0)])]),t("div",xs,[J.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:te(E=>Ca(l),["stop"])},"Edit",8,_s)):g("",!0),ae.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:te(E=>Ta(l),["stop"])},"Hapus",8,hs)):g("",!0)])])],10,bs))),128))]))])):F.value==="ports"?(n(),r("div",ws,[t("div",Cs,[e[100]||(e[100]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Port (OLT/ODP)",-1)),H.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:Fa},"Tambah")):g("",!0)]),Ie.value.length===0?(n(),r("div",Ns,"Belum ada data port.")):(n(),r("div",Ps,[(n(!0),r(M,null,U(Ie.value,l=>(n(),r("div",{key:l.id,class:"p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-indigo-200 dark:hover:border-indigo-900/40 bg-white dark:bg-dark-800"},[t("div",Ts,[t("div",null,[t("div",Ss,d(String(l.port_type||"").toUpperCase()),1),t("div",Es,d(l.port_label||"#"+l.id),1),t("div",Ls,[t("div",null,[e[101]||(e[101]=h(" Titik: ",-1)),t("span",Os,d(oe(l.point_id)||"#"+l.point_id),1)]),l.cable_id&&l.core_no?(n(),r("div",$s,[e[102]||(e[102]=h(" Kabel: ",-1)),t("span",Ms,d(de(l.cable_id)||"Kabel #"+l.cable_id),1),t("span",Fs,"- core "+d(l.core_no),1)])):g("",!0)])]),t("div",Us,[J.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:te(E=>Ua(l),["stop"])},"Edit",8,Is)):g("",!0),ae.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:te(E=>Aa(l),["stop"])},"Hapus",8,As)):g("",!0)])])]))),128))]))])):F.value==="links"?(n(),r("div",js,[t("div",Gs,[e[103]||(e[103]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Sambungan (Splice/Split)",-1)),H.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:Ra},"Tambah")):g("",!0)]),Ht.value.length===0?(n(),r("div",Vs,"Belum ada data sambungan.")):(n(),r("div",Rs,[(n(!0),r(M,null,U(Ht.value,l=>(n(),r("div",{key:l.kind==="SPLIT_GROUP"?"g:"+l.split_group+":"+l.point_id:"l:"+l.id,class:"p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-amber-200 dark:hover:border-amber-900/40 bg-white dark:bg-dark-800"},[t("div",Ds,[t("div",Bs,[t("div",Ks,[h(d(l.kind==="SPLIT_GROUP"?"SPLIT":String(l.link_type||"").toUpperCase())+" ",1),l.kind==="SPLIT_GROUP"?(n(),r("span",Hs,"- "+d((l.outputs||[]).length)+" output",1)):g("",!0)]),t("div",Js,[e[104]||(e[104]=h(" Titik: ",-1)),t("span",zs,d(oe(l.point_id)||"#"+l.point_id),1)]),t("div",Ws,[h(d(de(l.from_cable_id)||"Kabel #"+l.from_cable_id)+" - core "+d(l.from_core_no)+" ",1),e[105]||(e[105]=t("span",{class:"mx-1 text-gray-400"},"->",-1)),l.kind==="SPLIT_GROUP"?(n(),r("span",Xs,"splitter")):(n(),r(M,{key:1},[h(d(de(l.to_cable_id)||"Kabel #"+l.to_cable_id)+" - core "+d(l.to_core_no),1)],64))]),l.kind==="SPLIT_GROUP"&&(l.outputs||[]).length?(n(),r("div",qs,[h(" Output: "+d((l.outputs||[]).slice(0,4).map(E=>`${de(E.to_cable_id)||"#"+E.to_cable_id}:${E.to_core_no}`).join(", ")),1),(l.outputs||[]).length>4?(n(),r("span",Zs,", ...")):g("",!0)])):g("",!0),l.loss_db!==null&&l.loss_db!==void 0&&l.loss_db!==""?(n(),r("div",Ys,[e[106]||(e[106]=h(" Loss: ",-1)),t("span",Qs,d(l.loss_db)+" dB",1)])):g("",!0)]),t("div",eo,[J.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:te(E=>Da(l),["stop"])},"Edit",8,to)):g("",!0),ae.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:te(E=>Ka(l),["stop"])},"Hapus",8,ao)):g("",!0)])])]))),128))]))])):F.value==="trace"?(n(),r("div",lo,[t("div",so,[e[107]||(e[107]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Tracing End-to-End",-1)),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Ja,disabled:Fe.value},"Clear",8,oo)]),t("div",ro,[t("div",null,[e[109]||(e[109]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Start Port (OLT_PON)",-1)),y(t("select",{"onUpdate:modelValue":e[16]||(e[16]=l=>He.value=l),class:"input w-full"},[e[108]||(e[108]=t("option",{value:""},"(pilih port)",-1)),(n(!0),r(M,null,U(Ha.value,l=>(n(),r("option",{key:l.id,value:l.id},d(oe(l.point_id)||"#"+l.point_id)+" | "+d(l.port_label)+" | "+d(de(l.cable_id)||"Kabel #"+l.cable_id)+":"+d(l.core_no),9,no))),128))],512),[[G,He.value]])]),t("div",io,[t("button",{class:"btn btn-primary !py-2 !text-xs",onClick:za,disabled:Fe.value||!He.value},d(Fe.value?"Tracing...":"Trace"),9,uo),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:j,disabled:Se.value||Fe.value},"Refresh Data",8,po)]),Ue.value?(n(),r("div",vo,d(Ue.value),1)):g("",!0)]),ne.value?(n(),r("div",co,[t("div",bo,[e[110]||(e[110]=h(" Endpoint: ",-1)),t("span",go,d((ne.value.endpoints||[]).length),1),e[111]||(e[111]=t("span",{class:"mx-2"},"|",-1)),e[112]||(e[112]=h(" Visited: ",-1)),t("span",mo,d(ne.value.visited_nodes||0),1),ne.value.truncated?(n(),r("span",fo,"(truncated)")):g("",!0)]),(ne.value.endpoints||[]).length===0?(n(),r("div",yo,[...e[113]||(e[113]=[h(" Tidak ada endpoint ",-1),t("span",{class:"font-mono"},"ODP_OUT",-1),h(" terjangkau dari port ini. ",-1)])])):(n(),r("div",ko,[(n(!0),r(M,null,U(ne.value.endpoints||[],(l,E)=>{var B,Je,ze,We,Xe,qe,Ze,Xt;return n(),r("div",{key:((B=l.port)==null?void 0:B.id)||E,class:A(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-slate-200 dark:hover:border-slate-700 cursor-pointer",Te.value===l?"bg-slate-50/60 dark:bg-slate-700/30":"bg-white dark:bg-dark-800"]),onClick:Fn=>Te.value=l},[t("div",_o,d(((Je=l.point)==null?void 0:Je.name)||oe((ze=l.port)==null?void 0:ze.point_id)||"-"),1),t("div",ho,[e[114]||(e[114]=h(" Port: ",-1)),t("span",wo,d(((We=l.port)==null?void 0:We.port_label)||"#"+((Xe=l.port)==null?void 0:Xe.id)),1),e[115]||(e[115]=t("span",{class:"mx-2"},"|",-1)),h(" "+d(de((qe=l.port)==null?void 0:qe.cable_id)||"Kabel #"+((Ze=l.port)==null?void 0:Ze.cable_id))+":"+d((Xt=l.port)==null?void 0:Xt.core_no),1)])],10,xo)}),128))])),(o=Te.value)!=null&&o.path?(n(),r("div",Co,[e[117]||(e[117]=t("div",{class:"text-xs font-semibold text-gray-900 dark:text-white"},"Path (ringkas)",-1)),t("div",No,[(n(!0),r(M,null,U(Te.value.path,(l,E)=>{var B,Je,ze,We,Xe,qe,Ze;return n(),r("div",{key:E,class:"text-xs"},[t("div",Po,[h(d(E===0?"START":((B=l.edge)==null?void 0:B.type)==="CABLE"?"KABEL":"LINK "+(((Je=l.edge)==null?void 0:Je.link_type)||""))+" ",1),e[116]||(e[116]=t("span",{class:"mx-1 text-gray-400"},"|",-1)),h(" "+d(((ze=l.point)==null?void 0:ze.name)||"Titik #"+((We=l.node)==null?void 0:We.point_id)),1)]),t("div",To,d(((Xe=l.cable)==null?void 0:Xe.name)||"Kabel #"+((qe=l.node)==null?void 0:qe.cable_id))+" - core "+d((Ze=l.node)==null?void 0:Ze.core_no),1)])}),128))])])):g("",!0)])):g("",!0)])):(n(),r("div",So,[t("div",Eo,[e[118]||(e[118]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Data Putus",-1)),H.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:Sa},"Tambah")):g("",!0)]),Le.value.length===0?(n(),r("div",Lo,"Belum ada data putus.")):(n(),r("div",Oo,[(n(!0),r(M,null,U(Le.value,l=>(n(),r("div",{key:l.id,class:A(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-red-200 dark:hover:border-red-900/40 cursor-pointer",Number(se.value)===Number(l.id)?"bg-red-50/60 dark:bg-red-900/10":"bg-white dark:bg-dark-800"]),onClick:E=>{se.value=l.id,le.value=null,R.value=null,ht(),fe(Number(l.latitude),Number(l.longitude),17)}},[t("div",Mo,[t("div",null,[t("div",Fo,d(ca(l.status)),1),t("div",Uo,d(de(l.cable_id)||(l.cable_id?"Kabel #"+l.cable_id:"Tanpa kabel")),1),t("div",Io,[t("span",null,"Titik: "+d(oe(l.point_id)||"-"),1),l.severity?(n(),r("span",Ao,"| "+d(l.severity),1)):g("",!0)]),l.description?(n(),r("div",jo,d(l.description),1)):g("",!0)]),t("div",Go,[H.value&&J.value&&["OPEN","IN_PROGRESS"].includes(String(l.status||"OPEN").toUpperCase())?(n(),r("button",{key:0,class:"btn btn-primary !py-1 !px-2 !text-xs",disabled:Bt(l.id),onClick:te(E=>Ma(l),["stop"])},d(Bt(l.id)?"Memproses...":"Selesaikan"),9,Vo)):g("",!0),J.value?(n(),r("button",{key:1,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:te(E=>Ea(l),["stop"])},"Edit",8,Ro)):g("",!0),ae.value?(n(),r("button",{key:2,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:te(E=>$a(l),["stop"])},"Hapus",8,Do)):g("",!0)])])],10,$o))),128))]))]))])],2)])])):(n(),r("div",bl,[...e[84]||(e[84]=[t("div",{class:"text-gray-900 dark:text-white font-semibold"},"Tidak punya akses",-1),t("div",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},[h(" Butuh permission "),t("code",{class:"px-1 py-0.5 bg-gray-100 dark:bg-dark-700 rounded"},"view fiber"),h(". ")],-1)])]))]),V.value?(n(),r("div",{key:0,class:A(["fixed inset-0 z-[10000] flex items-center justify-center p-4",w.value?"pointer-events-none":""])},[t("div",{class:A(["absolute inset-0 bg-black/40",w.value?"pointer-events-none opacity-20":""]),onClick:e[17]||(e[17]=l=>{V.value=!1,O()})},null,2),t("div",Bo,[t("div",Ko,[t("div",Ho,d(Me.value==="edit"?"Edit Kabel":"Tambah Kabel"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[18]||(e[18]=l=>{V.value=!1,O()})},"Tutup")]),t("div",Jo,[t("div",zo,[t("div",null,[e[119]||(e[119]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Nama",-1)),y(t("input",{"onUpdate:modelValue":e[19]||(e[19]=l=>v.value.name=l),class:"input w-full",placeholder:"Feeder ODC-POP A"},null,512),[[P,v.value.name]]),Y.value.name?(n(),r("div",Wo,d((s=Y.value.name)==null?void 0:s[0]),1)):g("",!0)]),t("div",null,[e[120]||(e[120]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kode (opsional)",-1)),y(t("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>v.value.code=l),class:"input w-full",placeholder:"FO-001"},null,512),[[P,v.value.code]]),Y.value.code?(n(),r("div",Xo,d((i=Y.value.code)==null?void 0:i[0]),1)):g("",!0)]),t("div",null,[e[121]||(e[121]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(t("input",{"onUpdate:modelValue":e[21]||(e[21]=l=>v.value.cable_type=l),class:"input w-full",placeholder:"FEEDER / DISTRIBUTION / DROP"},null,512),[[P,v.value.cable_type]]),Y.value.cable_type?(n(),r("div",qo,d((p=Y.value.cable_type)==null?void 0:p[0]),1)):g("",!0)]),t("div",null,[e[122]||(e[122]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Core",-1)),y(t("input",{"onUpdate:modelValue":e[22]||(e[22]=l=>v.value.core_count=l),type:"number",min:"1",class:"input w-full",placeholder:"12"},null,512),[[P,v.value.core_count]]),Y.value.core_count?(n(),r("div",Zo,d((b=Y.value.core_count)==null?void 0:b[0]),1)):g("",!0)]),t("div",Yo,[e[124]||(e[124]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Panjang (meter)",-1)),t("div",Qo,[y(t("input",{"onUpdate:modelValue":e[23]||(e[23]=l=>v.value.length_m=l),type:"number",min:"0",class:"input w-full sm:flex-1",placeholder:"(opsional)",onInput:e[24]||(e[24]=l=>ye.value=!1)},null,544),[[P,v.value.length_m]]),t("button",{class:"btn btn-secondary shrink-0 !py-2 !text-xs",onClick:ha},"Hitung dari jalur")]),t("div",er,[e[123]||(e[123]=h(" Estimasi dari jalur: ",-1)),t("span",tr,d(At(Ct.value)),1),t("span",ar,"("+d(Ct.value)+" m)",1),ye.value?(n(),r("span",lr,"[auto]")):g("",!0)])]),t("div",null,[e[126]||(e[126]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Dari Titik",-1)),y(t("select",{"onUpdate:modelValue":e[25]||(e[25]=l=>v.value.from_point_id=l),class:"input w-full"},[e[125]||(e[125]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(M,null,U(K.value,l=>(n(),r("option",{key:l.id,value:l.id},d(l.name),9,sr))),128))],512),[[G,v.value.from_point_id]])]),t("div",null,[e[128]||(e[128]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Ke Titik",-1)),y(t("select",{"onUpdate:modelValue":e[26]||(e[26]=l=>v.value.to_point_id=l),class:"input w-full"},[e[127]||(e[127]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(M,null,U(K.value,l=>(n(),r("option",{key:l.id,value:l.id},d(l.name),9,or))),128))],512),[[G,v.value.to_point_id]])]),t("div",rr,[e[129]||(e[129]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Warna Jalur",-1)),t("div",nr,[y(t("input",{"onUpdate:modelValue":e[27]||(e[27]=l=>v.value.map_color=l),type:"color",class:"h-10 w-14 rounded border border-gray-200 dark:border-dark-700 bg-transparent"},null,512),[[P,v.value.map_color]]),y(t("input",{"onUpdate:modelValue":e[28]||(e[28]=l=>v.value.map_color=l),class:"input flex-1",placeholder:"#2563eb"},null,512),[[P,v.value.map_color]])])]),t("div",ir,[e[130]||(e[130]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(t("textarea",{"onUpdate:modelValue":e[29]||(e[29]=l=>v.value.notes=l),class:"input w-full min-h-[80px]",placeholder:"Keterangan kabel..."},null,512),[[P,v.value.notes]])])]),t("div",ur,[t("div",dr,[t("div",null,[e[131]||(e[131]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Jalur di Peta",-1)),t("div",pr,"Titik: "+d(Array.isArray(v.value.path)?v.value.path.length:0),1)]),t("div",vr,[t("label",cr,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[30]||(e[30]=l=>q.value=l)},null,512),[[Ye,q.value]]),e[132]||(e[132]=h(" Ikuti jalan ",-1))]),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:e[31]||(e[31]=l=>Gt({force:!0})),disabled:!v.value.from_point_id||!v.value.to_point_id}," Auto ",8,br),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:xa},"Gambar"),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:_a,disabled:!v.value.path||v.value.path.length<2},"Edit",8,gr),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Vt,disabled:!v.value.path||v.value.path.length===0},"Undo",8,mr),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Nt,disabled:!v.value.path||v.value.path.length===0},"Clear",8,fr)])]),e[133]||(e[133]=t("div",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},[h(" Tips: mode "),t("span",{class:"font-semibold"},"Ikuti jalan"),h(" memakai Google Directions. Jika gagal/limit, otomatis fallback ke garis lurus. Jalur bisa dirapikan lewat tombol "),t("span",{class:"font-semibold"},"Edit"),h(". ")],-1))])]),t("div",yr,[t("button",{class:"btn btn-secondary",onClick:e[32]||(e[32]=l=>{V.value=!1,O()})},"Batal"),t("button",{class:"btn btn-primary",disabled:st.value,onClick:ya},d(st.value?"Menyimpan...":"Simpan"),9,kr)])])],2)):g("",!0),Q.value?(n(),r("div",{key:1,class:A(["fixed inset-0 z-[10000] flex items-center justify-center p-4",w.value?"pointer-events-none":""])},[t("div",{class:A(["absolute inset-0 bg-black/40",w.value?"pointer-events-none opacity-20":""]),onClick:e[33]||(e[33]=l=>{Q.value=!1,O()})},null,2),t("div",xr,[t("div",_r,[t("div",hr,d(ot.value==="edit"?"Edit Titik":"Tambah Titik"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[34]||(e[34]=l=>{Q.value=!1,O()})},"Tutup")]),t("div",wr,[t("div",null,[e[134]||(e[134]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Nama",-1)),y(t("input",{"onUpdate:modelValue":e[35]||(e[35]=l=>_.value.name=l),class:"input w-full",placeholder:"ODP-01 / Joint A"},null,512),[[P,_.value.name]]),pe.value.name?(n(),r("div",Cr,d((u=pe.value.name)==null?void 0:u[0]),1)):g("",!0)]),t("div",null,[e[135]||(e[135]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(t("input",{"onUpdate:modelValue":e[36]||(e[36]=l=>_.value.point_type=l),class:"input w-full",placeholder:"ODP / ODC / JOINT / HANDHOLE"},null,512),[[P,_.value.point_type]])]),t("div",Nr,[t("div",null,[e[136]||(e[136]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Latitude",-1)),y(t("input",{"onUpdate:modelValue":e[37]||(e[37]=l=>_.value.latitude=l),class:"input w-full",placeholder:"-6.2"},null,512),[[P,_.value.latitude]]),pe.value.latitude?(n(),r("div",Pr,d((x=pe.value.latitude)==null?void 0:x[0]),1)):g("",!0)]),t("div",null,[e[137]||(e[137]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Longitude",-1)),y(t("input",{"onUpdate:modelValue":e[38]||(e[38]=l=>_.value.longitude=l),class:"input w-full",placeholder:"106.8"},null,512),[[P,_.value.longitude]]),pe.value.longitude?(n(),r("div",Tr,d((N=pe.value.longitude)==null?void 0:N[0]),1)):g("",!0)])]),t("div",Sr,[t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Na},"Pilih dari peta"),_.value.latitude&&_.value.longitude?(n(),r("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[39]||(e[39]=l=>fe(Number(_.value.latitude),Number(_.value.longitude),18))},"Zoom")):g("",!0)]),t("div",null,[e[138]||(e[138]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Alamat",-1)),y(t("input",{"onUpdate:modelValue":e[40]||(e[40]=l=>_.value.address=l),class:"input w-full",placeholder:"(opsional)"},null,512),[[P,_.value.address]])]),t("div",null,[e[139]||(e[139]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(t("textarea",{"onUpdate:modelValue":e[41]||(e[41]=l=>_.value.notes=l),class:"input w-full min-h-[80px]",placeholder:"(opsional)"},null,512),[[P,_.value.notes]])])]),t("div",Er,[t("button",{class:"btn btn-secondary",onClick:e[42]||(e[42]=l=>{Q.value=!1,O()})},"Batal"),t("button",{class:"btn btn-primary",disabled:rt.value,onClick:Pa},d(rt.value?"Menyimpan...":"Simpan"),9,Lr)])])],2)):g("",!0),ee.value?(n(),r("div",{key:2,class:A(["fixed inset-0 z-[10000] flex items-center justify-center p-4",w.value?"pointer-events-none":""])},[t("div",{class:A(["absolute inset-0 bg-black/40",w.value?"pointer-events-none opacity-20":""]),onClick:e[43]||(e[43]=l=>{ee.value=!1,O()})},null,2),t("div",Or,[t("div",$r,[t("div",Mr,d(nt.value==="edit"?"Edit Data Putus":"Tambah Data Putus"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[44]||(e[44]=l=>{ee.value=!1,O()})},"Tutup")]),t("div",Fr,[t("div",null,[e[141]||(e[141]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kabel",-1)),y(t("select",{"onUpdate:modelValue":e[45]||(e[45]=l=>k.value.cable_id=l),class:"input w-full"},[e[140]||(e[140]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(M,null,U(z.value,l=>(n(),r("option",{key:l.id,value:l.id},d(l.name),9,Ur))),128))],512),[[G,k.value.cable_id]])]),t("div",null,[e[143]||(e[143]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik (opsional)",-1)),y(t("select",{"onUpdate:modelValue":e[46]||(e[46]=l=>k.value.point_id=l),class:"input w-full"},[e[142]||(e[142]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(M,null,U(K.value,l=>(n(),r("option",{key:l.id,value:l.id},d(l.name),9,Ir))),128))],512),[[G,k.value.point_id]])]),t("div",Ar,[t("div",null,[e[145]||(e[145]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Status",-1)),y(t("select",{"onUpdate:modelValue":e[47]||(e[47]=l=>k.value.status=l),class:"input w-full"},[...e[144]||(e[144]=[t("option",{value:"OPEN"},"OPEN",-1),t("option",{value:"IN_PROGRESS"},"IN_PROGRESS",-1),t("option",{value:"FIXED"},"FIXED",-1),t("option",{value:"CANCELLED"},"CANCELLED",-1)])],512),[[G,k.value.status]])]),t("div",null,[e[147]||(e[147]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Severity",-1)),y(t("select",{"onUpdate:modelValue":e[48]||(e[48]=l=>k.value.severity=l),class:"input w-full"},[...e[146]||(e[146]=[t("option",{value:""},"(kosong)",-1),t("option",{value:"MINOR"},"MINOR",-1),t("option",{value:"MAJOR"},"MAJOR",-1),t("option",{value:"CRITICAL"},"CRITICAL",-1)])],512),[[G,k.value.severity]])])]),t("div",jr,[t("div",null,[e[148]||(e[148]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Dilaporkan",-1)),y(t("input",{"onUpdate:modelValue":e[49]||(e[49]=l=>k.value.reported_at=l),type:"datetime-local",class:"input w-full"},null,512),[[P,k.value.reported_at]])]),t("div",null,[e[149]||(e[149]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Fixed At",-1)),y(t("input",{"onUpdate:modelValue":e[50]||(e[50]=l=>k.value.fixed_at=l),type:"datetime-local",class:"input w-full",disabled:String(k.value.status).toUpperCase()!=="FIXED"},null,8,Gr),[[P,k.value.fixed_at]])])]),t("div",Vr,[t("div",null,[e[150]||(e[150]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Latitude",-1)),y(t("input",{"onUpdate:modelValue":e[51]||(e[51]=l=>k.value.latitude=l),class:"input w-full",placeholder:"-6.2"},null,512),[[P,k.value.latitude]]),Ce.value.latitude?(n(),r("div",Rr,d((S=Ce.value.latitude)==null?void 0:S[0]),1)):g("",!0)]),t("div",null,[e[151]||(e[151]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Longitude",-1)),y(t("input",{"onUpdate:modelValue":e[52]||(e[52]=l=>k.value.longitude=l),class:"input w-full",placeholder:"106.8"},null,512),[[P,k.value.longitude]]),Ce.value.longitude?(n(),r("div",Dr,d(($=Ce.value.longitude)==null?void 0:$[0]),1)):g("",!0)])]),t("div",Br,[t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:La},"Pilih dari peta"),k.value.latitude&&k.value.longitude?(n(),r("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[53]||(e[53]=l=>fe(Number(k.value.latitude),Number(k.value.longitude),18))},"Zoom")):g("",!0)]),t("div",null,[e[152]||(e[152]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(t("textarea",{"onUpdate:modelValue":e[54]||(e[54]=l=>k.value.description=l),class:"input w-full min-h-[90px]",placeholder:"Keterangan kejadian putus..."},null,512),[[P,k.value.description]])])]),t("div",Kr,[t("button",{class:"btn btn-secondary",onClick:e[55]||(e[55]=l=>{ee.value=!1,O()})},"Batal"),t("button",{class:"btn btn-primary",disabled:it.value,onClick:Oa},d(it.value?"Menyimpan...":"Simpan"),9,Hr)])])],2)):g("",!0),Ne.value?(n(),r("div",Jr,[t("div",{class:"absolute inset-0 bg-black/40",onClick:e[56]||(e[56]=l=>Ne.value=!1)}),t("div",zr,[t("div",Wr,[t("div",Xr,d(ut.value==="edit"?"Edit Port":"Tambah Port"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[57]||(e[57]=l=>Ne.value=!1)},"Tutup")]),t("div",qr,[t("div",null,[e[154]||(e[154]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik",-1)),y(t("select",{"onUpdate:modelValue":e[58]||(e[58]=l=>T.value.point_id=l),class:"input w-full"},[e[153]||(e[153]=t("option",{value:""},"(pilih titik)",-1)),(n(!0),r(M,null,U(K.value,l=>(n(),r("option",{key:l.id,value:l.id},d(l.name),9,Zr))),128))],512),[[G,T.value.point_id]]),Pe.value.point_id?(n(),r("div",Yr,d((L=Pe.value.point_id)==null?void 0:L[0]),1)):g("",!0)]),t("div",Qr,[t("div",null,[e[156]||(e[156]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(t("select",{"onUpdate:modelValue":e[59]||(e[59]=l=>T.value.port_type=l),class:"input w-full"},[...e[155]||(e[155]=[t("option",{value:"OLT_PON"},"OLT_PON",-1),t("option",{value:"ODP_OUT"},"ODP_OUT",-1)])],512),[[G,T.value.port_type]])]),t("div",null,[e[157]||(e[157]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Label",-1)),y(t("input",{"onUpdate:modelValue":e[60]||(e[60]=l=>T.value.port_label=l),class:"input w-full",placeholder:"PON 1/1/1 / OUT 1"},null,512),[[P,T.value.port_label]]),Pe.value.port_label?(n(),r("div",en,d((ce=Pe.value.port_label)==null?void 0:ce[0]),1)):g("",!0)])]),t("div",tn,[t("div",null,[e[159]||(e[159]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kabel",-1)),y(t("select",{"onUpdate:modelValue":e[61]||(e[61]=l=>T.value.cable_id=l),class:"input w-full"},[e[158]||(e[158]=t("option",{value:""},"(pilih kabel)",-1)),(n(!0),r(M,null,U(z.value,l=>(n(),r("option",{key:l.id,value:l.id},d(l.name),9,an))),128))],512),[[G,T.value.cable_id]])]),t("div",null,[e[160]||(e[160]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Core",-1)),y(t("input",{"onUpdate:modelValue":e[62]||(e[62]=l=>T.value.core_no=l),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[P,T.value.core_no]])])]),t("div",null,[e[161]||(e[161]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(t("textarea",{"onUpdate:modelValue":e[63]||(e[63]=l=>T.value.notes=l),class:"input w-full min-h-[90px]",placeholder:"(opsional)"},null,512),[[P,T.value.notes]])])]),t("div",ln,[t("button",{class:"btn btn-secondary",onClick:e[64]||(e[64]=l=>Ne.value=!1)},"Batal"),t("button",{class:"btn btn-primary",disabled:dt.value,onClick:Ia},d(dt.value?"Menyimpan...":"Simpan"),9,sn)])])])):g("",!0),xe.value?(n(),r("div",on,[t("div",{class:"absolute inset-0 bg-black/40",onClick:e[65]||(e[65]=l=>xe.value=!1)}),t("div",rn,[t("div",nn,[t("div",un,d(pt.value==="edit"?"Edit Sambungan":"Tambah Sambungan"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[66]||(e[66]=l=>xe.value=!1)},"Tutup")]),t("div",dn,[t("div",null,[e[163]||(e[163]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik",-1)),y(t("select",{"onUpdate:modelValue":e[67]||(e[67]=l=>f.value.point_id=l),class:"input w-full"},[e[162]||(e[162]=t("option",{value:""},"(pilih titik)",-1)),(n(!0),r(M,null,U(K.value,l=>(n(),r("option",{key:l.id,value:l.id},d(l.name),9,pn))),128))],512),[[G,f.value.point_id]]),ve.value.point_id?(n(),r("div",vn,d((I=ve.value.point_id)==null?void 0:I[0]),1)):g("",!0)]),t("div",cn,[t("div",null,[e[165]||(e[165]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(t("select",{"onUpdate:modelValue":e[68]||(e[68]=l=>f.value.link_type=l),class:"input w-full"},[...e[164]||(e[164]=[t("option",{value:"SPLICE"},"SPLICE",-1),t("option",{value:"PATCH"},"PATCH",-1),t("option",{value:"SPLIT"},"SPLIT",-1)])],512),[[G,f.value.link_type]])]),t("div",null,[e[166]||(e[166]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Loss (dB)",-1)),y(t("input",{"onUpdate:modelValue":e[69]||(e[69]=l=>f.value.loss_db=l),class:"input w-full",placeholder:"0.20"},null,512),[[P,f.value.loss_db]])])]),t("div",bn,[t("div",null,[e[168]||(e[168]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"From Cable",-1)),y(t("select",{"onUpdate:modelValue":e[70]||(e[70]=l=>f.value.from_cable_id=l),class:"input w-full"},[e[167]||(e[167]=t("option",{value:""},"(pilih kabel)",-1)),(n(!0),r(M,null,U(z.value,l=>(n(),r("option",{key:l.id,value:l.id},d(l.name),9,gn))),128))],512),[[G,f.value.from_cable_id]]),ve.value.from_cable_id?(n(),r("div",mn,d((zt=ve.value.from_cable_id)==null?void 0:zt[0]),1)):g("",!0)]),t("div",null,[e[169]||(e[169]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"From Core",-1)),y(t("input",{"onUpdate:modelValue":e[71]||(e[71]=l=>f.value.from_core_no=l),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[P,f.value.from_core_no]]),ve.value.from_core_no?(n(),r("div",fn,d((Wt=ve.value.from_core_no)==null?void 0:Wt[0]),1)):g("",!0)])]),String(f.value.link_type).toUpperCase()!=="SPLIT"?(n(),r("div",yn,[t("div",null,[e[171]||(e[171]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"To Cable",-1)),y(t("select",{"onUpdate:modelValue":e[72]||(e[72]=l=>f.value.to_cable_id=l),class:"input w-full"},[e[170]||(e[170]=t("option",{value:""},"(pilih kabel)",-1)),(n(!0),r(M,null,U(z.value,l=>(n(),r("option",{key:l.id,value:l.id},d(l.name),9,kn))),128))],512),[[G,f.value.to_cable_id]])]),t("div",null,[e[172]||(e[172]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"To Core",-1)),y(t("input",{"onUpdate:modelValue":e[73]||(e[73]=l=>f.value.to_core_no=l),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[P,f.value.to_core_no]])])])):(n(),r("div",xn,[t("div",_n,[t("div",null,[e[173]||(e[173]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Splitter Group (opsional)",-1)),y(t("input",{"onUpdate:modelValue":e[74]||(e[74]=l=>f.value.split_group=l),class:"input w-full",placeholder:"ODP-01 1:8"},null,512),[[P,f.value.split_group]])]),t("div",null,[e[174]||(e[174]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Jumlah Output",-1)),t("div",hn,[y(t("input",{"onUpdate:modelValue":e[75]||(e[75]=l=>Ke.value=l),type:"number",min:"1",max:"64",class:"input w-full"},null,512),[[P,Ke.value]]),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:e[76]||(e[76]=l=>ja(Ke.value))},"Buat"),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Ga},"Tambah")])])]),(f.value.outputs||[]).length===0?(n(),r("div",wn,[...e[175]||(e[175]=[h(" Output masih kosong. Klik ",-1),t("span",{class:"font-semibold"},"Buat",-1),h(" untuk generate baris output. ",-1)])])):(n(),r("div",Cn,[(n(!0),r(M,null,U(f.value.outputs,(l,E)=>(n(),r("div",{key:E,class:"grid grid-cols-12 gap-2 items-center"},[t("div",Nn,[y(t("select",{"onUpdate:modelValue":B=>l.to_cable_id=B,class:"input w-full"},[e[176]||(e[176]=t("option",{value:""},"(kabel output)",-1)),(n(!0),r(M,null,U(z.value,B=>(n(),r("option",{key:B.id,value:B.id},d(B.name),9,Tn))),128))],8,Pn),[[G,l.to_cable_id]])]),t("div",Sn,[y(t("input",{"onUpdate:modelValue":B=>l.to_core_no=B,type:"number",min:"1",class:"input w-full",placeholder:"core"},null,8,En),[[P,l.to_core_no]])]),t("div",Ln,[t("button",{class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:B=>Va(E)},"Hapus",8,On)])]))),128))]))])),t("div",null,[e[177]||(e[177]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(t("textarea",{"onUpdate:modelValue":e[77]||(e[77]=l=>f.value.notes=l),class:"input w-full min-h-[90px]",placeholder:"(opsional)"},null,512),[[P,f.value.notes]])])]),t("div",$n,[t("button",{class:"btn btn-secondary",onClick:e[78]||(e[78]=l=>xe.value=!1)},"Batal"),t("button",{class:"btn btn-primary",disabled:vt.value,onClick:Ba},d(vt.value?"Menyimpan...":"Simpan"),9,Mn)])])])):g("",!0)]}),_:1})],64))}};export{An as default};
