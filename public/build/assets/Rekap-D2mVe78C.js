import{r as i,o as L,E as V,c as n,a as E,u as F,h as H,m as O,b as e,d as S,f as R,v as N,t as o,j as r,e as j,F as h,s as C,B as U,T as J,w as K,x as z,y as W}from"./app-7Yij2D9z.js";import{_ as q}from"./AdminLayout-C8hEeuN6.js";const Q={class:"space-y-6"},X={class:"flex gap-3"},Y={key:0,class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 space-y-3"},Z={key:1,class:"flex justify-center py-12"},ee={key:2,class:"space-y-4"},te={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700"},ae={class:"text-sm font-bold text-gray-700 dark:text-gray-300 uppercase mb-3"},se={key:0,class:"space-y-2"},re={class:"flex items-start justify-between"},ne={class:"flex-1"},oe={class:"flex items-center gap-2 mb-1"},le={class:"text-xs font-bold text-gray-500 dark:text-gray-400"},ie={class:"font-semibold text-gray-900 dark:text-white"},de={class:"text-sm text-gray-600 dark:text-gray-400"},ue={class:"text-sm font-bold text-green-600 dark:text-green-400"},ce={key:1,class:"text-sm text-gray-500 dark:text-gray-400 italic"},pe={key:0,class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700"},ge={class:"space-y-1"},xe={class:"text-gray-700 dark:text-gray-300"},ve={class:"font-semibold text-red-600 dark:text-red-400"},me={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700 space-y-4"},ye={class:"flex items-center justify-between"},be={class:"text-xs text-gray-500 dark:text-gray-400"},ke=["value"],fe={class:"grid grid-cols-3 gap-3"},he={class:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},we={class:"text-sm font-bold text-blue-700 dark:text-blue-300"},_e={class:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg"},Se={class:"text-sm font-bold text-red-700 dark:text-red-300"},Re={class:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg"},je={class:"text-sm font-bold text-green-700 dark:text-green-300"},Ce={class:"bg-white dark:bg-gray-800 w-full max-w-md rounded-2xl shadow-2xl"},Te={class:"p-6 space-y-4"},$e=["value"],Ee=["value"],T="/api/v1",Be={__name:"Rekap",props:{techName:{type:String,default:"Teknisi"},techPop:{type:String,default:""},techRole:{type:String,default:"teknisi"},initialDate:{type:String,default:new Date().toISOString().split("T")[0]}},setup(P){const m=P,c=i([]),g=i([]),$=i([]),d=i({total_jobs:0,total_revenue:0,total_expenses:0}),w=i(!1),p=i(m.initialDate),x=i(!1),_=i(!1),v=i(""),y=i("");async function b(){w.value=!0;try{const s=new URLSearchParams({tech_name:m.techName,date:p.value}),a=await(await fetch(`${T}/teknisi/rekap?${s}`)).json();a.success&&(c.value=a.jobs||[],g.value=a.expenses||[],$.value=a.groups||[],d.value=a.summary||{total_jobs:0,total_revenue:0,total_expenses:0})}catch(s){console.error("Failed to load rekap:",s)}finally{w.value=!1}}function B(){x.value=!x.value,!x.value&&y.value&&I()}async function I(){const s=y.value.split(`
`).filter(a=>a.trim()),t=[];for(const a of s){const u=a.match(/(.+?)\s+(\d+)/);u&&t.push({name:u[1].trim(),amount:parseFloat(u[2])})}if(t.length!==0)try{(await(await fetch(`${T}/teknisi/expenses`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tech_name:m.techName,date:p.value,expenses:t})})).json()).success&&b()}catch(a){console.error("Failed to save expenses:",a)}}function D(){_.value=!0}function k(){_.value=!1,v.value=""}async function M(){if(!v.value){alert("Pilih grup terlebih dahulu");return}try{const t=await(await fetch(`${T}/teknisi/rekap/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group_id:v.value,message:f.value})})).json();t.success?(alert("Rekap berhasil dikirim ke grup!"),k()):alert(t.message||"Gagal mengirim rekap")}catch(s){alert("Error: "+s.message)}}function A(){navigator.clipboard.writeText(f.value),alert("Rekap berhasil disalin!")}function l(s){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s||0)}function G(s){return s?new Date(s).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"}):"-"}const f=W(()=>{let s=`ðŸ“‹ REKAP HARIAN - ${G(p.value)}
`;return s+=`Teknisi: ${m.techName}

`,c.value.length>0?(s+=`âœ… JOB SELESAI (${c.value.length}):
`,c.value.forEach((t,a)=>{s+=`${a+1}. ${t.nama} - ${t.alamat}
`,t.harga&&(s+=`   ${l(t.harga)}
`)}),s+=`
ðŸ’° Total Revenue: ${l(d.value.total_revenue)}

`):s+=`Tidak ada job selesai hari ini.

`,g.value.length>0&&(s+=`ðŸ’¸ PENGELUARAN:
`,g.value.forEach((t,a)=>{s+=`${a+1}. ${t.name}: ${l(t.amount)}
`}),s+=`
ðŸ’¸ Total Pengeluaran: ${l(d.value.total_expenses)}

`),s+=`ðŸ“Š NET: ${l(d.value.total_revenue-d.value.total_expenses)}`,s});return L(()=>{b()}),V(p,()=>{b()}),(s,t)=>(r(),n(h,null,[E(F(H),{title:"Rekap Harian"}),E(q,null,{default:O(()=>[e("div",Q,[e("div",{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},[t[4]||(t[4]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Rekap Harian"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Selesai hari ini")],-1)),e("button",{onClick:b,class:"btn btn-secondary flex items-center gap-2"},[...t[3]||(t[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),S(" Refresh ",-1)])])]),e("div",X,[R(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>p.value=a),type:"date",class:"input flex-1"},null,512),[[N,p.value]]),e("button",{onClick:B,class:"btn btn-secondary"},o(x.value?"Selesai":"Pengeluaran"),1)]),x.value?(r(),n("div",Y,[t[5]||(t[5]=e("h4",{class:"text-sm font-bold text-gray-700 dark:text-gray-300 uppercase"},"Input Pengeluaran",-1)),R(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>y.value=a),rows:"4",class:"input w-full font-mono text-sm",placeholder:`Contoh:
Makan 30000
Rokok 30000
Bensin 30000`},null,512),[[N,y.value]]),t[6]||(t[6]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Tulis per baris atau dipisah koma.",-1))])):j("",!0),w.value?(r(),n("div",Z,[...t[7]||(t[7]=[e("div",{class:"animate-spin rounded-full h-10 w-10 border-4 border-primary-500 border-t-transparent"},null,-1)])])):(r(),n("div",ee,[e("div",te,[e("h4",ae,"Job Selesai ("+o(c.value.length)+")",1),c.value.length>0?(r(),n("div",se,[(r(!0),n(h,null,C(c.value,(a,u)=>(r(),n("div",{key:a.id,class:"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},[e("div",re,[e("div",ne,[e("div",oe,[e("span",le,o(u+1)+".",1),e("h5",ie,o(a.nama),1)]),e("p",de,o(a.alamat),1)]),e("span",ue,o(l(a.harga)),1)])]))),128))])):(r(),n("p",ce,"Belum ada job selesai."))]),g.value.length>0?(r(),n("div",pe,[t[8]||(t[8]=e("h4",{class:"text-sm font-bold text-gray-700 dark:text-gray-300 uppercase mb-3"},"Pengeluaran",-1)),e("div",ge,[(r(!0),n(h,null,C(g.value,(a,u)=>(r(),n("div",{key:u,class:"flex items-center justify-between text-sm"},[e("span",xe,o(u+1)+". "+o(a.name),1),e("span",ve,o(l(a.amount)),1)]))),128))])])):j("",!0),e("div",me,[e("div",ye,[t[9]||(t[9]=e("h4",{class:"text-sm font-bold text-gray-700 dark:text-gray-300"},"Preview Rekap",-1)),e("span",be,o(c.value.length)+" job",1)]),e("textarea",{value:f.value,readonly:"",rows:"12",class:"input w-full font-mono text-sm bg-gray-50 dark:bg-gray-900"},null,8,ke),e("div",fe,[e("div",he,[t[10]||(t[10]=e("p",{class:"text-xs text-blue-600 dark:text-blue-400 uppercase"},"Revenue",-1)),e("p",we,o(l(d.value.total_revenue)),1)]),e("div",_e,[t[11]||(t[11]=e("p",{class:"text-xs text-red-600 dark:text-red-400 uppercase"},"Expense",-1)),e("p",Se,o(l(d.value.total_expenses)),1)]),e("div",Re,[t[12]||(t[12]=e("p",{class:"text-xs text-green-600 dark:text-green-400 uppercase"},"Net",-1)),e("p",je,o(l(d.value.total_revenue-d.value.total_expenses)),1)])]),e("div",{class:"grid grid-cols-2 gap-3"},[e("button",{onClick:A,class:"btn btn-secondary"},[...t[13]||(t[13]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),S(" Salin ",-1)])]),e("button",{onClick:D,class:"btn btn-success"},[...t[14]||(t[14]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1),S(" Kirim Laporan ",-1)])])])])]))]),(r(),U(J,{to:"body"},[_.value?(r(),n("div",{key:0,class:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:K(k,["self"])},[e("div",Ce,[e("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between"},[t[16]||(t[16]=e("h3",{class:"text-lg font-bold text-gray-900 dark:text-white"},"Kirim Laporan ke Grup",-1)),e("button",{onClick:k,class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"},[...t[15]||(t[15]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Te,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"},"Pilih Grup WhatsApp",-1)),R(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>v.value=a),class:"input w-full"},[t[17]||(t[17]=e("option",{value:""},"-- Pilih Grup --",-1)),(r(!0),n(h,null,C($.value,a=>(r(),n("option",{key:a.id,value:a.id},o(a.name),9,$e))),128))],512),[[z,v.value]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"},"Isi Laporan",-1)),e("textarea",{value:f.value,readonly:"",rows:"10",class:"input w-full font-mono text-sm bg-gray-50 dark:bg-gray-900"},null,8,Ee)])]),e("div",{class:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 grid grid-cols-2 gap-3"},[e("button",{onClick:k,class:"btn btn-secondary"},"Batal"),e("button",{onClick:M,class:"btn btn-success"},"Kirim")])])])):j("",!0)]))]),_:1})],64))}};export{Be as default};
