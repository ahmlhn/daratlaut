import{C as ur,E as pe,G as Qa,o as dr,D as vr,c as n,a as el,u as cr,h as pr,m as br,b as a,t as u,j as i,e as f,d as w,n as O,f as y,x as G,F as $,s as A,i as tl,v as C,w as le,r as k,y as F,z as gr}from"./app-7gE5Lya0.js";import{_ as fr}from"./AdminLayout-1ZLzoPA1.js";const mr={class:"space-y-4 animate-fade-in"},kr={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3 bg-white dark:bg-dark-800 p-5 rounded-xl shadow-card border border-gray-100 dark:border-dark-700"},yr={class:"flex flex-wrap items-center gap-2"},xr={class:"px-3 py-2 rounded-lg bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 text-xs"},_r={class:"font-semibold text-gray-900 dark:text-white"},hr={class:"px-3 py-2 rounded-lg bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 text-xs"},wr={class:"font-semibold text-gray-900 dark:text-white"},Nr={class:"px-3 py-2 rounded-lg bg-red-50/60 dark:bg-red-900/10 border border-red-200/60 dark:border-red-900/30 text-xs"},Cr={class:"font-semibold text-red-700 dark:text-red-300"},Pr={key:0,class:"bg-amber-50 dark:bg-amber-900/10 border border-amber-200 dark:border-amber-900/30 text-amber-800 dark:text-amber-200 rounded-xl p-4 text-sm"},Sr={key:1,class:"bg-white dark:bg-dark-800 border border-gray-100 dark:border-dark-700 rounded-xl p-6"},Er={key:2,class:"relative"},Tr={key:1,class:"fixed left-3 right-3 bottom-3 z-[8900] lg:hidden"},Ir={class:"rounded-2xl border border-white/20 bg-white/90 dark:bg-dark-900/90 backdrop-blur shadow-xl p-2"},Lr={class:"grid grid-cols-4 gap-2"},Or=["disabled"],$r=["disabled"],Fr=["disabled"],Ur={class:"grid grid-cols-1 lg:grid-cols-12 gap-4"},Mr={class:"relative flex-1 min-h-[420px] lg:min-h-0"},Rr={class:"absolute top-3 left-3 z-20 flex flex-wrap items-center gap-2 bg-white/90 dark:bg-dark-900/80 backdrop-blur border border-gray-200 dark:border-white/10 rounded-xl p-2 shadow-lg"},Ar={class:"absolute top-16 left-3 z-20 w-64 max-w-[calc(100%-1.5rem)] bg-white/90 dark:bg-dark-900/80 backdrop-blur border border-gray-200 dark:border-white/10 rounded-xl shadow-lg overflow-hidden"},Dr={class:"flex items-center justify-between px-3 py-2 border-b border-gray-200/70 dark:border-white/10"},Vr={key:0,class:"p-3 space-y-2"},jr={class:"absolute top-3 right-3 z-20 flex items-center gap-2 bg-white/90 dark:bg-dark-900/80 backdrop-blur border border-gray-200 dark:border-white/10 rounded-xl p-2 shadow-lg"},Gr=["disabled"],Br={class:"flex items-start justify-between gap-2"},Kr={class:"min-w-0"},Hr={class:"mt-1 text-sm font-semibold text-gray-900 dark:text-white truncate"},Jr={class:"text-xs text-gray-500 dark:text-gray-400 truncate"},zr={class:"mt-3 grid grid-cols-1 gap-1.5"},Xr={class:"text-gray-500 dark:text-gray-400"},Zr={class:"text-right font-medium text-gray-800 dark:text-gray-200"},qr={key:0,class:"mt-2 text-xs text-gray-600 dark:text-gray-300 line-clamp-2"},Wr={class:"mt-3 flex flex-wrap items-center gap-2"},Yr={key:1,class:"absolute inset-0 z-40 flex items-center justify-center p-6 bg-white/85 dark:bg-dark-900/70 backdrop-blur"},Qr={class:"max-w-md text-center"},es={class:"mt-1 text-xs text-gray-600 dark:text-gray-300"},ts={key:2,class:"absolute bottom-3 left-3 right-3 lg:right-auto lg:max-w-md bg-white/90 dark:bg-dark-900/80 backdrop-blur border border-gray-200 dark:border-white/10 rounded-xl p-3 text-xs text-gray-700 dark:text-gray-200 shadow-lg"},as={class:"font-semibold"},ls={class:"uppercase"},rs={key:0,class:"text-gray-600 dark:text-gray-300 mt-1"},ss={key:1,class:"text-gray-600 dark:text-gray-300 mt-1"},os={class:"font-semibold"},ns={key:0,class:"ml-1 text-blue-700 dark:text-blue-300"},is={key:2,class:"text-gray-600 dark:text-gray-300 mt-1"},us={key:3,class:"mt-2 flex items-center gap-2 text-xs text-gray-700 dark:text-gray-200"},ds=["disabled"],vs={class:"mt-2 flex items-center gap-2"},cs=["disabled"],ps=["disabled"],bs=["disabled"],gs={class:"lg:hidden px-4 pt-2 pb-3 border-b border-gray-100 dark:border-dark-700"},fs={class:"mt-2 flex items-center justify-between gap-2"},ms={class:"text-[11px] text-gray-500 dark:text-gray-400"},ks={class:"font-semibold text-gray-700 dark:text-gray-200 uppercase"},ys={class:"mt-2 flex items-center gap-2"},xs={value:"cables"},_s={value:"points"},hs={value:"ports"},ws={value:"links"},Ns={value:"breaks"},Cs={class:"hidden lg:flex items-center gap-1 border-b border-gray-100 dark:border-dark-700 overflow-x-auto"},Ps={class:"p-4 overflow-y-auto flex-1 min-h-0"},Ss={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Es={key:1,class:"text-sm text-red-600 dark:text-red-300"},Ts={key:2,class:"space-y-3"},Is={class:"flex items-center justify-between"},Ls={class:"flex items-center gap-2"},Os=["placeholder"],$s={key:0,class:"text-[11px] text-gray-500 dark:text-gray-400"},Fs={class:"font-semibold text-gray-800 dark:text-gray-200"},Us={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},Ms={key:2,class:"space-y-2 pr-1"},Rs=["onClick"],As={class:"flex items-start justify-between gap-2"},Ds={class:"text-sm font-semibold text-gray-900 dark:text-white"},Vs={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},js={key:0},Gs={key:1,class:"ml-2"},Bs={key:2,class:"ml-2"},Ks={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Hs={class:"font-medium text-gray-700 dark:text-gray-200"},Js={class:"font-medium text-gray-700 dark:text-gray-200"},zs={class:"flex items-center gap-1 shrink-0"},Xs=["onClick"],Zs=["onClick"],qs=["onClick"],Ws={key:3,class:"space-y-3"},Ys={class:"flex items-center justify-between"},Qs={class:"flex items-center gap-2"},eo=["placeholder"],to={key:0,class:"text-[11px] text-gray-500 dark:text-gray-400"},ao={class:"font-semibold text-gray-800 dark:text-gray-200"},lo={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},ro={key:2,class:"space-y-2 pr-1"},so=["onClick"],oo={class:"flex items-start justify-between gap-2"},no={class:"text-sm font-semibold text-gray-900 dark:text-white"},io={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},uo={key:0},vo={key:1,class:"ml-2"},co={class:"flex items-center gap-1 shrink-0"},po=["onClick"],bo=["onClick"],go={key:4,class:"space-y-3"},fo={class:"flex items-center justify-between"},mo={class:"flex items-center gap-2"},ko=["placeholder"],yo={key:0,class:"text-[11px] text-gray-500 dark:text-gray-400"},xo={class:"font-semibold text-gray-800 dark:text-gray-200"},_o={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},ho={key:2,class:"space-y-2 pr-1"},wo={class:"flex items-start justify-between gap-2"},No={class:"text-xs font-bold text-indigo-700 dark:text-indigo-300"},Co={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1"},Po={class:"text-xs text-gray-500 dark:text-gray-400 mt-1 space-y-0.5"},So={class:"font-medium text-gray-700 dark:text-gray-200"},Eo={key:0},To={class:"font-medium text-gray-700 dark:text-gray-200"},Io={class:"ml-1"},Lo={class:"flex items-center gap-1 shrink-0"},Oo=["onClick"],$o=["onClick"],Fo={key:5,class:"space-y-3"},Uo={class:"flex items-center justify-between"},Mo={class:"flex items-center gap-2"},Ro=["placeholder"],Ao={key:0,class:"text-[11px] text-gray-500 dark:text-gray-400"},Do={class:"font-semibold text-gray-800 dark:text-gray-200"},Vo={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},jo={key:2,class:"space-y-2 pr-1"},Go={class:"flex items-start justify-between gap-2"},Bo={class:"min-w-0"},Ko={class:"text-xs font-bold text-amber-700 dark:text-amber-300"},Ho={key:0,class:"ml-1"},Jo={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},zo={class:"font-medium text-gray-700 dark:text-gray-200"},Xo={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1 truncate"},Zo={key:0,class:"text-gray-700 dark:text-gray-200"},qo={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-2"},Wo={key:0},Yo={key:1,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Qo={class:"font-medium text-gray-700 dark:text-gray-200"},en={class:"flex items-center gap-1 shrink-0"},tn=["onClick"],an=["onClick"],ln={key:6,class:"space-y-3"},rn={class:"flex items-center justify-between"},sn={class:"flex items-center gap-2"},on=["value"],nn=["disabled"],un={class:"grid grid-cols-2 gap-2 text-[11px]"},dn={class:"px-2 py-1.5 rounded-lg border border-gray-200 dark:border-white/10 bg-white dark:bg-dark-800 text-gray-700 dark:text-gray-200"},vn={class:"font-semibold"},cn={class:"px-2 py-1.5 rounded-lg border border-blue-200 dark:border-blue-900/40 bg-blue-50/70 dark:bg-blue-900/20 text-blue-700 dark:text-blue-200"},pn={class:"font-semibold"},bn={class:"px-2 py-1.5 rounded-lg border border-amber-200 dark:border-amber-900/40 bg-amber-50/70 dark:bg-amber-900/20 text-amber-700 dark:text-amber-200"},gn={class:"font-semibold"},fn={class:"px-2 py-1.5 rounded-lg border border-red-200 dark:border-red-900/40 bg-red-50/70 dark:bg-red-900/20 text-red-700 dark:text-red-200"},mn={class:"font-semibold"},kn={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},yn={key:1,class:"text-sm text-red-600 dark:text-red-300"},xn={key:2,class:"text-sm text-gray-500 dark:text-gray-400"},_n={key:3,class:"space-y-3"},hn={class:"grid grid-cols-4 sm:grid-cols-6 gap-2"},wn=["onClick"],Nn={class:"font-semibold"},Cn={class:"mt-0.5 uppercase tracking-wide"},Pn={key:0,class:"rounded-xl border border-gray-100 dark:border-dark-700 p-3 bg-gray-50/40 dark:bg-dark-900/30"},Sn={class:"flex items-center justify-between gap-2"},En={class:"text-xs font-semibold text-gray-900 dark:text-white"},Tn={class:"inline-flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},In=["checked"],Ln={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},On={class:"font-semibold text-gray-800 dark:text-gray-200"},$n={class:"mt-2 grid grid-cols-2 gap-2 text-[11px]"},Fn={class:"rounded-lg border border-gray-200 dark:border-white/10 px-2 py-1.5"},Un={class:"font-semibold"},Mn={class:"rounded-lg border border-gray-200 dark:border-white/10 px-2 py-1.5"},Rn={class:"font-semibold"},An={key:0,class:"mt-2"},Dn={class:"mt-1 space-y-1"},Vn={key:1,class:"mt-2"},jn={class:"mt-1 space-y-1"},Gn={class:"flex items-center justify-end gap-2"},Bn=["disabled"],Kn=["disabled"],Hn={key:7,class:"space-y-3"},Jn={class:"flex items-center justify-between"},zn=["disabled"],Xn={class:"space-y-2"},Zn=["value"],qn={class:"flex items-center gap-2"},Wn=["disabled"],Yn=["disabled"],Qn={key:0,class:"text-xs text-red-600 dark:text-red-300"},ei={key:0,class:"space-y-3"},ti={class:"text-xs text-gray-500 dark:text-gray-400"},ai={class:"font-semibold text-gray-800 dark:text-gray-200"},li={class:"font-semibold text-gray-800 dark:text-gray-200"},ri={key:0,class:"ml-2 text-amber-700 dark:text-amber-300"},si={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},oi={key:1,class:"space-y-2 max-h-[260px] overflow-auto pr-1"},ni=["onClick"],ii={class:"text-sm font-semibold text-gray-900 dark:text-white"},ui={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},di={class:"font-medium text-gray-700 dark:text-gray-200"},vi={key:2,class:"rounded-xl border border-gray-100 dark:border-dark-700 p-3 bg-gray-50/40 dark:bg-dark-900/30"},ci={class:"mt-2 space-y-1 max-h-[220px] overflow-auto pr-1"},pi={class:"font-medium text-gray-900 dark:text-white"},bi={class:"text-gray-600 dark:text-gray-300"},gi={key:8,class:"space-y-3"},fi={class:"flex items-center justify-between"},mi={class:"flex items-center gap-2"},ki=["placeholder"],yi={class:"flex flex-wrap items-center gap-2"},xi={key:0,class:"text-[11px] text-gray-500 dark:text-gray-400"},_i={class:"font-semibold text-gray-800 dark:text-gray-200"},hi={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},wi={key:2,class:"space-y-2 pr-1"},Ni=["onClick"],Ci={class:"flex items-start justify-between gap-2"},Pi={class:"text-xs font-bold"},Si={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1"},Ei={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},Ti={key:0,class:"ml-2"},Ii={key:1,class:"ml-2"},Li={key:0,class:"text-xs text-gray-600 dark:text-gray-300 mt-1 line-clamp-2"},Oi={class:"flex items-center gap-1 shrink-0"},$i=["disabled","onClick"],Fi=["disabled","onClick"],Ui=["disabled","onClick"],Mi=["onClick"],Ri=["onClick"],Ai={class:"relative pointer-events-auto w-full max-w-2xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},Di={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Vi={class:"font-semibold text-gray-900 dark:text-white"},ji={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},Gi={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Bi={key:0,class:"text-xs text-red-600 mt-1"},Ki={key:0,class:"text-xs text-red-600 mt-1"},Hi={key:0,class:"text-xs text-red-600 mt-1"},Ji={key:0,class:"text-xs text-red-600 mt-1"},zi={class:"md:col-span-2"},Xi={class:"flex flex-col sm:flex-row gap-2"},Zi={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},qi={class:"font-medium text-gray-700 dark:text-gray-200"},Wi={class:"ml-2"},Yi={key:0,class:"ml-2"},Qi=["value"],eu=["value"],tu={class:"md:col-span-2"},au={class:"flex items-center gap-2"},lu={class:"md:col-span-2"},ru={class:"rounded-xl border border-gray-100 dark:border-dark-700 p-3"},su={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-2"},ou={class:"text-xs text-gray-500 dark:text-gray-400"},nu={class:"flex flex-wrap items-center gap-2"},iu={class:"flex items-center gap-2 text-xs text-gray-700 dark:text-gray-200 px-3 py-2 rounded-xl border border-gray-200/70 dark:border-white/10 bg-white/70 dark:bg-dark-900/40"},uu=["disabled"],du=["disabled"],vu=["disabled"],cu=["disabled"],pu={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},bu=["disabled"],gu={class:"relative pointer-events-auto w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},fu={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},mu={class:"font-semibold text-gray-900 dark:text-white"},ku={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},yu={key:0,class:"text-xs text-red-600 mt-1"},xu={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},_u={key:0,class:"text-xs text-red-600 mt-1"},hu={key:0,class:"text-xs text-red-600 mt-1"},wu={class:"flex items-center gap-2"},Nu={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},Cu=["disabled"],Pu={class:"relative pointer-events-auto w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},Su={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Eu={class:"font-semibold text-gray-900 dark:text-white"},Tu={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},Iu=["value"],Lu=["value"],Ou={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},$u={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Fu={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Uu=["disabled"],Mu={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ru=["disabled"],Au=["disabled"],Du=["value"],Vu={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ju={key:0,class:"text-xs text-red-600 mt-1"},Gu={key:0,class:"text-xs text-red-600 mt-1"},Bu={class:"flex items-center gap-2"},Ku={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Hu={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},Ju=["disabled"],zu={key:3,class:"fixed inset-0 z-[10000] flex items-center justify-center p-4"},Xu={class:"relative w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},Zu={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},qu={class:"font-semibold text-gray-900 dark:text-white"},Wu={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},Yu=["value"],Qu={key:0,class:"text-xs text-red-600 mt-1"},ed={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},td={key:0,class:"text-xs text-red-600 mt-1"},ad={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ld=["value"],rd={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},sd=["disabled"],od={key:4,class:"fixed inset-0 z-[10000] flex items-center justify-center p-4"},nd={class:"relative w-full max-w-2xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden max-h-[calc(100vh-2rem)] flex flex-col"},id={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},ud={class:"font-semibold text-gray-900 dark:text-white"},dd={class:"p-4 space-y-3 overflow-y-auto flex-1 min-h-0"},vd=["value"],cd={key:0,class:"text-xs text-red-600 mt-1"},pd={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},bd={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},gd=["value"],fd={key:0,class:"text-xs text-red-600 mt-1"},md={key:0,class:"text-xs text-red-600 mt-1"},kd={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},yd=["value"],xd={key:1,class:"space-y-3 rounded-xl border border-gray-100 dark:border-dark-700 p-3"},_d={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},hd={class:"flex items-center gap-2"},wd={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},Nd={key:1,class:"space-y-2 max-h-[260px] overflow-auto pr-1"},Cd={class:"col-span-7"},Pd=["onUpdate:modelValue"],Sd=["value"],Ed={class:"col-span-3"},Td=["onUpdate:modelValue"],Id={class:"col-span-2 flex items-center justify-end"},Ld=["onClick"],Od={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},$d=["disabled"],Nt=25,Fd=18,Ad={__name:"Index",props:{tenantId:{type:Number,default:0},warning:{type:String,default:null},googleMapsApiKey:{type:String,default:""}},setup(al){const c=ur("toast"),Kt=al,Ct=gr(),pa=F(()=>{var t,e;return((e=(t=Ct.props.auth)==null?void 0:t.user)==null?void 0:e.permissions)||[]}),ll=F(()=>{var t,e;return(((e=(t=Ct.props.auth)==null?void 0:t.user)==null?void 0:e.role)||"").toString().toLowerCase().trim()});function rl(t){const e=(t||"").toString().toLowerCase().trim();return e==="svp lapangan"?"svp_lapangan":e}function Pt(t){const e=rl(ll.value);return["admin","owner"].includes(e)||pa.value.includes("manage fiber")?!0:pa.value.includes(t)}const ba=F(()=>Pt("view fiber")),W=F(()=>Pt("create fiber")),B=F(()=>Pt("edit fiber")),fe=F(()=>Pt("delete fiber")),at=k(!1),St=k(""),xe=k({cables:0,points:0,breaks_total:0,breaks_open:0}),z=k([]),X=k([]),me=k([]),_e=k([]),lt=k([]),I=k("cables"),ze=k(!0),Xe=k(!0),Ze=k(!0),re=k(null),se=k(null),he=k(null),qe=k(!1),oe=k(!1),U=k(""),Q=k("ALL"),Ee=k("half"),we=k(null),Et=k([]),ga=F(()=>{const t=new Set;return(Et.value||[]).forEach(e=>{const r=Number(e);Number.isFinite(r)&&r>0&&t.add(r)}),t});async function K(t,e={}){const r=await fetch(t,{credentials:"same-origin",headers:{Accept:"application/json",...e.headers||{}},...e}),s=await r.text();let o=null;try{o=s?JSON.parse(s):null}catch{o=null}return{ok:r.ok,status:r.status,data:o,text:s}}async function j(){var t,e,r,s,o,v,p,d,b,x,N,h;if(ba.value){at.value=!0,St.value="";try{const[T,te]=await Promise.all([K("/api/v1/fiber/map-data"),K("/api/v1/fiber/summary")]);if(!T.ok){const V=((t=T.data)==null?void 0:t.message)||`Gagal memuat data fiber (HTTP ${T.status}).`;throw new Error(V)}te.ok?xe.value=((e=te.data)==null?void 0:e.data)||xe.value:xe.value={cables:0,points:0,breaks_total:0,breaks_open:0},z.value=((s=(r=T.data)==null?void 0:r.data)==null?void 0:s.cables)||[],X.value=((v=(o=T.data)==null?void 0:o.data)==null?void 0:v.points)||[],me.value=((d=(p=T.data)==null?void 0:p.data)==null?void 0:d.breaks)||[],_e.value=((x=(b=T.data)==null?void 0:b.data)==null?void 0:x.ports)||[],lt.value=((h=(N=T.data)==null?void 0:N.data)==null?void 0:h.links)||[],_a(),ha()}catch(T){console.error("Fiber: loadAll failed",T),St.value=T&&T.message?T.message:"Gagal memuat data fiber."}finally{at.value=!1}}}const Ht=k(null);let S=null,Y=null,Jt=new Map,zt=new Map,Xt=new Map,Ae={markers:[],polyline:null},Zt=!1;const De=k(""),Ve=k("roadmap"),rt={roadmap:{label:"Roadmap",mapTypeId:"roadmap"},satellite:{label:"Satelit",mapTypeId:"satellite"},hybrid:{label:"Hybrid",mapTypeId:"hybrid"}},Te=k(!1);function sl(t){var r;const e=(t||"").toString().trim();return e?(r=window.google)!=null&&r.maps?Promise.resolve():(window.__fiberGoogleMapsPromise||(window.__fiberGoogleMapsPromise=new Promise((s,o)=>{const v=document.createElement("script"),p=new URLSearchParams({key:e,v:"weekly"});v.src=`https://maps.googleapis.com/maps/api/js?${p.toString()}`,v.async=!0,v.defer=!0,v.onload=()=>s(),v.onerror=()=>o(new Error("Gagal memuat Google Maps. Cek API key/koneksi.")),document.head.appendChild(v)})),window.__fiberGoogleMapsPromise):Promise.reject(new Error("Google Maps API key belum di-set."))}function ol(){var e;if(!S||!((e=window.google)!=null&&e.maps))return;const t=rt[Ve.value]||rt.roadmap;try{S.setMapTypeId(t.mapTypeId)}catch{}}function fa(){var t;if(!(!S||!((t=window.google)!=null&&t.maps)))try{window.google.maps.event.trigger(S,"resize")}catch{}}function ma(){var t;Wt();try{(Ae.markers||[]).forEach(e=>{try{e.setMap(null)}catch{}})}catch{}Ae.markers=[];try{(t=Ae.polyline)==null||t.setMap(null)}catch{}Ae.polyline=null}function We(t){try{Array.from(t.values()).forEach(e=>{try{e.setMap(null)}catch{}})}catch{}try{t.clear()}catch{}}function nl(){var e;if(!((e=window.google)!=null&&e.maps)||!Ht.value)return;const t=rt[Ve.value]||rt.roadmap;S=new window.google.maps.Map(Ht.value,{center:{lat:-2.5489,lng:118.0149},zoom:5,mapTypeId:t.mapTypeId,clickableIcons:!1,fullscreenControl:!1,streetViewControl:!1,mapTypeControl:!1}),Y=new window.google.maps.InfoWindow,S.addListener("click",cl)}function il(){var t;if(!((t=window.google)!=null&&t.maps)){S=null,Y=null;return}try{window.google.maps.event.clearInstanceListeners(S)}catch{}try{Y==null||Y.close()}catch{}ma(),We(Jt),We(zt),We(Xt),S=null,Y=null}const E=k(null),ne=k(null),ie=k(!0),Ie=k(!1);let Ne=[],qt=null,st=[];function ul(t){var e,r,s,o;if(t){try{if(typeof t.remove=="function"){t.remove();return}}catch{}try{(o=(s=(r=(e=window.google)==null?void 0:e.maps)==null?void 0:r.event)==null?void 0:s.removeListener)==null||o.call(s,t)}catch{}}}function Wt(){try{(st||[]).forEach(t=>ul(t))}catch{}st=[]}function ue(t){const e=Number(t);return Number.isFinite(e)?Math.round(e*1e7)/1e7:null}function dl(){var t;return(t=window.google)!=null&&t.maps?(qt||(qt=new window.google.maps.DirectionsService),qt):null}async function ka(t,e){const r=dl();if(!r)throw new Error("Google Maps Directions belum siap.");const s={origin:t,destination:e,travelMode:window.google.maps.TravelMode.DRIVING};return new Promise((o,v)=>{try{r.route(s,(p,d)=>{var N;if(d!=="OK"||!((N=p==null?void 0:p.routes)!=null&&N[0])){v(new Error(`Gagal ambil rute jalan (${d||"UNKNOWN"}).`));return}const x=(p.routes[0].overview_path||[]).map(h=>({lat:ue(h.lat()),lng:ue(h.lng())})).filter(h=>Number.isFinite(h.lat)&&Number.isFinite(h.lng));o(x)})}catch(p){v(p)}})}function ya(t,e,r=Nt){if(!Number.isFinite(t)||!Number.isFinite(e))return null;let s=null,o=Number.POSITIVE_INFINITY;return(X.value||[]).forEach(v=>{const p=Number(v==null?void 0:v.latitude),d=Number(v==null?void 0:v.longitude);if(!Number.isFinite(p)||!Number.isFinite(d))return;const b=Ta({lat:t,lng:e},{lat:p,lng:d});b<o&&(o=b,s=v)}),!s||!Number.isFinite(o)||o>Number(r||Nt)?null:{point:s,distance_m:Math.round(o),lat:Number(s==null?void 0:s.latitude),lng:Number(s==null?void 0:s.longitude)}}function vl(t,e,r=Nt){const s=ya(t,e,r);return s?{lat:ue(s.lat),lng:ue(s.lng),snapped:!0,point:s.point,distance_m:s.distance_m}:{lat:t,lng:e,snapped:!1,point:null,distance_m:null}}async function cl(t){var v,p;if(!(t!=null&&t.latLng))return;const e=ue(t.latLng.lat()),r=ue(t.latLng.lng()),s=e,o=r;if(E.value==="pickPoint"){P.value.latitude=s,P.value.longitude=o,c&&c.success("Lokasi titik dipilih dari peta."),D();return}if(E.value==="pickBreak"){m.value.latitude=s,m.value.longitude=o,c&&c.success("Lokasi putus dipilih dari peta."),D();return}if(E.value==="drawCable"){const d=Array.isArray(g.value.path)?g.value.path:[];if(!Number.isFinite(e)||!Number.isFinite(r))return;const b=vl(e,r,Nt),x=Number(b==null?void 0:b.lat),N=Number(b==null?void 0:b.lng);if(!Number.isFinite(x)||!Number.isFinite(N))return;if(d.length<1||!ie.value){Ne.push(d.length),d.push({lat:x,lng:N}),g.value.path=d,be(),b!=null&&b.snapped&&c&&c.info(`Snap ke titik: ${((v=b==null?void 0:b.point)==null?void 0:v.name)||"NODE"} (${(b==null?void 0:b.distance_m)||0}m)`);return}if(Ie.value)return;Ne.push(d.length),Ie.value=!0;try{const h=d[d.length-1],T=await ka({lat:Number(h==null?void 0:h.lat),lng:Number(h==null?void 0:h.lng)},{lat:x,lng:N});if(Array.isArray(T)&&T.length>=2){const te=T.slice(1);g.value.path=d.concat(te)}else d.push({lat:x,lng:N}),g.value.path=d}catch(h){d.push({lat:x,lng:N}),g.value.path=d,c&&c.error((h==null?void 0:h.message)||"Gagal mengikuti jalan. Pakai garis lurus.")}finally{Ie.value=!1,be(),b!=null&&b.snapped&&c&&c.info(`Snap ke titik: ${((p=b==null?void 0:b.point)==null?void 0:p.name)||"NODE"} (${(b==null?void 0:b.distance_m)||0}m)`)}}}function D(t={}){const e=(t==null?void 0:t.reopen)!==!1,r=e?ne.value:null;Wt(),E.value=null,ne.value=null,e&&r&&(r==="cable"&&(q.value=!0),r==="point"&&(de.value=!0),r==="break"&&(ve.value=!0)),be()}function pl(t){const e=document.createElement("div");return e.className="text-sm",(t||[]).forEach(r=>{const s=document.createElement("div");s.textContent=String(r??""),e.appendChild(s)}),e}function Yt(t,e,r=null){if(!S||!Y)return;const s=(e||[]).filter(Boolean);if(!(s.length<1)){try{Y.close()}catch{}Y.setContent(pl(s));try{if(r){Y.open({map:S,anchor:r});return}t&&Y.setPosition(t),Y.open({map:S})}catch{}}}const Qt=F(()=>{const t=new Map;return(X.value||[]).forEach(e=>{const r=Number((e==null?void 0:e.id)||0);r>0&&t.set(r,e)}),t}),ea=F(()=>{const t=new Map;return(z.value||[]).forEach(e=>{const r=Number((e==null?void 0:e.id)||0);r>0&&t.set(r,e)}),t}),bl=F(()=>{const t=new Map;return(me.value||[]).forEach(e=>{const r=Number((e==null?void 0:e.id)||0);r>0&&t.set(r,e)}),t}),Le=F(()=>{const t=Number(re.value||0);return t&&ea.value.get(t)||null}),Oe=F(()=>{const t=Number(se.value||0);return t&&Qt.value.get(t)||null}),$e=F(()=>{const t=Number(he.value||0);return t&&bl.value.get(t)||null});function xa(t,e){const r=Number(t),s=Number(e);return!Number.isFinite(r)||!Number.isFinite(s)?"-":`${r.toFixed(6)}, ${s.toFixed(6)}`}function gl(t){if(!t)return"-";const e=new Date(t);if(!Number.isFinite(e.getTime()))return"-";try{return e.toLocaleString("id-ID",{dateStyle:"medium",timeStyle:"short"})}catch{return e.toISOString()}}const ke=F(()=>{if(Le.value){const t=Le.value;return{type:"cable",tone:"blue",badge:"KABEL",title:t.name||`Kabel #${t.id}`,subtitle:[t.code,t.cable_type].filter(Boolean).join(" | ")||"Jalur kabel",rows:[{label:"Core",value:t.core_count?`${t.core_count} core`:"-"},{label:"Panjang",value:ra(t.length_m)},{label:"Dari",value:H(t.from_point_id)||"-"},{label:"Ke",value:H(t.to_point_id)||"-"}],note:t.notes||""}}if(Oe.value){const t=Oe.value,e=Number((t==null?void 0:t.id)||0),r=(z.value||[]).filter(o=>Number((o==null?void 0:o.from_point_id)||0)===e||Number((o==null?void 0:o.to_point_id)||0)===e).length,s=(_e.value||[]).filter(o=>Number((o==null?void 0:o.point_id)||0)===e).length;return{type:"point",tone:"teal",badge:"TITIK",title:t.name||`Titik #${t.id}`,subtitle:t.point_type||"Tanpa tipe",rows:[{label:"Koordinat",value:xa(t.latitude,t.longitude)},{label:"Port",value:String(s)},{label:"Kabel terkait",value:String(r)}],note:t.address||t.notes||""}}if($e.value){const t=$e.value,e=wa(t.status);return{type:"break",tone:e==="OPEN"?"red":e==="IN PROGRESS"?"amber":e==="FIXED"?"green":"slate",badge:"PUTUS",title:Z(t.cable_id)||(t.cable_id?`Kabel #${t.cable_id}`:"Tanpa kabel"),subtitle:e,rows:[{label:"Titik",value:H(t.point_id)||"-"},{label:"Core",value:t.core_no?String(t.core_no):"-"},{label:"Severity",value:t.severity||"-"},{label:"Teknisi",value:t.technician_name||"-"},{label:"Koordinat",value:xa(t.latitude,t.longitude)},{label:"Dilaporkan",value:gl(t.reported_at)}],note:t.description||""}}return null}),fl=F(()=>{var e;const t=(e=ke.value)==null?void 0:e.tone;return t==="blue"?"border-blue-200/80 dark:border-blue-900/40":t==="teal"?"border-teal-200/80 dark:border-teal-900/40":t==="red"?"border-red-200/80 dark:border-red-900/40":t==="amber"?"border-amber-200/80 dark:border-amber-900/40":t==="green"?"border-emerald-200/80 dark:border-emerald-900/40":"border-slate-200/80 dark:border-white/10"}),ml=F(()=>{var e;const t=(e=ke.value)==null?void 0:e.tone;return t==="blue"?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-200":t==="teal"?"bg-teal-50 text-teal-700 dark:bg-teal-900/20 dark:text-teal-200":t==="red"?"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-200":t==="amber"?"bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-200":t==="green"?"bg-emerald-50 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-200":"bg-slate-100 text-slate-700 dark:bg-slate-700/40 dark:text-slate-200"});function kl(){re.value=null,se.value=null,he.value=null;try{Y==null||Y.close()}catch{}ot(),ta(),aa()}function yl(){if(Le.value){Ca(Le.value);return}if(Oe.value){ye(Number(Oe.value.latitude),Number(Oe.value.longitude),18);return}$e.value&&ye(Number($e.value.latitude),Number($e.value.longitude),18)}function xl(){Le.value?I.value="cables":Oe.value?I.value="points":$e.value&&(I.value="breaks"),Lt("open")}function _l(){if(B.value){if(Le.value){Oa(Le.value);return}if(Oe.value){Ra(Oe.value);return}$e.value&&Va($e.value)}}function H(t){const e=Number(t||0);if(!e)return null;const r=Qt.value.get(e);return r?String(r.name||""):null}function Tt(t){const e=Number(t||0);if(!e)return null;const r=Qt.value.get(e);if(!r)return null;const s=ue(Number(r==null?void 0:r.latitude)),o=ue(Number(r==null?void 0:r.longitude));return!Number.isFinite(s)||!Number.isFinite(o)?null:{lat:s,lng:o}}function Z(t){const e=Number(t||0);if(!e)return null;const r=ea.value.get(e);return r?String(r.name||""):null}function hl(t){const e=String(t||"").toUpperCase();return e==="OPEN"?{stroke:"#dc2626",fill:"#ef4444"}:e==="IN_PROGRESS"?{stroke:"#b45309",fill:"#f59e0b"}:e==="FIXED"?{stroke:"#047857",fill:"#10b981"}:e==="VERIFIED"?{stroke:"#065f46",fill:"#34d399"}:{stroke:"#64748b",fill:"#94a3b8"}}function _a(){var t;!S||!((t=window.google)!=null&&t.maps)||(ot(),ta(),aa(),be())}function ot(){var t;!S||!((t=window.google)!=null&&t.maps)||(We(Jt),ze.value&&(z.value||[]).forEach(e=>{const r=Array.isArray(e==null?void 0:e.path)?e.path:null;if(!r||r.length<2)return;const s=r.map(V=>({lat:Number(V==null?void 0:V.lat),lng:Number(V==null?void 0:V.lng)})).filter(V=>Number.isFinite(V.lat)&&Number.isFinite(V.lng));if(s.length<2)return;const o=Number(e==null?void 0:e.id)===Number(re.value||0),v=ga.value.size>0,p=ga.value.has(Number(e==null?void 0:e.id)),d=((e==null?void 0:e.map_color)||"#2563eb").toString(),b=o?6:4,x=p?Math.max(b,6):b,N=v?p?1:.25:.9,h=new window.google.maps.Polyline({path:s,strokeColor:d,strokeWeight:x,strokeOpacity:N,clickable:!0});h.setMap(S),Jt.set(Number(e==null?void 0:e.id)||0,h);const T=H(e==null?void 0:e.from_point_id)||"-",te=H(e==null?void 0:e.to_point_id)||"-";h.addListener("click",V=>{Pa(e,{zoom:!1,panel:"open"}),Yt((V==null?void 0:V.latLng)||null,[`Kabel: ${(e==null?void 0:e.name)||"-"}`,e!=null&&e.code?`Kode: ${e.code}`:null,e!=null&&e.cable_type?`Tipe: ${e.cable_type}`:null,e!=null&&e.core_count?`Core: ${e.core_count}`:null,`Dari: ${T}`,`Ke: ${te}`])})}))}function ta(){var t;!S||!((t=window.google)!=null&&t.maps)||(We(zt),Xe.value&&(X.value||[]).forEach(e=>{const r=Number(e==null?void 0:e.latitude),s=Number(e==null?void 0:e.longitude);if(!Number.isFinite(r)||!Number.isFinite(s))return;const o=Number(e==null?void 0:e.id)===Number(se.value||0),v=new window.google.maps.Marker({position:{lat:r,lng:s},map:S,title:((e==null?void 0:e.name)||"").toString(),clickable:!0,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:o?7:6,fillColor:"#14b8a6",fillOpacity:.9,strokeColor:"#0f766e",strokeWeight:2}});zt.set(Number(e==null?void 0:e.id)||0,v),v.addListener("click",()=>{Sa(e,{zoom:!1,panel:"open"}),Yt(v.getPosition(),[`Titik: ${(e==null?void 0:e.name)||"-"}`,e!=null&&e.point_type?`Tipe: ${e.point_type}`:null,`Koordinat: ${r}, ${s}`],v)})}))}function aa(){var t;!S||!((t=window.google)!=null&&t.maps)||(We(Xt),Ze.value&&(me.value||[]).forEach(e=>{const r=Number(e==null?void 0:e.latitude),s=Number(e==null?void 0:e.longitude);if(!Number.isFinite(r)||!Number.isFinite(s))return;const o=hl(e==null?void 0:e.status),v=Number(e==null?void 0:e.id)===Number(he.value||0),p=new window.google.maps.Marker({position:{lat:r,lng:s},map:S,title:`PUTUS: ${String((e==null?void 0:e.status)||"OPEN").toUpperCase()}`,clickable:!0,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:v?8:7,fillColor:o.fill,fillOpacity:.9,strokeColor:o.stroke,strokeWeight:2}});Xt.set(Number(e==null?void 0:e.id)||0,p),p.addListener("click",()=>{Ea(e,{zoom:!1,panel:"open"});const d=Z(e==null?void 0:e.cable_id)||(e!=null&&e.cable_id?`#${e.cable_id}`:"-"),b=H(e==null?void 0:e.point_id)||(e!=null&&e.point_id?`#${e.point_id}`:"-");Yt(p.getPosition(),[`PUTUS: ${String((e==null?void 0:e.status)||"OPEN").toUpperCase()}`,`Kabel: ${d}`,`Titik: ${b}`,e!=null&&e.severity?`Severity: ${e.severity}`:null],p)})}))}function wl(t){var e,r,s;try{const o=(e=t==null?void 0:t.getPath)==null?void 0:e.call(t);if(!o||typeof o.getLength!="function")return;const v=[];for(let p=0;p<o.getLength();p+=1){const d=o.getAt(p),b=ue((r=d==null?void 0:d.lat)==null?void 0:r.call(d)),x=ue((s=d==null?void 0:d.lng)==null?void 0:s.call(d));!Number.isFinite(b)||!Number.isFinite(x)||v.push({lat:b,lng:x})}g.value.path=v}catch{}}function Nl(t){var s,o;if(Wt(),!t||!((s=window.google)!=null&&s.maps))return;const e=(o=t.getPath)==null?void 0:o.call(t);if(!e||typeof e.addListener!="function")return;const r=()=>wl(t);st.push(e.addListener("insert_at",r)),st.push(e.addListener("set_at",r)),st.push(e.addListener("remove_at",r)),r()}function be(){var e;if(!S||!((e=window.google)!=null&&e.maps))return;ma();const t=(r,s,o={})=>{if(!Number.isFinite(r)||!Number.isFinite(s))return;const v=new window.google.maps.Marker({position:{lat:r,lng:s},map:S,clickable:!1,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:Number(o.scale??6),fillColor:(o.fillColor||"#38bdf8").toString(),fillOpacity:Number(o.fillOpacity??.9),strokeColor:(o.strokeColor||"#0ea5e9").toString(),strokeWeight:Number(o.strokeWeight??2)}});Ae.markers.push(v)};if((de.value||E.value==="pickPoint")&&P.value.latitude!==null&&P.value.longitude!==null){const r=Number(P.value.latitude),s=Number(P.value.longitude);Number.isFinite(r)&&Number.isFinite(s)&&t(r,s,{scale:7,strokeColor:"#0ea5e9",fillColor:"#38bdf8",fillOpacity:.85})}if((ve.value||E.value==="pickBreak")&&m.value.latitude!==null&&m.value.longitude!==null){const r=Number(m.value.latitude),s=Number(m.value.longitude);Number.isFinite(r)&&Number.isFinite(s)&&t(r,s,{scale:8,strokeColor:"#f97316",fillColor:"#fb923c",fillOpacity:.85})}if((q.value||E.value==="drawCable"||E.value==="editCable")&&Array.isArray(g.value.path)&&g.value.path.length>0){const r=E.value==="editCable",s=g.value.path.map(o=>({lat:Number(o==null?void 0:o.lat),lng:Number(o==null?void 0:o.lng)})).filter(o=>Number.isFinite(o.lat)&&Number.isFinite(o.lng));if(r||s.forEach(o=>{t(o.lat,o.lng,{scale:3,strokeColor:"#1d4ed8",fillColor:"#60a5fa",fillOpacity:.95})}),s.length>=2){const o={path:"M 0,-1 0,1",strokeOpacity:1,strokeColor:"#1d4ed8",scale:3};Ae.polyline=new window.google.maps.Polyline({path:s,strokeColor:"#1d4ed8",strokeOpacity:r?.85:0,strokeWeight:r?4:0,icons:r?[]:[{icon:o,offset:"0",repeat:"12px"}],clickable:r,editable:r,map:S}),r&&Nl(Ae.polyline)}}}function ha(){var r;if(!S||Zt||!((r=window.google)!=null&&r.maps))return;const t=new window.google.maps.LatLngBounds;let e=!1;try{ze.value&&(z.value||[]).forEach(s=>{const o=Array.isArray(s==null?void 0:s.path)?s.path:null;!o||o.length<1||o.forEach(v=>{const p=Number(v==null?void 0:v.lat),d=Number(v==null?void 0:v.lng);!Number.isFinite(p)||!Number.isFinite(d)||(t.extend({lat:p,lng:d}),e=!0)})})}catch{}try{Xe.value&&(X.value||[]).forEach(s=>{const o=Number(s==null?void 0:s.latitude),v=Number(s==null?void 0:s.longitude);!Number.isFinite(o)||!Number.isFinite(v)||(t.extend({lat:o,lng:v}),e=!0)})}catch{}try{Ze.value&&(me.value||[]).forEach(s=>{const o=Number(s==null?void 0:s.latitude),v=Number(s==null?void 0:s.longitude);!Number.isFinite(o)||!Number.isFinite(v)||(t.extend({lat:o,lng:v}),e=!0)})}catch{}if(e)try{S.fitBounds(t),Zt=!0}catch{}}function Cl(){Zt=!1,ha()}function wa(t){const e=String(t||"OPEN").toUpperCase();return e==="IN_PROGRESS"?"IN PROGRESS":e}function It(t){if(!t)return"";const e=new Date(t);if(!Number.isFinite(e.getTime()))return"";const r=s=>String(s).padStart(2,"0");return`${e.getFullYear()}-${r(e.getMonth()+1)}-${r(e.getDate())}T${r(e.getHours())}:${r(e.getMinutes())}`}function ye(t,e,r=17){var s;if(!(!S||!((s=window.google)!=null&&s.maps)||!Number.isFinite(t)||!Number.isFinite(e))){try{S.panTo({lat:t,lng:e})}catch{}if(Number.isFinite(Number(r)))try{S.setZoom(Number(r))}catch{}}}function Na(){try{return window.innerWidth<1024}catch{return!1}}const Pl=F(()=>{const t=String(Ee.value||"half");return t==="peek"?"max-h-[38vh]":t==="full"?"max-h-[calc(100vh-4rem)]":"max-h-[68vh]"});function Sl(){const t=String(Ee.value||"half");Ee.value=t==="peek"?"half":t==="half"?"full":"peek"}function Lt(t){Na()&&(t==="open"&&(oe.value=!0),t==="close"&&(oe.value=!1))}function Ca(t){var v;if(!S||!((v=window.google)!=null&&v.maps))return;const e=typeof t=="object"&&t?t:ea.value.get(Number(t||0)),r=Array.isArray(e==null?void 0:e.path)?e.path:null;if(!r||r.length<1)return;const s=new window.google.maps.LatLngBounds;let o=!1;if(r.forEach(p=>{const d=Number(p==null?void 0:p.lat),b=Number(p==null?void 0:p.lng);!Number.isFinite(d)||!Number.isFinite(b)||(s.extend({lat:d,lng:b}),o=!0)}),!!o)try{S.fitBounds(s,60)}catch{try{S.fitBounds(s)}catch{}}}function Pa(t,e={}){re.value=(t==null?void 0:t.id)??null,se.value=null,he.value=null,I.value="cables",ot(),e.zoom!==!1&&Ca(t),e.panel&&Lt(e.panel)}function Sa(t,e={}){se.value=(t==null?void 0:t.id)??null,re.value=null,he.value=null,I.value="points",ta(),e.zoom!==!1&&ye(Number(t==null?void 0:t.latitude),Number(t==null?void 0:t.longitude),17),e.panel&&Lt(e.panel)}function Ea(t,e={}){he.value=(t==null?void 0:t.id)??null,re.value=null,se.value=null,I.value="breaks",aa(),e.zoom!==!1&&ye(Number(t==null?void 0:t.latitude),Number(t==null?void 0:t.longitude),17),e.panel&&Lt(e.panel)}function Ta(t,e){const r=Number(t==null?void 0:t.lat),s=Number(t==null?void 0:t.lng),o=Number(e==null?void 0:e.lat),v=Number(e==null?void 0:e.lng);if(!Number.isFinite(r)||!Number.isFinite(s)||!Number.isFinite(o)||!Number.isFinite(v))return 0;const p=6371e3,d=te=>Number(te)*Math.PI/180,b=d(o-r),x=d(v-s),N=Math.sin(b/2),h=Math.sin(x/2),T=N*N+Math.cos(d(r))*Math.cos(d(o))*h*h;return 2*p*Math.asin(Math.min(1,Math.sqrt(T)))}function la(t){const e=Array.isArray(t)?t:[];if(e.length<2)return 0;let r=0;for(let s=1;s<e.length;s+=1)r+=Ta(e[s-1],e[s]);return r}function ra(t){const e=Number(t);if(!Number.isFinite(e)||e<=0)return"-";if(e<1e3)return`${Math.round(e)} m`;const r=e/1e3;return`${r.toFixed(r<10?2:1)} km`}function Ot(){var t;return De.value?(c&&c.error(De.value),!1):!S||!((t=window.google)!=null&&t.maps)?(c&&c.error("Peta belum siap."),!1):!0}const q=k(!1),Ye=k("create"),Qe=k(!1),ge=k({}),Fe=k(!0),Ue=k(!1),g=k({id:null,name:"",code:"",cable_type:"",core_count:"",map_color:"#2563eb",from_point_id:"",to_point_id:"",path:[],length_m:"",notes:""}),sa=F(()=>Math.round(la(g.value.path)));function Ia(){g.value={id:null,name:"",code:"",cable_type:"",core_count:"",map_color:"#2563eb",from_point_id:"",to_point_id:"",path:[],length_m:"",notes:""},ge.value={},Fe.value=!0,Ue.value=!1}function La(){W.value&&(Ia(),Ye.value="create",Ne=[],Fe.value=!0,Ue.value=!0,q.value=!0,ne.value=null,D({reopen:!1}))}function Oa(t){if(!B.value)return;Ia(),Ye.value="edit",Ne=[],g.value={id:t.id,name:t.name||"",code:t.code||"",cable_type:t.cable_type||"",core_count:t.core_count??"",map_color:t.map_color||"#2563eb",from_point_id:t.from_point_id??"",to_point_id:t.to_point_id??"",path:Array.isArray(t.path)?t.path.slice():[],length_m:t.length_m??"",notes:t.notes||""},Fe.value=!(g.value.length_m!==""&&g.value.length_m!==null&&g.value.length_m!==void 0),Ue.value=!1,q.value=!0,ne.value=null,D({reopen:!1});const e=(g.value.path||[])[0];e&&Number.isFinite(Number(e.lat))&&Number.isFinite(Number(e.lng))&&ye(Number(e.lat),Number(e.lng),16)}function El(t){var o;if(!S||!((o=window.google)!=null&&o.maps))return;const e=Array.isArray(t)?t:[];if(e.length<1)return;const r=new window.google.maps.LatLngBounds;let s=!1;if(e.forEach(v=>{const p=Number(v==null?void 0:v.lat),d=Number(v==null?void 0:v.lng);!Number.isFinite(p)||!Number.isFinite(d)||(r.extend({lat:p,lng:d}),s=!0)}),!!s)try{S.fitBounds(r)}catch{}}async function $a(t={}){var x;const e=(t==null?void 0:t.force)===!0,r=Number(g.value.from_point_id||0),s=Number(g.value.to_point_id||0);if(!r||!s)return c&&c.error("Pilih Dari Titik dan Ke Titik dulu."),!1;if(r===s)return c&&c.error("Dari Titik dan Ke Titik tidak boleh sama."),!1;const o=Tt(r),v=Tt(s);if(!o||!v)return c&&c.error("Koordinat titik belum lengkap. Isi latitude/longitude di data Titik."),!1;const p=Array.isArray(g.value.path)&&g.value.path.length>=2;if(p&&!e||p&&e&&!confirm("Jalur sudah ada. Timpa jalur dengan jalur otomatis dari titik?"))return!1;let d=[];const b=!!ie.value;if(b&&((x=window.google)!=null&&x.maps))try{d=await ka(o,v)}catch(N){d=[],c&&c.error((N==null?void 0:N.message)||"Gagal mengikuti jalan. Pakai garis lurus.")}return(!Array.isArray(d)||d.length<2)&&(d=[o,v]),Ne=[],g.value.path=d,be(),El(d),Fe.value=!0,g.value.length_m=Math.round(la(d)),c&&c.success(b?"Jalur otomatis dibuat (ikut jalan).":"Jalur otomatis dibuat."),!0}function Tl(t,e,r){const s=Number(t==null?void 0:t.lng)-Number(e==null?void 0:e.lng),o=Number(t==null?void 0:t.lat)-Number(e==null?void 0:e.lat),v=Number(r==null?void 0:r.lng)-Number(e==null?void 0:e.lng),p=Number(r==null?void 0:r.lat)-Number(e==null?void 0:e.lat),d=Math.hypot(s,o),b=Math.hypot(v,p);if(!Number.isFinite(d)||!Number.isFinite(b)||d===0||b===0)return 0;const x=s*v+o*p,N=Math.max(-1,Math.min(1,x/(d*b))),h=Math.acos(N)*180/Math.PI;return Math.max(0,180-h)}function Il(t){const e=Array.isArray(t)?t:[];if(e.length<3)return[];const r=[];for(let s=1;s<e.length-1;s+=1){const o=e[s-1],v=e[s],p=e[s+1],d=Number(v==null?void 0:v.lat),b=Number(v==null?void 0:v.lng);if(!Number.isFinite(d)||!Number.isFinite(b))continue;const x=Tl(o,v,p);x<Fd||ya(d,b,Nt)||r.push({lat:ue(d),lng:ue(b),turn_deg:Math.round(x)})}return r.slice(0,24)}async function Ll(){var h,T,te,V,mt;Qe.value=!0,ge.value={};const t=g.value.from_point_id!==""?Number(g.value.from_point_id):null,e=g.value.to_point_id!==""?Number(g.value.to_point_id):null;if(!t||!e){Qe.value=!1,c&&c.error("Dari Titik dan Ke Titik wajib diisi.");return}if(Number(t)===Number(e)){Qe.value=!1,c&&c.error("Dari Titik dan Ke Titik tidak boleh sama.");return}let r=Array.isArray(g.value.path)&&g.value.path.length>=2?g.value.path.slice():null;const s=Tt(t),o=Tt(e);s&&o&&(!Array.isArray(r)||r.length<2?r=[s,o]:(r[0]={lat:s.lat,lng:s.lng},r[r.length-1]={lat:o.lat,lng:o.lng})),Array.isArray(r)&&(g.value.path=r);const v=Il(r||[]);let p=[];v.length>0&&confirm(`Ditemukan ${v.length} titik belok yang belum punya node. Buat titik FO otomatis (JOINT_CLOSURE)?`)&&(p=v.map(Re=>({lat:Re.lat,lng:Re.lng})));const d={name:g.value.name,code:g.value.code||null,cable_type:g.value.cable_type||null,core_count:g.value.core_count!==""?Number(g.value.core_count):null,map_color:g.value.map_color||null,from_point_id:t,to_point_id:e,path:r,length_m:g.value.length_m!==""&&g.value.length_m!==null&&g.value.length_m!==void 0?Number(g.value.length_m):null,auto_mid_points:p.length>0?p:void 0,auto_mid_point_type:p.length>0?"JOINT_CLOSURE":void 0,auto_mid_point_prefix:p.length>0?"NODE AUTO":void 0,notes:g.value.notes||null},b=Ye.value==="edit"&&g.value.id,x=b?`/api/v1/fiber/cables/${g.value.id}`:"/api/v1/fiber/cables",N=b?"PUT":"POST";try{const J=await K(x,{method:N,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!J.ok)throw J.status===422&&((h=J.data)!=null&&h.errors)?(ge.value=J.data.errors,new Error(((T=J.data)==null?void 0:T.message)||"Validasi gagal.")):new Error(((te=J.data)==null?void 0:te.message)||`Gagal menyimpan kabel (HTTP ${J.status}).`);q.value=!1,D(),await j(),c&&c.success("Kabel tersimpan.");const Re=Array.isArray((mt=(V=J.data)==null?void 0:V.meta)==null?void 0:mt.auto_mid_points_created)?J.data.meta.auto_mid_points_created:[];Re.length>0&&c&&c.info(`Node otomatis dibuat: ${Re.length} titik.`)}catch(J){console.error("Fiber: saveCable failed",J),c&&c.error((J==null?void 0:J.message)||"Gagal menyimpan kabel.")}finally{Qe.value=!1}}async function Ol(t){var r;if(!(!fe.value||!confirm(`Hapus kabel "${(t==null?void 0:t.name)||""}"?`)))try{const s=await K(`/api/v1/fiber/cables/${t.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((r=s.data)==null?void 0:r.message)||`Gagal hapus kabel (HTTP ${s.status}).`);c&&c.success("Kabel dihapus."),Number(re.value)===Number(t.id)&&(re.value=null),await j()}catch(s){console.error("Fiber: deleteCable failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus kabel.")}}function $l(){q.value&&Ot()&&(ne.value="cable",q.value=!1,Ne=[],E.value="drawCable",be(),c&&c.info(ie.value?"Mode gambar jalur aktif (ikut jalan): klik peta untuk set titik berikutnya, lalu klik Selesai untuk kembali.":"Mode gambar jalur aktif: klik peta untuk menambah titik, lalu klik Selesai untuk kembali."))}function Fl(){if(!q.value||!Ot())return;if((Array.isArray(g.value.path)?g.value.path:[]).length<2){c&&c.error("Jalur belum ada. Klik Gambar dulu minimal 2 titik.");return}ne.value="cable",q.value=!1,E.value="editCable",be(),c&&c.info("Mode edit jalur aktif: geser titik/segmen di peta, lalu klik Selesai untuk kembali.")}function Fa(){const t=Array.isArray(g.value.path)?g.value.path:[];if(t.length!==0){if(Ne.length>0){const e=Number(Ne.pop());Number.isFinite(e)&&e>=0?g.value.path=t.slice(0,e):(t.pop(),g.value.path=t)}else t.pop(),g.value.path=t;be()}}function oa(){g.value.path=[],Ne=[],be()}function Ul(){const t=Number(sa.value||0);if(!Number.isFinite(t)||t<=0){c&&c.error("Tidak ada jalur untuk dihitung.");return}g.value.length_m=Math.round(t),Fe.value=!0,c&&c.success("Panjang kabel diisi dari jalur.")}const de=k(!1),$t=k("create"),Ft=k(!1),Ce=k({}),P=k({id:null,name:"",point_type:"",latitude:null,longitude:null,address:"",notes:""});function Ua(){P.value={id:null,name:"",point_type:"",latitude:null,longitude:null,address:"",notes:""},Ce.value={}}function Ma(){W.value&&(Ua(),$t.value="create",de.value=!0,ne.value=null,D({reopen:!1}))}function Ra(t){if(!B.value)return;Ua(),$t.value="edit",P.value={id:t.id,name:t.name||"",point_type:t.point_type||"",latitude:t.latitude??null,longitude:t.longitude??null,address:t.address||"",notes:t.notes||""},de.value=!0,ne.value=null,D({reopen:!1});const e=Number(P.value.latitude),r=Number(P.value.longitude);Number.isFinite(e)&&Number.isFinite(r)&&ye(e,r,17)}function Ml(){de.value&&Ot()&&(ne.value="point",de.value=!1,E.value="pickPoint",be(),c&&c.info("Klik peta untuk memilih lokasi titik."))}async function Rl(){var o,v,p;Ft.value=!0,Ce.value={};const t={name:P.value.name,point_type:P.value.point_type||null,latitude:P.value.latitude,longitude:P.value.longitude,address:P.value.address||null,notes:P.value.notes||null},e=$t.value==="edit"&&P.value.id,r=e?`/api/v1/fiber/points/${P.value.id}`:"/api/v1/fiber/points",s=e?"PUT":"POST";try{const d=await K(r,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!d.ok)throw d.status===422&&((o=d.data)!=null&&o.errors)?(Ce.value=d.data.errors,new Error(((v=d.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((p=d.data)==null?void 0:p.message)||`Gagal menyimpan titik (HTTP ${d.status}).`);de.value=!1,D(),await j(),c&&c.success("Titik tersimpan.")}catch(d){console.error("Fiber: savePoint failed",d),c&&c.error((d==null?void 0:d.message)||"Gagal menyimpan titik.")}finally{Ft.value=!1}}async function Al(t){var r;if(!(!fe.value||!confirm(`Hapus titik "${(t==null?void 0:t.name)||""}"?`)))try{const s=await K(`/api/v1/fiber/points/${t.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((r=s.data)==null?void 0:r.message)||`Gagal hapus titik (HTTP ${s.status}).`);c&&c.success("Titik dihapus."),Number(se.value)===Number(t.id)&&(se.value=null),await j()}catch(s){console.error("Fiber: deletePoint failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus titik.")}}const ve=k(!1),Ut=k("create"),Mt=k(!1),je=k({}),m=k({id:null,cable_id:"",point_id:"",core_no:"",status:"OPEN",severity:"",reported_at:"",repair_started_at:"",fixed_at:"",verified_at:"",verified_by_name:"",technician_name:"",repair_photos_text:"",repair_materials_text:"",closure_point_id:"",latitude:null,longitude:null,description:""});function Aa(){m.value={id:null,cable_id:"",point_id:"",core_no:"",status:"OPEN",severity:"",reported_at:"",repair_started_at:"",fixed_at:"",verified_at:"",verified_by_name:"",technician_name:"",repair_photos_text:"",repair_materials_text:"",closure_point_id:"",latitude:null,longitude:null,description:""},je.value={}}function Da(){W.value&&(Aa(),Ut.value="create",ve.value=!0,ne.value=null,D({reopen:!1}))}function Va(t){if(!B.value)return;Aa(),Ut.value="edit",m.value={id:t.id,cable_id:t.cable_id??"",point_id:t.point_id??"",core_no:t.core_no??"",status:(t.status||"OPEN").toString().toUpperCase(),severity:t.severity||"",reported_at:It(t.reported_at),repair_started_at:It(t.repair_started_at),fixed_at:It(t.fixed_at),verified_at:It(t.verified_at),verified_by_name:t.verified_by_name||"",technician_name:t.technician_name||"",repair_photos_text:Array.isArray(t.repair_photos)?t.repair_photos.join(`
`):"",repair_materials_text:Array.isArray(t.repair_materials)?t.repair_materials.join(`
`):"",closure_point_id:t.closure_point_id??"",latitude:t.latitude??null,longitude:t.longitude??null,description:t.description||""},ve.value=!0,ne.value=null,D({reopen:!1});const e=Number(m.value.latitude),r=Number(m.value.longitude);Number.isFinite(e)&&Number.isFinite(r)&&ye(e,r,17)}function Dl(){ve.value&&Ot()&&(ne.value="break",ve.value=!1,E.value="pickBreak",be(),c&&c.info("Klik peta untuk memilih lokasi putus."))}async function Vl(){var o,v,p;Mt.value=!0,je.value={};const t={cable_id:m.value.cable_id!==""?Number(m.value.cable_id):null,point_id:m.value.point_id!==""?Number(m.value.point_id):null,core_no:m.value.core_no!==""?Number(m.value.core_no):null,status:(m.value.status||"OPEN").toString().toUpperCase(),severity:m.value.severity||null,reported_at:m.value.reported_at||null,repair_started_at:m.value.repair_started_at||null,fixed_at:m.value.fixed_at||null,verified_at:m.value.verified_at||null,verified_by_name:m.value.verified_by_name||null,technician_name:m.value.technician_name||null,repair_photos:String(m.value.repair_photos_text||"").split(`
`).map(d=>d.trim()).filter(d=>d.length>0),repair_materials:String(m.value.repair_materials_text||"").split(`
`).map(d=>d.trim()).filter(d=>d.length>0),closure_point_id:m.value.closure_point_id!==""?Number(m.value.closure_point_id):null,latitude:m.value.latitude,longitude:m.value.longitude,description:m.value.description||null},e=Ut.value==="edit"&&m.value.id,r=e?`/api/v1/fiber/breaks/${m.value.id}`:"/api/v1/fiber/breaks",s=e?"PUT":"POST";try{const d=await K(r,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!d.ok)throw d.status===422&&((o=d.data)!=null&&o.errors)?(je.value=d.data.errors,new Error(((v=d.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((p=d.data)==null?void 0:p.message)||`Gagal menyimpan data putus (HTTP ${d.status}).`);ve.value=!1,D(),await j(),c&&c.success("Data putus tersimpan.")}catch(d){console.error("Fiber: saveBreak failed",d),c&&c.error((d==null?void 0:d.message)||"Gagal menyimpan data putus.")}finally{Mt.value=!1}}async function jl(t){var r;if(!(!fe.value||!confirm("Hapus data putus ini?")))try{const s=await K(`/api/v1/fiber/breaks/${t.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((r=s.data)==null?void 0:r.message)||`Gagal hapus data putus (HTTP ${s.status}).`);c&&c.success("Data putus dihapus."),Number(he.value)===Number(t.id)&&(he.value=null),await j()}catch(s){console.error("Fiber: deleteBreak failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus data putus.")}}const nt=k({}),Pe=k({});function ja(t){var r;const e=String(Number(t||0));return!!((r=nt.value)!=null&&r[e])}function Rt(t){var r;const e=String(Number(t||0));return!!((r=Pe.value)!=null&&r[e])}async function Gl(t){var s;if(!B.value)return;const e=String((t==null?void 0:t.status)||"OPEN").toUpperCase();if(!["OPEN","IN_PROGRESS"].includes(e))return;const r=String(Number((t==null?void 0:t.id)||0));Pe.value={...Pe.value||{},[r]:!0};try{const o=await K(`/api/v1/fiber/breaks/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"IN_PROGRESS",repair_started_at:(t==null?void 0:t.repair_started_at)||null})});if(!o.ok)throw new Error(((s=o.data)==null?void 0:s.message)||`Gagal update status (HTTP ${o.status}).`);await j(),c&&c.success("Status putus menjadi IN_PROGRESS.")}catch(o){console.error("Fiber: markBreakInProgress failed",o),c&&c.error((o==null?void 0:o.message)||"Gagal update status putus.")}finally{const o={...Pe.value||{}};delete o[r],Pe.value=o}}async function Bl(t){var o,v,p,d,b;if(!B.value)return;const e=String((t==null?void 0:t.status)||"").toUpperCase();if(!["FIXED","VERIFIED"].includes(e)){c&&c.info("Verifikasi hanya untuk status FIXED.");return}if(!confirm("Verifikasi data putus ini? Status akan menjadi VERIFIED."))return;const s=String(Number((t==null?void 0:t.id)||0));Pe.value={...Pe.value||{},[s]:!0};try{const x=((v=(o=Ct.props.auth)==null?void 0:o.user)==null?void 0:v.name)||((d=(p=Ct.props.auth)==null?void 0:p.user)==null?void 0:d.username)||"",N=await K(`/api/v1/fiber/breaks/${t.id}/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({verified_by_name:x||null})});if(!N.ok)throw new Error(((b=N.data)==null?void 0:b.message)||`Gagal verifikasi (HTTP ${N.status}).`);await j(),c&&c.success("Data putus terverifikasi.")}catch(x){console.error("Fiber: verifyBreak failed",x),c&&c.error((x==null?void 0:x.message)||"Gagal verifikasi data putus.")}finally{const x={...Pe.value||{}};delete x[s],Pe.value=x}}async function Kl(t){var o,v,p;if(!B.value||!W.value)return;const e=String((t==null?void 0:t.status)||"OPEN").toUpperCase();if(!["OPEN","IN_PROGRESS"].includes(e)){c&&c.info("Status putus sudah bukan OPEN/IN_PROGRESS.");return}if(!confirm("Selesaikan data putus ini? Sistem akan membuat titik JOINT_CLOSURE di lokasi putus dan mengubah status menjadi FIXED."))return;const s=String(Number((t==null?void 0:t.id)||0));nt.value={...nt.value||{},[s]:!0};try{const d=Z(t==null?void 0:t.cable_id)||(t!=null&&t.cable_id?`Kabel #${t.cable_id}`:""),b=(d?`JC - ${d}`:`Joint Closure - Break #${(t==null?void 0:t.id)||""}`).slice(0,160),x=await K(`/api/v1/fiber/breaks/${t.id}/fix`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({joint_name:b,joint_type:"JOINT_CLOSURE",joint_notes:`Auto dari data putus #${(t==null?void 0:t.id)||""}`})});if(!x.ok)throw new Error(((o=x.data)==null?void 0:o.message)||`Gagal menyelesaikan putus (HTTP ${x.status}).`);await j();const N=((p=(v=x.data)==null?void 0:v.data)==null?void 0:p.joint_point)||null,h=Number(N==null?void 0:N.latitude),T=Number(N==null?void 0:N.longitude);Number.isFinite(h)&&Number.isFinite(T)&&ye(h,T,18),c&&c.success("Data putus diselesaikan. Titik Joint Closure dibuat.")}catch(d){console.error("Fiber: fixBreakWithJoint failed",d),c&&c.error((d==null?void 0:d.message)||"Gagal menyelesaikan putus.")}finally{const d={...nt.value||{}};delete d[s],nt.value=d}}const Ge=k(!1),At=k("create"),Dt=k(!1),Be=k({}),R=k({id:null,point_id:"",port_type:"OLT_PON",port_label:"",cable_id:"",core_no:"",notes:""});function Ga(){R.value={id:null,point_id:"",port_type:"OLT_PON",port_label:"",cable_id:"",core_no:"",notes:""},Be.value={}}function Hl(){W.value&&(Ga(),se.value&&(R.value.point_id=String(se.value)),At.value="create",Ge.value=!0)}function Jl(t){B.value&&(Ga(),At.value="edit",R.value={id:t.id,point_id:t.point_id??"",port_type:t.port_type||"OLT_PON",port_label:t.port_label||"",cable_id:t.cable_id??"",core_no:t.core_no??"",notes:t.notes||""},Ge.value=!0)}async function zl(){var o,v,p;Dt.value=!0,Be.value={};const t={point_id:R.value.point_id!==""?Number(R.value.point_id):null,port_type:(R.value.port_type||"OLT_PON").toString().toUpperCase(),port_label:R.value.port_label||"",cable_id:R.value.cable_id!==""?Number(R.value.cable_id):null,core_no:R.value.core_no!==""?Number(R.value.core_no):null,notes:R.value.notes||null},e=At.value==="edit"&&R.value.id,r=e?`/api/v1/fiber/ports/${R.value.id}`:"/api/v1/fiber/ports",s=e?"PUT":"POST";try{const d=await K(r,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!d.ok)throw d.status===422&&((o=d.data)!=null&&o.errors)?(Be.value=d.data.errors,new Error(((v=d.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((p=d.data)==null?void 0:p.message)||`Gagal menyimpan port (HTTP ${d.status}).`);Ge.value=!1,await j(),c&&c.success("Port tersimpan.")}catch(d){console.error("Fiber: savePort failed",d),c&&c.error((d==null?void 0:d.message)||"Gagal menyimpan port.")}finally{Dt.value=!1}}async function Xl(t){var r;if(!(!fe.value||!confirm(`Hapus port "${(t==null?void 0:t.port_label)||""}"?`)))try{const s=await K(`/api/v1/fiber/ports/${t.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((r=s.data)==null?void 0:r.message)||`Gagal hapus port (HTTP ${s.status}).`);c&&c.success("Port dihapus."),await j()}catch(s){console.error("Fiber: deletePort failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus port.")}}const Me=k(!1),Vt=k("create"),jt=k(!1),Se=k({}),it=k(8),_=k({id:null,point_id:"",link_type:"SPLICE",from_cable_id:"",from_core_no:"",to_cable_id:"",to_core_no:"",split_group:"",outputs:[],loss_db:"",notes:""}),Gt=F(()=>{const t=Array.isArray(lt.value)?lt.value:[],e=[],r={};return t.forEach(s=>{const o=((s==null?void 0:s.link_type)||"").toString().toUpperCase(),v=((s==null?void 0:s.split_group)||"").toString();if(o==="SPLIT"&&v){const p=`${Number(s.point_id)||0}|${v}`;r[p]||(r[p]={kind:"SPLIT_GROUP",id:s.id,point_id:s.point_id,link_type:"SPLIT",split_group:v,from_cable_id:s.from_cable_id,from_core_no:s.from_core_no,loss_db:s.loss_db??null,notes:s.notes||"",outputs:[],link_ids:[]}),r[p].outputs.push({to_cable_id:s.to_cable_id,to_core_no:s.to_core_no}),r[p].link_ids.push(s.id);return}e.push({kind:"LINK",...s||{}})}),Object.values(r).forEach(s=>{s.outputs=(s.outputs||[]).filter(o=>(o==null?void 0:o.to_cable_id)&&(o==null?void 0:o.to_core_no)),e.push(s)}),e.sort((s,o)=>{const v=Number((s==null?void 0:s.point_id)||0),p=Number((o==null?void 0:o.point_id)||0);if(v!==p)return v-p;const d=((s==null?void 0:s.link_type)||"").toString(),b=((o==null?void 0:o.link_type)||"").toString();return d.localeCompare(b)}),e}),ut=F(()=>(U.value||"").toString().toLowerCase().trim()),dt=F(()=>{const t=String(I.value||"cables");return t==="cables"?"Cari kabel (nama/kode/tipe/titik)...":t==="points"?"Cari titik (nama/tipe)...":t==="ports"?"Cari port (label/tipe/kabel/titik)...":t==="links"?"Cari sambungan (titik/kabel/core)...":t==="cores"?"Cari core...":t==="breaks"?"Cari putus (kabel/titik/status)...":"Cari..."});function M(t,e){return(t||"").toString().toLowerCase().includes(e)}const na=F(()=>{const t=Array.isArray(z.value)?z.value:[],e=ut.value;return e?t.filter(r=>{const s=H(r==null?void 0:r.from_point_id)||"",o=H(r==null?void 0:r.to_point_id)||"";return M(r==null?void 0:r.name,e)||M(r==null?void 0:r.code,e)||M(r==null?void 0:r.cable_type,e)||M(s,e)||M(o,e)}):t}),ia=F(()=>{const t=Array.isArray(X.value)?X.value:[],e=ut.value;return e?t.filter(r=>M(r==null?void 0:r.name,e)||M(r==null?void 0:r.point_type,e)||M(r==null?void 0:r.address,e)||M(r==null?void 0:r.notes,e)):t}),ua=F(()=>{const t=Array.isArray(_e.value)?_e.value:[],e=ut.value;return e?t.filter(r=>{const s=H(r==null?void 0:r.point_id)||"",o=Z(r==null?void 0:r.cable_id)||"";return M(r==null?void 0:r.port_label,e)||M(r==null?void 0:r.port_type,e)||M(s,e)||M(o,e)||M(String((r==null?void 0:r.core_no)??""),e)}):t}),da=F(()=>{const t=Array.isArray(Gt.value)?Gt.value:[],e=ut.value;return e?t.filter(r=>{const s=H(r==null?void 0:r.point_id)||"",o=Z(r==null?void 0:r.from_cable_id)||"",v=Z(r==null?void 0:r.to_cable_id)||"",p=((r==null?void 0:r.link_type)||"").toString().toUpperCase();let d="";return(r==null?void 0:r.kind)==="SPLIT_GROUP"&&(d=((r==null?void 0:r.outputs)||[]).map(b=>`${Z(b==null?void 0:b.to_cable_id)||""}:${(b==null?void 0:b.to_core_no)??""}`).join(" ")),M(p,e)||M(s,e)||M(o,e)||M(v,e)||M(r==null?void 0:r.split_group,e)||M(String((r==null?void 0:r.from_core_no)??""),e)||M(String((r==null?void 0:r.to_core_no)??""),e)||M(d,e)}):t}),va=F(()=>{const t=Array.isArray(me.value)?me.value:[],e=ut.value,r=String(Q.value||"ALL").toUpperCase();return t.filter(s=>{const o=String((s==null?void 0:s.status)||"OPEN").toUpperCase();if(r!=="ALL"&&o!==r)return!1;if(!e)return!0;const v=Z(s==null?void 0:s.cable_id)||"",p=H(s==null?void 0:s.point_id)||"";return M(o,e)||M(s==null?void 0:s.severity,e)||M(v,e)||M(p,e)||M(s==null?void 0:s.description,e)})}),ce=k(""),Bt=k(!1),vt=k(!1),Ke=k(""),ct=k({FREE:0,USED:0,RESERVED:0,BROKEN:0}),pt=k([]),bt=k([]),gt=k(null),ee=F(()=>{const t=Number(gt.value||0);return t&&(pt.value||[]).find(e=>Number(e==null?void 0:e.core_no)===t)||null});function Zl(t){const e=String(t||"").toUpperCase();return e==="BROKEN"?"border-red-300 bg-red-50 text-red-700 dark:border-red-900/40 dark:bg-red-900/20 dark:text-red-200":e==="USED"?"border-blue-300 bg-blue-50 text-blue-700 dark:border-blue-900/40 dark:bg-blue-900/20 dark:text-blue-200":e==="RESERVED"?"border-amber-300 bg-amber-50 text-amber-700 dark:border-amber-900/40 dark:bg-amber-900/20 dark:text-amber-200":"border-gray-200 bg-white text-gray-700 dark:border-white/10 dark:bg-dark-800 dark:text-gray-200"}function ql(t){return(bt.value||[]).includes(Number(t))}function Wl(t){const e=Number(t||0);if(!e)return;const r=new Set((bt.value||[]).map(s=>Number(s)));r.has(e)?r.delete(e):r.add(e),bt.value=Array.from(r).filter(s=>Number.isFinite(s)&&s>0).sort((s,o)=>s-o)}async function He(t){var r,s,o,v,p,d,b,x,N;const e=Number(t||0);if(e){ce.value=String(e),Bt.value=!0,Ke.value="",gt.value=null;try{const h=await K(`/api/v1/fiber/cables/${e}/core-occupancy`);if(!h.ok)throw new Error(((r=h.data)==null?void 0:r.message)||`Gagal memuat core occupancy (HTTP ${h.status}).`);ct.value=((o=(s=h.data)==null?void 0:s.data)==null?void 0:o.summary)||{FREE:0,USED:0,RESERVED:0,BROKEN:0},pt.value=Array.isArray((p=(v=h.data)==null?void 0:v.data)==null?void 0:p.cores)?h.data.data.cores:[],bt.value=Array.isArray((x=(b=(d=h.data)==null?void 0:d.data)==null?void 0:b.cable)==null?void 0:x.reserved_cores)?h.data.data.cable.reserved_cores.map(T=>Number(T)):[],pt.value.length>0&&(gt.value=Number(((N=pt.value[0])==null?void 0:N.core_no)||0))}catch(h){console.error("Fiber: loadCoreOccupancy failed",h),Ke.value=(h==null?void 0:h.message)||"Gagal memuat data core."}finally{Bt.value=!1}}}function ca(t=null){const e=Number((t==null?void 0:t.id)||re.value||0);if(!e){c&&c.info("Pilih kabel dulu untuk melihat core.");return}re.value=e,I.value="cores",He(e)}async function Yl(){var e;const t=Number(ce.value||0);if(t){vt.value=!0,Ke.value="";try{const r=await K(`/api/v1/fiber/cables/${t}/core-reservations`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({reserved_cores:(bt.value||[]).map(s=>Number(s)).filter(s=>Number.isFinite(s)&&s>0)})});if(!r.ok)throw new Error(((e=r.data)==null?void 0:e.message)||`Gagal menyimpan reservasi core (HTTP ${r.status}).`);await He(t),await j(),c&&c.success("Reservasi core tersimpan.")}catch(r){console.error("Fiber: saveCoreReservations failed",r),Ke.value=(r==null?void 0:r.message)||"Gagal menyimpan reservasi core.",c&&c.error(Ke.value)}finally{vt.value=!1}}}function Ba(){_.value={id:null,point_id:"",link_type:"SPLICE",from_cable_id:"",from_core_no:"",to_cable_id:"",to_core_no:"",split_group:"",outputs:[],loss_db:"",notes:""},Se.value={},it.value=8}function Ql(t){const e=Math.max(1,Math.min(64,Number(t)||1));_.value.outputs=Array.from({length:e}).map(()=>({to_cable_id:"",to_core_no:""}))}function er(){const t=Array.isArray(_.value.outputs)?_.value.outputs:[];t.push({to_cable_id:"",to_core_no:""}),_.value.outputs=t}function tr(t){const e=Array.isArray(_.value.outputs)?_.value.outputs:[];t<0||t>=e.length||(e.splice(t,1),_.value.outputs=e)}function ar(){W.value&&(Ba(),se.value&&(_.value.point_id=String(se.value)),Vt.value="create",Me.value=!0)}function lr(t){if(B.value){if(Ba(),Vt.value="edit",(t==null?void 0:t.kind)==="SPLIT_GROUP"){_.value={id:t.id,point_id:t.point_id??"",link_type:"SPLIT",from_cable_id:t.from_cable_id??"",from_core_no:t.from_core_no??"",to_cable_id:"",to_core_no:"",split_group:t.split_group||"",outputs:(t.outputs||[]).map(e=>({to_cable_id:e.to_cable_id??"",to_core_no:e.to_core_no??""})),loss_db:t.loss_db??"",notes:t.notes||""},it.value=(_.value.outputs||[]).length||8,Me.value=!0;return}_.value={id:t.id,point_id:t.point_id??"",link_type:(t.link_type||"SPLICE").toString().toUpperCase(),from_cable_id:t.from_cable_id??"",from_core_no:t.from_core_no??"",to_cable_id:t.to_cable_id??"",to_core_no:t.to_core_no??"",split_group:t.split_group||"",outputs:[],loss_db:t.loss_db??"",notes:t.notes||""},Me.value=!0}}async function rr(){var v,p,d;jt.value=!0,Se.value={};const t=(_.value.link_type||"SPLICE").toString().toUpperCase(),e={point_id:_.value.point_id!==""?Number(_.value.point_id):null,link_type:t,from_cable_id:_.value.from_cable_id!==""?Number(_.value.from_cable_id):null,from_core_no:_.value.from_core_no!==""?Number(_.value.from_core_no):null,split_group:_.value.split_group||null,loss_db:_.value.loss_db!==""?Number(_.value.loss_db):null,notes:_.value.notes||null};if(t==="SPLIT"){const b=Array.isArray(_.value.outputs)?_.value.outputs:[];e.outputs=b.map(x=>({to_cable_id:x.to_cable_id!==""?Number(x.to_cable_id):null,to_core_no:x.to_core_no!==""?Number(x.to_core_no):null})).filter(x=>x.to_cable_id&&x.to_core_no)}else e.to_cable_id=_.value.to_cable_id!==""?Number(_.value.to_cable_id):null,e.to_core_no=_.value.to_core_no!==""?Number(_.value.to_core_no):null;const r=Vt.value==="edit"&&_.value.id,s=r?`/api/v1/fiber/links/${_.value.id}`:"/api/v1/fiber/links",o=r?"PUT":"POST";try{const b=await K(s,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!b.ok)throw b.status===422&&((v=b.data)!=null&&v.errors)?(Se.value=b.data.errors,new Error(((p=b.data)==null?void 0:p.message)||"Validasi gagal.")):new Error(((d=b.data)==null?void 0:d.message)||`Gagal menyimpan sambungan (HTTP ${b.status}).`);Me.value=!1,await j(),c&&c.success("Sambungan tersimpan.")}catch(b){console.error("Fiber: saveLink failed",b),c&&c.error((b==null?void 0:b.message)||"Gagal menyimpan sambungan.")}finally{jt.value=!1}}async function sr(t){var s;if(!fe.value)return;const e=(t==null?void 0:t.kind)==="SPLIT_GROUP"?`splitter "${(t==null?void 0:t.split_group)||""}"`:"sambungan ini";if(confirm(`Hapus ${e}?`))try{const o=await K(`/api/v1/fiber/links/${t.id}`,{method:"DELETE"});if(!o.ok)throw new Error(((s=o.data)==null?void 0:s.message)||`Gagal hapus sambungan (HTTP ${o.status}).`);c&&c.success("Sambungan dihapus."),await j()}catch(o){console.error("Fiber: deleteLink failed",o),c&&c.error((o==null?void 0:o.message)||"Gagal hapus sambungan.")}}const ft=k(""),et=k(!1),tt=k(""),Je=k(null),or=F(()=>(_e.value||[]).filter(t=>((t==null?void 0:t.port_type)||"").toString().toUpperCase()==="OLT_PON"));function nr(){we.value=null,tt.value="",Je.value=null,Et.value=[],ot()}async function ir(){var t,e,r,s,o,v;if(ft.value){et.value=!0,tt.value="",we.value=null,Je.value=null,Et.value=[];try{const p=await K(`/api/v1/fiber/trace/${Number(ft.value)}?stop_at_odp_out=1`);if(!p.ok)throw new Error(((t=p.data)==null?void 0:t.message)||`Gagal trace (HTTP ${p.status}).`);we.value=((e=p.data)==null?void 0:e.data)||null,Et.value=((s=(r=p.data)==null?void 0:r.data)==null?void 0:s.used_cable_ids)||[],ot();const d=((v=(o=p.data)==null?void 0:o.data)==null?void 0:v.endpoints)||[];d.length>0&&(Je.value=d[0]),c&&c.success("Trace selesai.")}catch(p){console.error("Fiber: runTrace failed",p),tt.value=(p==null?void 0:p.message)||"Gagal trace.",c&&c.error(tt.value)}finally{et.value=!1}}}return pe([ze,Xe,Ze],()=>{_a()}),pe(re,t=>{I.value==="cores"&&Number(t||0)>0&&He(t)}),pe(I,t=>{if(U.value="",t==="cores"){const e=Number(ce.value||re.value||0);e>0&&He(e)}}),pe(E,t=>{t&&(oe.value=!1)}),pe(qe,()=>{Qa(()=>fa())}),pe(q,t=>{if(!t){Ue.value=!1;return}Ye.value==="create"&&(Ue.value=!0)}),pe([()=>g.value.from_point_id,()=>g.value.to_point_id],async()=>{if(!q.value||Ye.value!=="create"||!Ue.value)return;const t=Number(g.value.from_point_id||0),e=Number(g.value.to_point_id||0);if(!t||!e||t===e)return;if(Array.isArray(g.value.path)&&g.value.path.length>=2){Ue.value=!1;return}await $a({force:!1})&&(Ue.value=!1)}),pe(()=>g.value.path,()=>{if(!Fe.value)return;const t=Math.round(la(g.value.path));Number.isFinite(t)&&t>0&&(g.value.length_m=t)},{deep:!0}),pe(Ve,()=>{try{localStorage.setItem("fiber_map_style",Ve.value)}catch{}ol()}),pe(ie,()=>{try{localStorage.setItem("fiber_follow_road",ie.value?"1":"0")}catch{}}),pe(Ee,()=>{try{localStorage.setItem("fiber_panel_snap",Ee.value)}catch{}}),pe(Te,()=>{try{localStorage.setItem("fiber_legend_collapsed",Te.value?"1":"0")}catch{}}),dr(()=>{try{const e=localStorage.getItem("fiber_map_style");e&&rt[e]&&(Ve.value=e)}catch{}try{const e=localStorage.getItem("fiber_follow_road");e==="0"&&(ie.value=!1),e==="1"&&(ie.value=!0)}catch{}try{const e=localStorage.getItem("fiber_panel_snap");["peek","half","full"].includes(String(e))&&(Ee.value=String(e))}catch{}try{const e=localStorage.getItem("fiber_legend_collapsed");e==="1"&&(Te.value=!0),e==="0"&&(Te.value=!1)}catch{}De.value="";const t=(Kt.googleMapsApiKey||"").toString().trim();if(!t){De.value="Google Maps API key belum di-set. Buka Pengaturan -> System -> Google Maps.",j();return}sl(t).then(()=>{Qa(()=>{nl(),fa(),j()})}).catch(e=>{console.error("Fiber: Google Maps load failed",e),De.value=(e==null?void 0:e.message)||"Gagal memuat Google Maps.",j()})}),vr(()=>{il()}),(t,e)=>(i(),n($,null,[el(cr(pr),{title:"Kabel FO"}),el(fr,null,{default:br(()=>{var r,s,o,v,p,d,b,x,N,h,T,te,V,mt,J,Re,Ka,Ha,Ja,za,Xa,Za,qa,Wa;return[a("div",mr,[a("div",kr,[e[115]||(e[115]=a("div",null,[a("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Manajemen Kabel FO"),a("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Pemetaan jalur kabel, titik sambungan, dan data putus.")],-1)),a("div",yr,[a("div",xr,[a("span",_r,u(xe.value.cables),1),e[112]||(e[112]=a("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"kabel",-1))]),a("div",hr,[a("span",wr,u(xe.value.points),1),e[113]||(e[113]=a("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"titik",-1))]),a("div",Nr,[a("span",Cr,u(xe.value.breaks_open),1),e[114]||(e[114]=a("span",{class:"text-red-600/70 dark:text-red-300/70 ml-1"},"putus aktif",-1))])])]),Kt.warning?(i(),n("div",Pr,u(Kt.warning),1)):f("",!0),ba.value?(i(),n("div",Er,[oe.value?(i(),n("div",{key:0,class:"fixed inset-0 z-[9000] bg-black/35 backdrop-blur-sm lg:hidden",onClick:e[0]||(e[0]=l=>oe.value=!1)})):f("",!0),!oe.value&&!E.value&&!q.value&&!de.value&&!ve.value?(i(),n("div",Tr,[a("div",Ir,[a("div",Lr,[a("button",{class:"btn btn-primary !py-2 !text-[11px]",onClick:e[1]||(e[1]=l=>oe.value=!0)},"Data"),a("button",{class:"btn btn-secondary !py-2 !text-[11px]",disabled:!W.value,onClick:La},"+ Kabel",8,Or),a("button",{class:"btn btn-secondary !py-2 !text-[11px]",disabled:!W.value,onClick:Ma},"+ Titik",8,$r),a("button",{class:"btn btn-secondary !py-2 !text-[11px]",disabled:!W.value,onClick:Da},"+ Putus",8,Fr)])])])):f("",!0),a("div",Ur,[a("div",{class:O(["bg-white dark:bg-dark-800 rounded-xl shadow-card border border-gray-100 dark:border-dark-700 overflow-hidden flex flex-col lg:h-[calc(100vh-13rem)]",qe.value?"lg:col-span-12":"lg:col-span-8"])},[a("div",Mr,[a("div",{ref_key:"mapContainer",ref:Ht,class:"absolute inset-0 w-full h-full bg-slate-100 dark:bg-slate-900"},null,512),a("div",Rr,[a("button",{class:O(["px-3 py-1.5 rounded-lg text-xs font-semibold border transition",ze.value?"bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-900/30 dark:text-blue-200":"bg-white/70 dark:bg-dark-800/70 border-gray-200/70 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[2]||(e[2]=l=>ze.value=!ze.value)}," Kabel ("+u(xe.value.cables)+") ",3),a("button",{class:O(["px-3 py-1.5 rounded-lg text-xs font-semibold border transition",Xe.value?"bg-teal-50 border-teal-200 text-teal-700 dark:bg-teal-900/20 dark:border-teal-900/30 dark:text-teal-200":"bg-white/70 dark:bg-dark-800/70 border-gray-200/70 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[3]||(e[3]=l=>Xe.value=!Xe.value)}," Titik ("+u(xe.value.points)+") ",3),a("button",{class:O(["px-3 py-1.5 rounded-lg text-xs font-semibold border transition",Ze.value?"bg-red-50 border-red-200 text-red-700 dark:bg-red-900/10 dark:border-red-900/30 dark:text-red-300":"bg-white/70 dark:bg-dark-800/70 border-gray-200/70 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[4]||(e[4]=l=>Ze.value=!Ze.value)}," Putus ("+u(xe.value.breaks_open)+") ",3)]),a("div",Ar,[a("div",Dr,[e[117]||(e[117]=a("div",{class:"text-[11px] font-semibold text-gray-700 dark:text-gray-200 uppercase tracking-wide"},"Legend Peta",-1)),a("button",{class:"text-[11px] font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",onClick:e[5]||(e[5]=l=>Te.value=!Te.value)},u(Te.value?"Tampilkan":"Ringkas"),1)]),Te.value?f("",!0):(i(),n("div",Vr,[...e[118]||(e[118]=[a("div",{class:"grid grid-cols-2 gap-2 text-[11px] text-gray-600 dark:text-gray-300"},[a("div",{class:"flex items-center gap-2"},[a("span",{class:"w-5 h-1 rounded-full bg-blue-600"}),a("span",null,"Kabel")]),a("div",{class:"flex items-center gap-2"},[a("span",{class:"w-2.5 h-2.5 rounded-full border-2 border-teal-700 bg-teal-400"}),a("span",null,"Titik")]),a("div",{class:"flex items-center gap-2"},[a("span",{class:"w-2.5 h-2.5 rounded-full border-2 border-red-700 bg-red-500"}),a("span",null,"Putus OPEN")]),a("div",{class:"flex items-center gap-2"},[a("span",{class:"w-2.5 h-2.5 rounded-full border-2 border-amber-700 bg-amber-500"}),a("span",null,"IN PROGRESS")]),a("div",{class:"flex items-center gap-2"},[a("span",{class:"w-2.5 h-2.5 rounded-full border-2 border-emerald-700 bg-emerald-500"}),a("span",null,"FIXED")]),a("div",{class:"flex items-center gap-2"},[a("span",{class:"w-5 h-1 rounded-full bg-sky-700"}),a("span",null,"Trace aktif")])],-1),a("div",{class:"text-[11px] text-gray-500 dark:text-gray-400"}," Klik objek di peta untuk membuka detail cepat. ",-1)])]))]),a("div",jr,[y(a("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>Ve.value=l),class:"input !py-1.5 !text-xs"},[...e[119]||(e[119]=[a("option",{value:"roadmap"},"Roadmap",-1),a("option",{value:"hybrid"},"Hybrid",-1),a("option",{value:"satellite"},"Satelit",-1)])],512),[[G,Ve.value]]),a("button",{onClick:Cl,class:"btn btn-secondary !py-1.5 !text-xs"},"Fit"),a("button",{onClick:j,class:"btn btn-secondary !py-1.5 !text-xs",disabled:at.value},"Refresh",8,Gr),a("button",{class:"btn btn-primary !py-1.5 !text-xs lg:hidden",onClick:e[7]||(e[7]=l=>oe.value=!oe.value)},u(oe.value?"Tutup":"Data"),1),a("button",{class:"btn btn-secondary !py-1.5 !text-xs hidden lg:inline-flex",onClick:e[8]||(e[8]=l=>qe.value=!qe.value)},u(qe.value?"Panel":"Full Map"),1)]),ke.value&&(!oe.value||!Na())?(i(),n("div",{key:0,class:O(["absolute z-20 left-3 right-3 sm:left-auto sm:w-80 bg-white/95 dark:bg-dark-900/90 backdrop-blur rounded-2xl border shadow-xl p-3",[fl.value,E.value?"bottom-36":"bottom-3"]])},[a("div",Br,[a("div",Kr,[a("div",{class:O(["inline-flex px-2 py-1 rounded-full text-[10px] font-bold tracking-wide",ml.value])},u(ke.value.badge),3),a("div",Hr,u(ke.value.title),1),a("div",Jr,u(ke.value.subtitle),1)]),a("button",{class:"text-xs text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:kl},"Tutup")]),a("div",zr,[(i(!0),n($,null,A(ke.value.rows,(l,L)=>(i(),n("div",{key:L,class:"flex items-start justify-between gap-2 text-xs"},[a("span",Xr,u(l.label),1),a("span",Zr,u(l.value),1)]))),128))]),ke.value.note?(i(),n("div",qr,u(ke.value.note),1)):f("",!0),a("div",Wr,[a("button",{class:"btn btn-secondary !py-1.5 !text-xs",onClick:yl},"Zoom"),ke.value.type==="cable"?(i(),n("button",{key:0,class:"btn btn-secondary !py-1.5 !text-xs",onClick:e[9]||(e[9]=l=>ca(Le.value))},"Core")):f("",!0),a("button",{class:"btn btn-secondary !py-1.5 !text-xs lg:hidden",onClick:xl},"Panel"),B.value?(i(),n("button",{key:1,class:"btn btn-primary !py-1.5 !text-xs",onClick:_l},"Edit")):f("",!0)])],2)):f("",!0),De.value?(i(),n("div",Yr,[a("div",Qr,[e[120]||(e[120]=a("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Peta tidak dapat dimuat",-1)),a("div",es,u(De.value),1)])])):f("",!0),E.value?(i(),n("div",ts,[a("div",as,[e[121]||(e[121]=w(" Mode peta aktif: ",-1)),a("span",ls,u(E.value==="drawCable"?"gambar kabel":E.value==="editCable"?"edit jalur":E.value==="pickPoint"?"pilih titik":"pilih putus"),1)]),E.value==="editCable"?(i(),n("div",rs," Geser titik/segmen untuk merapikan jalur, lalu klik tombol Selesai. ")):E.value==="drawCable"?(i(),n("div",ss,[e[122]||(e[122]=w(" Klik peta untuk menambah titik. Mode: ",-1)),a("span",os,u(ie.value?"Ikuti jalan":"Garis lurus"),1),e[123]||(e[123]=w(". ",-1)),Ie.value?(i(),n("span",ns,"Menghitung rute...")):f("",!0)])):(i(),n("div",is," Klik peta untuk memilih lokasi, lalu klik tombol Selesai. ")),E.value==="drawCable"?(i(),n("label",us,[y(a("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=l=>ie.value=l),disabled:Ie.value},null,8,ds),[[tl,ie.value]]),e[124]||(e[124]=w(" Ikuti jalan ",-1))])):f("",!0),a("div",vs,[a("button",{class:"btn btn-secondary !py-1 !text-xs",onClick:D,disabled:E.value==="drawCable"&&Ie.value},"Selesai",8,cs),E.value==="drawCable"?(i(),n("button",{key:0,class:"btn btn-secondary !py-1 !text-xs",onClick:Fa,disabled:Ie.value},"Undo",8,ps)):f("",!0),E.value==="drawCable"?(i(),n("button",{key:1,class:"btn btn-secondary !py-1 !text-xs",onClick:oa,disabled:Ie.value},"Clear",8,bs)):f("",!0),E.value==="editCable"?(i(),n("button",{key:2,class:"btn btn-secondary !py-1 !text-xs",onClick:oa},"Clear")):f("",!0)])])):f("",!0)])],2),a("div",{class:O(["bg-white dark:bg-dark-800 shadow-card border border-gray-100 dark:border-dark-700 overflow-hidden flex flex-col lg:h-[calc(100vh-13rem)] fixed inset-x-0 bottom-0 z-[9001] lg:static lg:z-auto rounded-t-2xl lg:rounded-xl lg:max-h-none transform transition-transform duration-200 ease-out lg:transform-none",[qe.value?"lg:hidden":"lg:col-span-4",oe.value?"translate-y-0 pointer-events-auto":"translate-y-full pointer-events-none lg:pointer-events-auto lg:translate-y-0",Pl.value]])},[a("div",gs,[e[128]||(e[128]=a("div",{class:"mx-auto h-1 w-10 rounded-full bg-gray-200 dark:bg-white/10"},null,-1)),a("div",fs,[a("div",ms,[e[125]||(e[125]=w(" Panel: ",-1)),a("span",ks,u(Ee.value==="peek"?"Ringkas":Ee.value==="half"?"Sedang":"Penuh"),1)]),a("button",{class:"btn btn-secondary !py-1 !text-[11px]",onClick:Sl},"Ubah Mode")]),a("div",ys,[y(a("select",{"onUpdate:modelValue":e[11]||(e[11]=l=>I.value=l),class:"input !py-2 !text-xs flex-1"},[a("option",xs,"Kabel ("+u(z.value.length)+")",1),a("option",_s,"Titik ("+u(X.value.length)+")",1),a("option",hs,"Port ("+u(_e.value.length)+")",1),a("option",ws,"Sambungan ("+u(lt.value.length)+")",1),e[126]||(e[126]=a("option",{value:"cores"},"Core",-1)),e[127]||(e[127]=a("option",{value:"trace"},"Trace",-1)),a("option",Ns,"Putus ("+u(me.value.length)+")",1)],512),[[G,I.value]]),a("button",{class:"btn btn-secondary !py-1.5 !text-xs",onClick:e[12]||(e[12]=l=>oe.value=!1)},"Tutup")])]),a("div",Cs,[a("button",{onClick:e[13]||(e[13]=l=>I.value="cables"),class:O(["px-3 py-3 text-xs font-semibold whitespace-nowrap",I.value==="cables"?"text-blue-700 dark:text-blue-300 bg-blue-50/60 dark:bg-blue-900/10":"text-gray-600 dark:text-gray-300"])}," Kabel ("+u(z.value.length)+") ",3),a("button",{onClick:e[14]||(e[14]=l=>I.value="points"),class:O(["px-3 py-3 text-xs font-semibold whitespace-nowrap",I.value==="points"?"text-teal-700 dark:text-teal-300 bg-teal-50/60 dark:bg-teal-900/10":"text-gray-600 dark:text-gray-300"])}," Titik ("+u(X.value.length)+") ",3),a("button",{onClick:e[15]||(e[15]=l=>I.value="ports"),class:O(["px-3 py-3 text-xs font-semibold whitespace-nowrap",I.value==="ports"?"text-indigo-700 dark:text-indigo-300 bg-indigo-50/60 dark:bg-indigo-900/10":"text-gray-600 dark:text-gray-300"])}," Port ("+u(_e.value.length)+") ",3),a("button",{onClick:e[16]||(e[16]=l=>I.value="links"),class:O(["px-3 py-3 text-xs font-semibold whitespace-nowrap",I.value==="links"?"text-amber-700 dark:text-amber-300 bg-amber-50/60 dark:bg-amber-900/10":"text-gray-600 dark:text-gray-300"])}," Sambungan ("+u(lt.value.length)+") ",3),a("button",{onClick:e[17]||(e[17]=l=>ca()),class:O(["px-3 py-3 text-xs font-semibold whitespace-nowrap",I.value==="cores"?"text-emerald-700 dark:text-emerald-300 bg-emerald-50/60 dark:bg-emerald-900/10":"text-gray-600 dark:text-gray-300"])}," Core ",2),a("button",{onClick:e[18]||(e[18]=l=>I.value="trace"),class:O(["px-3 py-3 text-xs font-semibold whitespace-nowrap",I.value==="trace"?"text-slate-700 dark:text-slate-200 bg-slate-50/60 dark:bg-slate-700/30":"text-gray-600 dark:text-gray-300"])}," Trace ",2),a("button",{onClick:e[19]||(e[19]=l=>I.value="breaks"),class:O(["px-3 py-3 text-xs font-semibold whitespace-nowrap",I.value==="breaks"?"text-red-700 dark:text-red-300 bg-red-50/60 dark:bg-red-900/10":"text-gray-600 dark:text-gray-300"])}," Putus ("+u(me.value.length)+") ",3)]),a("div",Ps,[at.value?(i(),n("div",Ss,"Memuat...")):St.value?(i(),n("div",Es,u(St.value),1)):I.value==="cables"?(i(),n("div",Ts,[a("div",Is,[e[129]||(e[129]=a("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Daftar Kabel",-1)),W.value?(i(),n("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:La},"Tambah")):f("",!0)]),a("div",Ls,[y(a("input",{"onUpdate:modelValue":e[20]||(e[20]=l=>U.value=l),class:"input w-full !py-2 !text-xs",placeholder:dt.value},null,8,Os),[[C,U.value]]),U.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[21]||(e[21]=l=>U.value="")},"Clear")):f("",!0)]),U.value?(i(),n("div",$s,[e[130]||(e[130]=w(" Hasil: ",-1)),a("span",Fs,u(na.value.length),1),w(" / "+u(z.value.length),1)])):f("",!0),na.value.length===0?(i(),n("div",Us,u(z.value.length===0?"Belum ada data kabel.":"Tidak ada hasil."),1)):(i(),n("div",Ms,[(i(!0),n($,null,A(na.value,l=>(i(),n("div",{key:l.id,class:O(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-blue-200 dark:hover:border-blue-900/40 cursor-pointer",Number(re.value)===Number(l.id)?"bg-blue-50/60 dark:bg-blue-900/10":"bg-white dark:bg-dark-800"]),onClick:L=>Pa(l,{panel:"close"})},[a("div",As,[a("div",null,[a("div",Ds,u(l.name),1),a("div",Vs,[l.cable_type?(i(),n("span",js,u(l.cable_type),1)):f("",!0),l.core_count?(i(),n("span",Gs,"| "+u(l.core_count)+" core",1)):f("",!0),l.length_m?(i(),n("span",Bs,"| "+u(ra(l.length_m)),1)):f("",!0)]),l.from_point_id||l.to_point_id?(i(),n("div",Ks,[a("div",null,[e[131]||(e[131]=w("Dari: ",-1)),a("span",Hs,u(H(l.from_point_id)||"-"),1)]),a("div",null,[e[132]||(e[132]=w("Ke: ",-1)),a("span",Js,u(H(l.to_point_id)||"-"),1)])])):f("",!0)]),a("div",zs,[a("button",{class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:le(L=>ca(l),["stop"])},"Core",8,Xs),B.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:le(L=>Oa(l),["stop"])},"Edit",8,Zs)):f("",!0),fe.value?(i(),n("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:le(L=>Ol(l),["stop"])},"Hapus",8,qs)):f("",!0)])])],10,Rs))),128))]))])):I.value==="points"?(i(),n("div",Ws,[a("div",Ys,[e[133]||(e[133]=a("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Titik Sambungan",-1)),W.value?(i(),n("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:Ma},"Tambah")):f("",!0)]),a("div",Qs,[y(a("input",{"onUpdate:modelValue":e[22]||(e[22]=l=>U.value=l),class:"input w-full !py-2 !text-xs",placeholder:dt.value},null,8,eo),[[C,U.value]]),U.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[23]||(e[23]=l=>U.value="")},"Clear")):f("",!0)]),U.value?(i(),n("div",to,[e[134]||(e[134]=w(" Hasil: ",-1)),a("span",ao,u(ia.value.length),1),w(" / "+u(X.value.length),1)])):f("",!0),ia.value.length===0?(i(),n("div",lo,u(X.value.length===0?"Belum ada data titik.":"Tidak ada hasil."),1)):(i(),n("div",ro,[(i(!0),n($,null,A(ia.value,l=>(i(),n("div",{key:l.id,class:O(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-teal-200 dark:hover:border-teal-900/40 cursor-pointer",Number(se.value)===Number(l.id)?"bg-teal-50/60 dark:bg-teal-900/10":"bg-white dark:bg-dark-800"]),onClick:L=>Sa(l,{panel:"close"})},[a("div",oo,[a("div",null,[a("div",no,u(l.name),1),a("div",io,[l.point_type?(i(),n("span",uo,u(l.point_type),1)):f("",!0),l.latitude&&l.longitude?(i(),n("span",vo,"| "+u(l.latitude)+", "+u(l.longitude),1)):f("",!0)])]),a("div",co,[B.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:le(L=>Ra(l),["stop"])},"Edit",8,po)):f("",!0),fe.value?(i(),n("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:le(L=>Al(l),["stop"])},"Hapus",8,bo)):f("",!0)])])],10,so))),128))]))])):I.value==="ports"?(i(),n("div",go,[a("div",fo,[e[135]||(e[135]=a("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Port (OLT/ODP)",-1)),W.value?(i(),n("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:Hl},"Tambah")):f("",!0)]),a("div",mo,[y(a("input",{"onUpdate:modelValue":e[24]||(e[24]=l=>U.value=l),class:"input w-full !py-2 !text-xs",placeholder:dt.value},null,8,ko),[[C,U.value]]),U.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[25]||(e[25]=l=>U.value="")},"Clear")):f("",!0)]),U.value?(i(),n("div",yo,[e[136]||(e[136]=w(" Hasil: ",-1)),a("span",xo,u(ua.value.length),1),w(" / "+u(_e.value.length),1)])):f("",!0),ua.value.length===0?(i(),n("div",_o,u(_e.value.length===0?"Belum ada data port.":"Tidak ada hasil."),1)):(i(),n("div",ho,[(i(!0),n($,null,A(ua.value,l=>(i(),n("div",{key:l.id,class:"p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-indigo-200 dark:hover:border-indigo-900/40 bg-white dark:bg-dark-800"},[a("div",wo,[a("div",null,[a("div",No,u(String(l.port_type||"").toUpperCase()),1),a("div",Co,u(l.port_label||"#"+l.id),1),a("div",Po,[a("div",null,[e[137]||(e[137]=w(" Titik: ",-1)),a("span",So,u(H(l.point_id)||"#"+l.point_id),1)]),l.cable_id&&l.core_no?(i(),n("div",Eo,[e[138]||(e[138]=w(" Kabel: ",-1)),a("span",To,u(Z(l.cable_id)||"Kabel #"+l.cable_id),1),a("span",Io,"- core "+u(l.core_no),1)])):f("",!0)])]),a("div",Lo,[B.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:le(L=>Jl(l),["stop"])},"Edit",8,Oo)):f("",!0),fe.value?(i(),n("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:le(L=>Xl(l),["stop"])},"Hapus",8,$o)):f("",!0)])])]))),128))]))])):I.value==="links"?(i(),n("div",Fo,[a("div",Uo,[e[139]||(e[139]=a("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Sambungan (Splice/Split)",-1)),W.value?(i(),n("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:ar},"Tambah")):f("",!0)]),a("div",Mo,[y(a("input",{"onUpdate:modelValue":e[26]||(e[26]=l=>U.value=l),class:"input w-full !py-2 !text-xs",placeholder:dt.value},null,8,Ro),[[C,U.value]]),U.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[27]||(e[27]=l=>U.value="")},"Clear")):f("",!0)]),U.value?(i(),n("div",Ao,[e[140]||(e[140]=w(" Hasil: ",-1)),a("span",Do,u(da.value.length),1),w(" / "+u(Gt.value.length),1)])):f("",!0),da.value.length===0?(i(),n("div",Vo,u(Gt.value.length===0?"Belum ada data sambungan.":"Tidak ada hasil."),1)):(i(),n("div",jo,[(i(!0),n($,null,A(da.value,l=>(i(),n("div",{key:l.kind==="SPLIT_GROUP"?"g:"+l.split_group+":"+l.point_id:"l:"+l.id,class:"p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-amber-200 dark:hover:border-amber-900/40 bg-white dark:bg-dark-800"},[a("div",Go,[a("div",Bo,[a("div",Ko,[w(u(l.kind==="SPLIT_GROUP"?"SPLIT":String(l.link_type||"").toUpperCase())+" ",1),l.kind==="SPLIT_GROUP"?(i(),n("span",Ho,"- "+u((l.outputs||[]).length)+" output",1)):f("",!0)]),a("div",Jo,[e[141]||(e[141]=w(" Titik: ",-1)),a("span",zo,u(H(l.point_id)||"#"+l.point_id),1)]),a("div",Xo,[w(u(Z(l.from_cable_id)||"Kabel #"+l.from_cable_id)+" - core "+u(l.from_core_no)+" ",1),e[142]||(e[142]=a("span",{class:"mx-1 text-gray-400"},"->",-1)),l.kind==="SPLIT_GROUP"?(i(),n("span",Zo,"splitter")):(i(),n($,{key:1},[w(u(Z(l.to_cable_id)||"Kabel #"+l.to_cable_id)+" - core "+u(l.to_core_no),1)],64))]),l.kind==="SPLIT_GROUP"&&(l.outputs||[]).length?(i(),n("div",qo,[w(" Output: "+u((l.outputs||[]).slice(0,4).map(L=>`${Z(L.to_cable_id)||"#"+L.to_cable_id}:${L.to_core_no}`).join(", ")),1),(l.outputs||[]).length>4?(i(),n("span",Wo,", ...")):f("",!0)])):f("",!0),l.loss_db!==null&&l.loss_db!==void 0&&l.loss_db!==""?(i(),n("div",Yo,[e[143]||(e[143]=w(" Loss: ",-1)),a("span",Qo,u(l.loss_db)+" dB",1)])):f("",!0)]),a("div",en,[B.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:le(L=>lr(l),["stop"])},"Edit",8,tn)):f("",!0),fe.value?(i(),n("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:le(L=>sr(l),["stop"])},"Hapus",8,an)):f("",!0)])])]))),128))]))])):I.value==="cores"?(i(),n("div",ln,[a("div",rn,[e[145]||(e[145]=a("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Core Occupancy",-1)),a("div",sn,[y(a("select",{"onUpdate:modelValue":e[28]||(e[28]=l=>ce.value=l),class:"input !py-2 !text-xs",onChange:e[29]||(e[29]=l=>He(ce.value))},[e[144]||(e[144]=a("option",{value:""},"(pilih kabel)",-1)),(i(!0),n($,null,A(z.value,l=>(i(),n("option",{key:l.id,value:String(l.id)},u(l.name)+" ("+u(l.core_count||"-")+" core) ",9,on))),128))],544),[[G,ce.value]]),a("button",{class:"btn btn-secondary !py-2 !text-xs",disabled:Bt.value||!ce.value,onClick:e[30]||(e[30]=l=>He(ce.value))},"Refresh",8,nn)])]),a("div",un,[a("div",dn,[e[146]||(e[146]=w("FREE: ",-1)),a("span",vn,u(ct.value.FREE||0),1)]),a("div",cn,[e[147]||(e[147]=w("USED: ",-1)),a("span",pn,u(ct.value.USED||0),1)]),a("div",bn,[e[148]||(e[148]=w("RESERVED: ",-1)),a("span",gn,u(ct.value.RESERVED||0),1)]),a("div",fn,[e[149]||(e[149]=w("BROKEN: ",-1)),a("span",mn,u(ct.value.BROKEN||0),1)])]),Bt.value?(i(),n("div",kn,"Memuat data core...")):Ke.value?(i(),n("div",yn,u(Ke.value),1)):ce.value?(i(),n("div",_n,[a("div",hn,[(i(!0),n($,null,A(pt.value,l=>(i(),n("button",{key:l.core_no,class:O(["rounded-lg border px-2 py-2 text-[11px] text-center transition",[Zl(l.status),Number(gt.value)===Number(l.core_no)?"!ring-2 !ring-slate-900/20 dark:!ring-white/30":""]]),onClick:L=>gt.value=l.core_no},[a("div",Nn,"Core "+u(l.core_no),1),a("div",Cn,u(l.status),1)],10,wn))),128))]),ee.value?(i(),n("div",Pn,[a("div",Sn,[a("div",En,"Detail Core "+u(ee.value.core_no),1),a("label",Tn,[a("input",{type:"checkbox",checked:ql(ee.value.core_no),onChange:e[31]||(e[31]=l=>Wl(ee.value.core_no))},null,40,In),e[150]||(e[150]=w(" Reserve ",-1))])]),a("div",Ln,[e[151]||(e[151]=w(" Status saat ini: ",-1)),a("span",On,u(ee.value.status),1)]),a("div",$n,[a("div",Fn,[e[152]||(e[152]=w(" Port: ",-1)),a("span",Un,u((((r=ee.value.details)==null?void 0:r.ports)||[]).length),1)]),a("div",Mn,[e[153]||(e[153]=w(" Link: ",-1)),a("span",Rn,u((((s=ee.value.details)==null?void 0:s.links_from)||[]).length+(((o=ee.value.details)==null?void 0:o.links_to)||[]).length),1)])]),(((v=ee.value.details)==null?void 0:v.ports)||[]).length?(i(),n("div",An,[e[154]||(e[154]=a("div",{class:"text-[11px] font-semibold text-gray-700 dark:text-gray-200"},"Ports",-1)),a("div",Dn,[(i(!0),n($,null,A(((p=ee.value.details)==null?void 0:p.ports)||[],l=>(i(),n("div",{key:"p"+l.id,class:"text-[11px] text-gray-600 dark:text-gray-300"},u(l.point_name||"#"+l.point_id)+" | "+u(l.port_type)+" | "+u(l.port_label),1))),128))])])):f("",!0),(((d=ee.value.details)==null?void 0:d.links_from)||[]).length||(((b=ee.value.details)==null?void 0:b.links_to)||[]).length?(i(),n("div",Vn,[e[155]||(e[155]=a("div",{class:"text-[11px] font-semibold text-gray-700 dark:text-gray-200"},"Links",-1)),a("div",jn,[(i(!0),n($,null,A(((x=ee.value.details)==null?void 0:x.links_from)||[],l=>(i(),n("div",{key:"lf"+l.id,class:"text-[11px] text-gray-600 dark:text-gray-300"}," OUT "+u(l.link_type)+" @ "+u(l.point_name||"#"+l.point_id)+" -> Kabel "+u(Z(l.to_cable_id)||"#"+l.to_cable_id)+":"+u(l.to_core_no),1))),128)),(i(!0),n($,null,A(((N=ee.value.details)==null?void 0:N.links_to)||[],l=>(i(),n("div",{key:"lt"+l.id,class:"text-[11px] text-gray-600 dark:text-gray-300"}," IN "+u(l.link_type)+" @ "+u(l.point_name||"#"+l.point_id)+" <- Kabel "+u(Z(l.from_cable_id)||"#"+l.from_cable_id)+":"+u(l.from_core_no),1))),128))])])):f("",!0)])):f("",!0),a("div",Gn,[a("button",{class:"btn btn-secondary !py-2 !text-xs",disabled:vt.value||!ce.value,onClick:e[32]||(e[32]=l=>He(ce.value))},"Undo Draft",8,Bn),a("button",{class:"btn btn-primary !py-2 !text-xs",disabled:vt.value||!ce.value,onClick:Yl},u(vt.value?"Menyimpan...":"Simpan Reservasi"),9,Kn)])])):(i(),n("div",xn,"Pilih kabel untuk melihat okupansi core."))])):I.value==="trace"?(i(),n("div",Hn,[a("div",Jn,[e[156]||(e[156]=a("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Tracing End-to-End",-1)),a("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:nr,disabled:et.value},"Clear",8,zn)]),a("div",Xn,[a("div",null,[e[158]||(e[158]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Start Port (OLT_PON)",-1)),y(a("select",{"onUpdate:modelValue":e[33]||(e[33]=l=>ft.value=l),class:"input w-full"},[e[157]||(e[157]=a("option",{value:""},"(pilih port)",-1)),(i(!0),n($,null,A(or.value,l=>(i(),n("option",{key:l.id,value:l.id},u(H(l.point_id)||"#"+l.point_id)+" | "+u(l.port_label)+" | "+u(Z(l.cable_id)||"Kabel #"+l.cable_id)+":"+u(l.core_no),9,Zn))),128))],512),[[G,ft.value]])]),a("div",qn,[a("button",{class:"btn btn-primary !py-2 !text-xs",onClick:ir,disabled:et.value||!ft.value},u(et.value?"Tracing...":"Trace"),9,Wn),a("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:j,disabled:at.value||et.value},"Refresh Data",8,Yn)]),tt.value?(i(),n("div",Qn,u(tt.value),1)):f("",!0)]),we.value?(i(),n("div",ei,[a("div",ti,[e[159]||(e[159]=w(" Endpoint: ",-1)),a("span",ai,u((we.value.endpoints||[]).length),1),e[160]||(e[160]=a("span",{class:"mx-2"},"|",-1)),e[161]||(e[161]=w(" Visited: ",-1)),a("span",li,u(we.value.visited_nodes||0),1),we.value.truncated?(i(),n("span",ri,"(truncated)")):f("",!0)]),(we.value.endpoints||[]).length===0?(i(),n("div",si,[...e[162]||(e[162]=[w(" Tidak ada endpoint ",-1),a("span",{class:"font-mono"},"ODP_OUT",-1),w(" terjangkau dari port ini. ",-1)])])):(i(),n("div",oi,[(i(!0),n($,null,A(we.value.endpoints||[],(l,L)=>{var ae,kt,yt,xt,_t,ht,wt,Ya;return i(),n("div",{key:((ae=l.port)==null?void 0:ae.id)||L,class:O(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-slate-200 dark:hover:border-slate-700 cursor-pointer",Je.value===l?"bg-slate-50/60 dark:bg-slate-700/30":"bg-white dark:bg-dark-800"]),onClick:Ud=>Je.value=l},[a("div",ii,u(((kt=l.point)==null?void 0:kt.name)||H((yt=l.port)==null?void 0:yt.point_id)||"-"),1),a("div",ui,[e[163]||(e[163]=w(" Port: ",-1)),a("span",di,u(((xt=l.port)==null?void 0:xt.port_label)||"#"+((_t=l.port)==null?void 0:_t.id)),1),e[164]||(e[164]=a("span",{class:"mx-2"},"|",-1)),w(" "+u(Z((ht=l.port)==null?void 0:ht.cable_id)||"Kabel #"+((wt=l.port)==null?void 0:wt.cable_id))+":"+u((Ya=l.port)==null?void 0:Ya.core_no),1)])],10,ni)}),128))])),(h=Je.value)!=null&&h.path?(i(),n("div",vi,[e[166]||(e[166]=a("div",{class:"text-xs font-semibold text-gray-900 dark:text-white"},"Path (ringkas)",-1)),a("div",ci,[(i(!0),n($,null,A(Je.value.path,(l,L)=>{var ae,kt,yt,xt,_t,ht,wt;return i(),n("div",{key:L,class:"text-xs"},[a("div",pi,[w(u(L===0?"START":((ae=l.edge)==null?void 0:ae.type)==="CABLE"?"KABEL":"LINK "+(((kt=l.edge)==null?void 0:kt.link_type)||""))+" ",1),e[165]||(e[165]=a("span",{class:"mx-1 text-gray-400"},"|",-1)),w(" "+u(((yt=l.point)==null?void 0:yt.name)||"Titik #"+((xt=l.node)==null?void 0:xt.point_id)),1)]),a("div",bi,u(((_t=l.cable)==null?void 0:_t.name)||"Kabel #"+((ht=l.node)==null?void 0:ht.cable_id))+" - core "+u((wt=l.node)==null?void 0:wt.core_no),1)])}),128))])])):f("",!0)])):f("",!0)])):(i(),n("div",gi,[a("div",fi,[e[167]||(e[167]=a("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Data Putus",-1)),W.value?(i(),n("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:Da},"Tambah")):f("",!0)]),a("div",mi,[y(a("input",{"onUpdate:modelValue":e[34]||(e[34]=l=>U.value=l),class:"input w-full !py-2 !text-xs",placeholder:dt.value},null,8,ki),[[C,U.value]]),U.value?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[35]||(e[35]=l=>U.value="")},"Clear")):f("",!0)]),a("div",yi,[a("button",{class:O(["px-3 py-1.5 rounded-full text-xs font-semibold border transition",Q.value==="ALL"?"bg-slate-900 text-white border-slate-900 dark:bg-white dark:text-slate-900 dark:border-white":"bg-white dark:bg-dark-800 border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[36]||(e[36]=l=>Q.value="ALL")}," Semua ",2),a("button",{class:O(["px-3 py-1.5 rounded-full text-xs font-semibold border transition",Q.value==="OPEN"?"bg-red-50 border-red-200 text-red-700 dark:bg-red-900/10 dark:border-red-900/30 dark:text-red-300":"bg-white dark:bg-dark-800 border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[37]||(e[37]=l=>Q.value="OPEN")}," OPEN ",2),a("button",{class:O(["px-3 py-1.5 rounded-full text-xs font-semibold border transition",Q.value==="IN_PROGRESS"?"bg-amber-50 border-amber-200 text-amber-800 dark:bg-amber-900/10 dark:border-amber-900/30 dark:text-amber-200":"bg-white dark:bg-dark-800 border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[38]||(e[38]=l=>Q.value="IN_PROGRESS")}," IN PROGRESS ",2),a("button",{class:O(["px-3 py-1.5 rounded-full text-xs font-semibold border transition",Q.value==="FIXED"?"bg-emerald-50 border-emerald-200 text-emerald-700 dark:bg-emerald-900/10 dark:border-emerald-900/30 dark:text-emerald-200":"bg-white dark:bg-dark-800 border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[39]||(e[39]=l=>Q.value="FIXED")}," FIXED ",2),a("button",{class:O(["px-3 py-1.5 rounded-full text-xs font-semibold border transition",Q.value==="VERIFIED"?"bg-emerald-100 border-emerald-300 text-emerald-800 dark:bg-emerald-900/20 dark:border-emerald-900/40 dark:text-emerald-100":"bg-white dark:bg-dark-800 border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[40]||(e[40]=l=>Q.value="VERIFIED")}," VERIFIED ",2),a("button",{class:O(["px-3 py-1.5 rounded-full text-xs font-semibold border transition",Q.value==="CANCELLED"?"bg-slate-100 border-slate-200 text-slate-700 dark:bg-slate-700/30 dark:border-white/10 dark:text-slate-200":"bg-white dark:bg-dark-800 border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-white/5"]),onClick:e[41]||(e[41]=l=>Q.value="CANCELLED")}," CANCELLED ",2)]),U.value||Q.value!=="ALL"?(i(),n("div",xi,[e[168]||(e[168]=w(" Hasil: ",-1)),a("span",_i,u(va.value.length),1),w(" / "+u(me.value.length),1)])):f("",!0),va.value.length===0?(i(),n("div",hi,u(me.value.length===0?"Belum ada data putus.":"Tidak ada hasil."),1)):(i(),n("div",wi,[(i(!0),n($,null,A(va.value,l=>(i(),n("div",{key:l.id,class:O(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-red-200 dark:hover:border-red-900/40 cursor-pointer",Number(he.value)===Number(l.id)?"bg-red-50/60 dark:bg-red-900/10":"bg-white dark:bg-dark-800"]),onClick:L=>Ea(l,{panel:"close"})},[a("div",Ci,[a("div",null,[a("div",Pi,u(wa(l.status)),1),a("div",Si,u(Z(l.cable_id)||(l.cable_id?"Kabel #"+l.cable_id:"Tanpa kabel")),1),a("div",Ei,[a("span",null,"Titik: "+u(H(l.point_id)||"-"),1),l.core_no?(i(),n("span",Ti,"| core "+u(l.core_no),1)):f("",!0),l.severity?(i(),n("span",Ii,"| "+u(l.severity),1)):f("",!0)]),l.description?(i(),n("div",Li,u(l.description),1)):f("",!0)]),a("div",Oi,[B.value&&String(l.status||"").toUpperCase()==="OPEN"?(i(),n("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",disabled:Rt(l.id),onClick:le(L=>Gl(l),["stop"])},u(Rt(l.id)?"Memproses...":"Proses"),9,$i)):f("",!0),W.value&&B.value&&["OPEN","IN_PROGRESS"].includes(String(l.status||"OPEN").toUpperCase())?(i(),n("button",{key:1,class:"btn btn-primary !py-1 !px-2 !text-xs",disabled:ja(l.id),onClick:le(L=>Kl(l),["stop"])},u(ja(l.id)?"Memproses...":"Selesaikan"),9,Fi)):f("",!0),B.value&&String(l.status||"").toUpperCase()==="FIXED"?(i(),n("button",{key:2,class:"btn btn-secondary !py-1 !px-2 !text-xs",disabled:Rt(l.id),onClick:le(L=>Bl(l),["stop"])},u(Rt(l.id)?"Memproses...":"Verifikasi"),9,Ui)):f("",!0),B.value?(i(),n("button",{key:3,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:le(L=>Va(l),["stop"])},"Edit",8,Mi)):f("",!0),fe.value?(i(),n("button",{key:4,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:le(L=>jl(l),["stop"])},"Hapus",8,Ri)):f("",!0)])])],10,Ni))),128))]))]))])],2)])])):(i(),n("div",Sr,[...e[116]||(e[116]=[a("div",{class:"text-gray-900 dark:text-white font-semibold"},"Tidak punya akses",-1),a("div",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},[w(" Butuh permission "),a("code",{class:"px-1 py-0.5 bg-gray-100 dark:bg-dark-700 rounded"},"view fiber"),w(". ")],-1)])]))]),q.value?(i(),n("div",{key:0,class:O(["fixed inset-0 z-[10000] flex items-center justify-center p-4",E.value?"pointer-events-none":""])},[a("div",{class:O(["absolute inset-0 bg-black/40",E.value?"pointer-events-none opacity-20":""]),onClick:e[42]||(e[42]=l=>{q.value=!1,D()})},null,2),a("div",Ai,[a("div",Di,[a("div",Vi,u(Ye.value==="edit"?"Edit Kabel":"Tambah Kabel"),1),a("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[43]||(e[43]=l=>{q.value=!1,D()})},"Tutup")]),a("div",ji,[a("div",Gi,[a("div",null,[e[169]||(e[169]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Nama",-1)),y(a("input",{"onUpdate:modelValue":e[44]||(e[44]=l=>g.value.name=l),class:"input w-full",placeholder:"Feeder ODC-POP A"},null,512),[[C,g.value.name]]),ge.value.name?(i(),n("div",Bi,u((T=ge.value.name)==null?void 0:T[0]),1)):f("",!0)]),a("div",null,[e[170]||(e[170]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kode (opsional)",-1)),y(a("input",{"onUpdate:modelValue":e[45]||(e[45]=l=>g.value.code=l),class:"input w-full",placeholder:"FO-001"},null,512),[[C,g.value.code]]),ge.value.code?(i(),n("div",Ki,u((te=ge.value.code)==null?void 0:te[0]),1)):f("",!0)]),a("div",null,[e[171]||(e[171]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(a("input",{"onUpdate:modelValue":e[46]||(e[46]=l=>g.value.cable_type=l),class:"input w-full",placeholder:"FEEDER / DISTRIBUTION / DROP"},null,512),[[C,g.value.cable_type]]),ge.value.cable_type?(i(),n("div",Hi,u((V=ge.value.cable_type)==null?void 0:V[0]),1)):f("",!0)]),a("div",null,[e[172]||(e[172]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Core",-1)),y(a("input",{"onUpdate:modelValue":e[47]||(e[47]=l=>g.value.core_count=l),type:"number",min:"1",class:"input w-full",placeholder:"12"},null,512),[[C,g.value.core_count]]),ge.value.core_count?(i(),n("div",Ji,u((mt=ge.value.core_count)==null?void 0:mt[0]),1)):f("",!0)]),a("div",zi,[e[174]||(e[174]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Panjang (meter)",-1)),a("div",Xi,[y(a("input",{"onUpdate:modelValue":e[48]||(e[48]=l=>g.value.length_m=l),type:"number",min:"0",class:"input w-full sm:flex-1",placeholder:"(opsional)",onInput:e[49]||(e[49]=l=>Fe.value=!1)},null,544),[[C,g.value.length_m]]),a("button",{class:"btn btn-secondary shrink-0 !py-2 !text-xs",onClick:Ul},"Hitung dari jalur")]),a("div",Zi,[e[173]||(e[173]=w(" Estimasi dari jalur: ",-1)),a("span",qi,u(ra(sa.value)),1),a("span",Wi,"("+u(sa.value)+" m)",1),Fe.value?(i(),n("span",Yi,"[auto]")):f("",!0)])]),a("div",null,[e[176]||(e[176]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Dari Titik *",-1)),y(a("select",{"onUpdate:modelValue":e[50]||(e[50]=l=>g.value.from_point_id=l),class:"input w-full"},[e[175]||(e[175]=a("option",{value:""},"(pilih titik)",-1)),(i(!0),n($,null,A(X.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,Qi))),128))],512),[[G,g.value.from_point_id]])]),a("div",null,[e[178]||(e[178]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Ke Titik *",-1)),y(a("select",{"onUpdate:modelValue":e[51]||(e[51]=l=>g.value.to_point_id=l),class:"input w-full"},[e[177]||(e[177]=a("option",{value:""},"(pilih titik)",-1)),(i(!0),n($,null,A(X.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,eu))),128))],512),[[G,g.value.to_point_id]])]),a("div",tu,[e[179]||(e[179]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Warna Jalur",-1)),a("div",au,[y(a("input",{"onUpdate:modelValue":e[52]||(e[52]=l=>g.value.map_color=l),type:"color",class:"h-10 w-14 rounded border border-gray-200 dark:border-dark-700 bg-transparent"},null,512),[[C,g.value.map_color]]),y(a("input",{"onUpdate:modelValue":e[53]||(e[53]=l=>g.value.map_color=l),class:"input flex-1",placeholder:"#2563eb"},null,512),[[C,g.value.map_color]])])]),a("div",lu,[e[180]||(e[180]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(a("textarea",{"onUpdate:modelValue":e[54]||(e[54]=l=>g.value.notes=l),class:"input w-full min-h-[80px]",placeholder:"Keterangan kabel..."},null,512),[[C,g.value.notes]])])]),a("div",ru,[a("div",su,[a("div",null,[e[181]||(e[181]=a("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Jalur di Peta",-1)),a("div",ou,"Titik: "+u(Array.isArray(g.value.path)?g.value.path.length:0),1)]),a("div",nu,[a("label",iu,[y(a("input",{type:"checkbox","onUpdate:modelValue":e[55]||(e[55]=l=>ie.value=l)},null,512),[[tl,ie.value]]),e[182]||(e[182]=w(" Ikuti jalan ",-1))]),a("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:e[56]||(e[56]=l=>$a({force:!0})),disabled:!g.value.from_point_id||!g.value.to_point_id}," Auto ",8,uu),a("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:$l},"Gambar"),a("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Fl,disabled:!g.value.path||g.value.path.length<2},"Edit",8,du),a("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Fa,disabled:!g.value.path||g.value.path.length===0},"Undo",8,vu),a("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:oa,disabled:!g.value.path||g.value.path.length===0},"Clear",8,cu)])]),e[183]||(e[183]=a("div",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},[w(" Tips: mode "),a("span",{class:"font-semibold"},"Ikuti jalan"),w(" memakai Google Directions. Jika gagal/limit, otomatis fallback ke garis lurus. Jalur bisa dirapikan lewat tombol "),a("span",{class:"font-semibold"},"Edit"),w(". ")],-1))])]),a("div",pu,[a("button",{class:"btn btn-secondary",onClick:e[57]||(e[57]=l=>{q.value=!1,D()})},"Batal"),a("button",{class:"btn btn-primary",disabled:Qe.value,onClick:Ll},u(Qe.value?"Menyimpan...":"Simpan"),9,bu)])])],2)):f("",!0),de.value?(i(),n("div",{key:1,class:O(["fixed inset-0 z-[10000] flex items-center justify-center p-4",E.value?"pointer-events-none":""])},[a("div",{class:O(["absolute inset-0 bg-black/40",E.value?"pointer-events-none opacity-20":""]),onClick:e[58]||(e[58]=l=>{de.value=!1,D()})},null,2),a("div",gu,[a("div",fu,[a("div",mu,u($t.value==="edit"?"Edit Titik":"Tambah Titik"),1),a("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[59]||(e[59]=l=>{de.value=!1,D()})},"Tutup")]),a("div",ku,[a("div",null,[e[184]||(e[184]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Nama",-1)),y(a("input",{"onUpdate:modelValue":e[60]||(e[60]=l=>P.value.name=l),class:"input w-full",placeholder:"ODP-01 / Joint A"},null,512),[[C,P.value.name]]),Ce.value.name?(i(),n("div",yu,u((J=Ce.value.name)==null?void 0:J[0]),1)):f("",!0)]),a("div",null,[e[185]||(e[185]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(a("input",{"onUpdate:modelValue":e[61]||(e[61]=l=>P.value.point_type=l),class:"input w-full",placeholder:"ODP / ODC / JOINT / HANDHOLE"},null,512),[[C,P.value.point_type]])]),a("div",xu,[a("div",null,[e[186]||(e[186]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Latitude",-1)),y(a("input",{"onUpdate:modelValue":e[62]||(e[62]=l=>P.value.latitude=l),class:"input w-full",placeholder:"-6.2"},null,512),[[C,P.value.latitude]]),Ce.value.latitude?(i(),n("div",_u,u((Re=Ce.value.latitude)==null?void 0:Re[0]),1)):f("",!0)]),a("div",null,[e[187]||(e[187]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Longitude",-1)),y(a("input",{"onUpdate:modelValue":e[63]||(e[63]=l=>P.value.longitude=l),class:"input w-full",placeholder:"106.8"},null,512),[[C,P.value.longitude]]),Ce.value.longitude?(i(),n("div",hu,u((Ka=Ce.value.longitude)==null?void 0:Ka[0]),1)):f("",!0)])]),a("div",wu,[a("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Ml},"Pilih dari peta"),P.value.latitude&&P.value.longitude?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[64]||(e[64]=l=>ye(Number(P.value.latitude),Number(P.value.longitude),18))},"Zoom")):f("",!0)]),a("div",null,[e[188]||(e[188]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Alamat",-1)),y(a("input",{"onUpdate:modelValue":e[65]||(e[65]=l=>P.value.address=l),class:"input w-full",placeholder:"(opsional)"},null,512),[[C,P.value.address]])]),a("div",null,[e[189]||(e[189]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(a("textarea",{"onUpdate:modelValue":e[66]||(e[66]=l=>P.value.notes=l),class:"input w-full min-h-[80px]",placeholder:"(opsional)"},null,512),[[C,P.value.notes]])])]),a("div",Nu,[a("button",{class:"btn btn-secondary",onClick:e[67]||(e[67]=l=>{de.value=!1,D()})},"Batal"),a("button",{class:"btn btn-primary",disabled:Ft.value,onClick:Rl},u(Ft.value?"Menyimpan...":"Simpan"),9,Cu)])])],2)):f("",!0),ve.value?(i(),n("div",{key:2,class:O(["fixed inset-0 z-[10000] flex items-center justify-center p-4",E.value?"pointer-events-none":""])},[a("div",{class:O(["absolute inset-0 bg-black/40",E.value?"pointer-events-none opacity-20":""]),onClick:e[68]||(e[68]=l=>{ve.value=!1,D()})},null,2),a("div",Pu,[a("div",Su,[a("div",Eu,u(Ut.value==="edit"?"Edit Data Putus":"Tambah Data Putus"),1),a("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[69]||(e[69]=l=>{ve.value=!1,D()})},"Tutup")]),a("div",Tu,[a("div",null,[e[191]||(e[191]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kabel",-1)),y(a("select",{"onUpdate:modelValue":e[70]||(e[70]=l=>m.value.cable_id=l),class:"input w-full"},[e[190]||(e[190]=a("option",{value:""},"(kosong)",-1)),(i(!0),n($,null,A(z.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,Iu))),128))],512),[[G,m.value.cable_id]])]),a("div",null,[e[193]||(e[193]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik (opsional)",-1)),y(a("select",{"onUpdate:modelValue":e[71]||(e[71]=l=>m.value.point_id=l),class:"input w-full"},[e[192]||(e[192]=a("option",{value:""},"(kosong)",-1)),(i(!0),n($,null,A(X.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,Lu))),128))],512),[[G,m.value.point_id]])]),a("div",null,[e[194]||(e[194]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Core (opsional)",-1)),y(a("input",{"onUpdate:modelValue":e[72]||(e[72]=l=>m.value.core_no=l),type:"number",min:"1",class:"input w-full",placeholder:"contoh: 1"},null,512),[[C,m.value.core_no]]),e[195]||(e[195]=a("div",{class:"text-[11px] text-gray-500 dark:text-gray-400 mt-1"},"Isi core bila gangguan hanya pada core tertentu.",-1))]),a("div",Ou,[a("div",null,[e[197]||(e[197]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Status",-1)),y(a("select",{"onUpdate:modelValue":e[73]||(e[73]=l=>m.value.status=l),class:"input w-full"},[...e[196]||(e[196]=[a("option",{value:"OPEN"},"OPEN",-1),a("option",{value:"IN_PROGRESS"},"IN_PROGRESS",-1),a("option",{value:"FIXED"},"FIXED",-1),a("option",{value:"VERIFIED"},"VERIFIED",-1),a("option",{value:"CANCELLED"},"CANCELLED",-1)])],512),[[G,m.value.status]])]),a("div",null,[e[199]||(e[199]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Severity",-1)),y(a("select",{"onUpdate:modelValue":e[74]||(e[74]=l=>m.value.severity=l),class:"input w-full"},[...e[198]||(e[198]=[a("option",{value:""},"(kosong)",-1),a("option",{value:"MINOR"},"MINOR",-1),a("option",{value:"MAJOR"},"MAJOR",-1),a("option",{value:"CRITICAL"},"CRITICAL",-1)])],512),[[G,m.value.severity]])])]),a("div",$u,[a("div",null,[e[200]||(e[200]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Teknisi",-1)),y(a("input",{"onUpdate:modelValue":e[75]||(e[75]=l=>m.value.technician_name=l),class:"input w-full",placeholder:"Nama teknisi lapangan"},null,512),[[C,m.value.technician_name]])]),a("div",null,[e[201]||(e[201]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Verifier",-1)),y(a("input",{"onUpdate:modelValue":e[76]||(e[76]=l=>m.value.verified_by_name=l),class:"input w-full",placeholder:"Nama verifier (opsional)"},null,512),[[C,m.value.verified_by_name]])])]),a("div",Fu,[a("div",null,[e[202]||(e[202]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Dilaporkan",-1)),y(a("input",{"onUpdate:modelValue":e[77]||(e[77]=l=>m.value.reported_at=l),type:"datetime-local",class:"input w-full"},null,512),[[C,m.value.reported_at]])]),a("div",null,[e[203]||(e[203]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Mulai Perbaikan",-1)),y(a("input",{"onUpdate:modelValue":e[78]||(e[78]=l=>m.value.repair_started_at=l),type:"datetime-local",class:"input w-full",disabled:!["IN_PROGRESS","FIXED","VERIFIED"].includes(String(m.value.status).toUpperCase())},null,8,Uu),[[C,m.value.repair_started_at]])])]),a("div",Mu,[a("div",null,[e[204]||(e[204]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Fixed At",-1)),y(a("input",{"onUpdate:modelValue":e[79]||(e[79]=l=>m.value.fixed_at=l),type:"datetime-local",class:"input w-full",disabled:!["FIXED","VERIFIED"].includes(String(m.value.status).toUpperCase())},null,8,Ru),[[C,m.value.fixed_at]])]),a("div",null,[e[205]||(e[205]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Verified At",-1)),y(a("input",{"onUpdate:modelValue":e[80]||(e[80]=l=>m.value.verified_at=l),type:"datetime-local",class:"input w-full",disabled:String(m.value.status).toUpperCase()!=="VERIFIED"},null,8,Au),[[C,m.value.verified_at]])])]),a("div",null,[e[207]||(e[207]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Closure Point (opsional)",-1)),y(a("select",{"onUpdate:modelValue":e[81]||(e[81]=l=>m.value.closure_point_id=l),class:"input w-full"},[e[206]||(e[206]=a("option",{value:""},"(kosong)",-1)),(i(!0),n($,null,A(X.value,l=>(i(),n("option",{key:"cp-"+l.id,value:l.id},u(l.name),9,Du))),128))],512),[[G,m.value.closure_point_id]])]),a("div",Vu,[a("div",null,[e[208]||(e[208]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Latitude",-1)),y(a("input",{"onUpdate:modelValue":e[82]||(e[82]=l=>m.value.latitude=l),class:"input w-full",placeholder:"-6.2"},null,512),[[C,m.value.latitude]]),je.value.latitude?(i(),n("div",ju,u((Ha=je.value.latitude)==null?void 0:Ha[0]),1)):f("",!0)]),a("div",null,[e[209]||(e[209]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Longitude",-1)),y(a("input",{"onUpdate:modelValue":e[83]||(e[83]=l=>m.value.longitude=l),class:"input w-full",placeholder:"106.8"},null,512),[[C,m.value.longitude]]),je.value.longitude?(i(),n("div",Gu,u((Ja=je.value.longitude)==null?void 0:Ja[0]),1)):f("",!0)])]),a("div",Bu,[a("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Dl},"Pilih dari peta"),m.value.latitude&&m.value.longitude?(i(),n("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[84]||(e[84]=l=>ye(Number(m.value.latitude),Number(m.value.longitude),18))},"Zoom")):f("",!0)]),a("div",null,[e[210]||(e[210]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(a("textarea",{"onUpdate:modelValue":e[85]||(e[85]=l=>m.value.description=l),class:"input w-full min-h-[90px]",placeholder:"Keterangan kejadian putus..."},null,512),[[C,m.value.description]])]),a("div",Ku,[a("div",null,[e[211]||(e[211]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Foto Perbaikan (1 URL/baris)",-1)),y(a("textarea",{"onUpdate:modelValue":e[86]||(e[86]=l=>m.value.repair_photos_text=l),class:"input w-full min-h-[90px]",placeholder:"https://..."},null,512),[[C,m.value.repair_photos_text]])]),a("div",null,[e[212]||(e[212]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Material (1 item/baris)",-1)),y(a("textarea",{"onUpdate:modelValue":e[87]||(e[87]=l=>m.value.repair_materials_text=l),class:"input w-full min-h-[90px]",placeholder:"Joint Closure 24 Core"},null,512),[[C,m.value.repair_materials_text]])])])]),a("div",Hu,[a("button",{class:"btn btn-secondary",onClick:e[88]||(e[88]=l=>{ve.value=!1,D()})},"Batal"),a("button",{class:"btn btn-primary",disabled:Mt.value,onClick:Vl},u(Mt.value?"Menyimpan...":"Simpan"),9,Ju)])])],2)):f("",!0),Ge.value?(i(),n("div",zu,[a("div",{class:"absolute inset-0 bg-black/40",onClick:e[89]||(e[89]=l=>Ge.value=!1)}),a("div",Xu,[a("div",Zu,[a("div",qu,u(At.value==="edit"?"Edit Port":"Tambah Port"),1),a("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[90]||(e[90]=l=>Ge.value=!1)},"Tutup")]),a("div",Wu,[a("div",null,[e[214]||(e[214]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik",-1)),y(a("select",{"onUpdate:modelValue":e[91]||(e[91]=l=>R.value.point_id=l),class:"input w-full"},[e[213]||(e[213]=a("option",{value:""},"(pilih titik)",-1)),(i(!0),n($,null,A(X.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,Yu))),128))],512),[[G,R.value.point_id]]),Be.value.point_id?(i(),n("div",Qu,u((za=Be.value.point_id)==null?void 0:za[0]),1)):f("",!0)]),a("div",ed,[a("div",null,[e[216]||(e[216]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(a("select",{"onUpdate:modelValue":e[92]||(e[92]=l=>R.value.port_type=l),class:"input w-full"},[...e[215]||(e[215]=[a("option",{value:"OLT_PON"},"OLT_PON",-1),a("option",{value:"ODP_OUT"},"ODP_OUT",-1)])],512),[[G,R.value.port_type]])]),a("div",null,[e[217]||(e[217]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Label",-1)),y(a("input",{"onUpdate:modelValue":e[93]||(e[93]=l=>R.value.port_label=l),class:"input w-full",placeholder:"PON 1/1/1 / OUT 1"},null,512),[[C,R.value.port_label]]),Be.value.port_label?(i(),n("div",td,u((Xa=Be.value.port_label)==null?void 0:Xa[0]),1)):f("",!0)])]),a("div",ad,[a("div",null,[e[219]||(e[219]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kabel",-1)),y(a("select",{"onUpdate:modelValue":e[94]||(e[94]=l=>R.value.cable_id=l),class:"input w-full"},[e[218]||(e[218]=a("option",{value:""},"(pilih kabel)",-1)),(i(!0),n($,null,A(z.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,ld))),128))],512),[[G,R.value.cable_id]])]),a("div",null,[e[220]||(e[220]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Core",-1)),y(a("input",{"onUpdate:modelValue":e[95]||(e[95]=l=>R.value.core_no=l),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[C,R.value.core_no]])])]),a("div",null,[e[221]||(e[221]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(a("textarea",{"onUpdate:modelValue":e[96]||(e[96]=l=>R.value.notes=l),class:"input w-full min-h-[90px]",placeholder:"(opsional)"},null,512),[[C,R.value.notes]])])]),a("div",rd,[a("button",{class:"btn btn-secondary",onClick:e[97]||(e[97]=l=>Ge.value=!1)},"Batal"),a("button",{class:"btn btn-primary",disabled:Dt.value,onClick:zl},u(Dt.value?"Menyimpan...":"Simpan"),9,sd)])])])):f("",!0),Me.value?(i(),n("div",od,[a("div",{class:"absolute inset-0 bg-black/40",onClick:e[98]||(e[98]=l=>Me.value=!1)}),a("div",nd,[a("div",id,[a("div",ud,u(Vt.value==="edit"?"Edit Sambungan":"Tambah Sambungan"),1),a("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[99]||(e[99]=l=>Me.value=!1)},"Tutup")]),a("div",dd,[a("div",null,[e[223]||(e[223]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik",-1)),y(a("select",{"onUpdate:modelValue":e[100]||(e[100]=l=>_.value.point_id=l),class:"input w-full"},[e[222]||(e[222]=a("option",{value:""},"(pilih titik)",-1)),(i(!0),n($,null,A(X.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,vd))),128))],512),[[G,_.value.point_id]]),Se.value.point_id?(i(),n("div",cd,u((Za=Se.value.point_id)==null?void 0:Za[0]),1)):f("",!0)]),a("div",pd,[a("div",null,[e[225]||(e[225]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),y(a("select",{"onUpdate:modelValue":e[101]||(e[101]=l=>_.value.link_type=l),class:"input w-full"},[...e[224]||(e[224]=[a("option",{value:"SPLICE"},"SPLICE",-1),a("option",{value:"PATCH"},"PATCH",-1),a("option",{value:"SPLIT"},"SPLIT",-1)])],512),[[G,_.value.link_type]])]),a("div",null,[e[226]||(e[226]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Loss (dB)",-1)),y(a("input",{"onUpdate:modelValue":e[102]||(e[102]=l=>_.value.loss_db=l),class:"input w-full",placeholder:"0.20"},null,512),[[C,_.value.loss_db]])])]),a("div",bd,[a("div",null,[e[228]||(e[228]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"From Cable",-1)),y(a("select",{"onUpdate:modelValue":e[103]||(e[103]=l=>_.value.from_cable_id=l),class:"input w-full"},[e[227]||(e[227]=a("option",{value:""},"(pilih kabel)",-1)),(i(!0),n($,null,A(z.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,gd))),128))],512),[[G,_.value.from_cable_id]]),Se.value.from_cable_id?(i(),n("div",fd,u((qa=Se.value.from_cable_id)==null?void 0:qa[0]),1)):f("",!0)]),a("div",null,[e[229]||(e[229]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"From Core",-1)),y(a("input",{"onUpdate:modelValue":e[104]||(e[104]=l=>_.value.from_core_no=l),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[C,_.value.from_core_no]]),Se.value.from_core_no?(i(),n("div",md,u((Wa=Se.value.from_core_no)==null?void 0:Wa[0]),1)):f("",!0)])]),String(_.value.link_type).toUpperCase()!=="SPLIT"?(i(),n("div",kd,[a("div",null,[e[231]||(e[231]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"To Cable",-1)),y(a("select",{"onUpdate:modelValue":e[105]||(e[105]=l=>_.value.to_cable_id=l),class:"input w-full"},[e[230]||(e[230]=a("option",{value:""},"(pilih kabel)",-1)),(i(!0),n($,null,A(z.value,l=>(i(),n("option",{key:l.id,value:l.id},u(l.name),9,yd))),128))],512),[[G,_.value.to_cable_id]])]),a("div",null,[e[232]||(e[232]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"To Core",-1)),y(a("input",{"onUpdate:modelValue":e[106]||(e[106]=l=>_.value.to_core_no=l),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[C,_.value.to_core_no]])])])):(i(),n("div",xd,[a("div",_d,[a("div",null,[e[233]||(e[233]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Splitter Group (opsional)",-1)),y(a("input",{"onUpdate:modelValue":e[107]||(e[107]=l=>_.value.split_group=l),class:"input w-full",placeholder:"ODP-01 1:8"},null,512),[[C,_.value.split_group]])]),a("div",null,[e[234]||(e[234]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Jumlah Output",-1)),a("div",hd,[y(a("input",{"onUpdate:modelValue":e[108]||(e[108]=l=>it.value=l),type:"number",min:"1",max:"64",class:"input w-full"},null,512),[[C,it.value]]),a("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:e[109]||(e[109]=l=>Ql(it.value))},"Buat"),a("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:er},"Tambah")])])]),(_.value.outputs||[]).length===0?(i(),n("div",wd,[...e[235]||(e[235]=[w(" Output masih kosong. Klik ",-1),a("span",{class:"font-semibold"},"Buat",-1),w(" untuk generate baris output. ",-1)])])):(i(),n("div",Nd,[(i(!0),n($,null,A(_.value.outputs,(l,L)=>(i(),n("div",{key:L,class:"grid grid-cols-12 gap-2 items-center"},[a("div",Cd,[y(a("select",{"onUpdate:modelValue":ae=>l.to_cable_id=ae,class:"input w-full"},[e[236]||(e[236]=a("option",{value:""},"(kabel output)",-1)),(i(!0),n($,null,A(z.value,ae=>(i(),n("option",{key:ae.id,value:ae.id},u(ae.name),9,Sd))),128))],8,Pd),[[G,l.to_cable_id]])]),a("div",Ed,[y(a("input",{"onUpdate:modelValue":ae=>l.to_core_no=ae,type:"number",min:"1",class:"input w-full",placeholder:"core"},null,8,Td),[[C,l.to_core_no]])]),a("div",Id,[a("button",{class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:ae=>tr(L)},"Hapus",8,Ld)])]))),128))]))])),a("div",null,[e[237]||(e[237]=a("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),y(a("textarea",{"onUpdate:modelValue":e[110]||(e[110]=l=>_.value.notes=l),class:"input w-full min-h-[90px]",placeholder:"(opsional)"},null,512),[[C,_.value.notes]])])]),a("div",Od,[a("button",{class:"btn btn-secondary",onClick:e[111]||(e[111]=l=>Me.value=!1)},"Batal"),a("button",{class:"btn btn-primary",disabled:jt.value,onClick:rr},u(jt.value?"Menyimpan...":"Simpan"),9,$d)])])])):f("",!0)]}),_:1})],64))}};export{Ad as default};
