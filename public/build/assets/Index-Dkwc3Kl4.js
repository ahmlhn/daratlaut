import{C as Oa,E as kt,o as Ua,G as $a,D as Ma,c as r,a as Vt,u as Ia,h as Fa,m as Va,b as t,t as d,f as k,x as I,j as n,e as g,d as _,i as He,n as V,F as E,s as U,w as oe,v as C,r as m,y as ue,z as Ga}from"./app-Ba6bH5FL.js";import{_ as Aa}from"./AdminLayout-CEt2y2ad.js";const ja={class:"space-y-4 animate-fade-in"},Da={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3 bg-white dark:bg-dark-800 p-5 rounded-xl shadow-card border border-gray-100 dark:border-dark-700"},Ra={class:"flex flex-wrap items-center gap-2"},Ba={class:"px-3 py-2 rounded-lg bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 text-xs"},Ka={class:"font-semibold text-gray-900 dark:text-white"},Ha={class:"px-3 py-2 rounded-lg bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 text-xs"},Ja={class:"font-semibold text-gray-900 dark:text-white"},za={class:"px-3 py-2 rounded-lg bg-red-50/60 dark:bg-red-900/10 border border-red-200/60 dark:border-red-900/30 text-xs"},Wa={class:"font-semibold text-red-700 dark:text-red-300"},Xa={class:"hidden lg:flex items-center gap-2 ml-2"},Za=["disabled"],qa={key:0,class:"bg-amber-50 dark:bg-amber-900/10 border border-amber-200 dark:border-amber-900/30 text-amber-800 dark:text-amber-200 rounded-xl p-4 text-sm"},Ya={key:1,class:"bg-white dark:bg-dark-800 border border-gray-100 dark:border-dark-700 rounded-xl p-6"},Qa={key:2,class:"grid grid-cols-1 lg:grid-cols-12 gap-4"},el={class:"lg:col-span-8 bg-white dark:bg-dark-800 rounded-xl shadow-card border border-gray-100 dark:border-dark-700 overflow-hidden"},tl={class:"flex flex-wrap items-center gap-2 p-3 border-b border-gray-100 dark:border-dark-700"},al={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},ll={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},sl={class:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},ol={class:"ml-auto flex items-center gap-2 lg:hidden"},rl=["disabled"],nl={class:"relative"},il={key:0,class:"absolute inset-0 z-10 flex items-center justify-center p-6 bg-white/85 dark:bg-dark-900/70 backdrop-blur"},dl={class:"max-w-md text-center"},ul={class:"mt-1 text-xs text-gray-600 dark:text-gray-300"},pl={key:1,class:"absolute bottom-3 left-3 right-3 lg:right-auto lg:max-w-md bg-white/90 dark:bg-dark-900/80 backdrop-blur border border-gray-200 dark:border-white/10 rounded-xl p-3 text-xs text-gray-700 dark:text-gray-200 shadow-lg"},vl={class:"font-semibold"},cl={class:"uppercase"},bl={key:0,class:"text-gray-600 dark:text-gray-300 mt-1"},gl={key:1,class:"text-gray-600 dark:text-gray-300 mt-1"},ml={class:"font-semibold"},yl={key:0,class:"ml-1 text-blue-700 dark:text-blue-300"},kl={key:2,class:"text-gray-600 dark:text-gray-300 mt-1"},xl={key:3,class:"mt-2 flex items-center gap-2 text-xs text-gray-700 dark:text-gray-200"},fl=["disabled"],_l={class:"mt-2 flex items-center gap-2"},hl=["disabled"],wl=["disabled"],Cl=["disabled"],Nl={class:"lg:col-span-4 bg-white dark:bg-dark-800 rounded-xl shadow-card border border-gray-100 dark:border-dark-700 overflow-hidden"},Pl={class:"flex items-center gap-1 border-b border-gray-100 dark:border-dark-700 overflow-x-auto"},Tl={class:"p-4"},Sl={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},El={key:1,class:"text-sm text-red-600 dark:text-red-300"},Ll={key:2,class:"space-y-3"},Ol={class:"flex items-center justify-between"},Ul={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},$l={key:1,class:"space-y-2 max-h-[420px] lg:max-h-[calc(100vh-18rem)] overflow-auto pr-1"},Ml=["onClick"],Il={class:"flex items-start justify-between gap-2"},Fl={class:"text-sm font-semibold text-gray-900 dark:text-white"},Vl={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},Gl={key:0},Al={key:1,class:"ml-2"},jl={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Dl={class:"font-medium text-gray-700 dark:text-gray-200"},Rl={class:"font-medium text-gray-700 dark:text-gray-200"},Bl={class:"flex items-center gap-1 shrink-0"},Kl=["onClick"],Hl=["onClick"],Jl={key:3,class:"space-y-3"},zl={class:"flex items-center justify-between"},Wl={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Xl={key:1,class:"space-y-2 max-h-[420px] lg:max-h-[calc(100vh-18rem)] overflow-auto pr-1"},Zl=["onClick"],ql={class:"flex items-start justify-between gap-2"},Yl={class:"text-sm font-semibold text-gray-900 dark:text-white"},Ql={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},es={key:0},ts={key:1,class:"ml-2"},as={class:"flex items-center gap-1 shrink-0"},ls=["onClick"],ss=["onClick"],os={key:4,class:"space-y-3"},rs={class:"flex items-center justify-between"},ns={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},is={key:1,class:"space-y-2 max-h-[420px] lg:max-h-[calc(100vh-18rem)] overflow-auto pr-1"},ds={class:"flex items-start justify-between gap-2"},us={class:"text-xs font-bold text-indigo-700 dark:text-indigo-300"},ps={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1"},vs={class:"text-xs text-gray-500 dark:text-gray-400 mt-1 space-y-0.5"},cs={class:"font-medium text-gray-700 dark:text-gray-200"},bs={key:0},gs={class:"font-medium text-gray-700 dark:text-gray-200"},ms={class:"ml-1"},ys={class:"flex items-center gap-1 shrink-0"},ks=["onClick"],xs=["onClick"],fs={key:5,class:"space-y-3"},_s={class:"flex items-center justify-between"},hs={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},ws={key:1,class:"space-y-2 max-h-[420px] lg:max-h-[calc(100vh-18rem)] overflow-auto pr-1"},Cs={class:"flex items-start justify-between gap-2"},Ns={class:"min-w-0"},Ps={class:"text-xs font-bold text-amber-700 dark:text-amber-300"},Ts={key:0,class:"ml-1"},Ss={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Es={class:"font-medium text-gray-700 dark:text-gray-200"},Ls={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1 truncate"},Os={key:0,class:"text-gray-700 dark:text-gray-200"},Us={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-2"},$s={key:0},Ms={key:1,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Is={class:"font-medium text-gray-700 dark:text-gray-200"},Fs={class:"flex items-center gap-1 shrink-0"},Vs=["onClick"],Gs=["onClick"],As={key:6,class:"space-y-3"},js={class:"flex items-center justify-between"},Ds=["disabled"],Rs={class:"space-y-2"},Bs=["value"],Ks={class:"flex items-center gap-2"},Hs=["disabled"],Js=["disabled"],zs={key:0,class:"text-xs text-red-600 dark:text-red-300"},Ws={key:0,class:"space-y-3"},Xs={class:"text-xs text-gray-500 dark:text-gray-400"},Zs={class:"font-semibold text-gray-800 dark:text-gray-200"},qs={class:"font-semibold text-gray-800 dark:text-gray-200"},Ys={key:0,class:"ml-2 text-amber-700 dark:text-amber-300"},Qs={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},eo={key:1,class:"space-y-2 max-h-[260px] overflow-auto pr-1"},to=["onClick"],ao={class:"text-sm font-semibold text-gray-900 dark:text-white"},lo={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},so={class:"font-medium text-gray-700 dark:text-gray-200"},oo={key:2,class:"rounded-xl border border-gray-100 dark:border-dark-700 p-3 bg-gray-50/40 dark:bg-dark-900/30"},ro={class:"mt-2 space-y-1 max-h-[220px] overflow-auto pr-1"},no={class:"font-medium text-gray-900 dark:text-white"},io={class:"text-gray-600 dark:text-gray-300"},uo={key:7,class:"space-y-3"},po={class:"flex items-center justify-between"},vo={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},co={key:1,class:"space-y-2 max-h-[420px] lg:max-h-[calc(100vh-18rem)] overflow-auto pr-1"},bo=["onClick"],go={class:"flex items-start justify-between gap-2"},mo={class:"text-xs font-bold"},yo={class:"text-sm font-semibold text-gray-900 dark:text-white mt-1"},ko={class:"text-xs text-gray-500 dark:text-gray-400 mt-0.5"},xo={key:0,class:"ml-2"},fo={key:0,class:"text-xs text-gray-600 dark:text-gray-300 mt-1 line-clamp-2"},_o={class:"flex items-center gap-1 shrink-0"},ho=["onClick"],wo=["onClick"],Co={class:"relative pointer-events-auto w-full max-w-2xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden"},No={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Po={class:"font-semibold text-gray-900 dark:text-white"},To={class:"p-4 space-y-3"},So={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Eo={key:0,class:"text-xs text-red-600 mt-1"},Lo={key:0,class:"text-xs text-red-600 mt-1"},Oo={key:0,class:"text-xs text-red-600 mt-1"},Uo={key:0,class:"text-xs text-red-600 mt-1"},$o=["value"],Mo=["value"],Io={class:"md:col-span-2"},Fo={class:"flex items-center gap-2"},Vo={class:"md:col-span-2"},Go={class:"rounded-xl border border-gray-100 dark:border-dark-700 p-3"},Ao={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-2"},jo={class:"text-xs text-gray-500 dark:text-gray-400"},Do={class:"flex flex-wrap items-center gap-2"},Ro={class:"flex items-center gap-2 text-xs text-gray-700 dark:text-gray-200 px-3 py-2 rounded-xl border border-gray-200/70 dark:border-white/10 bg-white/70 dark:bg-dark-900/40"},Bo=["disabled"],Ko=["disabled"],Ho=["disabled"],Jo={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},zo=["disabled"],Wo={class:"relative pointer-events-auto w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden"},Xo={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Zo={class:"font-semibold text-gray-900 dark:text-white"},qo={class:"p-4 space-y-3"},Yo={key:0,class:"text-xs text-red-600 mt-1"},Qo={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},er={key:0,class:"text-xs text-red-600 mt-1"},tr={key:0,class:"text-xs text-red-600 mt-1"},ar={class:"flex items-center gap-2"},lr={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},sr=["disabled"],or={class:"relative pointer-events-auto w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden"},rr={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},nr={class:"font-semibold text-gray-900 dark:text-white"},ir={class:"p-4 space-y-3"},dr=["value"],ur=["value"],pr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},vr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},cr=["disabled"],br={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},gr={key:0,class:"text-xs text-red-600 mt-1"},mr={key:0,class:"text-xs text-red-600 mt-1"},yr={class:"flex items-center gap-2"},kr={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},xr=["disabled"],fr={key:3,class:"fixed inset-0 z-[10000] flex items-center justify-center p-4"},_r={class:"relative w-full max-w-xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden"},hr={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},wr={class:"font-semibold text-gray-900 dark:text-white"},Cr={class:"p-4 space-y-3"},Nr=["value"],Pr={key:0,class:"text-xs text-red-600 mt-1"},Tr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Sr={key:0,class:"text-xs text-red-600 mt-1"},Er={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Lr=["value"],Or={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},Ur=["disabled"],$r={key:4,class:"fixed inset-0 z-[10000] flex items-center justify-center p-4"},Mr={class:"relative w-full max-w-2xl bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden"},Ir={class:"p-4 border-b border-gray-100 dark:border-dark-700 flex items-center justify-between"},Fr={class:"font-semibold text-gray-900 dark:text-white"},Vr={class:"p-4 space-y-3"},Gr=["value"],Ar={key:0,class:"text-xs text-red-600 mt-1"},jr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Dr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Rr=["value"],Br={key:0,class:"text-xs text-red-600 mt-1"},Kr={key:0,class:"text-xs text-red-600 mt-1"},Hr={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Jr=["value"],zr={key:1,class:"space-y-3 rounded-xl border border-gray-100 dark:border-dark-700 p-3"},Wr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Xr={class:"flex items-center gap-2"},Zr={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},qr={key:1,class:"space-y-2 max-h-[260px] overflow-auto pr-1"},Yr={class:"col-span-7"},Qr=["onUpdate:modelValue"],en=["value"],tn={class:"col-span-3"},an=["onUpdate:modelValue"],ln={class:"col-span-2 flex items-center justify-end"},sn=["onClick"],on={class:"p-4 border-t border-gray-100 dark:border-dark-700 flex items-center justify-end gap-2"},rn=["disabled"],pn={__name:"Index",props:{tenantId:{type:Number,default:0},warning:{type:String,default:null},googleMapsApiKey:{type:String,default:""}},setup(Gt){const c=Oa("toast"),nt=Gt,xt=Ga(),ft=ue(()=>{var l,e;return((e=(l=xt.props.auth)==null?void 0:l.user)==null?void 0:e.permissions)||[]}),At=ue(()=>{var l,e;return(((e=(l=xt.props.auth)==null?void 0:l.user)==null?void 0:e.role)||"").toString().toLowerCase().trim()});function jt(l){const e=(l||"").toString().toLowerCase().trim();return e==="svp lapangan"?"svp_lapangan":e}function Je(l){const e=jt(At.value);return["admin","owner"].includes(e)||ft.value.includes("manage fiber")?!0:ft.value.includes(l)}const _t=ue(()=>Je("view fiber")),q=ue(()=>Je("create fiber")),Y=ue(()=>Je("edit fiber")),Q=ue(()=>Je("delete fiber")),we=m(!1),ze=m(""),Ce=m({cables:0,points:0,breaks_total:0,breaks_open:0}),B=m([]),K=m([]),Ne=m([]),Le=m([]),We=m([]),L=m("cables"),Oe=m(!0),Ue=m(!0),$e=m(!0),ee=m(null),A=m(null),te=m(null),re=m(null),Xe=m([]),ht=ue(()=>{const l=new Set;return(Xe.value||[]).forEach(e=>{const o=Number(e);Number.isFinite(o)&&o>0&&l.add(o)}),l});async function D(l,e={}){const o=await fetch(l,{credentials:"same-origin",headers:{Accept:"application/json",...e.headers||{}},...e}),s=await o.text();let i=null;try{i=s?JSON.parse(s):null}catch{i=null}return{ok:o.ok,status:o.status,data:i,text:s}}async function F(){var l,e,o,s,i,p,v,u,h,O,se,G;if(_t.value){we.value=!0,ze.value="";try{const[$,he]=await Promise.all([D("/api/v1/fiber/map-data"),D("/api/v1/fiber/summary")]);if(!$.ok){const M=((l=$.data)==null?void 0:l.message)||`Gagal memuat data fiber (HTTP ${$.status}).`;throw new Error(M)}he.ok?Ce.value=((e=he.data)==null?void 0:e.data)||Ce.value:Ce.value={cables:0,points:0,breaks_total:0,breaks_open:0},B.value=((s=(o=$.data)==null?void 0:o.data)==null?void 0:s.cables)||[],K.value=((p=(i=$.data)==null?void 0:i.data)==null?void 0:p.points)||[],Ne.value=((u=(v=$.data)==null?void 0:v.data)==null?void 0:u.breaks)||[],Le.value=((O=(h=$.data)==null?void 0:h.data)==null?void 0:O.ports)||[],We.value=((G=(se=$.data)==null?void 0:se.data)==null?void 0:G.links)||[],Nt(),Qt()}catch($){console.error("Fiber: loadAll failed",$),ze.value=$&&$.message?$.message:"Gagal memuat data fiber."}finally{we.value=!1}}}const it=m(null);let N=null,H=null,dt=new Map,ut=new Map,pt=new Map,ge={markers:[],polyline:null},wt=!1;const me=m(""),ne=m("roadmap"),Me={roadmap:{label:"Roadmap",mapTypeId:"roadmap"},satellite:{label:"Satelit",mapTypeId:"satellite"},hybrid:{label:"Hybrid",mapTypeId:"hybrid"}};function Dt(l){var o;const e=(l||"").toString().trim();return e?(o=window.google)!=null&&o.maps?Promise.resolve():(window.__fiberGoogleMapsPromise||(window.__fiberGoogleMapsPromise=new Promise((s,i)=>{const p=document.createElement("script"),v=new URLSearchParams({key:e,v:"weekly"});p.src=`https://maps.googleapis.com/maps/api/js?${v.toString()}`,p.async=!0,p.defer=!0,p.onload=()=>s(),p.onerror=()=>i(new Error("Gagal memuat Google Maps. Cek API key/koneksi.")),document.head.appendChild(p)})),window.__fiberGoogleMapsPromise):Promise.reject(new Error("Google Maps API key belum di-set."))}function Rt(){var e;if(!N||!((e=window.google)!=null&&e.maps))return;const l=Me[ne.value]||Me.roadmap;try{N.setMapTypeId(l.mapTypeId)}catch{}}function Ct(){var l;ct();try{(ge.markers||[]).forEach(e=>{try{e.setMap(null)}catch{}})}catch{}ge.markers=[];try{(l=ge.polyline)==null||l.setMap(null)}catch{}ge.polyline=null}function Pe(l){try{Array.from(l.values()).forEach(e=>{try{e.setMap(null)}catch{}})}catch{}try{l.clear()}catch{}}function Bt(){var e;if(!((e=window.google)!=null&&e.maps)||!it.value)return;const l=Me[ne.value]||Me.roadmap;N=new window.google.maps.Map(it.value,{center:{lat:-2.5489,lng:118.0149},zoom:5,mapTypeId:l.mapTypeId,clickableIcons:!1,fullscreenControl:!1,streetViewControl:!1,mapTypeControl:!1}),H=new window.google.maps.InfoWindow,N.addListener("click",Wt)}function Kt(){var l;if(!((l=window.google)!=null&&l.maps)){N=null,H=null;return}try{window.google.maps.event.clearInstanceListeners(N)}catch{}try{H==null||H.close()}catch{}Ct(),Pe(dt),Pe(ut),Pe(pt),N=null,H=null}const w=m(null),J=m(null),z=m(!0),pe=m(!1);let ve=[],vt=null,Ie=[];function Ht(l){var e,o,s,i;if(l){try{if(typeof l.remove=="function"){l.remove();return}}catch{}try{(i=(s=(o=(e=window.google)==null?void 0:e.maps)==null?void 0:o.event)==null?void 0:s.removeListener)==null||i.call(s,l)}catch{}}}function ct(){try{(Ie||[]).forEach(l=>Ht(l))}catch{}Ie=[]}function Te(l){const e=Number(l);return Number.isFinite(e)?Math.round(e*1e7)/1e7:null}function Jt(){var l;return(l=window.google)!=null&&l.maps?(vt||(vt=new window.google.maps.DirectionsService),vt):null}async function zt(l,e){const o=Jt();if(!o)throw new Error("Google Maps Directions belum siap.");const s={origin:l,destination:e,travelMode:window.google.maps.TravelMode.DRIVING};return new Promise((i,p)=>{try{o.route(s,(v,u)=>{var se;if(u!=="OK"||!((se=v==null?void 0:v.routes)!=null&&se[0])){p(new Error(`Gagal ambil rute jalan (${u||"UNKNOWN"}).`));return}const O=(v.routes[0].overview_path||[]).map(G=>({lat:Te(G.lat()),lng:Te(G.lng())})).filter(G=>Number.isFinite(G.lat)&&Number.isFinite(G.lng));i(O)})}catch(v){p(v)}})}async function Wt(l){if(!(l!=null&&l.latLng))return;const e=Te(l.latLng.lat()),o=Te(l.latLng.lng());if(w.value==="pickPoint"){f.value.latitude=e,f.value.longitude=o,c&&c.success("Lokasi titik dipilih dari peta."),S();return}if(w.value==="pickBreak"){x.value.latitude=e,x.value.longitude=o,c&&c.success("Lokasi putus dipilih dari peta."),S();return}if(w.value==="drawCable"){const s=Array.isArray(b.value.path)?b.value.path:[];if(!Number.isFinite(e)||!Number.isFinite(o))return;if(s.length<1||!z.value){ve.push(s.length),s.push({lat:e,lng:o}),b.value.path=s,le();return}if(pe.value)return;ve.push(s.length),pe.value=!0;try{const i=s[s.length-1],p=await zt({lat:Number(i==null?void 0:i.lat),lng:Number(i==null?void 0:i.lng)},{lat:e,lng:o});if(Array.isArray(p)&&p.length>=2){const v=p.slice(1);b.value.path=s.concat(v)}else s.push({lat:e,lng:o}),b.value.path=s}catch(i){s.push({lat:e,lng:o}),b.value.path=s,c&&c.error((i==null?void 0:i.message)||"Gagal mengikuti jalan. Pakai garis lurus.")}finally{pe.value=!1,le()}}}function S(l={}){const e=(l==null?void 0:l.reopen)!==!1,o=e?J.value:null;ct(),w.value=null,J.value=null,e&&o&&(o==="cable"&&(R.value=!0),o==="point"&&(X.value=!0),o==="break"&&(Z.value=!0)),le()}function Xt(l){const e=document.createElement("div");return e.className="text-sm",(l||[]).forEach(o=>{const s=document.createElement("div");s.textContent=String(o??""),e.appendChild(s)}),e}function bt(l,e,o=null){if(!N||!H)return;const s=(e||[]).filter(Boolean);if(!(s.length<1)){try{H.close()}catch{}H.setContent(Xt(s));try{if(o){H.open({map:N,anchor:o});return}l&&H.setPosition(l),H.open({map:N})}catch{}}}function ae(l){const e=Number(l||0);if(!e)return null;const o=(K.value||[]).find(s=>Number(s==null?void 0:s.id)===e);return o?String(o.name||""):null}function ce(l){const e=Number(l||0);if(!e)return null;const o=(B.value||[]).find(s=>Number(s==null?void 0:s.id)===e);return o?String(o.name||""):null}function Zt(l){const e=String(l||"").toUpperCase();return e==="OPEN"?{stroke:"#dc2626",fill:"#ef4444"}:e==="IN_PROGRESS"?{stroke:"#b45309",fill:"#f59e0b"}:e==="FIXED"?{stroke:"#047857",fill:"#10b981"}:{stroke:"#64748b",fill:"#94a3b8"}}function Nt(){var l;!N||!((l=window.google)!=null&&l.maps)||(Fe(),gt(),mt(),le())}function Fe(){var l;!N||!((l=window.google)!=null&&l.maps)||(Pe(dt),Oe.value&&(B.value||[]).forEach(e=>{const o=Array.isArray(e==null?void 0:e.path)?e.path:null;if(!o||o.length<2)return;const s=o.map(M=>({lat:Number(M==null?void 0:M.lat),lng:Number(M==null?void 0:M.lng)})).filter(M=>Number.isFinite(M.lat)&&Number.isFinite(M.lng));if(s.length<2)return;const i=Number(e==null?void 0:e.id)===Number(ee.value||0),p=ht.value.size>0,v=ht.value.has(Number(e==null?void 0:e.id)),u=((e==null?void 0:e.map_color)||"#2563eb").toString(),h=i?6:4,O=v?Math.max(h,6):h,se=p?v?1:.25:.9,G=new window.google.maps.Polyline({path:s,strokeColor:u,strokeWeight:O,strokeOpacity:se,clickable:!0});G.setMap(N),dt.set(Number(e==null?void 0:e.id)||0,G);const $=ae(e==null?void 0:e.from_point_id)||"-",he=ae(e==null?void 0:e.to_point_id)||"-";G.addListener("click",M=>{ee.value=e.id,A.value=null,te.value=null,L.value="cables",Fe(),bt((M==null?void 0:M.latLng)||null,[`Kabel: ${(e==null?void 0:e.name)||"-"}`,e!=null&&e.code?`Kode: ${e.code}`:null,e!=null&&e.cable_type?`Tipe: ${e.cable_type}`:null,e!=null&&e.core_count?`Core: ${e.core_count}`:null,`Dari: ${$}`,`Ke: ${he}`])})}))}function gt(){var l;!N||!((l=window.google)!=null&&l.maps)||(Pe(ut),Ue.value&&(K.value||[]).forEach(e=>{const o=Number(e==null?void 0:e.latitude),s=Number(e==null?void 0:e.longitude);if(!Number.isFinite(o)||!Number.isFinite(s))return;const i=Number(e==null?void 0:e.id)===Number(A.value||0),p=new window.google.maps.Marker({position:{lat:o,lng:s},map:N,title:((e==null?void 0:e.name)||"").toString(),clickable:!0,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:i?7:6,fillColor:"#14b8a6",fillOpacity:.9,strokeColor:"#0f766e",strokeWeight:2}});ut.set(Number(e==null?void 0:e.id)||0,p),p.addListener("click",()=>{A.value=e.id,ee.value=null,te.value=null,L.value="points",gt(),bt(p.getPosition(),[`Titik: ${(e==null?void 0:e.name)||"-"}`,e!=null&&e.point_type?`Tipe: ${e.point_type}`:null,`Koordinat: ${o}, ${s}`],p)})}))}function mt(){var l;!N||!((l=window.google)!=null&&l.maps)||(Pe(pt),$e.value&&(Ne.value||[]).forEach(e=>{const o=Number(e==null?void 0:e.latitude),s=Number(e==null?void 0:e.longitude);if(!Number.isFinite(o)||!Number.isFinite(s))return;const i=Zt(e==null?void 0:e.status),p=Number(e==null?void 0:e.id)===Number(te.value||0),v=new window.google.maps.Marker({position:{lat:o,lng:s},map:N,title:`PUTUS: ${String((e==null?void 0:e.status)||"OPEN").toUpperCase()}`,clickable:!0,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:p?8:7,fillColor:i.fill,fillOpacity:.9,strokeColor:i.stroke,strokeWeight:2}});pt.set(Number(e==null?void 0:e.id)||0,v),v.addListener("click",()=>{te.value=e.id,ee.value=null,A.value=null,L.value="breaks",mt();const u=ce(e==null?void 0:e.cable_id)||(e!=null&&e.cable_id?`#${e.cable_id}`:"-"),h=ae(e==null?void 0:e.point_id)||(e!=null&&e.point_id?`#${e.point_id}`:"-");bt(v.getPosition(),[`PUTUS: ${String((e==null?void 0:e.status)||"OPEN").toUpperCase()}`,`Kabel: ${u}`,`Titik: ${h}`,e!=null&&e.severity?`Severity: ${e.severity}`:null],v)})}))}function qt(l){var e,o,s;try{const i=(e=l==null?void 0:l.getPath)==null?void 0:e.call(l);if(!i||typeof i.getLength!="function")return;const p=[];for(let v=0;v<i.getLength();v+=1){const u=i.getAt(v),h=Te((o=u==null?void 0:u.lat)==null?void 0:o.call(u)),O=Te((s=u==null?void 0:u.lng)==null?void 0:s.call(u));!Number.isFinite(h)||!Number.isFinite(O)||p.push({lat:h,lng:O})}b.value.path=p}catch{}}function Yt(l){var s,i;if(ct(),!l||!((s=window.google)!=null&&s.maps))return;const e=(i=l.getPath)==null?void 0:i.call(l);if(!e||typeof e.addListener!="function")return;const o=()=>qt(l);Ie.push(e.addListener("insert_at",o)),Ie.push(e.addListener("set_at",o)),Ie.push(e.addListener("remove_at",o)),o()}function le(){var e;if(!N||!((e=window.google)!=null&&e.maps))return;Ct();const l=(o,s,i={})=>{if(!Number.isFinite(o)||!Number.isFinite(s))return;const p=new window.google.maps.Marker({position:{lat:o,lng:s},map:N,clickable:!1,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:Number(i.scale??6),fillColor:(i.fillColor||"#38bdf8").toString(),fillOpacity:Number(i.fillOpacity??.9),strokeColor:(i.strokeColor||"#0ea5e9").toString(),strokeWeight:Number(i.strokeWeight??2)}});ge.markers.push(p)};if((X.value||w.value==="pickPoint")&&f.value.latitude!==null&&f.value.longitude!==null){const o=Number(f.value.latitude),s=Number(f.value.longitude);Number.isFinite(o)&&Number.isFinite(s)&&l(o,s,{scale:7,strokeColor:"#0ea5e9",fillColor:"#38bdf8",fillOpacity:.85})}if((Z.value||w.value==="pickBreak")&&x.value.latitude!==null&&x.value.longitude!==null){const o=Number(x.value.latitude),s=Number(x.value.longitude);Number.isFinite(o)&&Number.isFinite(s)&&l(o,s,{scale:8,strokeColor:"#f97316",fillColor:"#fb923c",fillOpacity:.85})}if((R.value||w.value==="drawCable"||w.value==="editCable")&&Array.isArray(b.value.path)&&b.value.path.length>0){const o=w.value==="editCable",s=b.value.path.map(i=>({lat:Number(i==null?void 0:i.lat),lng:Number(i==null?void 0:i.lng)})).filter(i=>Number.isFinite(i.lat)&&Number.isFinite(i.lng));if(o||s.forEach(i=>{l(i.lat,i.lng,{scale:3,strokeColor:"#1d4ed8",fillColor:"#60a5fa",fillOpacity:.95})}),s.length>=2){const i={path:"M 0,-1 0,1",strokeOpacity:1,strokeColor:"#1d4ed8",scale:3};ge.polyline=new window.google.maps.Polyline({path:s,strokeColor:"#1d4ed8",strokeOpacity:o?.85:0,strokeWeight:o?4:0,icons:o?[]:[{icon:i,offset:"0",repeat:"12px"}],clickable:o,editable:o,map:N}),o&&Yt(ge.polyline)}}}function Qt(){var o;if(!N||wt||!((o=window.google)!=null&&o.maps))return;const l=new window.google.maps.LatLngBounds;let e=!1;try{Oe.value&&(B.value||[]).forEach(s=>{const i=Array.isArray(s==null?void 0:s.path)?s.path:null;!i||i.length<1||i.forEach(p=>{const v=Number(p==null?void 0:p.lat),u=Number(p==null?void 0:p.lng);!Number.isFinite(v)||!Number.isFinite(u)||(l.extend({lat:v,lng:u}),e=!0)})})}catch{}try{Ue.value&&(K.value||[]).forEach(s=>{const i=Number(s==null?void 0:s.latitude),p=Number(s==null?void 0:s.longitude);!Number.isFinite(i)||!Number.isFinite(p)||(l.extend({lat:i,lng:p}),e=!0)})}catch{}try{$e.value&&(Ne.value||[]).forEach(s=>{const i=Number(s==null?void 0:s.latitude),p=Number(s==null?void 0:s.longitude);!Number.isFinite(i)||!Number.isFinite(p)||(l.extend({lat:i,lng:p}),e=!0)})}catch{}if(e)try{N.fitBounds(l),wt=!0}catch{}}function ea(l){const e=String(l||"OPEN").toUpperCase();return e==="IN_PROGRESS"?"IN PROGRESS":e}function Pt(l){if(!l)return"";const e=new Date(l);if(!Number.isFinite(e.getTime()))return"";const o=s=>String(s).padStart(2,"0");return`${e.getFullYear()}-${o(e.getMonth()+1)}-${o(e.getDate())}T${o(e.getHours())}:${o(e.getMinutes())}`}function ye(l,e,o=17){var s;if(!(!N||!((s=window.google)!=null&&s.maps)||!Number.isFinite(l)||!Number.isFinite(e))){try{N.panTo({lat:l,lng:e})}catch{}if(Number.isFinite(Number(o)))try{N.setZoom(Number(o))}catch{}}}function Ze(){var l;return me.value?(c&&c.error(me.value),!1):!N||!((l=window.google)!=null&&l.maps)?(c&&c.error("Peta belum siap."),!1):!0}const R=m(!1),qe=m("create"),Ye=m(!1),W=m({}),b=m({id:null,name:"",code:"",cable_type:"",core_count:"",map_color:"#2563eb",from_point_id:"",to_point_id:"",path:[],notes:""});function Tt(){b.value={id:null,name:"",code:"",cable_type:"",core_count:"",map_color:"#2563eb",from_point_id:"",to_point_id:"",path:[],notes:""},W.value={}}function ta(){q.value&&(Tt(),qe.value="create",ve=[],R.value=!0,J.value=null,S({reopen:!1}))}function aa(l){if(!Y.value)return;Tt(),qe.value="edit",ve=[],b.value={id:l.id,name:l.name||"",code:l.code||"",cable_type:l.cable_type||"",core_count:l.core_count??"",map_color:l.map_color||"#2563eb",from_point_id:l.from_point_id??"",to_point_id:l.to_point_id??"",path:Array.isArray(l.path)?l.path.slice():[],notes:l.notes||""},R.value=!0,J.value=null,S({reopen:!1});const e=(b.value.path||[])[0];e&&Number.isFinite(Number(e.lat))&&Number.isFinite(Number(e.lng))&&ye(Number(e.lat),Number(e.lng),16)}async function la(){var i,p,v;Ye.value=!0,W.value={};const l={name:b.value.name,code:b.value.code||null,cable_type:b.value.cable_type||null,core_count:b.value.core_count!==""?Number(b.value.core_count):null,map_color:b.value.map_color||null,from_point_id:b.value.from_point_id!==""?Number(b.value.from_point_id):null,to_point_id:b.value.to_point_id!==""?Number(b.value.to_point_id):null,path:Array.isArray(b.value.path)&&b.value.path.length>=2?b.value.path:null,notes:b.value.notes||null},e=qe.value==="edit"&&b.value.id,o=e?`/api/v1/fiber/cables/${b.value.id}`:"/api/v1/fiber/cables",s=e?"PUT":"POST";try{const u=await D(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(W.value=u.data.errors,new Error(((p=u.data)==null?void 0:p.message)||"Validasi gagal.")):new Error(((v=u.data)==null?void 0:v.message)||`Gagal menyimpan kabel (HTTP ${u.status}).`);R.value=!1,S(),await F(),c&&c.success("Kabel tersimpan.")}catch(u){console.error("Fiber: saveCable failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan kabel.")}finally{Ye.value=!1}}async function sa(l){var o;if(!(!Q.value||!confirm(`Hapus kabel "${(l==null?void 0:l.name)||""}"?`)))try{const s=await D(`/api/v1/fiber/cables/${l.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus kabel (HTTP ${s.status}).`);c&&c.success("Kabel dihapus."),Number(ee.value)===Number(l.id)&&(ee.value=null),await F()}catch(s){console.error("Fiber: deleteCable failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus kabel.")}}function oa(){R.value&&Ze()&&(J.value="cable",R.value=!1,ve=[],w.value="drawCable",le(),c&&c.info(z.value?"Mode gambar jalur aktif (ikut jalan): klik peta untuk set titik berikutnya, lalu klik Selesai untuk kembali.":"Mode gambar jalur aktif: klik peta untuk menambah titik, lalu klik Selesai untuk kembali."))}function ra(){if(!R.value||!Ze())return;if((Array.isArray(b.value.path)?b.value.path:[]).length<2){c&&c.error("Jalur belum ada. Klik Gambar dulu minimal 2 titik.");return}J.value="cable",R.value=!1,w.value="editCable",le(),c&&c.info("Mode edit jalur aktif: geser titik/segmen di peta, lalu klik Selesai untuk kembali.")}function St(){const l=Array.isArray(b.value.path)?b.value.path:[];if(l.length!==0){if(ve.length>0){const e=Number(ve.pop());Number.isFinite(e)&&e>=0?b.value.path=l.slice(0,e):(l.pop(),b.value.path=l)}else l.pop(),b.value.path=l;le()}}function yt(){b.value.path=[],ve=[],le()}const X=m(!1),Qe=m("create"),et=m(!1),ie=m({}),f=m({id:null,name:"",point_type:"",latitude:null,longitude:null,address:"",notes:""});function Et(){f.value={id:null,name:"",point_type:"",latitude:null,longitude:null,address:"",notes:""},ie.value={}}function na(){q.value&&(Et(),Qe.value="create",X.value=!0,J.value=null,S({reopen:!1}))}function ia(l){if(!Y.value)return;Et(),Qe.value="edit",f.value={id:l.id,name:l.name||"",point_type:l.point_type||"",latitude:l.latitude??null,longitude:l.longitude??null,address:l.address||"",notes:l.notes||""},X.value=!0,J.value=null,S({reopen:!1});const e=Number(f.value.latitude),o=Number(f.value.longitude);Number.isFinite(e)&&Number.isFinite(o)&&ye(e,o,17)}function da(){X.value&&Ze()&&(J.value="point",X.value=!1,w.value="pickPoint",le(),c&&c.info("Klik peta untuk memilih lokasi titik."))}async function ua(){var i,p,v;et.value=!0,ie.value={};const l={name:f.value.name,point_type:f.value.point_type||null,latitude:f.value.latitude,longitude:f.value.longitude,address:f.value.address||null,notes:f.value.notes||null},e=Qe.value==="edit"&&f.value.id,o=e?`/api/v1/fiber/points/${f.value.id}`:"/api/v1/fiber/points",s=e?"PUT":"POST";try{const u=await D(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(ie.value=u.data.errors,new Error(((p=u.data)==null?void 0:p.message)||"Validasi gagal.")):new Error(((v=u.data)==null?void 0:v.message)||`Gagal menyimpan titik (HTTP ${u.status}).`);X.value=!1,S(),await F(),c&&c.success("Titik tersimpan.")}catch(u){console.error("Fiber: savePoint failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan titik.")}finally{et.value=!1}}async function pa(l){var o;if(!(!Q.value||!confirm(`Hapus titik "${(l==null?void 0:l.name)||""}"?`)))try{const s=await D(`/api/v1/fiber/points/${l.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus titik (HTTP ${s.status}).`);c&&c.success("Titik dihapus."),Number(A.value)===Number(l.id)&&(A.value=null),await F()}catch(s){console.error("Fiber: deletePoint failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus titik.")}}const Z=m(!1),tt=m("create"),at=m(!1),ke=m({}),x=m({id:null,cable_id:"",point_id:"",status:"OPEN",severity:"",reported_at:"",fixed_at:"",latitude:null,longitude:null,description:""});function Lt(){x.value={id:null,cable_id:"",point_id:"",status:"OPEN",severity:"",reported_at:"",fixed_at:"",latitude:null,longitude:null,description:""},ke.value={}}function va(){q.value&&(Lt(),tt.value="create",Z.value=!0,J.value=null,S({reopen:!1}))}function ca(l){if(!Y.value)return;Lt(),tt.value="edit",x.value={id:l.id,cable_id:l.cable_id??"",point_id:l.point_id??"",status:(l.status||"OPEN").toString().toUpperCase(),severity:l.severity||"",reported_at:Pt(l.reported_at),fixed_at:Pt(l.fixed_at),latitude:l.latitude??null,longitude:l.longitude??null,description:l.description||""},Z.value=!0,J.value=null,S({reopen:!1});const e=Number(x.value.latitude),o=Number(x.value.longitude);Number.isFinite(e)&&Number.isFinite(o)&&ye(e,o,17)}function ba(){Z.value&&Ze()&&(J.value="break",Z.value=!1,w.value="pickBreak",le(),c&&c.info("Klik peta untuk memilih lokasi putus."))}async function ga(){var i,p,v;at.value=!0,ke.value={};const l={cable_id:x.value.cable_id!==""?Number(x.value.cable_id):null,point_id:x.value.point_id!==""?Number(x.value.point_id):null,status:(x.value.status||"OPEN").toString().toUpperCase(),severity:x.value.severity||null,reported_at:x.value.reported_at||null,fixed_at:x.value.fixed_at||null,latitude:x.value.latitude,longitude:x.value.longitude,description:x.value.description||null},e=tt.value==="edit"&&x.value.id,o=e?`/api/v1/fiber/breaks/${x.value.id}`:"/api/v1/fiber/breaks",s=e?"PUT":"POST";try{const u=await D(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(ke.value=u.data.errors,new Error(((p=u.data)==null?void 0:p.message)||"Validasi gagal.")):new Error(((v=u.data)==null?void 0:v.message)||`Gagal menyimpan data putus (HTTP ${u.status}).`);Z.value=!1,S(),await F(),c&&c.success("Data putus tersimpan.")}catch(u){console.error("Fiber: saveBreak failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan data putus.")}finally{at.value=!1}}async function ma(l){var o;if(!(!Q.value||!confirm("Hapus data putus ini?")))try{const s=await D(`/api/v1/fiber/breaks/${l.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus data putus (HTTP ${s.status}).`);c&&c.success("Data putus dihapus."),Number(te.value)===Number(l.id)&&(te.value=null),await F()}catch(s){console.error("Fiber: deleteBreak failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus data putus.")}}const xe=m(!1),lt=m("create"),st=m(!1),fe=m({}),P=m({id:null,point_id:"",port_type:"OLT_PON",port_label:"",cable_id:"",core_no:"",notes:""});function Ot(){P.value={id:null,point_id:"",port_type:"OLT_PON",port_label:"",cable_id:"",core_no:"",notes:""},fe.value={}}function ya(){q.value&&(Ot(),A.value&&(P.value.point_id=String(A.value)),lt.value="create",xe.value=!0)}function ka(l){Y.value&&(Ot(),lt.value="edit",P.value={id:l.id,point_id:l.point_id??"",port_type:l.port_type||"OLT_PON",port_label:l.port_label||"",cable_id:l.cable_id??"",core_no:l.core_no??"",notes:l.notes||""},xe.value=!0)}async function xa(){var i,p,v;st.value=!0,fe.value={};const l={point_id:P.value.point_id!==""?Number(P.value.point_id):null,port_type:(P.value.port_type||"OLT_PON").toString().toUpperCase(),port_label:P.value.port_label||"",cable_id:P.value.cable_id!==""?Number(P.value.cable_id):null,core_no:P.value.core_no!==""?Number(P.value.core_no):null,notes:P.value.notes||null},e=lt.value==="edit"&&P.value.id,o=e?`/api/v1/fiber/ports/${P.value.id}`:"/api/v1/fiber/ports",s=e?"PUT":"POST";try{const u=await D(o,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok)throw u.status===422&&((i=u.data)!=null&&i.errors)?(fe.value=u.data.errors,new Error(((p=u.data)==null?void 0:p.message)||"Validasi gagal.")):new Error(((v=u.data)==null?void 0:v.message)||`Gagal menyimpan port (HTTP ${u.status}).`);xe.value=!1,await F(),c&&c.success("Port tersimpan.")}catch(u){console.error("Fiber: savePort failed",u),c&&c.error((u==null?void 0:u.message)||"Gagal menyimpan port.")}finally{st.value=!1}}async function fa(l){var o;if(!(!Q.value||!confirm(`Hapus port "${(l==null?void 0:l.port_label)||""}"?`)))try{const s=await D(`/api/v1/fiber/ports/${l.id}`,{method:"DELETE"});if(!s.ok)throw new Error(((o=s.data)==null?void 0:o.message)||`Gagal hapus port (HTTP ${s.status}).`);c&&c.success("Port dihapus."),await F()}catch(s){console.error("Fiber: deletePort failed",s),c&&c.error((s==null?void 0:s.message)||"Gagal hapus port.")}}const be=m(!1),ot=m("create"),rt=m(!1),de=m({}),Ve=m(8),y=m({id:null,point_id:"",link_type:"SPLICE",from_cable_id:"",from_core_no:"",to_cable_id:"",to_core_no:"",split_group:"",outputs:[],loss_db:"",notes:""}),Ut=ue(()=>{const l=Array.isArray(We.value)?We.value:[],e=[],o={};return l.forEach(s=>{const i=((s==null?void 0:s.link_type)||"").toString().toUpperCase(),p=((s==null?void 0:s.split_group)||"").toString();if(i==="SPLIT"&&p){const v=`${Number(s.point_id)||0}|${p}`;o[v]||(o[v]={kind:"SPLIT_GROUP",id:s.id,point_id:s.point_id,link_type:"SPLIT",split_group:p,from_cable_id:s.from_cable_id,from_core_no:s.from_core_no,loss_db:s.loss_db??null,notes:s.notes||"",outputs:[],link_ids:[]}),o[v].outputs.push({to_cable_id:s.to_cable_id,to_core_no:s.to_core_no}),o[v].link_ids.push(s.id);return}e.push({kind:"LINK",...s||{}})}),Object.values(o).forEach(s=>{s.outputs=(s.outputs||[]).filter(i=>(i==null?void 0:i.to_cable_id)&&(i==null?void 0:i.to_core_no)),e.push(s)}),e.sort((s,i)=>{const p=Number((s==null?void 0:s.point_id)||0),v=Number((i==null?void 0:i.point_id)||0);if(p!==v)return p-v;const u=((s==null?void 0:s.link_type)||"").toString(),h=((i==null?void 0:i.link_type)||"").toString();return u.localeCompare(h)}),e});function $t(){y.value={id:null,point_id:"",link_type:"SPLICE",from_cable_id:"",from_core_no:"",to_cable_id:"",to_core_no:"",split_group:"",outputs:[],loss_db:"",notes:""},de.value={},Ve.value=8}function _a(l){const e=Math.max(1,Math.min(64,Number(l)||1));y.value.outputs=Array.from({length:e}).map(()=>({to_cable_id:"",to_core_no:""}))}function ha(){const l=Array.isArray(y.value.outputs)?y.value.outputs:[];l.push({to_cable_id:"",to_core_no:""}),y.value.outputs=l}function wa(l){const e=Array.isArray(y.value.outputs)?y.value.outputs:[];l<0||l>=e.length||(e.splice(l,1),y.value.outputs=e)}function Ca(){q.value&&($t(),A.value&&(y.value.point_id=String(A.value)),ot.value="create",be.value=!0)}function Na(l){if(Y.value){if($t(),ot.value="edit",(l==null?void 0:l.kind)==="SPLIT_GROUP"){y.value={id:l.id,point_id:l.point_id??"",link_type:"SPLIT",from_cable_id:l.from_cable_id??"",from_core_no:l.from_core_no??"",to_cable_id:"",to_core_no:"",split_group:l.split_group||"",outputs:(l.outputs||[]).map(e=>({to_cable_id:e.to_cable_id??"",to_core_no:e.to_core_no??""})),loss_db:l.loss_db??"",notes:l.notes||""},Ve.value=(y.value.outputs||[]).length||8,be.value=!0;return}y.value={id:l.id,point_id:l.point_id??"",link_type:(l.link_type||"SPLICE").toString().toUpperCase(),from_cable_id:l.from_cable_id??"",from_core_no:l.from_core_no??"",to_cable_id:l.to_cable_id??"",to_core_no:l.to_core_no??"",split_group:l.split_group||"",outputs:[],loss_db:l.loss_db??"",notes:l.notes||""},be.value=!0}}async function Pa(){var p,v,u;rt.value=!0,de.value={};const l=(y.value.link_type||"SPLICE").toString().toUpperCase(),e={point_id:y.value.point_id!==""?Number(y.value.point_id):null,link_type:l,from_cable_id:y.value.from_cable_id!==""?Number(y.value.from_cable_id):null,from_core_no:y.value.from_core_no!==""?Number(y.value.from_core_no):null,split_group:y.value.split_group||null,loss_db:y.value.loss_db!==""?Number(y.value.loss_db):null,notes:y.value.notes||null};if(l==="SPLIT"){const h=Array.isArray(y.value.outputs)?y.value.outputs:[];e.outputs=h.map(O=>({to_cable_id:O.to_cable_id!==""?Number(O.to_cable_id):null,to_core_no:O.to_core_no!==""?Number(O.to_core_no):null})).filter(O=>O.to_cable_id&&O.to_core_no)}else e.to_cable_id=y.value.to_cable_id!==""?Number(y.value.to_cable_id):null,e.to_core_no=y.value.to_core_no!==""?Number(y.value.to_core_no):null;const o=ot.value==="edit"&&y.value.id,s=o?`/api/v1/fiber/links/${y.value.id}`:"/api/v1/fiber/links",i=o?"PUT":"POST";try{const h=await D(s,{method:i,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!h.ok)throw h.status===422&&((p=h.data)!=null&&p.errors)?(de.value=h.data.errors,new Error(((v=h.data)==null?void 0:v.message)||"Validasi gagal.")):new Error(((u=h.data)==null?void 0:u.message)||`Gagal menyimpan sambungan (HTTP ${h.status}).`);be.value=!1,await F(),c&&c.success("Sambungan tersimpan.")}catch(h){console.error("Fiber: saveLink failed",h),c&&c.error((h==null?void 0:h.message)||"Gagal menyimpan sambungan.")}finally{rt.value=!1}}async function Ta(l){var s;if(!Q.value)return;const e=(l==null?void 0:l.kind)==="SPLIT_GROUP"?`splitter "${(l==null?void 0:l.split_group)||""}"`:"sambungan ini";if(confirm(`Hapus ${e}?`))try{const i=await D(`/api/v1/fiber/links/${l.id}`,{method:"DELETE"});if(!i.ok)throw new Error(((s=i.data)==null?void 0:s.message)||`Gagal hapus sambungan (HTTP ${i.status}).`);c&&c.success("Sambungan dihapus."),await F()}catch(i){console.error("Fiber: deleteLink failed",i),c&&c.error((i==null?void 0:i.message)||"Gagal hapus sambungan.")}}const Ge=m(""),Se=m(!1),Ee=m(""),_e=m(null),Sa=ue(()=>(Le.value||[]).filter(l=>((l==null?void 0:l.port_type)||"").toString().toUpperCase()==="OLT_PON"));function Ea(){re.value=null,Ee.value="",_e.value=null,Xe.value=[],Fe()}async function La(){var l,e,o,s,i,p;if(Ge.value){Se.value=!0,Ee.value="",re.value=null,_e.value=null,Xe.value=[];try{const v=await D(`/api/v1/fiber/trace/${Number(Ge.value)}?stop_at_odp_out=1`);if(!v.ok)throw new Error(((l=v.data)==null?void 0:l.message)||`Gagal trace (HTTP ${v.status}).`);re.value=((e=v.data)==null?void 0:e.data)||null,Xe.value=((s=(o=v.data)==null?void 0:o.data)==null?void 0:s.used_cable_ids)||[],Fe();const u=((p=(i=v.data)==null?void 0:i.data)==null?void 0:p.endpoints)||[];u.length>0&&(_e.value=u[0]),c&&c.success("Trace selesai.")}catch(v){console.error("Fiber: runTrace failed",v),Ee.value=(v==null?void 0:v.message)||"Gagal trace.",c&&c.error(Ee.value)}finally{Se.value=!1}}}return kt([Oe,Ue,$e],()=>{Nt()}),kt(ne,()=>{try{localStorage.setItem("fiber_map_style",ne.value)}catch{}Rt()}),kt(z,()=>{try{localStorage.setItem("fiber_follow_road",z.value?"1":"0")}catch{}}),Ua(()=>{try{const e=localStorage.getItem("fiber_map_style");e&&Me[e]&&(ne.value=e)}catch{}try{const e=localStorage.getItem("fiber_follow_road");e==="0"&&(z.value=!1),e==="1"&&(z.value=!0)}catch{}me.value="";const l=(nt.googleMapsApiKey||"").toString().trim();if(!l){me.value="Google Maps API key belum di-set. Buka Pengaturan -> System -> Google Maps.",F();return}Dt(l).then(()=>{$a(()=>{Bt(),F()})}).catch(e=>{console.error("Fiber: Google Maps load failed",e),me.value=(e==null?void 0:e.message)||"Gagal memuat Google Maps.",F()})}),Ma(()=>{Kt()}),(l,e)=>(n(),r(E,null,[Vt(Ia(Fa),{title:"Kabel FO"}),Vt(Aa,null,{default:Va(()=>{var o,s,i,p,v,u,h,O,se,G,$,he,M,Mt,It;return[t("div",ja,[t("div",Da,[e[76]||(e[76]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Manajemen Kabel FO"),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Pemetaan jalur kabel, titik sambungan, dan data putus.")],-1)),t("div",Ra,[t("div",Ba,[t("span",Ka,d(Ce.value.cables),1),e[72]||(e[72]=t("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"kabel",-1))]),t("div",Ha,[t("span",Ja,d(Ce.value.points),1),e[73]||(e[73]=t("span",{class:"text-gray-500 dark:text-gray-400 ml-1"},"titik",-1))]),t("div",za,[t("span",Wa,d(Ce.value.breaks_open),1),e[74]||(e[74]=t("span",{class:"text-red-600/70 dark:text-red-300/70 ml-1"},"putus aktif",-1))]),t("div",Xa,[k(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>ne.value=a),class:"input !py-2 !text-xs"},[...e[75]||(e[75]=[t("option",{value:"roadmap"},"Roadmap",-1),t("option",{value:"hybrid"},"Hybrid",-1),t("option",{value:"satellite"},"Satelit",-1)])],512),[[I,ne.value]]),t("button",{onClick:F,class:"btn btn-secondary !py-2 !text-xs",disabled:we.value},"Refresh",8,Za)])])]),nt.warning?(n(),r("div",qa,d(nt.warning),1)):g("",!0),_t.value?(n(),r("div",Qa,[t("div",el,[t("div",tl,[t("label",al,[k(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>Oe.value=a)},null,512),[[He,Oe.value]]),e[78]||(e[78]=_(" Kabel ",-1))]),t("label",ll,[k(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=a=>Ue.value=a)},null,512),[[He,Ue.value]]),e[79]||(e[79]=_(" Titik ",-1))]),t("label",sl,[k(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>$e.value=a)},null,512),[[He,$e.value]]),e[80]||(e[80]=_(" Putus ",-1))]),t("div",ol,[k(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>ne.value=a),class:"input !py-2 !text-xs"},[...e[81]||(e[81]=[t("option",{value:"roadmap"},"Roadmap",-1),t("option",{value:"hybrid"},"Hybrid",-1),t("option",{value:"satellite"},"Satelit",-1)])],512),[[I,ne.value]]),t("button",{onClick:F,class:"btn btn-secondary !py-2 !text-xs",disabled:we.value},"Refresh",8,rl)])]),t("div",nl,[t("div",{ref_key:"mapContainer",ref:it,class:"w-full h-[420px] lg:h-[calc(100vh-13rem)] bg-slate-100 dark:bg-slate-900"},null,512),me.value?(n(),r("div",il,[t("div",dl,[e[82]||(e[82]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Peta tidak dapat dimuat",-1)),t("div",ul,d(me.value),1)])])):g("",!0),w.value?(n(),r("div",pl,[t("div",vl,[e[83]||(e[83]=_(" Mode peta aktif: ",-1)),t("span",cl,d(w.value==="drawCable"?"gambar kabel":w.value==="editCable"?"edit jalur":w.value==="pickPoint"?"pilih titik":"pilih putus"),1)]),w.value==="editCable"?(n(),r("div",bl," Geser titik/segmen untuk merapikan jalur, lalu klik tombol Selesai. ")):w.value==="drawCable"?(n(),r("div",gl,[e[84]||(e[84]=_(" Klik peta untuk menambah titik. Mode: ",-1)),t("span",ml,d(z.value?"Ikuti jalan":"Garis lurus"),1),e[85]||(e[85]=_(". ",-1)),pe.value?(n(),r("span",yl,"Menghitung rute...")):g("",!0)])):(n(),r("div",kl," Klik peta untuk memilih lokasi, lalu klik tombol Selesai. ")),w.value==="drawCable"?(n(),r("label",xl,[k(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=a=>z.value=a),disabled:pe.value},null,8,fl),[[He,z.value]]),e[86]||(e[86]=_(" Ikuti jalan ",-1))])):g("",!0),t("div",_l,[t("button",{class:"btn btn-secondary !py-1 !text-xs",onClick:S,disabled:w.value==="drawCable"&&pe.value},"Selesai",8,hl),w.value==="drawCable"?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !text-xs",onClick:St,disabled:pe.value},"Undo",8,wl)):g("",!0),w.value==="drawCable"?(n(),r("button",{key:1,class:"btn btn-secondary !py-1 !text-xs",onClick:yt,disabled:pe.value},"Clear",8,Cl)):g("",!0),w.value==="editCable"?(n(),r("button",{key:2,class:"btn btn-secondary !py-1 !text-xs",onClick:yt},"Clear")):g("",!0)])])):g("",!0)])]),t("div",Nl,[t("div",Pl,[t("button",{onClick:e[6]||(e[6]=a=>L.value="cables"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",L.value==="cables"?"text-blue-700 dark:text-blue-300 bg-blue-50/60 dark:bg-blue-900/10":"text-gray-600 dark:text-gray-300"])}," Kabel ("+d(B.value.length)+") ",3),t("button",{onClick:e[7]||(e[7]=a=>L.value="points"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",L.value==="points"?"text-teal-700 dark:text-teal-300 bg-teal-50/60 dark:bg-teal-900/10":"text-gray-600 dark:text-gray-300"])}," Titik ("+d(K.value.length)+") ",3),t("button",{onClick:e[8]||(e[8]=a=>L.value="ports"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",L.value==="ports"?"text-indigo-700 dark:text-indigo-300 bg-indigo-50/60 dark:bg-indigo-900/10":"text-gray-600 dark:text-gray-300"])}," Port ("+d(Le.value.length)+") ",3),t("button",{onClick:e[9]||(e[9]=a=>L.value="links"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",L.value==="links"?"text-amber-700 dark:text-amber-300 bg-amber-50/60 dark:bg-amber-900/10":"text-gray-600 dark:text-gray-300"])}," Sambungan ("+d(We.value.length)+") ",3),t("button",{onClick:e[10]||(e[10]=a=>L.value="trace"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",L.value==="trace"?"text-slate-700 dark:text-slate-200 bg-slate-50/60 dark:bg-slate-700/30":"text-gray-600 dark:text-gray-300"])}," Trace ",2),t("button",{onClick:e[11]||(e[11]=a=>L.value="breaks"),class:V(["px-3 py-3 text-xs font-semibold whitespace-nowrap",L.value==="breaks"?"text-red-700 dark:text-red-300 bg-red-50/60 dark:bg-red-900/10":"text-gray-600 dark:text-gray-300"])}," Putus ("+d(Ne.value.length)+") ",3)]),t("div",Tl,[we.value?(n(),r("div",Sl,"Memuat...")):ze.value?(n(),r("div",El,d(ze.value),1)):L.value==="cables"?(n(),r("div",Ll,[t("div",Ol,[e[87]||(e[87]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Daftar Kabel",-1)),q.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:ta},"Tambah")):g("",!0)]),B.value.length===0?(n(),r("div",Ul,"Belum ada data kabel.")):(n(),r("div",$l,[(n(!0),r(E,null,U(B.value,a=>(n(),r("div",{key:a.id,class:V(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-blue-200 dark:hover:border-blue-900/40 cursor-pointer",Number(ee.value)===Number(a.id)?"bg-blue-50/60 dark:bg-blue-900/10":"bg-white dark:bg-dark-800"]),onClick:T=>{ee.value=a.id,A.value=null,te.value=null,Fe()}},[t("div",Il,[t("div",null,[t("div",Fl,d(a.name),1),t("div",Vl,[a.cable_type?(n(),r("span",Gl,d(a.cable_type),1)):g("",!0),a.core_count?(n(),r("span",Al," "+d(a.core_count)+" core",1)):g("",!0)]),a.from_point_id||a.to_point_id?(n(),r("div",jl,[t("div",null,[e[88]||(e[88]=_("Dari: ",-1)),t("span",Dl,d(ae(a.from_point_id)||"-"),1)]),t("div",null,[e[89]||(e[89]=_("Ke: ",-1)),t("span",Rl,d(ae(a.to_point_id)||"-"),1)])])):g("",!0)]),t("div",Bl,[Y.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:oe(T=>aa(a),["stop"])},"Edit",8,Kl)):g("",!0),Q.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:oe(T=>sa(a),["stop"])},"Hapus",8,Hl)):g("",!0)])])],10,Ml))),128))]))])):L.value==="points"?(n(),r("div",Jl,[t("div",zl,[e[90]||(e[90]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Titik Sambungan",-1)),q.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:na},"Tambah")):g("",!0)]),K.value.length===0?(n(),r("div",Wl,"Belum ada data titik.")):(n(),r("div",Xl,[(n(!0),r(E,null,U(K.value,a=>(n(),r("div",{key:a.id,class:V(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-teal-200 dark:hover:border-teal-900/40 cursor-pointer",Number(A.value)===Number(a.id)?"bg-teal-50/60 dark:bg-teal-900/10":"bg-white dark:bg-dark-800"]),onClick:T=>{A.value=a.id,ee.value=null,te.value=null,gt(),ye(Number(a.latitude),Number(a.longitude),17)}},[t("div",ql,[t("div",null,[t("div",Yl,d(a.name),1),t("div",Ql,[a.point_type?(n(),r("span",es,d(a.point_type),1)):g("",!0),a.latitude&&a.longitude?(n(),r("span",ts," "+d(a.latitude)+", "+d(a.longitude),1)):g("",!0)])]),t("div",as,[Y.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:oe(T=>ia(a),["stop"])},"Edit",8,ls)):g("",!0),Q.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:oe(T=>pa(a),["stop"])},"Hapus",8,ss)):g("",!0)])])],10,Zl))),128))]))])):L.value==="ports"?(n(),r("div",os,[t("div",rs,[e[91]||(e[91]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Port (OLT/ODP)",-1)),q.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:ya},"Tambah")):g("",!0)]),Le.value.length===0?(n(),r("div",ns,"Belum ada data port.")):(n(),r("div",is,[(n(!0),r(E,null,U(Le.value,a=>(n(),r("div",{key:a.id,class:"p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-indigo-200 dark:hover:border-indigo-900/40 bg-white dark:bg-dark-800"},[t("div",ds,[t("div",null,[t("div",us,d(String(a.port_type||"").toUpperCase()),1),t("div",ps,d(a.port_label||"#"+a.id),1),t("div",vs,[t("div",null,[e[92]||(e[92]=_(" Titik: ",-1)),t("span",cs,d(ae(a.point_id)||"#"+a.point_id),1)]),a.cable_id&&a.core_no?(n(),r("div",bs,[e[93]||(e[93]=_(" Kabel: ",-1)),t("span",gs,d(ce(a.cable_id)||"Kabel #"+a.cable_id),1),t("span",ms,"- core "+d(a.core_no),1)])):g("",!0)])]),t("div",ys,[Y.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:oe(T=>ka(a),["stop"])},"Edit",8,ks)):g("",!0),Q.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:oe(T=>fa(a),["stop"])},"Hapus",8,xs)):g("",!0)])])]))),128))]))])):L.value==="links"?(n(),r("div",fs,[t("div",_s,[e[94]||(e[94]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Sambungan (Splice/Split)",-1)),q.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:Ca},"Tambah")):g("",!0)]),Ut.value.length===0?(n(),r("div",hs,"Belum ada data sambungan.")):(n(),r("div",ws,[(n(!0),r(E,null,U(Ut.value,a=>(n(),r("div",{key:a.kind==="SPLIT_GROUP"?"g:"+a.split_group+":"+a.point_id:"l:"+a.id,class:"p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-amber-200 dark:hover:border-amber-900/40 bg-white dark:bg-dark-800"},[t("div",Cs,[t("div",Ns,[t("div",Ps,[_(d(a.kind==="SPLIT_GROUP"?"SPLIT":String(a.link_type||"").toUpperCase())+" ",1),a.kind==="SPLIT_GROUP"?(n(),r("span",Ts,"- "+d((a.outputs||[]).length)+" output",1)):g("",!0)]),t("div",Ss,[e[95]||(e[95]=_(" Titik: ",-1)),t("span",Es,d(ae(a.point_id)||"#"+a.point_id),1)]),t("div",Ls,[_(d(ce(a.from_cable_id)||"Kabel #"+a.from_cable_id)+" - core "+d(a.from_core_no)+" ",1),e[96]||(e[96]=t("span",{class:"mx-1 text-gray-400"},"->",-1)),a.kind==="SPLIT_GROUP"?(n(),r("span",Os,"splitter")):(n(),r(E,{key:1},[_(d(ce(a.to_cable_id)||"Kabel #"+a.to_cable_id)+" - core "+d(a.to_core_no),1)],64))]),a.kind==="SPLIT_GROUP"&&(a.outputs||[]).length?(n(),r("div",Us,[_(" Output: "+d((a.outputs||[]).slice(0,4).map(T=>`${ce(T.to_cable_id)||"#"+T.to_cable_id}:${T.to_core_no}`).join(", ")),1),(a.outputs||[]).length>4?(n(),r("span",$s,", ...")):g("",!0)])):g("",!0),a.loss_db!==null&&a.loss_db!==void 0&&a.loss_db!==""?(n(),r("div",Ms,[e[97]||(e[97]=_(" Loss: ",-1)),t("span",Is,d(a.loss_db)+" dB",1)])):g("",!0)]),t("div",Fs,[Y.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:oe(T=>Na(a),["stop"])},"Edit",8,Vs)):g("",!0),Q.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:oe(T=>Ta(a),["stop"])},"Hapus",8,Gs)):g("",!0)])])]))),128))]))])):L.value==="trace"?(n(),r("div",As,[t("div",js,[e[98]||(e[98]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Tracing End-to-End",-1)),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:Ea,disabled:Se.value},"Clear",8,Ds)]),t("div",Rs,[t("div",null,[e[100]||(e[100]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Start Port (OLT_PON)",-1)),k(t("select",{"onUpdate:modelValue":e[12]||(e[12]=a=>Ge.value=a),class:"input w-full"},[e[99]||(e[99]=t("option",{value:""},"(pilih port)",-1)),(n(!0),r(E,null,U(Sa.value,a=>(n(),r("option",{key:a.id,value:a.id},d(ae(a.point_id)||"#"+a.point_id)+" | "+d(a.port_label)+" | "+d(ce(a.cable_id)||"Kabel #"+a.cable_id)+":"+d(a.core_no),9,Bs))),128))],512),[[I,Ge.value]])]),t("div",Ks,[t("button",{class:"btn btn-primary !py-2 !text-xs",onClick:La,disabled:Se.value||!Ge.value},d(Se.value?"Tracing...":"Trace"),9,Hs),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:F,disabled:we.value||Se.value},"Refresh Data",8,Js)]),Ee.value?(n(),r("div",zs,d(Ee.value),1)):g("",!0)]),re.value?(n(),r("div",Ws,[t("div",Xs,[e[101]||(e[101]=_(" Endpoint: ",-1)),t("span",Zs,d((re.value.endpoints||[]).length),1),e[102]||(e[102]=t("span",{class:"mx-2"},"|",-1)),e[103]||(e[103]=_(" Visited: ",-1)),t("span",qs,d(re.value.visited_nodes||0),1),re.value.truncated?(n(),r("span",Ys,"(truncated)")):g("",!0)]),(re.value.endpoints||[]).length===0?(n(),r("div",Qs,[...e[104]||(e[104]=[_(" Tidak ada endpoint ",-1),t("span",{class:"font-mono"},"ODP_OUT",-1),_(" terjangkau dari port ini. ",-1)])])):(n(),r("div",eo,[(n(!0),r(E,null,U(re.value.endpoints||[],(a,T)=>{var j,Ae,je,De,Re,Be,Ke,Ft;return n(),r("div",{key:((j=a.port)==null?void 0:j.id)||T,class:V(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-slate-200 dark:hover:border-slate-700 cursor-pointer",_e.value===a?"bg-slate-50/60 dark:bg-slate-700/30":"bg-white dark:bg-dark-800"]),onClick:nn=>_e.value=a},[t("div",ao,d(((Ae=a.point)==null?void 0:Ae.name)||ae((je=a.port)==null?void 0:je.point_id)||"-"),1),t("div",lo,[e[105]||(e[105]=_(" Port: ",-1)),t("span",so,d(((De=a.port)==null?void 0:De.port_label)||"#"+((Re=a.port)==null?void 0:Re.id)),1),e[106]||(e[106]=t("span",{class:"mx-2"},"|",-1)),_(" "+d(ce((Be=a.port)==null?void 0:Be.cable_id)||"Kabel #"+((Ke=a.port)==null?void 0:Ke.cable_id))+":"+d((Ft=a.port)==null?void 0:Ft.core_no),1)])],10,to)}),128))])),(o=_e.value)!=null&&o.path?(n(),r("div",oo,[e[108]||(e[108]=t("div",{class:"text-xs font-semibold text-gray-900 dark:text-white"},"Path (ringkas)",-1)),t("div",ro,[(n(!0),r(E,null,U(_e.value.path,(a,T)=>{var j,Ae,je,De,Re,Be,Ke;return n(),r("div",{key:T,class:"text-xs"},[t("div",no,[_(d(T===0?"START":((j=a.edge)==null?void 0:j.type)==="CABLE"?"KABEL":"LINK "+(((Ae=a.edge)==null?void 0:Ae.link_type)||""))+" ",1),e[107]||(e[107]=t("span",{class:"mx-1 text-gray-400"},"|",-1)),_(" "+d(((je=a.point)==null?void 0:je.name)||"Titik #"+((De=a.node)==null?void 0:De.point_id)),1)]),t("div",io,d(((Re=a.cable)==null?void 0:Re.name)||"Kabel #"+((Be=a.node)==null?void 0:Be.cable_id))+" - core "+d((Ke=a.node)==null?void 0:Ke.core_no),1)])}),128))])])):g("",!0)])):g("",!0)])):(n(),r("div",uo,[t("div",po,[e[109]||(e[109]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Data Putus",-1)),q.value?(n(),r("button",{key:0,class:"btn btn-primary !py-2 !text-xs",onClick:va},"Tambah")):g("",!0)]),Ne.value.length===0?(n(),r("div",vo,"Belum ada data putus.")):(n(),r("div",co,[(n(!0),r(E,null,U(Ne.value,a=>(n(),r("div",{key:a.id,class:V(["p-3 rounded-xl border border-gray-100 dark:border-dark-700 hover:border-red-200 dark:hover:border-red-900/40 cursor-pointer",Number(te.value)===Number(a.id)?"bg-red-50/60 dark:bg-red-900/10":"bg-white dark:bg-dark-800"]),onClick:T=>{te.value=a.id,ee.value=null,A.value=null,mt(),ye(Number(a.latitude),Number(a.longitude),17)}},[t("div",go,[t("div",null,[t("div",mo,d(ea(a.status)),1),t("div",yo,d(ce(a.cable_id)||(a.cable_id?"Kabel #"+a.cable_id:"Tanpa kabel")),1),t("div",ko,[t("span",null,"Titik: "+d(ae(a.point_id)||"-"),1),a.severity?(n(),r("span",xo," "+d(a.severity),1)):g("",!0)]),a.description?(n(),r("div",fo,d(a.description),1)):g("",!0)]),t("div",_o,[Y.value?(n(),r("button",{key:0,class:"btn btn-secondary !py-1 !px-2 !text-xs",onClick:oe(T=>ca(a),["stop"])},"Edit",8,ho)):g("",!0),Q.value?(n(),r("button",{key:1,class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:oe(T=>ma(a),["stop"])},"Hapus",8,wo)):g("",!0)])])],10,bo))),128))]))]))])])])):(n(),r("div",Ya,[...e[77]||(e[77]=[t("div",{class:"text-gray-900 dark:text-white font-semibold"},"Tidak punya akses",-1),t("div",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},[_(" Butuh permission "),t("code",{class:"px-1 py-0.5 bg-gray-100 dark:bg-dark-700 rounded"},"view fiber"),_(". ")],-1)])]))]),R.value?(n(),r("div",{key:0,class:V(["fixed inset-0 z-[10000] flex items-center justify-center p-4",w.value?"pointer-events-none":""])},[t("div",{class:V(["absolute inset-0 bg-black/40",w.value?"pointer-events-none opacity-20":""]),onClick:e[13]||(e[13]=a=>{R.value=!1,S()})},null,2),t("div",Co,[t("div",No,[t("div",Po,d(qe.value==="edit"?"Edit Kabel":"Tambah Kabel"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[14]||(e[14]=a=>{R.value=!1,S()})},"Tutup")]),t("div",To,[t("div",So,[t("div",null,[e[110]||(e[110]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Nama",-1)),k(t("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>b.value.name=a),class:"input w-full",placeholder:"Feeder ODC-POP A"},null,512),[[C,b.value.name]]),W.value.name?(n(),r("div",Eo,d((s=W.value.name)==null?void 0:s[0]),1)):g("",!0)]),t("div",null,[e[111]||(e[111]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kode (opsional)",-1)),k(t("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>b.value.code=a),class:"input w-full",placeholder:"FO-001"},null,512),[[C,b.value.code]]),W.value.code?(n(),r("div",Lo,d((i=W.value.code)==null?void 0:i[0]),1)):g("",!0)]),t("div",null,[e[112]||(e[112]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),k(t("input",{"onUpdate:modelValue":e[17]||(e[17]=a=>b.value.cable_type=a),class:"input w-full",placeholder:"FEEDER / DISTRIBUTION / DROP"},null,512),[[C,b.value.cable_type]]),W.value.cable_type?(n(),r("div",Oo,d((p=W.value.cable_type)==null?void 0:p[0]),1)):g("",!0)]),t("div",null,[e[113]||(e[113]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Core",-1)),k(t("input",{"onUpdate:modelValue":e[18]||(e[18]=a=>b.value.core_count=a),type:"number",min:"1",class:"input w-full",placeholder:"12"},null,512),[[C,b.value.core_count]]),W.value.core_count?(n(),r("div",Uo,d((v=W.value.core_count)==null?void 0:v[0]),1)):g("",!0)]),t("div",null,[e[115]||(e[115]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Dari Titik",-1)),k(t("select",{"onUpdate:modelValue":e[19]||(e[19]=a=>b.value.from_point_id=a),class:"input w-full"},[e[114]||(e[114]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(E,null,U(K.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,$o))),128))],512),[[I,b.value.from_point_id]])]),t("div",null,[e[117]||(e[117]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Ke Titik",-1)),k(t("select",{"onUpdate:modelValue":e[20]||(e[20]=a=>b.value.to_point_id=a),class:"input w-full"},[e[116]||(e[116]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(E,null,U(K.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,Mo))),128))],512),[[I,b.value.to_point_id]])]),t("div",Io,[e[118]||(e[118]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Warna Jalur",-1)),t("div",Fo,[k(t("input",{"onUpdate:modelValue":e[21]||(e[21]=a=>b.value.map_color=a),type:"color",class:"h-10 w-14 rounded border border-gray-200 dark:border-dark-700 bg-transparent"},null,512),[[C,b.value.map_color]]),k(t("input",{"onUpdate:modelValue":e[22]||(e[22]=a=>b.value.map_color=a),class:"input flex-1",placeholder:"#2563eb"},null,512),[[C,b.value.map_color]])])]),t("div",Vo,[e[119]||(e[119]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),k(t("textarea",{"onUpdate:modelValue":e[23]||(e[23]=a=>b.value.notes=a),class:"input w-full min-h-[80px]",placeholder:"Keterangan kabel..."},null,512),[[C,b.value.notes]])])]),t("div",Go,[t("div",Ao,[t("div",null,[e[120]||(e[120]=t("div",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Jalur di Peta",-1)),t("div",jo,"Titik: "+d(Array.isArray(b.value.path)?b.value.path.length:0),1)]),t("div",Do,[t("label",Ro,[k(t("input",{type:"checkbox","onUpdate:modelValue":e[24]||(e[24]=a=>z.value=a)},null,512),[[He,z.value]]),e[121]||(e[121]=_(" Ikuti jalan ",-1))]),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:oa},"Gambar"),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:ra,disabled:!b.value.path||b.value.path.length<2},"Edit",8,Bo),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:St,disabled:!b.value.path||b.value.path.length===0},"Undo",8,Ko),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:yt,disabled:!b.value.path||b.value.path.length===0},"Clear",8,Ho)])]),e[122]||(e[122]=t("div",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},[_(" Tips: mode "),t("span",{class:"font-semibold"},"Ikuti jalan"),_(" memakai Google Directions. Jika gagal/limit, otomatis fallback ke garis lurus. Jalur bisa dirapikan lewat tombol "),t("span",{class:"font-semibold"},"Edit"),_(". ")],-1))])]),t("div",Jo,[t("button",{class:"btn btn-secondary",onClick:e[25]||(e[25]=a=>{R.value=!1,S()})},"Batal"),t("button",{class:"btn btn-primary",disabled:Ye.value,onClick:la},d(Ye.value?"Menyimpan...":"Simpan"),9,zo)])])],2)):g("",!0),X.value?(n(),r("div",{key:1,class:V(["fixed inset-0 z-[10000] flex items-center justify-center p-4",w.value?"pointer-events-none":""])},[t("div",{class:V(["absolute inset-0 bg-black/40",w.value?"pointer-events-none opacity-20":""]),onClick:e[26]||(e[26]=a=>{X.value=!1,S()})},null,2),t("div",Wo,[t("div",Xo,[t("div",Zo,d(Qe.value==="edit"?"Edit Titik":"Tambah Titik"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[27]||(e[27]=a=>{X.value=!1,S()})},"Tutup")]),t("div",qo,[t("div",null,[e[123]||(e[123]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Nama",-1)),k(t("input",{"onUpdate:modelValue":e[28]||(e[28]=a=>f.value.name=a),class:"input w-full",placeholder:"ODP-01 / Joint A"},null,512),[[C,f.value.name]]),ie.value.name?(n(),r("div",Yo,d((u=ie.value.name)==null?void 0:u[0]),1)):g("",!0)]),t("div",null,[e[124]||(e[124]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),k(t("input",{"onUpdate:modelValue":e[29]||(e[29]=a=>f.value.point_type=a),class:"input w-full",placeholder:"ODP / ODC / JOINT / HANDHOLE"},null,512),[[C,f.value.point_type]])]),t("div",Qo,[t("div",null,[e[125]||(e[125]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Latitude",-1)),k(t("input",{"onUpdate:modelValue":e[30]||(e[30]=a=>f.value.latitude=a),class:"input w-full",placeholder:"-6.2"},null,512),[[C,f.value.latitude]]),ie.value.latitude?(n(),r("div",er,d((h=ie.value.latitude)==null?void 0:h[0]),1)):g("",!0)]),t("div",null,[e[126]||(e[126]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Longitude",-1)),k(t("input",{"onUpdate:modelValue":e[31]||(e[31]=a=>f.value.longitude=a),class:"input w-full",placeholder:"106.8"},null,512),[[C,f.value.longitude]]),ie.value.longitude?(n(),r("div",tr,d((O=ie.value.longitude)==null?void 0:O[0]),1)):g("",!0)])]),t("div",ar,[t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:da},"Pilih dari peta"),f.value.latitude&&f.value.longitude?(n(),r("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[32]||(e[32]=a=>ye(Number(f.value.latitude),Number(f.value.longitude),18))},"Zoom")):g("",!0)]),t("div",null,[e[127]||(e[127]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Alamat",-1)),k(t("input",{"onUpdate:modelValue":e[33]||(e[33]=a=>f.value.address=a),class:"input w-full",placeholder:"(opsional)"},null,512),[[C,f.value.address]])]),t("div",null,[e[128]||(e[128]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),k(t("textarea",{"onUpdate:modelValue":e[34]||(e[34]=a=>f.value.notes=a),class:"input w-full min-h-[80px]",placeholder:"(opsional)"},null,512),[[C,f.value.notes]])])]),t("div",lr,[t("button",{class:"btn btn-secondary",onClick:e[35]||(e[35]=a=>{X.value=!1,S()})},"Batal"),t("button",{class:"btn btn-primary",disabled:et.value,onClick:ua},d(et.value?"Menyimpan...":"Simpan"),9,sr)])])],2)):g("",!0),Z.value?(n(),r("div",{key:2,class:V(["fixed inset-0 z-[10000] flex items-center justify-center p-4",w.value?"pointer-events-none":""])},[t("div",{class:V(["absolute inset-0 bg-black/40",w.value?"pointer-events-none opacity-20":""]),onClick:e[36]||(e[36]=a=>{Z.value=!1,S()})},null,2),t("div",or,[t("div",rr,[t("div",nr,d(tt.value==="edit"?"Edit Data Putus":"Tambah Data Putus"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[37]||(e[37]=a=>{Z.value=!1,S()})},"Tutup")]),t("div",ir,[t("div",null,[e[130]||(e[130]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kabel",-1)),k(t("select",{"onUpdate:modelValue":e[38]||(e[38]=a=>x.value.cable_id=a),class:"input w-full"},[e[129]||(e[129]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(E,null,U(B.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,dr))),128))],512),[[I,x.value.cable_id]])]),t("div",null,[e[132]||(e[132]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik (opsional)",-1)),k(t("select",{"onUpdate:modelValue":e[39]||(e[39]=a=>x.value.point_id=a),class:"input w-full"},[e[131]||(e[131]=t("option",{value:""},"(kosong)",-1)),(n(!0),r(E,null,U(K.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,ur))),128))],512),[[I,x.value.point_id]])]),t("div",pr,[t("div",null,[e[134]||(e[134]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Status",-1)),k(t("select",{"onUpdate:modelValue":e[40]||(e[40]=a=>x.value.status=a),class:"input w-full"},[...e[133]||(e[133]=[t("option",{value:"OPEN"},"OPEN",-1),t("option",{value:"IN_PROGRESS"},"IN_PROGRESS",-1),t("option",{value:"FIXED"},"FIXED",-1),t("option",{value:"CANCELLED"},"CANCELLED",-1)])],512),[[I,x.value.status]])]),t("div",null,[e[136]||(e[136]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Severity",-1)),k(t("select",{"onUpdate:modelValue":e[41]||(e[41]=a=>x.value.severity=a),class:"input w-full"},[...e[135]||(e[135]=[t("option",{value:""},"(kosong)",-1),t("option",{value:"MINOR"},"MINOR",-1),t("option",{value:"MAJOR"},"MAJOR",-1),t("option",{value:"CRITICAL"},"CRITICAL",-1)])],512),[[I,x.value.severity]])])]),t("div",vr,[t("div",null,[e[137]||(e[137]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Dilaporkan",-1)),k(t("input",{"onUpdate:modelValue":e[42]||(e[42]=a=>x.value.reported_at=a),type:"datetime-local",class:"input w-full"},null,512),[[C,x.value.reported_at]])]),t("div",null,[e[138]||(e[138]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Fixed At",-1)),k(t("input",{"onUpdate:modelValue":e[43]||(e[43]=a=>x.value.fixed_at=a),type:"datetime-local",class:"input w-full",disabled:String(x.value.status).toUpperCase()!=="FIXED"},null,8,cr),[[C,x.value.fixed_at]])])]),t("div",br,[t("div",null,[e[139]||(e[139]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Latitude",-1)),k(t("input",{"onUpdate:modelValue":e[44]||(e[44]=a=>x.value.latitude=a),class:"input w-full",placeholder:"-6.2"},null,512),[[C,x.value.latitude]]),ke.value.latitude?(n(),r("div",gr,d((se=ke.value.latitude)==null?void 0:se[0]),1)):g("",!0)]),t("div",null,[e[140]||(e[140]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Longitude",-1)),k(t("input",{"onUpdate:modelValue":e[45]||(e[45]=a=>x.value.longitude=a),class:"input w-full",placeholder:"106.8"},null,512),[[C,x.value.longitude]]),ke.value.longitude?(n(),r("div",mr,d((G=ke.value.longitude)==null?void 0:G[0]),1)):g("",!0)])]),t("div",yr,[t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:ba},"Pilih dari peta"),x.value.latitude&&x.value.longitude?(n(),r("button",{key:0,class:"btn btn-secondary !py-2 !text-xs",onClick:e[46]||(e[46]=a=>ye(Number(x.value.latitude),Number(x.value.longitude),18))},"Zoom")):g("",!0)]),t("div",null,[e[141]||(e[141]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),k(t("textarea",{"onUpdate:modelValue":e[47]||(e[47]=a=>x.value.description=a),class:"input w-full min-h-[90px]",placeholder:"Keterangan kejadian putus..."},null,512),[[C,x.value.description]])])]),t("div",kr,[t("button",{class:"btn btn-secondary",onClick:e[48]||(e[48]=a=>{Z.value=!1,S()})},"Batal"),t("button",{class:"btn btn-primary",disabled:at.value,onClick:ga},d(at.value?"Menyimpan...":"Simpan"),9,xr)])])],2)):g("",!0),xe.value?(n(),r("div",fr,[t("div",{class:"absolute inset-0 bg-black/40",onClick:e[49]||(e[49]=a=>xe.value=!1)}),t("div",_r,[t("div",hr,[t("div",wr,d(lt.value==="edit"?"Edit Port":"Tambah Port"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[50]||(e[50]=a=>xe.value=!1)},"Tutup")]),t("div",Cr,[t("div",null,[e[143]||(e[143]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik",-1)),k(t("select",{"onUpdate:modelValue":e[51]||(e[51]=a=>P.value.point_id=a),class:"input w-full"},[e[142]||(e[142]=t("option",{value:""},"(pilih titik)",-1)),(n(!0),r(E,null,U(K.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,Nr))),128))],512),[[I,P.value.point_id]]),fe.value.point_id?(n(),r("div",Pr,d(($=fe.value.point_id)==null?void 0:$[0]),1)):g("",!0)]),t("div",Tr,[t("div",null,[e[145]||(e[145]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),k(t("select",{"onUpdate:modelValue":e[52]||(e[52]=a=>P.value.port_type=a),class:"input w-full"},[...e[144]||(e[144]=[t("option",{value:"OLT_PON"},"OLT_PON",-1),t("option",{value:"ODP_OUT"},"ODP_OUT",-1)])],512),[[I,P.value.port_type]])]),t("div",null,[e[146]||(e[146]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Label",-1)),k(t("input",{"onUpdate:modelValue":e[53]||(e[53]=a=>P.value.port_label=a),class:"input w-full",placeholder:"PON 1/1/1 / OUT 1"},null,512),[[C,P.value.port_label]]),fe.value.port_label?(n(),r("div",Sr,d((he=fe.value.port_label)==null?void 0:he[0]),1)):g("",!0)])]),t("div",Er,[t("div",null,[e[148]||(e[148]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Kabel",-1)),k(t("select",{"onUpdate:modelValue":e[54]||(e[54]=a=>P.value.cable_id=a),class:"input w-full"},[e[147]||(e[147]=t("option",{value:""},"(pilih kabel)",-1)),(n(!0),r(E,null,U(B.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,Lr))),128))],512),[[I,P.value.cable_id]])]),t("div",null,[e[149]||(e[149]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Core",-1)),k(t("input",{"onUpdate:modelValue":e[55]||(e[55]=a=>P.value.core_no=a),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[C,P.value.core_no]])])]),t("div",null,[e[150]||(e[150]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),k(t("textarea",{"onUpdate:modelValue":e[56]||(e[56]=a=>P.value.notes=a),class:"input w-full min-h-[90px]",placeholder:"(opsional)"},null,512),[[C,P.value.notes]])])]),t("div",Or,[t("button",{class:"btn btn-secondary",onClick:e[57]||(e[57]=a=>xe.value=!1)},"Batal"),t("button",{class:"btn btn-primary",disabled:st.value,onClick:xa},d(st.value?"Menyimpan...":"Simpan"),9,Ur)])])])):g("",!0),be.value?(n(),r("div",$r,[t("div",{class:"absolute inset-0 bg-black/40",onClick:e[58]||(e[58]=a=>be.value=!1)}),t("div",Mr,[t("div",Ir,[t("div",Fr,d(ot.value==="edit"?"Edit Sambungan":"Tambah Sambungan"),1),t("button",{class:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white",onClick:e[59]||(e[59]=a=>be.value=!1)},"Tutup")]),t("div",Vr,[t("div",null,[e[152]||(e[152]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Titik",-1)),k(t("select",{"onUpdate:modelValue":e[60]||(e[60]=a=>y.value.point_id=a),class:"input w-full"},[e[151]||(e[151]=t("option",{value:""},"(pilih titik)",-1)),(n(!0),r(E,null,U(K.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,Gr))),128))],512),[[I,y.value.point_id]]),de.value.point_id?(n(),r("div",Ar,d((M=de.value.point_id)==null?void 0:M[0]),1)):g("",!0)]),t("div",jr,[t("div",null,[e[154]||(e[154]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Tipe",-1)),k(t("select",{"onUpdate:modelValue":e[61]||(e[61]=a=>y.value.link_type=a),class:"input w-full"},[...e[153]||(e[153]=[t("option",{value:"SPLICE"},"SPLICE",-1),t("option",{value:"PATCH"},"PATCH",-1),t("option",{value:"SPLIT"},"SPLIT",-1)])],512),[[I,y.value.link_type]])]),t("div",null,[e[155]||(e[155]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Loss (dB)",-1)),k(t("input",{"onUpdate:modelValue":e[62]||(e[62]=a=>y.value.loss_db=a),class:"input w-full",placeholder:"0.20"},null,512),[[C,y.value.loss_db]])])]),t("div",Dr,[t("div",null,[e[157]||(e[157]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"From Cable",-1)),k(t("select",{"onUpdate:modelValue":e[63]||(e[63]=a=>y.value.from_cable_id=a),class:"input w-full"},[e[156]||(e[156]=t("option",{value:""},"(pilih kabel)",-1)),(n(!0),r(E,null,U(B.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,Rr))),128))],512),[[I,y.value.from_cable_id]]),de.value.from_cable_id?(n(),r("div",Br,d((Mt=de.value.from_cable_id)==null?void 0:Mt[0]),1)):g("",!0)]),t("div",null,[e[158]||(e[158]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"From Core",-1)),k(t("input",{"onUpdate:modelValue":e[64]||(e[64]=a=>y.value.from_core_no=a),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[C,y.value.from_core_no]]),de.value.from_core_no?(n(),r("div",Kr,d((It=de.value.from_core_no)==null?void 0:It[0]),1)):g("",!0)])]),String(y.value.link_type).toUpperCase()!=="SPLIT"?(n(),r("div",Hr,[t("div",null,[e[160]||(e[160]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"To Cable",-1)),k(t("select",{"onUpdate:modelValue":e[65]||(e[65]=a=>y.value.to_cable_id=a),class:"input w-full"},[e[159]||(e[159]=t("option",{value:""},"(pilih kabel)",-1)),(n(!0),r(E,null,U(B.value,a=>(n(),r("option",{key:a.id,value:a.id},d(a.name),9,Jr))),128))],512),[[I,y.value.to_cable_id]])]),t("div",null,[e[161]||(e[161]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"To Core",-1)),k(t("input",{"onUpdate:modelValue":e[66]||(e[66]=a=>y.value.to_core_no=a),type:"number",min:"1",class:"input w-full",placeholder:"1"},null,512),[[C,y.value.to_core_no]])])])):(n(),r("div",zr,[t("div",Wr,[t("div",null,[e[162]||(e[162]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Splitter Group (opsional)",-1)),k(t("input",{"onUpdate:modelValue":e[67]||(e[67]=a=>y.value.split_group=a),class:"input w-full",placeholder:"ODP-01 1:8"},null,512),[[C,y.value.split_group]])]),t("div",null,[e[163]||(e[163]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Jumlah Output",-1)),t("div",Xr,[k(t("input",{"onUpdate:modelValue":e[68]||(e[68]=a=>Ve.value=a),type:"number",min:"1",max:"64",class:"input w-full"},null,512),[[C,Ve.value]]),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:e[69]||(e[69]=a=>_a(Ve.value))},"Buat"),t("button",{class:"btn btn-secondary !py-2 !text-xs",onClick:ha},"Tambah")])])]),(y.value.outputs||[]).length===0?(n(),r("div",Zr,[...e[164]||(e[164]=[_(" Output masih kosong. Klik ",-1),t("span",{class:"font-semibold"},"Buat",-1),_(" untuk generate baris output. ",-1)])])):(n(),r("div",qr,[(n(!0),r(E,null,U(y.value.outputs,(a,T)=>(n(),r("div",{key:T,class:"grid grid-cols-12 gap-2 items-center"},[t("div",Yr,[k(t("select",{"onUpdate:modelValue":j=>a.to_cable_id=j,class:"input w-full"},[e[165]||(e[165]=t("option",{value:""},"(kabel output)",-1)),(n(!0),r(E,null,U(B.value,j=>(n(),r("option",{key:j.id,value:j.id},d(j.name),9,en))),128))],8,Qr),[[I,a.to_cable_id]])]),t("div",tn,[k(t("input",{"onUpdate:modelValue":j=>a.to_core_no=j,type:"number",min:"1",class:"input w-full",placeholder:"core"},null,8,an),[[C,a.to_core_no]])]),t("div",ln,[t("button",{class:"btn btn-danger !py-1 !px-2 !text-xs",onClick:j=>wa(T)},"Hapus",8,sn)])]))),128))]))])),t("div",null,[e[166]||(e[166]=t("label",{class:"text-xs text-gray-600 dark:text-gray-300"},"Catatan",-1)),k(t("textarea",{"onUpdate:modelValue":e[70]||(e[70]=a=>y.value.notes=a),class:"input w-full min-h-[90px]",placeholder:"(opsional)"},null,512),[[C,y.value.notes]])])]),t("div",on,[t("button",{class:"btn btn-secondary",onClick:e[71]||(e[71]=a=>be.value=!1)},"Batal"),t("button",{class:"btn btn-primary",disabled:rt.value,onClick:Pa},d(rt.value?"Menyimpan...":"Simpan"),9,rn)])])])):g("",!0)]}),_:1})],64))}};export{pn as default};
