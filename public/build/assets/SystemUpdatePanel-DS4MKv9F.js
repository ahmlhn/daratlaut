import{C as Ce,E as Ue,H as Se,o as Te,c as n,b as t,K as J,d as k,t as o,e as v,n as y,a as Z,F as ze,s as Ne,J as Y,f as je,v as Ae,r as j,y as P,j as i}from"./app-F1YGqqXl.js";import{_ as K}from"./LoadingSpinner-Ci9qzCSt.js";const Be={class:"space-y-6"},De={class:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between"},Le={class:"min-w-0"},Ee={key:0,class:"text-lg font-semibold text-gray-900 dark:text-white"},Ge={key:1,class:"text-2xl font-black text-gray-900 dark:text-white"},Me={key:2,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Ie={class:"font-semibold"},Re={key:0,class:"ml-2"},He={class:"font-mono font-semibold"},$e={class:"flex flex-wrap items-center gap-2"},Fe=["disabled"],Oe={key:0,class:"mr-2"},Ve=["disabled"],Je={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Ze={class:"lg:col-span-2 space-y-6"},Ye={class:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between"},Ke={class:"text-sm text-gray-600 dark:text-gray-300 mt-1"},We={key:0,class:"mt-3 text-sm rounded-xl border border-amber-200 bg-amber-50 text-amber-900 dark:border-amber-500/20 dark:bg-amber-500/10 dark:text-amber-200 p-3"},qe={key:1,class:"mt-3 text-sm rounded-xl border border-red-200 bg-red-50 text-red-900 dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 p-3 whitespace-pre-line"},Qe={class:"flex items-center gap-2"},Xe=["disabled"],et=["disabled"],tt={key:0,class:"mr-2"},at={class:"mt-5 grid grid-cols-2 sm:grid-cols-5 gap-3"},st={key:0,class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},lt={key:1,class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},dt={key:2},nt={class:"sm:text-center"},it={class:"text-sm sm:text-xs font-semibold text-gray-900 dark:text-white"},ot={key:0,class:"mt-4"},rt={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},ut={class:"h-2 bg-gray-100 dark:bg-white/10 rounded-full overflow-hidden mt-2"},ct={key:1,class:"mt-4"},pt={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},bt={class:"h-2 bg-gray-100 dark:bg-white/10 rounded-full overflow-hidden mt-2"},mt={class:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm"},gt={class:"flex items-center justify-between sm:block"},vt={class:"flex items-center justify-between sm:block"},xt={class:"flex items-center justify-between sm:block"},ft={class:"mt-1 font-semibold text-gray-900 dark:text-white"},yt={key:0,class:"mt-2 text-xs text-amber-700 dark:text-amber-300"},kt={key:1,class:"mt-1 text-xs text-amber-700 dark:text-amber-300"},ht={class:"flex items-start justify-between gap-4"},_t={class:"flex items-center gap-2"},wt=["disabled"],Pt=["disabled"],Ct={key:0,class:"mt-4 text-sm rounded-xl border border-amber-200 bg-amber-50 text-amber-900 dark:border-amber-500/20 dark:bg-amber-500/10 dark:text-amber-200 p-3"},Ut={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-700 dark:text-gray-300"},St={class:"mt-1 font-semibold"},Tt={key:0},zt={key:1,class:"text-amber-700 dark:text-amber-300"},Nt={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},jt={class:"font-mono font-semibold"},At={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Bt={class:"font-mono font-semibold"},Dt={class:"font-mono font-semibold"},Lt={class:"mt-1 font-semibold"},Et={key:0,class:"text-emerald-700 dark:text-emerald-300"},Gt={key:1,class:"text-amber-700 dark:text-amber-300"},Mt={class:"flex items-start justify-between gap-3"},It=["disabled"],Rt={class:"mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3"},Ht=["disabled"],$t={class:"flex items-start justify-between gap-4"},Ft={class:"min-w-0"},Ot={class:"mt-1 text-sm font-semibold text-gray-900 dark:text-white"},Vt={class:"font-mono"},Jt={class:"ml-2 text-gray-600 dark:text-gray-300 truncate"},Zt={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Yt={key:1,class:"mt-3"},Kt={class:"mt-1 text-xs text-gray-600 dark:text-gray-300 space-y-1"},Wt={class:"font-mono"},qt={key:0},Qt={class:"font-mono"},Xt={key:0,class:"ml-2 text-gray-500 dark:text-gray-400"},ea={key:1,class:"text-amber-700 dark:text-amber-300"},ta={key:2},aa={class:"font-mono"},sa={key:0,class:"ml-2 text-gray-500 dark:text-gray-400"},la={class:"text-right text-xs whitespace-nowrap"},da={key:0,class:"font-bold text-emerald-700 dark:text-emerald-300"},na={key:1,class:"font-bold text-amber-700 dark:text-amber-300"},ia={key:2,class:"font-bold text-emerald-700 dark:text-emerald-300"},oa={key:3,class:"font-bold text-amber-700 dark:text-amber-300"},ra={key:4,class:"font-bold text-gray-500 dark:text-gray-400"},ua={class:"mt-4 space-y-3"},ca={class:"flex flex-wrap gap-2"},pa=["disabled"],ba={key:0,class:"mr-2"},ma=["disabled"],ga={key:0,class:"h-2 bg-gray-100 dark:bg-white/10 rounded-full overflow-hidden"},va={class:"space-y-6"},xa={class:"flex items-center justify-between gap-3"},fa={class:"flex items-center gap-2"},ya=["disabled"],ka={class:"text-[11px] leading-relaxed text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},ha={class:"mt-4 grid grid-cols-2 gap-3 text-sm"},_a={class:"mt-1 font-semibold text-gray-900 dark:text-white"},wa={class:"mt-1 font-semibold text-gray-900 dark:text-white"},Pa={class:"mt-1 font-semibold text-gray-900 dark:text-white"},Ca={class:"mt-1 font-semibold text-gray-900 dark:text-white"},Ta={__name:"SystemUpdatePanel",props:{embedded:{type:Boolean,default:!1}},setup(O){const ce=O,V=Ce("toast",null);function p(a,e){const l=V==null?void 0:V[a];if(typeof l=="function")return l(e);alert(e)}const M=j(!0),B=j(!1),I=j(0),_=j(!1),c=j(null),W=j(null),D=j(!1),H=j(""),m=j(null),q=j(null);function z(a){if(!a)return;const e=c.value;e&&!a.config&&e.config&&(a.config=e.config),e&&!a.github&&e.github&&(a.github=e.github),e&&!a.installed&&e.installed&&(a.installed=e.installed),e&&!a.log_tail&&e.log_tail&&(a.log_tail=e.log_tail),c.value=a}const g=P(()=>{var a;return((a=c.value)==null?void 0:a.stage)||"idle"}),$=P(()=>{var a;return((a=c.value)==null?void 0:a.error)||""}),S=P(()=>{var a;return((a=c.value)==null?void 0:a.config)||{}}),x=P(()=>{var a;return((a=c.value)==null?void 0:a.github)||{}}),F=P(()=>{var a;return((a=c.value)==null?void 0:a.installed)||null}),A=P(()=>{var r;const a=(r=c.value)==null?void 0:r.manifest;if(!a||!a.total_files)return null;const e=Number(a.total_files)||0,l=Number(a.index)||0,d=Number(a.copied)||0,u=Number(a.skipped)||0,s=e>0?Math.min(100,Math.round(l/e*100)):0;return{total:e,idx:l,copied:d,skipped:u,pct:s}}),L=P(()=>{var u;const a=(u=c.value)==null?void 0:u.finalize;if(!a||!Array.isArray(a.commands))return null;const e=a.commands.length,l=Number(a.index)||0,d=e>0?Math.min(100,Math.round(l/e*100)):0;return{total:e,idx:l,pct:d}}),pe=P(()=>({idle:"Idle",uploaded:"Paket sudah diunggah (belum diproses)",ready:"Siap (manifest siap)",copying:"Menyalin file update",finalize:"Finalisasi (artisan tasks)",done:"Selesai",error:"Error"})[g.value]||g.value),Q=P(()=>{const a=g.value;return a==="done"?{text:"DONE",klass:"bg-emerald-100 text-emerald-800 dark:bg-emerald-500/20 dark:text-emerald-300"}:a==="error"?{text:"ERROR",klass:"bg-red-100 text-red-800 dark:bg-red-500/20 dark:text-red-300"}:["copying","finalize"].includes(a)?{text:"RUNNING",klass:"bg-blue-100 text-blue-800 dark:bg-blue-500/20 dark:text-blue-300"}:["ready","uploaded"].includes(a)?{text:"READY",klass:"bg-amber-100 text-amber-800 dark:bg-amber-500/20 dark:text-amber-300"}:{text:"IDLE",klass:"bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-200"}}),T=P(()=>M.value||B.value||_.value||D.value),R=P(()=>{const a="rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-dark-950",e=ce.embedded?"":"shadow-sm";return`${a} ${e} p-5`}),N=P(()=>"rounded-xl border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-dark-900/40 p-4"),be=P(()=>{var a;return(a=S.value)!=null&&a.enabled?!T.value&&["uploaded","error","idle","ready","copying","finalize","done"].includes(g.value):!1}),me=P(()=>{var a;return(a=S.value)!=null&&a.enabled?!T.value&&["uploaded","ready","copying","finalize"].includes(g.value):!1}),ge=P(()=>{var d;const a=[{id:"package",label:"Paket"},{id:"prepare",label:"Prepare"},{id:"copy",label:"Copy"},{id:"finalize",label:"Finalize"},{id:"done",label:"Selesai"}],e=g.value;let l=0;return e==="idle"?l=0:e==="uploaded"?l=1:e==="ready"||e==="copying"?l=2:e==="finalize"?l=3:e==="done"?l=4:e==="error"&&(L.value?l=3:A.value||(d=c.value)!=null&&d.manifest?l=2:l=1),a.map((u,s)=>{const r=e==="error",b=e==="done"||s<l?"done":s===l?r?"error":"current":"upcoming";return{...u,index:s+1,status:b}})});async function h(){var a,e,l,d,u,s,r;M.value=!0;try{const b=await window.axios.get("/system-update/status");c.value=((e=(a=b==null?void 0:b.data)==null?void 0:a.data)==null?void 0:e.data)||((l=b==null?void 0:b.data)==null?void 0:l.data)||null}catch(b){c.value={stage:"error",error:((u=(d=b==null?void 0:b.response)==null?void 0:d.data)==null?void 0:u.message)||(b==null?void 0:b.message)||"Failed to load status",config:(s=c.value)==null?void 0:s.config,github:(r=c.value)==null?void 0:r.github}}finally{M.value=!1}}async function ve(){var e,l,d,u,s,r,b;const a=(l=(e=W.value)==null?void 0:e.files)==null?void 0:l[0];if(!a)return p("warning","Pilih file ZIP dulu.");B.value=!0,I.value=0;try{const w=new FormData;w.append("package",a);const U=await window.axios.post("/system-update/upload",w,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:f=>{f!=null&&f.total&&(I.value=Math.round(f.loaded/f.total*100))}});z(((u=(d=U==null?void 0:U.data)==null?void 0:d.data)==null?void 0:u.data)||((s=U==null?void 0:U.data)==null?void 0:s.data)||null),I.value=100,p("success","Paket ZIP berhasil diunggah.")}catch(w){p("error",((b=(r=w==null?void 0:w.response)==null?void 0:r.data)==null?void 0:b.message)||(w==null?void 0:w.message)||"Upload gagal")}finally{B.value=!1,await h()}}async function xe(){var a,e,l,d,u;if(confirm("Download paket update dari URL yang sudah diset di server?")){_.value=!0;try{const s=await window.axios.post("/system-update/download");z(((e=(a=s==null?void 0:s.data)==null?void 0:a.data)==null?void 0:e.data)||((l=s==null?void 0:s.data)==null?void 0:l.data)||null),p("success","Download paket update selesai.")}catch(s){p("error",((u=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:u.message)||(s==null?void 0:s.message)||"Download gagal")}finally{_.value=!1,await h()}}}async function X(){var a,e,l,d,u;_.value=!0;try{const s=await window.axios.post("/system-update/start");z(((e=(a=s==null?void 0:s.data)==null?void 0:a.data)==null?void 0:e.data)||((l=s==null?void 0:s.data)==null?void 0:l.data)||null),p("info","Prepare berhasil. Siap jalankan update.")}catch(s){p("error",((u=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:u.message)||(s==null?void 0:s.message)||"Prepare gagal")}finally{_.value=!1,await h()}}function ee(a){return new Promise(e=>setTimeout(e,a))}async function fe(){var a,e,l,d,u;_.value=!0;try{if(await h(),g.value==="uploaded"){if(!confirm("Paket sudah diunggah tapi belum diproses. Jalankan Prepare sekarang?"))return;await X()}let s=0;for(;_.value&&s<2e3&&(s++,await h(),!(g.value==="done"||g.value==="error"||g.value==="idle"||!["ready","copying","finalize"].includes(g.value)));){const r=await window.axios.post("/system-update/step");z(((e=(a=r==null?void 0:r.data)==null?void 0:a.data)==null?void 0:e.data)||((l=r==null?void 0:r.data)==null?void 0:l.data)||null),await ee(200)}await h(),g.value==="done"?p("success","Update selesai."):g.value==="error"&&p("error",$.value||"Update gagal.")}catch(s){p("error",((u=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:u.message)||(s==null?void 0:s.message)||"Update gagal")}finally{_.value=!1,await h()}}async function ye(){var a,e,l,d,u;if(confirm("Reset state update? Ini tidak menghapus paket ZIP yang sudah diunggah, hanya state/workdir.")){_.value=!0;try{const s=await window.axios.post("/system-update/reset");z(((e=(a=s==null?void 0:s.data)==null?void 0:a.data)==null?void 0:e.data)||((l=s==null?void 0:s.data)==null?void 0:l.data)||null),m.value=null,p("info","State update di-reset.")}catch(s){p("error",((u=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:u.message)||(s==null?void 0:s.message)||"Reset gagal")}finally{_.value=!1,await h()}}}async function ke(){var e,l,d,u,s;const a=(H.value||"").trim();if(!a)return p("warning","Isi token dulu.");D.value=!0;try{const r=await window.axios.post("/system-update/github/token",{token:a});z(((l=(e=r==null?void 0:r.data)==null?void 0:e.data)==null?void 0:l.data)||((d=r==null?void 0:r.data)==null?void 0:d.data)||null),H.value="",p("success","Token GitHub tersimpan.")}catch(r){p("error",((s=(u=r==null?void 0:r.response)==null?void 0:u.data)==null?void 0:s.message)||(r==null?void 0:r.message)||"Gagal menyimpan token")}finally{D.value=!1,await h()}}async function he(){var a,e,l,d,u;if(confirm("Hapus token GitHub yang disimpan di server (file-based)?")){D.value=!0;try{const s=await window.axios.post("/system-update/github/token/clear");z(((e=(a=s==null?void 0:s.data)==null?void 0:a.data)==null?void 0:e.data)||((l=s==null?void 0:s.data)==null?void 0:l.data)||null),p("info","Token GitHub dihapus.")}catch(s){p("error",((u=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:u.message)||(s==null?void 0:s.message)||"Gagal menghapus token")}finally{D.value=!1,await h()}}}async function _e(){var a,e,l;D.value=!0;try{const d=await window.axios.post("/system-update/github/check");m.value=((a=d==null?void 0:d.data)==null?void 0:a.data)||null}catch(d){m.value=null,p("error",((l=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:l.message)||(d==null?void 0:d.message)||"Gagal cek update GitHub")}finally{D.value=!1}}async function we(){var u,s,r,b,w,U,f,ae,se,le,de,ne,ie,oe,re;const a=(u=x.value)!=null&&u.owner&&((s=x.value)!=null&&s.repo)?`${x.value.owner}/${x.value.repo}`:"(repo belum diset)",e=((r=x.value)==null?void 0:r.release_tag)||"panel-main-latest",l=((b=x.value)==null?void 0:b.release_asset)||"update-package.zip",d=[`Sistem akan download paket build dari GitHub Release (${a} tag ${e}).`,`Asset: ${l}`,"","Catatan penting:","- Paket ini di-build oleh GitHub Actions setiap push ke main (termasuk vendor/ + public/build).","- Jika build belum selesai, sistem akan menolak update sampai artifact siap.","","Lanjutkan?"].join(`
`);if(confirm(d)){_.value=!0;try{const C=await window.axios.post("/system-update/github/download");z(((U=(w=C==null?void 0:C.data)==null?void 0:w.data)==null?void 0:U.data)||((f=C==null?void 0:C.data)==null?void 0:f.data)||null);const E=await window.axios.post("/system-update/start");z(((se=(ae=E==null?void 0:E.data)==null?void 0:ae.data)==null?void 0:se.data)||((le=E==null?void 0:E.data)==null?void 0:le.data)||null);let ue=0;for(;_.value&&ue<2e3&&(ue++,await h(),!(g.value==="done"||g.value==="error"||g.value==="idle"||!["ready","copying","finalize"].includes(g.value)&&(await h(),!["ready","copying","finalize"].includes(g.value))));){const G=await window.axios.post("/system-update/step");z(((ne=(de=G==null?void 0:G.data)==null?void 0:de.data)==null?void 0:ne.data)||((ie=G==null?void 0:G.data)==null?void 0:ie.data)||null),await ee(200)}await h(),g.value==="done"?p("success","Update GitHub selesai."):g.value==="error"&&p("error",$.value||"Update GitHub gagal.")}catch(C){p("error",((re=(oe=C==null?void 0:C.response)==null?void 0:oe.data)==null?void 0:re.message)||(C==null?void 0:C.message)||"Update GitHub gagal")}finally{_.value=!1,await h()}}}function te(){const a=q.value;a&&(a.scrollTop=a.scrollHeight)}async function Pe(){var a;try{const e=(((a=c.value)==null?void 0:a.log_tail)||[]).join(`
`);if(!e)return p("warning","Log masih kosong.");await navigator.clipboard.writeText(e),p("success","Log disalin ke clipboard.")}catch{p("error","Gagal menyalin log (clipboard tidak tersedia).")}}return Ue(()=>{var a;return(((a=c.value)==null?void 0:a.log_tail)||[]).length},async()=>{await Se(),te()}),Te(()=>{h()}),(a,e)=>{var l,d,u,s,r,b,w,U;return i(),n("div",{class:y(O.embedded?"card p-6":"")},[t("div",Be,[t("div",De,[t("div",Le,[O.embedded?(i(),n("h2",Ee,"Update Sistem")):(i(),n("h1",Ge,"Update Sistem")),e[3]||(e[3]=J('<p class="text-sm text-gray-500 dark:text-gray-400 mt-1"> Update lewat panel tanpa <span class="font-semibold">git pull</span> / <span class="font-semibold">composer</span>. Saran: gunakan paket build (sudah termasuk <span class="font-semibold">vendor</span> dan <span class="font-semibold">public/build</span>). </p>',1)),(l=F.value)!=null&&l.source?(i(),n("div",Me,[e[2]||(e[2]=k(" Installed: ",-1)),t("span",Ie,o(F.value.source),1),(d=F.value.github)!=null&&d.sha?(i(),n("span",Re,[e[1]||(e[1]=k(" sha ",-1)),t("span",He,o((F.value.github.sha||"").slice(0,7)),1)])):v("",!0)])):v("",!0)]),t("div",$e,[t("span",{class:y(["px-2.5 py-1 rounded-full text-xs font-black tracking-wider",Q.value.klass])},o(Q.value.text),3),t("button",{onClick:h,class:"btn btn-secondary",disabled:T.value},[M.value?(i(),n("span",Oe,[Z(K,{size:"sm"})])):v("",!0),e[4]||(e[4]=k(" Refresh ",-1))],8,Fe),t("button",{onClick:ye,class:"btn btn-danger",disabled:T.value}," Reset ",8,Ve)])]),t("div",Je,[t("div",Ze,[t("div",{class:y(R.value)},[t("div",Ye,[t("div",null,[e[7]||(e[7]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Progress",-1)),t("p",Ke,[e[5]||(e[5]=t("span",{class:"font-semibold"},"Stage:",-1)),k(" "+o(pe.value),1)]),!M.value&&c.value&&!S.value.enabled?(i(),n("div",We,[...e[6]||(e[6]=[k(" Fitur update dinonaktifkan di server. Set ",-1),t("span",{class:"font-mono font-semibold"},"SYSTEM_UPDATE_ENABLED=true",-1),k(". ",-1)])])):v("",!0),$.value?(i(),n("div",qe,o($.value),1)):v("",!0)]),t("div",Qe,[t("button",{onClick:X,class:"btn btn-secondary",disabled:!be.value}," Prepare ",8,Xe),t("button",{onClick:fe,class:"btn btn-primary",disabled:!me.value},[_.value?(i(),n("span",tt,[Z(K,{size:"sm",color:"primary"})])):v("",!0),k(" "+o(_.value?"Memproses...":g.value==="copying"||g.value==="finalize"?"Lanjutkan":"Apply Update"),1)],8,et)])]),t("div",at,[(i(!0),n(ze,null,Ne(ge.value,f=>(i(),n("div",{key:f.id,class:"flex items-center gap-3 sm:flex-col sm:items-center sm:gap-2"},[t("div",{class:y(["h-9 w-9 rounded-full flex items-center justify-center text-sm font-black border",f.status==="done"?"bg-emerald-600 text-white border-emerald-600":"",f.status==="current"?"bg-primary-600 text-white border-primary-600":"",f.status==="upcoming"?"bg-gray-100 text-gray-700 border-gray-200 dark:bg-white/5 dark:text-gray-200 dark:border-white/10":"",f.status==="error"?"bg-red-600 text-white border-red-600":""])},[f.status==="done"?(i(),n("svg",st,[...e[8]||(e[8]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):f.status==="error"?(i(),n("svg",lt,[...e[9]||(e[9]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v4m0 4h.01M10.29 3.86l-8.02 13.9A2 2 0 004 20h16a2 2 0 001.73-3.24l-8.02-13.9a2 2 0 00-3.46 0z"},null,-1)])])):(i(),n("span",dt,o(f.index),1))],2),t("div",nt,[t("div",it,o(f.label),1)])]))),128))]),A.value?(i(),n("div",ot,[t("div",rt,[t("span",null,"Copy "+o(A.value.idx)+"/"+o(A.value.total)+" (copied "+o(A.value.copied)+", skipped "+o(A.value.skipped)+")",1),t("span",null,o(A.value.pct)+"%",1)]),t("div",ut,[t("div",{class:"h-full bg-gradient-to-r from-primary-600 to-primary-500",style:Y({width:`${A.value.pct}%`})},null,4)])])):v("",!0),L.value?(i(),n("div",ct,[t("div",pt,[t("span",null,"Finalize "+o(L.value.idx)+"/"+o(L.value.total),1),t("span",null,o(L.value.pct)+"%",1)]),t("div",bt,[t("div",{class:"h-full bg-gradient-to-r from-emerald-600 to-emerald-500",style:Y({width:`${L.value.pct}%`})},null,4)])])):v("",!0),(u=c.value)!=null&&u.manifest?(i(),n("div",{key:2,class:y(["mt-5",N.value])},[t("div",mt,[t("div",gt,[e[10]||(e[10]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"vendor",-1)),t("div",{class:y(["mt-1 font-semibold",c.value.manifest.vendor_included?"text-emerald-700 dark:text-emerald-300":"text-amber-700 dark:text-amber-300"])},o(c.value.manifest.vendor_included?"included":"NOT included"),3)]),t("div",vt,[e[11]||(e[11]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"public/build",-1)),t("div",{class:y(["mt-1 font-semibold",c.value.manifest.build_included?"text-emerald-700 dark:text-emerald-300":"text-amber-700 dark:text-amber-300"])},o(c.value.manifest.build_included?"included":"NOT included"),3)]),t("div",xt,[e[12]||(e[12]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"excluded",-1)),t("div",ft,o(c.value.manifest.excluded_count||0),1)])]),e[15]||(e[15]=J('<div class="mt-3 text-xs text-gray-500 dark:text-gray-400"> Tidak menimpa: <span class="font-semibold">.env</span>, <span class="font-semibold">storage/</span>, <span class="font-semibold">bootstrap/cache</span>, <span class="font-semibold">public/storage</span>, <span class="font-semibold">public/uploads</span>. </div>',1)),c.value.manifest.vendor_included?v("",!0):(i(),n("div",yt,[...e[13]||(e[13]=[k(" Paket tidak mengandung ",-1),t("span",{class:"font-semibold"},"vendor/",-1),k(". Sistem mempertahankan vendor yang ada. Jika ada perubahan dependency, update bisa gagal. ",-1)])])),c.value.manifest.build_included?v("",!0):(i(),n("div",kt,[...e[14]||(e[14]=[k(" Paket tidak mengandung ",-1),t("span",{class:"font-semibold"},"public/build",-1),k(". Sistem mempertahankan build yang ada. Jika ada perubahan frontend, UI bisa tidak update. ",-1)])]))],2)):v("",!0)],2),t("div",{class:y(R.value)},[t("div",ht,[e[16]||(e[16]=t("div",null,[t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"GitHub (main)"),t("p",{class:"text-sm text-gray-600 dark:text-gray-300 mt-1"}," Ambil paket build dari GitHub Release, lalu apply otomatis. ")],-1)),t("div",_t,[t("button",{onClick:_e,class:"btn btn-secondary px-3 py-2 text-xs",disabled:T.value||!x.value.enabled}," Cek ",8,wt),t("button",{onClick:we,class:"btn btn-primary px-3 py-2 text-xs",disabled:T.value||!x.value.enabled||!x.value.configured||!x.value.token_present}," Update ",8,Pt)])]),x.value.enabled?v("",!0):(i(),n("div",Ct," GitHub update dinonaktifkan (server config). ")),t("div",Ut,[t("div",{class:y(N.value)},[e[21]||(e[21]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Repo",-1)),t("div",St,[x.value.configured?(i(),n("span",Tt,o(x.value.owner)+"/"+o(x.value.repo),1)):(i(),n("span",zt,"Belum diset di .env"))]),t("div",Nt,[e[17]||(e[17]=k(" Branch: ",-1)),t("span",jt,o(x.value.branch||"main"),1)]),t("div",At,[e[18]||(e[18]=k(" Tag: ",-1)),t("span",Bt,o(x.value.release_tag||"panel-main-latest"),1),e[19]||(e[19]=t("span",{class:"mx-2"},"|",-1)),e[20]||(e[20]=k(" Asset: ",-1)),t("span",Dt,o(x.value.release_asset||"update-package.zip"),1)])],2),t("div",{class:y(N.value)},[e[22]||(e[22]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Token",-1)),t("div",Lt,[x.value.token_present?(i(),n("span",Et," Ada ("+o(x.value.token_hint||"****")+") ",1)):(i(),n("span",Gt,"Belum ada"))]),e[23]||(e[23]=t("div",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},[k(" Saran: Fine-grained PAT, akses "),t("span",{class:"font-semibold"},"Contents: Read"),k(" untuk repo ini saja. ")],-1))],2)]),t("div",{class:y(["mt-4",N.value])},[t("div",Mt,[e[24]||(e[24]=t("div",null,[t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Simpan Token"),t("div",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Token disimpan di server (file-based, encrypted). ")],-1)),t("button",{onClick:he,class:"btn btn-danger px-3 py-2 text-xs",disabled:T.value||!x.value.enabled}," Hapus ",8,It)]),t("div",Rt,[je(t("input",{"onUpdate:modelValue":e[0]||(e[0]=f=>H.value=f),type:"password",class:"input sm:col-span-2",placeholder:"Fine-grained PAT (read-only)"},null,512),[[Ae,H.value]]),t("button",{onClick:ke,class:"btn btn-secondary px-3 py-2 text-xs",disabled:T.value||!x.value.enabled}," Simpan ",8,Ht)])],2),(s=m.value)!=null&&s.latest?(i(),n("div",{key:1,class:y(["mt-4",N.value])},[t("div",$t,[t("div",Ft,[e[29]||(e[29]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Latest",-1)),t("div",Ot,[t("span",Vt,o(m.value.latest.short),1),t("span",Jt,o(m.value.latest.message),1)]),m.value.latest.date?(i(),n("div",Zt,o(m.value.latest.date),1)):v("",!0),m.value.built?(i(),n("div",Yt,[e[28]||(e[28]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Built Artifact",-1)),t("div",Kt,[t("div",null,[e[25]||(e[25]=t("span",{class:"font-semibold"},"tag:",-1)),t("span",Wt,o(((r=m.value.built.release)==null?void 0:r.tag)||"-"),1)]),(b=m.value.built.meta)!=null&&b.short?(i(),n("div",qt,[e[26]||(e[26]=t("span",{class:"font-semibold"},"sha:",-1)),t("span",Qt,o(m.value.built.meta.short),1),m.value.built.meta.built_at?(i(),n("span",Xt,o(m.value.built.meta.built_at),1)):v("",!0)])):(i(),n("div",ea," Metadata build tidak terbaca (body release tidak berisi JSON meta). ")),(w=m.value.built.asset)!=null&&w.name?(i(),n("div",ta,[e[27]||(e[27]=t("span",{class:"font-semibold"},"asset:",-1)),t("span",aa,o(m.value.built.asset.name),1),typeof m.value.built.asset.size=="number"?(i(),n("span",sa," ("+o(Math.round(m.value.built.asset.size/1024/1024))+" MB) ",1)):v("",!0)])):v("",!0)])])):v("",!0)]),t("div",la,[m.value.build_ready===!0?(i(),n("div",da,"BUILD READY")):m.value.build_ready===!1?(i(),n("div",na,"BUILD PENDING")):v("",!0),m.value.update_available===!1?(i(),n("div",ia,"UP TO DATE")):m.value.update_available===!0?(i(),n("div",oa,"UPDATE AVAILABLE")):(i(),n("div",ra,"UNKNOWN"))])])],2)):v("",!0)],2),t("div",{class:y(R.value)},[e[31]||(e[31]=t("div",null,[t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Paket ZIP"),t("p",{class:"text-sm text-gray-600 dark:text-gray-300 mt-1"}," Upload paket update manual (ZIP). Cocok untuk hosting tanpa akses git/composer. ")],-1)),t("div",ua,[t("input",{ref_key:"fileRef",ref:W,type:"file",accept:".zip",class:"block w-full text-sm text-gray-700 dark:text-gray-300"},null,512),t("div",ca,[t("button",{onClick:ve,class:"btn btn-primary",disabled:B.value||T.value||!S.value.enabled},[B.value?(i(),n("span",ba,[Z(K,{size:"sm",color:"primary"})])):v("",!0),k(" "+o(B.value?`Uploading ${I.value}%`:"Upload ZIP"),1)],8,pa),S.value.allow_download&&S.value.package_url_set?(i(),n("button",{key:0,onClick:xe,class:"btn btn-secondary",disabled:T.value||!S.value.enabled}," Download Dari URL ",8,ma)):v("",!0)]),B.value?(i(),n("div",ga,[t("div",{class:"h-full bg-gradient-to-r from-primary-600 to-primary-500",style:Y({width:`${I.value}%`})},null,4)])):v("",!0),t("div",{class:y(N.value)},[...e[30]||(e[30]=[J('<div class="text-xs text-gray-500 dark:text-gray-400"> Tidak menimpa: <span class="font-semibold">.env</span>, <span class="font-semibold">storage/</span>, <span class="font-semibold">bootstrap/cache</span>, <span class="font-semibold">public/storage</span>, <span class="font-semibold">public/uploads</span>. </div>',1)])],2)])],2)]),t("div",va,[t("div",{class:y(R.value)},[t("div",xa,[e[32]||(e[32]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Log",-1)),t("div",fa,[t("button",{onClick:Pe,class:"btn btn-secondary px-3 py-2 text-xs",type:"button",disabled:T.value}," Copy ",8,ya),t("button",{onClick:te,class:"btn btn-secondary px-3 py-2 text-xs",type:"button"}," Ke bawah ")])]),t("div",{ref_key:"logBoxRef",ref:q,class:"mt-3 h-80 overflow-auto rounded-xl border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-black/20 p-3"},[t("pre",ka,o((((U=c.value)==null?void 0:U.log_tail)||[]).join(`
`)),1)],512)],2),t("div",{class:y(R.value)},[e[37]||(e[37]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Konfigurasi",-1)),t("div",ha,[t("div",{class:y(N.value)},[e[33]||(e[33]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Enabled",-1)),t("div",_a,o(S.value.enabled?"YES":"NO"),1)],2),t("div",{class:y(N.value)},[e[34]||(e[34]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Chunk size",-1)),t("div",wa,o(S.value.chunk_size),1)],2),t("div",{class:y(N.value)},[e[35]||(e[35]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Max package",-1)),t("div",Pa,o(S.value.max_package_mb)+" MB",1)],2),t("div",{class:y(N.value)},[e[36]||(e[36]=t("div",{class:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider"},"Download",-1)),t("div",Ca,o(S.value.allow_download?"YES":"NO"),1)],2)])],2)])])])],2)}}};export{Ta as default};
