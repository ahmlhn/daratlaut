import{o as Z,c as o,a as E,u as tt,h as et,m as at,b as t,d as R,t as n,f as c,q as st,v as y,j as l,e as b,F as B,s as j,B as nt,T as lt,w as ot,x as it,A as C,r as u,y as A}from"./app-CnOYw52P.js";import{_ as rt}from"./AdminLayout-ChBTLBzj.js";const dt={class:"space-y-6"},ut={class:"grid gap-4 sm:grid-cols-3"},mt={class:"card bg-gradient-to-br from-teal-500 to-teal-600 text-white"},pt={class:"mt-1 text-2xl font-bold"},ct={class:"card"},vt={class:"mt-1 text-2xl font-semibold text-gray-900"},yt={class:"card"},xt={class:"mt-1 text-2xl font-semibold text-gray-900"},gt={class:"card"},ft={class:"flex flex-col gap-4 sm:flex-row"},_t={class:"flex-1"},bt={key:0,class:"card text-center py-8"},wt={key:1,class:"card overflow-hidden !p-0"},ht={class:"min-w-full divide-y divide-gray-200"},kt={class:"divide-y divide-gray-200 bg-white"},Ct={key:0},It={class:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900"},St={class:"whitespace-nowrap px-6 py-4 text-sm text-primary-600"},Tt={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-900"},Pt={class:"whitespace-nowrap px-6 py-4 text-sm font-medium text-teal-600"},Mt={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},Bt={class:"whitespace-nowrap px-6 py-4 text-sm text-gray-500"},Vt={class:"whitespace-nowrap px-6 py-4 text-right text-sm"},Dt=["onClick"],Nt={key:0,class:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6"},$t={class:"text-sm text-gray-700"},Ft={class:"font-medium"},Lt={class:"flex gap-2"},Rt=["disabled"],jt={class:"px-3 py-2 text-sm"},At=["disabled"],Ut={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Et={class:"flex min-h-screen items-center justify-center p-4"},Ht={class:"relative w-full max-w-lg rounded-lg bg-white shadow-xl"},qt={class:"flex items-center justify-between border-b px-6 py-4"},Ot={key:0,class:"mt-1 flex items-center gap-2 p-3 bg-teal-50 border border-teal-200 rounded-lg"},Gt={class:"flex-1"},Jt={class:"font-medium text-teal-700"},Kt={class:"text-sm text-teal-600"},Qt={class:"text-sm text-gray-500"},Wt={key:1,class:"mt-1"},Yt={key:0,class:"mt-2 max-h-48 overflow-y-auto border rounded-lg divide-y"},zt=["onClick"],Xt={class:"font-medium text-primary-600"},Zt={class:"text-gray-500 ml-2"},te={class:"float-right text-sm text-gray-500"},ee={key:1,class:"mt-2 text-sm text-gray-500"},ae={key:2,class:"mt-1 text-sm text-red-600"},se={key:0,class:"mt-1 text-sm text-red-600"},ne=["value"],le={class:"flex justify-end gap-3 pt-4 border-t"},oe=["disabled"],ie={key:0},re={key:1},pe={__name:"Index",props:{tenantId:{type:Number,default:1}},setup(H){const w=H,V=u([]),D=u([]),f=u({total_amount:0,count:0}),N=u(!0),I=u(""),S=u(""),T=u(""),m=u({current_page:1,last_page:1,total:0}),_=u(!1),P=u(!1),x=u({}),p=u(null),g=u(""),i=u({invoice_id:"",amount:0,payment_date:"",payment_method:"CASH",reference_no:"",notes:""}),q=[{value:"CASH",label:"Tunai"},{value:"TRANSFER",label:"Transfer Bank"},{value:"QRIS",label:"QRIS"},{value:"EWALLET",label:"E-Wallet"},{value:"OTHER",label:"Lainnya"}],O=()=>{const s=new Date().toISOString().split("T")[0];i.value={invoice_id:"",amount:0,payment_date:s,payment_method:"CASH",reference_no:"",notes:""},p.value=null,g.value="",x.value={}},h=async(s=1)=>{var e,d,a;N.value=!0;try{const r={page:s,per_page:15,tenant_id:w.tenantId};I.value&&(r.q=I.value),S.value&&(r.date_from=S.value),T.value&&(r.date_to=T.value);const v=await C.get("/api/v1/payments",{params:r});V.value=v.data.data||[],m.value={current_page:((e=v.data.meta)==null?void 0:e.current_page)||1,last_page:((d=v.data.meta)==null?void 0:d.last_page)||1,total:((a=v.data.meta)==null?void 0:a.total)||0}}catch(r){console.error("Failed to load payments:",r)}finally{N.value=!1}},$=async()=>{try{const s=await C.get("/api/v1/payments/stats",{params:{tenant_id:w.tenantId}});f.value=s.data.data||{total_amount:0,count:0}}catch(s){console.error("Failed to load stats:",s)}},F=async()=>{try{const s=await C.get("/api/v1/invoices",{params:{per_page:500,status:"OPEN",tenant_id:w.tenantId}});D.value=s.data.data||[]}catch(s){console.error("Failed to load invoices:",s)}},M=()=>h(1),U=s=>h(s),G=()=>{O(),_.value=!0},J=s=>{p.value=s,i.value.invoice_id=s.id,i.value.amount=s.total_amount-s.paid_amount,g.value=""},K=()=>{p.value=null,i.value.invoice_id="",i.value.amount=0},L=A(()=>{if(!g.value)return D.value.slice(0,10);const s=g.value.toLowerCase();return D.value.filter(e=>{var d,a,r;return((d=e.invoice_no)==null?void 0:d.toLowerCase().includes(s))||((r=(a=e.customer)==null?void 0:a.full_name)==null?void 0:r.toLowerCase().includes(s))}).slice(0,10)}),Q=A(()=>p.value?p.value.total_amount-p.value.paid_amount:0),W=async()=>{var s,e,d;P.value=!0,x.value={};try{const a={...i.value,tenant_id:w.tenantId};await C.post("/api/v1/payments",a),_.value=!1,h(1),$(),F()}catch(a){((s=a.response)==null?void 0:s.status)===422?x.value=a.response.data.errors||{}:alert("Gagal menyimpan: "+(((d=(e=a.response)==null?void 0:e.data)==null?void 0:d.message)||a.message))}finally{P.value=!1}},Y=async s=>{var e,d;if(confirm(`Hapus pembayaran PAY-${String(s.id).padStart(4,"0")}?`))try{await C.delete(`/api/v1/payments/${s.id}?tenant_id=${w.tenantId}`),h(m.value.current_page),$(),F()}catch(a){alert("Gagal menghapus: "+(((d=(e=a.response)==null?void 0:e.data)==null?void 0:d.message)||a.message))}};Z(()=>{h(),$(),F()});const k=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s||0),z=s=>s?new Date(s).toLocaleDateString("id-ID"):"-",X=A(()=>f.value.count>0?f.value.total_amount/f.value.count:0);return(s,e)=>(l(),o(B,null,[E(tt(et),{title:"Riwayat Pembayaran"}),E(rt,null,{default:at(()=>{var d;return[t("div",dt,[t("div",{class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},[e[15]||(e[15]=t("div",null,[t("h1",{class:"text-2xl font-semibold text-gray-900"},"Payments"),t("p",{class:"mt-1 text-sm text-gray-500"},"Riwayat pembayaran pelanggan")],-1)),t("button",{onClick:G,class:"btn btn-primary"},[...e[14]||(e[14]=[t("svg",{class:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),R(" Catat Pembayaran ",-1)])])]),t("div",ut,[t("div",mt,[e[16]||(e[16]=t("p",{class:"text-sm font-medium text-teal-100"},"Total Bulan Ini",-1)),t("p",pt,n(k(f.value.total_amount)),1)]),t("div",ct,[e[17]||(e[17]=t("p",{class:"text-sm font-medium text-gray-500"},"Transaksi",-1)),t("p",vt,n(f.value.count),1)]),t("div",yt,[e[18]||(e[18]=t("p",{class:"text-sm font-medium text-gray-500"},"Rata-rata",-1)),t("p",xt,n(k(X.value)),1)])]),t("div",gt,[t("div",ft,[t("div",_t,[c(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>I.value=a),onKeyup:st(M,["enter"]),type:"search",placeholder:"Cari pembayaran...",class:"input"},null,544),[[y,I.value]])]),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),onChange:M,type:"date",class:"input sm:w-40",title:"Dari tanggal"},null,544),[[y,S.value]]),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>T.value=a),onChange:M,type:"date",class:"input sm:w-40",title:"Sampai tanggal"},null,544),[[y,T.value]]),t("button",{onClick:M,class:"btn btn-primary"},"Cari")])]),N.value?(l(),o("div",bt,[...e[19]||(e[19]=[t("div",{class:"animate-spin h-8 w-8 border-4 border-primary-500 border-t-transparent rounded-full mx-auto"},null,-1),t("p",{class:"mt-2 text-gray-500"},"Memuat data...",-1)])])):(l(),o("div",wt,[t("table",ht,[e[21]||(e[21]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"ID"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Invoice"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Pelanggan"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Jumlah"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Metode"),t("th",{class:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"},"Tanggal"),t("th",{class:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500"},"Aksi")])],-1)),t("tbody",kt,[V.value.length===0?(l(),o("tr",Ct,[...e[20]||(e[20]=[t("td",{colspan:"7",class:"px-6 py-8 text-center text-gray-500"},"Tidak ada pembayaran ditemukan",-1)])])):b("",!0),(l(!0),o(B,null,j(V.value,a=>{var r,v;return l(),o("tr",{key:a.id,class:"hover:bg-gray-50"},[t("td",It,"PAY-"+n(String(a.id).padStart(4,"0")),1),t("td",St,n(((r=a.invoice)==null?void 0:r.invoice_no)||"-"),1),t("td",Tt,n(((v=a.customer)==null?void 0:v.full_name)||"-"),1),t("td",Pt,n(k(a.amount)),1),t("td",Mt,n(a.payment_method||"-"),1),t("td",Bt,n(z(a.payment_date)),1),t("td",Vt,[t("button",{onClick:de=>Y(a),class:"text-red-600 hover:text-red-900"},"Hapus",8,Dt)])])}),128))])]),m.value.last_page>1?(l(),o("div",Nt,[t("div",$t,[e[22]||(e[22]=R(" Total ",-1)),t("span",Ft,n(m.value.total),1),e[23]||(e[23]=R(" pembayaran ",-1))]),t("div",Lt,[t("button",{onClick:e[3]||(e[3]=a=>U(m.value.current_page-1)),disabled:m.value.current_page===1,class:"btn btn-secondary text-sm disabled:opacity-50"},"Prev",8,Rt),t("span",jt,n(m.value.current_page)+" / "+n(m.value.last_page),1),t("button",{onClick:e[4]||(e[4]=a=>U(m.value.current_page+1)),disabled:m.value.current_page===m.value.last_page,class:"btn btn-secondary text-sm disabled:opacity-50"},"Next",8,At)])])):b("",!0)]))]),(l(),nt(lt,{to:"body"},[_.value?(l(),o("div",Ut,[t("div",Et,[t("div",{class:"fixed inset-0 bg-black/50",onClick:e[5]||(e[5]=a=>_.value=!1)}),t("div",Ht,[t("div",qt,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold text-gray-900"},"Catat Pembayaran",-1)),t("button",{onClick:e[6]||(e[6]=a=>_.value=!1),class:"text-gray-400 hover:text-gray-500"},[...e[24]||(e[24]=[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:ot(W,["prevent"]),class:"p-6 space-y-4"},[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700"},"Pilih Invoice *",-1)),p.value?(l(),o("div",Ot,[t("div",Gt,[t("p",Jt,n(p.value.invoice_no),1),t("p",Kt,n((d=p.value.customer)==null?void 0:d.full_name),1),t("p",Qt,"Sisa: "+n(k(Q.value)),1)]),t("button",{type:"button",onClick:K,class:"text-gray-400 hover:text-red-500"},[...e[26]||(e[26]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):(l(),o("div",Wt,[c(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>g.value=a),type:"text",placeholder:"Cari nomor invoice atau nama pelanggan...",class:"input"},null,512),[[y,g.value]]),L.value.length?(l(),o("div",Yt,[(l(!0),o(B,null,j(L.value,a=>{var r;return l(),o("button",{key:a.id,type:"button",onClick:v=>J(a),class:"w-full text-left px-3 py-2 hover:bg-gray-50"},[t("span",Xt,n(a.invoice_no),1),t("span",Zt,n((r=a.customer)==null?void 0:r.full_name),1),t("span",te,n(k(a.total_amount-a.paid_amount)),1)],8,zt)}),128))])):g.value&&!L.value.length?(l(),o("p",ee,"Tidak ada invoice ditemukan")):b("",!0)])),x.value.invoice_id?(l(),o("p",ae,n(x.value.invoice_id[0]),1)):b("",!0)]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700"},"Jumlah Bayar *",-1)),c(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>i.value.amount=a),type:"number",min:"0",class:"input mt-1",required:""},null,512),[[y,i.value.amount,void 0,{number:!0}]]),x.value.amount?(l(),o("p",se,n(x.value.amount[0]),1)):b("",!0)]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700"},"Tanggal Bayar *",-1)),c(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>i.value.payment_date=a),type:"date",class:"input mt-1",required:""},null,512),[[y,i.value.payment_date]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700"},"Metode Pembayaran *",-1)),c(t("select",{"onUpdate:modelValue":e[10]||(e[10]=a=>i.value.payment_method=a),class:"input mt-1",required:""},[(l(),o(B,null,j(q,a=>t("option",{key:a.value,value:a.value},n(a.label),9,ne)),64))],512),[[it,i.value.payment_method]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700"},"No. Referensi",-1)),c(t("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>i.value.reference_no=a),type:"text",placeholder:"No. transfer / kode bukti",class:"input mt-1"},null,512),[[y,i.value.reference_no]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700"},"Catatan",-1)),c(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=a=>i.value.notes=a),rows:"2",class:"input mt-1"},null,512),[[y,i.value.notes]])]),t("div",le,[t("button",{type:"button",onClick:e[13]||(e[13]=a=>_.value=!1),class:"btn btn-secondary"},"Batal"),t("button",{type:"submit",disabled:P.value||!i.value.invoice_id,class:"btn btn-primary disabled:opacity-50"},[P.value?(l(),o("span",ie,"Menyimpan...")):(l(),o("span",re,"Simpan Pembayaran"))],8,oe)])],32)])])])):b("",!0)]))]}),_:1})],64))}};export{pe as default};
