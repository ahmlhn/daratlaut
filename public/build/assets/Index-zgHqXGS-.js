import{C as Bt,G as H,o as Dt,c as i,a as G,u as Tt,h as jt,m as Nt,b as a,t as r,f as p,v as f,x as w,j as o,e as k,F as g,s as y,d as z,B as X,n as J,w as Z,i as Vt,H as Rt,r as _,y as nt}from"./app-Ci7n3qCe.js";import{_ as Ut}from"./AdminLayout-BTf2uWiW.js";import{_ as U}from"./LoadingSpinner-DR8I-POx.js";const Et={class:"space-y-5 pb-24"},Ot={class:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-9 gap-3"},Mt={class:"text-2xl font-black text-yellow-500"},At={class:"text-2xl font-black text-red-600"},Ft={class:"text-2xl font-black text-blue-600"},Gt={class:"text-2xl font-black text-purple-600"},It={class:"text-2xl font-black text-indigo-600"},Lt={class:"text-2xl font-black text-amber-600"},qt={class:"text-2xl font-black text-red-700"},Ht={class:"text-2xl font-black text-red-600"},zt={class:"text-2xl font-black text-emerald-600"},Jt={class:"card p-4 space-y-3"},Kt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3"},Wt={key:0,class:"sm:col-span-2 lg:col-span-2 grid grid-cols-2 gap-2"},Yt=["value"],Qt=["value"],Xt=["value"],Zt={class:"flex items-center justify-between gap-2"},te={class:"text-xs text-slate-500 dark:text-slate-400"},ee={class:"font-bold"},ae={class:"flex items-center gap-2"},se=["disabled"],le={key:1},ne={class:"card overflow-hidden"},oe={class:"overflow-x-auto"},ie={class:"min-w-full text-sm"},re={key:0},de={colspan:"6",class:"px-4 py-10 text-center text-slate-500"},ue={key:1},pe=["id","onClick"],ce={class:"px-3 py-3 text-center"},be=["onClick"],xe={class:"px-4 py-3"},fe={class:"font-bold text-slate-800 dark:text-slate-100"},me={key:1,class:"ml-2 px-2 py-0.5 rounded-full text-[10px] font-black bg-red-100 text-red-700 dark:bg-red-500/15 dark:text-red-200"},ve={class:"text-[11px] text-slate-500 dark:text-slate-400"},ge={class:"text-xs text-slate-600 dark:text-slate-300 truncate max-w-[520px]"},ke={class:"px-4 py-3"},ye={class:"px-4 py-3 text-xs text-slate-700 dark:text-slate-200"},_e={class:"px-4 py-3 text-xs text-slate-700 dark:text-slate-200"},he={class:"px-4 py-3 text-xs text-slate-700 dark:text-slate-200"},we={class:"flex items-center justify-between p-4 border-t border-slate-100 dark:border-white/10 text-xs"},Se={class:"text-slate-500 dark:text-slate-400 font-bold"},Ce={class:"flex items-center gap-2"},Pe=["disabled"],$e=["disabled"],Be={class:"bg-white dark:bg-slate-900 w-full max-w-3xl rounded-2xl shadow-2xl border border-slate-200 dark:border-white/10 overflow-hidden flex flex-col max-h-[92vh]"},De={class:"px-5 py-4 border-b border-slate-200 dark:border-white/10 flex items-center justify-between"},Te={class:"text-[10px] text-slate-500 dark:text-slate-400 font-bold uppercase"},je={class:"text-lg font-black text-slate-900 dark:text-slate-100"},Ne={class:"p-5 overflow-y-auto space-y-5"},Ve={key:0,class:"py-10 text-center text-slate-500"},Re={key:1,class:"space-y-5"},Ue={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},Ee={class:"sm:col-span-2"},Oe=["value"],Me={class:"sm:col-span-2"},Ae={class:"sm:col-span-2"},Fe={class:"flex gap-2"},Ge=["value"],Ie={class:"flex items-end gap-2"},Le={class:"flex items-center gap-2 text-xs font-bold text-slate-700 dark:text-slate-200"},qe={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},He=["value"],ze=["value"],Je=["value"],Ke=["value"],We={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},Ye={class:"grid grid-cols-1 lg:grid-cols-2 gap-3"},Qe={class:"card p-4"},Xe={class:"text-[11px] text-slate-600 dark:text-slate-300 whitespace-pre-wrap break-words"},Ze={class:"card p-4"},ta={class:"card p-4"},ea={class:"flex items-center justify-between"},aa={key:0,class:"text-xs text-slate-500"},sa={class:"mt-3 space-y-2"},la={key:0,class:"italic text-xs text-slate-400"},na={class:"text-[10px] text-slate-400 mb-1"},oa={class:"text-xs text-slate-700 dark:text-slate-200"},ia={class:"font-bold"},ra={class:"text-slate-500 dark:text-slate-400"},da={class:"text-slate-800 dark:text-slate-100 font-bold"},ua={key:0,class:"card p-4"},pa={class:"flex flex-wrap gap-2"},ca=["disabled"],ba=["disabled"],xa=["disabled"],fa=["disabled"],ma={class:"px-5 py-4 border-t border-slate-200 dark:border-white/10 flex items-center justify-between gap-3"},va=["disabled"],ga={class:"flex items-center gap-2"},ka=["disabled"],ya=["disabled"],_a={key:1},ha={class:"bg-white dark:bg-slate-900 w-full max-w-md rounded-2xl shadow-2xl border border-slate-200 dark:border-white/10 overflow-hidden"},wa={class:"px-5 py-4 border-b border-slate-200 dark:border-white/10 flex items-center justify-between"},Sa={class:"p-5 space-y-3"},Ca=["value"],Pa={class:"flex items-center justify-end gap-2"},$a=["disabled"],Ba=["disabled"],Da={key:1},tt=10,Va={__name:"Index",props:{initialFilters:{type:Object,default:()=>({})}},setup(ot){const d=Bt("toast"),D=ot,P=_(!1),I=_([]),h=_({priority:0,overdue:0,Baru:0,Survey:0,Proses:0,Pending:0,Req_Batal:0,Batal:0,today_done:0}),c=H({page:1,per_page:tt,total:0,total_pages:1}),x=H({pops:[],technicians:[]}),n=H({search:D.initialFilters.q||"",status:D.initialFilters.status||"",pop:D.initialFilters.pop||"",tech:D.initialFilters.technician||"",date_preset:"",date_from:D.initialFilters.date_from||"",date_to:D.initialFilters.date_to||"",priority_only:!1,overdue_only:!1}),et=[{value:"",label:"Semua Status"},{value:"Baru",label:"Baru"},{value:"Survey",label:"Survey"},{value:"Proses",label:"Proses"},{value:"Pending",label:"Pending"},{value:"Req_Batal",label:"Req Batal"},{value:"Selesai",label:"Selesai"},{value:"Batal",label:"Batal"}],it={Baru:"bg-blue-50 text-blue-700 border border-blue-100 dark:bg-blue-500/15 dark:text-blue-200 dark:border-blue-500/20",Survey:"bg-purple-50 text-purple-700 border border-purple-100 dark:bg-purple-500/15 dark:text-purple-200 dark:border-purple-500/20",Proses:"bg-indigo-50 text-indigo-700 border border-indigo-100 dark:bg-indigo-500/15 dark:text-indigo-200 dark:border-indigo-500/20",Pending:"bg-amber-50 text-amber-700 border border-amber-100 dark:bg-amber-500/15 dark:text-amber-200 dark:border-amber-500/20",Req_Batal:"bg-red-100 text-red-800 border border-red-200 dark:bg-red-500/15 dark:text-red-200 dark:border-red-500/20",Selesai:"bg-emerald-50 text-emerald-700 border border-emerald-100 dark:bg-emerald-500/15 dark:text-emerald-200 dark:border-emerald-500/20",Batal:"bg-red-50 text-red-700 border border-red-100 dark:bg-red-500/15 dark:text-red-200 dark:border-red-500/20"},rt=nt(()=>n.date_preset==="custom");function K(l){const t=l||new Date,e=t.getFullYear(),u=String(t.getMonth()+1).padStart(2,"0"),m=String(t.getDate()).padStart(2,"0");return`${e}-${u}-${m}`}function dt(l){const t=new Date,e=new Date(t),u=new Date(t);switch(l){case"today":break;case"yesterday":e.setDate(t.getDate()-1),u.setDate(t.getDate()-1);break;case"this_week":e.setDate(t.getDate()-t.getDay());break;case"this_month":e.setDate(1);break;case"this_year":e.setMonth(0),e.setDate(1);break;case"last_year":e.setFullYear(t.getFullYear()-1),e.setMonth(0),e.setDate(1),u.setFullYear(t.getFullYear()-1),u.setMonth(11),u.setDate(31);break;case"last_7":e.setDate(t.getDate()-7);break;case"last_30":e.setDate(t.getDate()-30);break;default:return null}return{from:K(e),to:K(u)}}function W(l){if(l==="custom")return;if(!l){n.date_from="",n.date_to="";return}const t=dt(l);t&&(n.date_from=t.from,n.date_to=t.to)}function at(l){return l==="Selesai"||l==="Batal"}function T(l){if(!l)return null;const t=String(l).match(/^(\d{4})-(\d{2})-(\d{2})/);if(!t)return null;const e=new Date(Number(t[1]),Number(t[2])-1,Number(t[3])),u=new Date,R=new Date(u.getFullYear(),u.getMonth(),u.getDate()).getTime()-e.getTime();return Math.floor(R/(1e3*60*60*24))}function ut(l){if(!l)return"-";const t=String(l).match(/^(\d{4})-(\d{2})-(\d{2})/);if(!t)return String(l);const e=Number(t[1]),u=Number(t[2]);return`${Number(t[3])} ${["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"][u-1]||""} ${e}`.trim()}function pt(l){if(!l)return"";const e=String(l).trim().match(/^(\d{4}-\d{2}-\d{2})\s+(\d{2}:\d{2})/);return e?`${e[1]}T${e[2]}`:""}function ct(l){if(!l)return null;const e=String(l).trim().replace(/\s+/g,",").split(",").map(R=>R.trim()).filter(Boolean);if(e.length<2)return null;const u=parseFloat(e[0]),m=parseFloat(e[1]);return Number.isNaN(u)||Number.isNaN(m)||u<-90||u>90||m<-180||m>180?null:{lat:u,lng:m}}const E=_(null);let Y=null;async function O(l){const e=await(await fetch(l,{credentials:"same-origin"})).json().catch(()=>null);if(!e)throw new Error("Response JSON tidak valid");return e}async function C(l,t,e){const u=await fetch(l,{method:t,credentials:"same-origin",headers:{"Content-Type":"application/json"},body:e?JSON.stringify(e):void 0}),m=await u.json().catch(()=>null);if(!m)throw new Error("Response JSON tidak valid");if(!u.ok){const R=m.msg||m.message||"Request gagal";throw new Error(R)}return m}async function Q(){if(x.pops.length===0)try{const l=await O("/api/v1/installations/pops");x.pops=l.status==="success"?l.data||[]:[]}catch{x.pops=[]}if(x.technicians.length===0)try{const l=await O("/api/v1/installations/technicians");x.technicians=l.status==="success"?l.data||[]:[]}catch{x.technicians=[]}}function bt(l){const t=document.getElementById(`row-${l}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("ring-2","ring-blue-400"),t.style.transition="background-color 300ms ease",t.style.backgroundColor="rgba(59,130,246,0.10)",setTimeout(()=>{t.classList.remove("ring-2","ring-blue-400"),t.style.backgroundColor=""},1800))}async function v(l=1){P.value=!0;try{const t=new URLSearchParams;t.set("page",String(l)),t.set("per_page",String(tt)),n.search&&t.set("search",n.search),n.status&&t.set("status",n.status),n.pop&&t.set("pop",n.pop),n.tech&&t.set("tech",n.tech),n.date_from&&t.set("date_from",n.date_from),n.date_to&&t.set("date_to",n.date_to),n.priority_only&&t.set("priority_only","1"),n.overdue_only&&t.set("overdue_only","1");const e=await O(`/api/v1/installations?${t.toString()}`);if(e.status!=="success")throw new Error(e.msg||"Gagal memuat data");I.value=Array.isArray(e.data)?e.data:[],c.page=Number(e.page||1),c.per_page=Number(e.per_page||tt),c.total=Number(e.total||0),c.total_pages=Number(e.total_pages||1),h.value=e.summary||h.value,await Q(),E.value&&(await Rt(),bt(E.value),E.value=null)}catch(t){console.error(t),I.value=[],d&&d.error(t.message||"Gagal memuat data")}finally{P.value=!1}}function $(){n.priority_only=!1,n.overdue_only=!1,c.page=1,v(1)}function xt(){n.search="",n.status="",n.pop="",n.tech="",n.date_preset="",n.date_from="",n.date_to="",n.priority_only=!1,n.overdue_only=!1,c.page=1,v(1)}function S(l,t){n.priority_only=!1,n.overdue_only=!1,l==="status"?n.status=n.status===t?"":t:l==="today_done"?(n.status="Selesai",n.date_preset="today",W("today")):l==="priority"?(n.status="",n.priority_only=!0,d&&d.info("Menampilkan data Prioritas")):l==="overdue"&&(n.status="",n.overdue_only=!0,d&&d.info("Menampilkan data Overdue")),c.page=1,v(1)}function ft(){Y&&clearTimeout(Y),Y=setTimeout(()=>$(),350)}function mt(){W(n.date_preset),$()}function vt(l){const t=ct(l);if(!t){d&&d.info("Koordinat kosong / tidak valid. Contoh: -6.200000,106.816666");return}const e=`https://www.google.com/maps?q=${encodeURIComponent(`${t.lat},${t.lng}`)}`;window.open(e,"_blank","noopener")}const M=_(!1),b=_(!1),B=_("edit"),L=_(!1),j=_([]),s=H({id:null,ticket_id:"",customer_name:"",customer_phone:"",address:"",pop:"",coordinates:"",plan_name:"",price:"",installation_date:"",finished_at:"",status:"Baru",technician:"",technician_2:"",technician_3:"",technician_4:"",sales_name:"",sales_name_2:"",sales_name_3:"",is_priority:!1,notes_old:"",note_append:""}),st=nt(()=>String(s.status||"")==="Req_Batal");function gt(){s.id=null,s.ticket_id="",s.customer_name="",s.customer_phone="",s.address="",s.pop="",s.coordinates="",s.plan_name="",s.price="",s.installation_date=K(new Date),s.finished_at="",s.status="Baru",s.technician="",s.technician_2="",s.technician_3="",s.technician_4="",s.sales_name="",s.sales_name_2="",s.sales_name_3="",s.is_priority=!1,s.notes_old="",s.note_append="",j.value=[]}async function kt(l){L.value=!0;try{const t=await O(`/api/v1/installations/${l}/history`);j.value=t.status==="success"?t.data||[]:[]}catch{j.value=[]}finally{L.value=!1}}function yt(){B.value="new",gt(),M.value=!0,Q()}async function q(l){B.value="edit",M.value=!0,b.value=!0,j.value=[],s.note_append="";try{await Q();const t=await O(`/api/v1/installations/${l}`);if(t.status!=="success"||!t.data)throw new Error(t.msg||"Data tidak ditemukan");const e=t.data;s.id=e.id,s.ticket_id=e.ticket_id||"",s.customer_name=e.customer_name||"",s.customer_phone=e.customer_phone||"",s.address=e.address||"",s.pop=e.pop||"",s.coordinates=e.coordinates||"",s.plan_name=e.plan_name||"",s.price=e.price||"",s.installation_date=e.installation_date||"",s.finished_at=pt(e.finished_at),s.status=e.status||"Baru",s.technician=e.technician||"",s.technician_2=e.technician_2||"",s.technician_3=e.technician_3||"",s.technician_4=e.technician_4||"",s.sales_name=e.sales_name||"",s.sales_name_2=e.sales_name_2||"",s.sales_name_3=e.sales_name_3||"",s.is_priority=String(e.is_priority)==="1",s.notes_old=e.notes||"",await kt(l)}catch(t){d&&d.error(t.message||"Gagal memuat detail"),M.value=!1}finally{b.value=!1}}function A(){M.value=!1}async function _t(){if(!String(s.customer_name||"").trim()){d&&d.error("Nama pelanggan wajib diisi.");return}b.value=!0;try{const l={customer_name:s.customer_name,customer_phone:s.customer_phone,address:s.address,pop:s.pop,coordinates:s.coordinates,plan_name:s.plan_name,price:s.price,installation_date:s.installation_date,finished_at:s.finished_at||"",status:s.status,technician:s.technician,technician_2:s.technician_2,technician_3:s.technician_3,technician_4:s.technician_4,sales_name:s.sales_name,sales_name_2:s.sales_name_2,sales_name_3:s.sales_name_3,is_priority:s.is_priority?1:0,note_append:(s.note_append||"").trim()};let t=null;if(B.value==="new"?(t=await C("/api/v1/installations","POST",l),E.value=t.id||null):(t=await C(`/api/v1/installations/${s.id}`,"PUT",l),E.value=s.id),t.status!=="success")throw new Error(t.msg||"Gagal menyimpan");d&&d.success("Data berhasil disimpan."),A(),await v(c.page)}catch(l){console.error(l),d&&d.error(l.message||"Gagal menyimpan")}finally{b.value=!1}}async function ht(){if(s.id&&confirm("Hapus data ini? Tindakan ini tidak bisa dibatalkan.")){b.value=!0;try{const l=await C(`/api/v1/installations/${s.id}`,"DELETE");if(l.status!=="success")throw new Error(l.msg||"Gagal menghapus");d&&d.success("Data berhasil dihapus."),A(),await v(c.page)}catch(l){d&&d.error(l.message||"Gagal menghapus")}finally{b.value=!1}}}async function wt(l,t){try{const e=String(t)==="1"?0:1,u=await C(`/api/v1/installations/${l}/toggle-priority`,"POST",{val:e});if(u.status!=="success")throw new Error(u.msg||"Gagal toggle prioritas");await v(c.page)}catch(e){d&&d.error(e.message||"Gagal toggle prioritas")}}async function St(){if(!s.id)return;const l=prompt("Alasan pengajuan batal:")||"";if(l.trim()){b.value=!0;try{const t=await C(`/api/v1/installations/${s.id}/request-cancel`,"POST",{reason:l});if(t.status!=="success")throw new Error(t.msg||"Gagal mengajukan batal");d&&d.success("Pengajuan batal terkirim."),await q(s.id),await v(c.page)}catch(t){d&&d.error(t.message||"Gagal mengajukan batal")}finally{b.value=!1}}}async function lt(l){if(!s.id)return;const t=prompt("Catatan (opsional):")||"";b.value=!0;try{const e=await C(`/api/v1/installations/${s.id}/decide-cancel`,"POST",{decision:l,reason:t});if(e.status!=="success")throw new Error(e.msg||"Gagal memproses");d&&d.success("Berhasil."),await q(s.id),await v(c.page)}catch(e){d&&d.error(e.message||"Gagal memproses")}finally{b.value=!1}}async function Ct(){if(!s.id)return;const l=prompt("Transfer ke teknisi (isi nama persis):")||"";if(!l.trim())return;const t=prompt("Alasan transfer (opsional):")||"";b.value=!0;try{const e=await C(`/api/v1/installations/${s.id}/transfer`,"POST",{to_tech:l.trim(),reason:t});if(e.status!=="success")throw new Error(e.msg||"Gagal transfer");d&&d.success("Transfer berhasil."),await q(s.id),await v(c.page)}catch(e){d&&d.error(e.message||"Gagal transfer")}finally{b.value=!1}}const N=_(!1),V=_(""),F=_(!1);function Pt(){if(!x.pops.length){d&&d.error("Daftar POP belum termuat. Coba refresh dulu.");return}V.value=n.pop||x.pops[0]||"",N.value=!0}async function $t(){if(V.value&&confirm(`Kirim rekap WA untuk POP: ${V.value}?`)){F.value=!0;try{const l=await C("/api/v1/installations/send-pop-recap","POST",{pop_name:V.value});if(l.status!=="success")throw new Error(l.msg||"Gagal mengirim rekap");const t=l.msg?` - ${l.msg}`:"";d&&d.success(`Rekap terkirim (${l.count||0} data, terkirim ${l.sent||0}, gagal ${l.failed||0})${t}`),N.value=!1}catch(l){d&&d.error(l.message||"Gagal mengirim rekap")}finally{F.value=!1}}}return Dt(()=>{!n.date_from&&!n.date_to&&(n.date_preset="today",W("today")),v(1)}),(l,t)=>(o(),i(g,null,[G(Tt(jt),{title:"Pasang Baru"}),G(Ut,null,{default:Nt(()=>[a("div",Et,[a("div",{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"},[t[45]||(t[45]=a("div",null,[a("h1",{class:"text-xl sm:text-2xl font-black text-slate-900 dark:text-slate-100"},"Pasang Baru"),a("p",{class:"text-xs text-slate-500 dark:text-slate-400 font-bold uppercase"},"Progress / Antrian")],-1)),a("div",{class:"flex items-center gap-2"},[a("button",{class:"btn btn-secondary",onClick:Pt,type:"button"},"Kirim Rekap WA"),a("button",{class:"btn btn-primary",onClick:yt,type:"button"},"Tambah")])]),a("div",Ot,[a("button",{type:"button",class:"card p-3 text-left hover:ring-2 hover:ring-primary-500",onClick:t[0]||(t[0]=e=>S("priority"))},[t[46]||(t[46]=a("div",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"PRIORITY",-1)),a("div",Mt,r(h.value.priority||0),1)]),a("button",{type:"button",class:"card p-3 text-left hover:ring-2 hover:ring-primary-500",onClick:t[1]||(t[1]=e=>S("overdue"))},[t[47]||(t[47]=a("div",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"OVERDUE",-1)),a("div",At,r(h.value.overdue||0),1)]),a("button",{type:"button",class:"card p-3 text-left hover:ring-2 hover:ring-primary-500",onClick:t[2]||(t[2]=e=>S("status","Baru"))},[t[48]||(t[48]=a("div",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"BARU",-1)),a("div",Ft,r(h.value.Baru||0),1)]),a("button",{type:"button",class:"card p-3 text-left hover:ring-2 hover:ring-primary-500",onClick:t[3]||(t[3]=e=>S("status","Survey"))},[t[49]||(t[49]=a("div",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"SURVEY",-1)),a("div",Gt,r(h.value.Survey||0),1)]),a("button",{type:"button",class:"card p-3 text-left hover:ring-2 hover:ring-primary-500",onClick:t[4]||(t[4]=e=>S("status","Proses"))},[t[50]||(t[50]=a("div",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"PROSES",-1)),a("div",It,r(h.value.Proses||0),1)]),a("button",{type:"button",class:"card p-3 text-left hover:ring-2 hover:ring-primary-500",onClick:t[5]||(t[5]=e=>S("status","Pending"))},[t[51]||(t[51]=a("div",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"PENDING",-1)),a("div",Lt,r(h.value.Pending||0),1)]),a("button",{type:"button",class:"card p-3 text-left hover:ring-2 hover:ring-primary-500",onClick:t[6]||(t[6]=e=>S("status","Req_Batal"))},[t[52]||(t[52]=a("div",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"REQ BATAL",-1)),a("div",qt,r(h.value.Req_Batal||0),1)]),a("button",{type:"button",class:"card p-3 text-left hover:ring-2 hover:ring-primary-500",onClick:t[7]||(t[7]=e=>S("status","Batal"))},[t[53]||(t[53]=a("div",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"BATAL",-1)),a("div",Ht,r(h.value.Batal||0),1)]),a("button",{type:"button",class:"card p-3 text-left hover:ring-2 hover:ring-primary-500",onClick:t[8]||(t[8]=e=>S("today_done"))},[t[54]||(t[54]=a("div",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"SELESAI HARI INI",-1)),a("div",zt,r(h.value.today_done||0),1)])]),a("div",Jt,[a("div",Kt,[a("div",null,[t[55]||(t[55]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Search",-1)),p(a("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>n.search=e),onInput:ft,class:"input w-full",placeholder:"Ticket/Nama/Alamat/Teknisi"},null,544),[[f,n.search]])]),a("div",null,[t[57]||(t[57]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Tanggal",-1)),p(a("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>n.date_preset=e),class:"input w-full",onChange:mt},[...t[56]||(t[56]=[a("option",{value:""},"Semua",-1),a("option",{value:"today"},"Hari ini",-1),a("option",{value:"yesterday"},"Kemarin",-1),a("option",{value:"this_week"},"Minggu ini",-1),a("option",{value:"this_month"},"Bulan ini",-1),a("option",{value:"this_year"},"Tahun ini",-1),a("option",{value:"last_year"},"Tahun lalu",-1),a("option",{value:"last_7"},"Last 7 hari",-1),a("option",{value:"last_30"},"Last 30 hari",-1),a("option",{value:"custom"},"Custom",-1)])],544),[[w,n.date_preset]])]),rt.value?(o(),i("div",Wt,[a("div",null,[t[58]||(t[58]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Dari",-1)),p(a("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>n.date_from=e),type:"date",class:"input w-full",onChange:$},null,544),[[f,n.date_from]])]),a("div",null,[t[59]||(t[59]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Sampai",-1)),p(a("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>n.date_to=e),type:"date",class:"input w-full",onChange:$},null,544),[[f,n.date_to]])])])):k("",!0),a("div",null,[t[60]||(t[60]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Status",-1)),p(a("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>n.status=e),class:"input w-full",onChange:$},[(o(),i(g,null,y(et,e=>a("option",{key:e.value,value:e.value},r(e.label),9,Yt)),64))],544),[[w,n.status]])]),a("div",null,[t[62]||(t[62]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"POP",-1)),p(a("select",{"onUpdate:modelValue":t[14]||(t[14]=e=>n.pop=e),class:"input w-full",onChange:$},[t[61]||(t[61]=a("option",{value:""},"Semua",-1)),(o(!0),i(g,null,y(x.pops,e=>(o(),i("option",{key:e,value:e},r(e),9,Qt))),128))],544),[[w,n.pop]])]),a("div",null,[t[64]||(t[64]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Teknisi",-1)),p(a("select",{"onUpdate:modelValue":t[15]||(t[15]=e=>n.tech=e),class:"input w-full",onChange:$},[t[63]||(t[63]=a("option",{value:""},"Semua",-1)),(o(!0),i(g,null,y(x.technicians,e=>(o(),i("option",{key:e,value:e},r(e),9,Xt))),128))],544),[[w,n.tech]])])]),a("div",Zt,[a("div",te,[a("span",ee,r(c.total),1),t[65]||(t[65]=z(" data ",-1))]),a("div",ae,[a("button",{class:"btn btn-secondary",type:"button",onClick:xt},"Reset"),a("button",{class:"btn btn-secondary",type:"button",onClick:t[16]||(t[16]=e=>v(c.page)),disabled:P.value},[P.value?(o(),X(U,{key:0,size:"sm"})):(o(),i("span",le,"Refresh"))],8,se)])])]),a("div",ne,[a("div",oe,[a("table",ie,[t[67]||(t[67]=a("thead",{class:"bg-slate-50 dark:bg-slate-900/40 text-slate-600 dark:text-slate-300"},[a("tr",null,[a("th",{class:"px-3 py-3 text-center w-12"},"★"),a("th",{class:"px-4 py-3 text-left"},"Pelanggan"),a("th",{class:"px-4 py-3 text-left"},"Status"),a("th",{class:"px-4 py-3 text-left"},"POP"),a("th",{class:"px-4 py-3 text-left"},"Teknisi"),a("th",{class:"px-4 py-3 text-left"},"Tanggal")])],-1)),a("tbody",null,[P.value?(o(),i("tr",re,[a("td",de,[G(U)])])):I.value.length===0?(o(),i("tr",ue,[...t[66]||(t[66]=[a("td",{colspan:"6",class:"px-4 py-10 text-center text-slate-400 italic"},"Tidak ada data ditemukan.",-1)])])):k("",!0),(o(!0),i(g,null,y(I.value,e=>(o(),i("tr",{key:e.id,id:`row-${e.id}`,class:J(["border-t border-slate-100 dark:border-white/10 cursor-pointer hover:bg-blue-50/40 dark:hover:bg-white/5 transition",(()=>{const u=T(e.installation_date);return typeof u=="number"&&u>0&&!at(e.status)?"bg-red-50/30 dark:bg-red-900/10 border-l-4 border-l-red-500":""})()]),onClick:u=>q(e.id)},[a("td",ce,[a("button",{type:"button",class:J(["p-2 transition-transform",String(e.is_priority)==="1"?"text-yellow-400 hover:scale-110":"text-slate-200 hover:text-yellow-400"]),onClick:Z(u=>wt(e.id,e.is_priority),["stop"]),title:"Toggle priority"}," ★ ",10,be)]),a("td",xe,[a("div",fe,[z(r(e.customer_name||"-")+" ",1),T(e.installation_date)!==null?(o(),i("span",{key:0,class:J(["ml-2 px-2 py-0.5 rounded-full text-[10px] font-bold",T(e.installation_date)>0?"bg-slate-200 text-slate-700 dark:bg-white/10 dark:text-slate-200":"bg-blue-100 text-blue-700 dark:bg-blue-500/15 dark:text-blue-200"])}," D+"+r(Math.max(0,T(e.installation_date))),3)):k("",!0),(()=>{const u=T(e.installation_date);return typeof u=="number"&&u>0&&!at(e.status)})()?(o(),i("span",me," OVERDUE +"+r(Math.max(0,T(e.installation_date)))+"d ",1)):k("",!0)]),a("div",ve,"#"+r(e.ticket_id||"-")+" • WA: "+r(e.customer_phone||"-"),1),a("div",ge,r(e.address||"-"),1)]),a("td",ke,[a("span",{class:J(["px-2 py-1 rounded-lg text-xs font-bold",it[e.status]||"bg-slate-100 text-slate-700 dark:bg-white/10 dark:text-slate-200"])},r(e.status||"-"),3)]),a("td",ye,r(e.pop||"-"),1),a("td",_e,r([e.technician,e.technician_2,e.technician_3,e.technician_4].filter(Boolean).join(", ")||"-"),1),a("td",he,r(ut(e.installation_date)),1)],10,pe))),128))])])]),a("div",we,[a("div",Se,"Halaman "+r(c.page)+" / "+r(c.total_pages),1),a("div",Ce,[a("button",{class:"btn btn-secondary",type:"button",disabled:c.page<=1||P.value,onClick:t[17]||(t[17]=e=>v(c.page-1))},"Prev",8,Pe),a("button",{class:"btn btn-secondary",type:"button",disabled:c.page>=c.total_pages||P.value,onClick:t[18]||(t[18]=e=>v(c.page+1))},"Next",8,$e)])])])]),M.value?(o(),i("div",{key:0,class:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",onClick:Z(A,["self"])},[a("div",Be,[a("div",De,[a("div",null,[a("div",Te,r(B.value==="new"?"Input Baru":"Detail Data"),1),a("div",je,r(B.value==="new"?"#NEW":"#"+(s.ticket_id||"UNKNOWN")),1)]),a("button",{class:"h-10 w-10 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-slate-900 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-white/5",onClick:A,type:"button"},"✕")]),a("div",Ne,[b.value?(o(),i("div",Ve,[G(U)])):(o(),i("div",Re,[a("div",Ue,[a("div",Ee,[t[68]||(t[68]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Nama",-1)),p(a("input",{"onUpdate:modelValue":t[19]||(t[19]=e=>s.customer_name=e),class:"input w-full"},null,512),[[f,s.customer_name]])]),a("div",null,[t[69]||(t[69]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"WA",-1)),p(a("input",{"onUpdate:modelValue":t[20]||(t[20]=e=>s.customer_phone=e),class:"input w-full",placeholder:"08xxx / 62xxx"},null,512),[[f,s.customer_phone]])]),a("div",null,[t[71]||(t[71]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"POP",-1)),p(a("select",{"onUpdate:modelValue":t[21]||(t[21]=e=>s.pop=e),class:"input w-full"},[t[70]||(t[70]=a("option",{value:""},"-- Pilih --",-1)),(o(!0),i(g,null,y(x.pops,e=>(o(),i("option",{key:e,value:e},r(e),9,Oe))),128))],512),[[w,s.pop]])]),a("div",Me,[t[72]||(t[72]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Alamat",-1)),p(a("textarea",{"onUpdate:modelValue":t[22]||(t[22]=e=>s.address=e),rows:"2",class:"input w-full"},null,512),[[f,s.address]])]),a("div",Ae,[t[73]||(t[73]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Koordinat",-1)),a("div",Fe,[p(a("input",{"onUpdate:modelValue":t[23]||(t[23]=e=>s.coordinates=e),class:"input w-full",placeholder:"-6.2,106.8"},null,512),[[f,s.coordinates]]),a("button",{class:"btn btn-secondary",type:"button",onClick:t[24]||(t[24]=e=>vt(s.coordinates))},"Maps")])]),a("div",null,[t[74]||(t[74]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Paket",-1)),p(a("input",{"onUpdate:modelValue":t[25]||(t[25]=e=>s.plan_name=e),class:"input w-full"},null,512),[[f,s.plan_name]])]),a("div",null,[t[75]||(t[75]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Harga",-1)),p(a("input",{"onUpdate:modelValue":t[26]||(t[26]=e=>s.price=e),class:"input w-full"},null,512),[[f,s.price]])]),a("div",null,[t[76]||(t[76]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Tanggal Install",-1)),p(a("input",{"onUpdate:modelValue":t[27]||(t[27]=e=>s.installation_date=e),type:"date",class:"input w-full"},null,512),[[f,s.installation_date]])]),a("div",null,[t[77]||(t[77]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Finished At",-1)),p(a("input",{"onUpdate:modelValue":t[28]||(t[28]=e=>s.finished_at=e),type:"datetime-local",class:"input w-full"},null,512),[[f,s.finished_at]])]),a("div",null,[t[78]||(t[78]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Status",-1)),p(a("select",{"onUpdate:modelValue":t[29]||(t[29]=e=>s.status=e),class:"input w-full"},[(o(!0),i(g,null,y(et.slice(1),e=>(o(),i("option",{key:e.value,value:e.value},r(e.label),9,Ge))),128))],512),[[w,s.status]])]),a("div",Ie,[a("label",Le,[p(a("input",{"onUpdate:modelValue":t[30]||(t[30]=e=>s.is_priority=e),type:"checkbox",class:"h-4 w-4 rounded border-slate-300"},null,512),[[Vt,s.is_priority]]),t[79]||(t[79]=z(" Priority ",-1))])])]),a("div",qe,[a("div",null,[t[81]||(t[81]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Teknisi 1",-1)),p(a("select",{"onUpdate:modelValue":t[31]||(t[31]=e=>s.technician=e),class:"input w-full"},[t[80]||(t[80]=a("option",{value:""},"-- Pilih --",-1)),(o(!0),i(g,null,y(x.technicians,e=>(o(),i("option",{key:e,value:e},r(e),9,He))),128))],512),[[w,s.technician]])]),a("div",null,[t[83]||(t[83]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Teknisi 2",-1)),p(a("select",{"onUpdate:modelValue":t[32]||(t[32]=e=>s.technician_2=e),class:"input w-full"},[t[82]||(t[82]=a("option",{value:""},"-- Pilih --",-1)),(o(!0),i(g,null,y(x.technicians,e=>(o(),i("option",{key:e,value:e},r(e),9,ze))),128))],512),[[w,s.technician_2]])]),a("div",null,[t[85]||(t[85]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Teknisi 3",-1)),p(a("select",{"onUpdate:modelValue":t[33]||(t[33]=e=>s.technician_3=e),class:"input w-full"},[t[84]||(t[84]=a("option",{value:""},"-- Pilih --",-1)),(o(!0),i(g,null,y(x.technicians,e=>(o(),i("option",{key:e,value:e},r(e),9,Je))),128))],512),[[w,s.technician_3]])]),a("div",null,[t[87]||(t[87]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Teknisi 4",-1)),p(a("select",{"onUpdate:modelValue":t[34]||(t[34]=e=>s.technician_4=e),class:"input w-full"},[t[86]||(t[86]=a("option",{value:""},"-- Pilih --",-1)),(o(!0),i(g,null,y(x.technicians,e=>(o(),i("option",{key:e,value:e},r(e),9,Ke))),128))],512),[[w,s.technician_4]])])]),a("div",We,[a("div",null,[t[88]||(t[88]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Sales 1",-1)),p(a("input",{"onUpdate:modelValue":t[35]||(t[35]=e=>s.sales_name=e),class:"input w-full"},null,512),[[f,s.sales_name]])]),a("div",null,[t[89]||(t[89]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Sales 2",-1)),p(a("input",{"onUpdate:modelValue":t[36]||(t[36]=e=>s.sales_name_2=e),class:"input w-full"},null,512),[[f,s.sales_name_2]])]),a("div",null,[t[90]||(t[90]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Sales 3",-1)),p(a("input",{"onUpdate:modelValue":t[37]||(t[37]=e=>s.sales_name_3=e),class:"input w-full"},null,512),[[f,s.sales_name_3]])])]),a("div",Ye,[a("div",Qe,[t[91]||(t[91]=a("div",{class:"text-xs font-black text-slate-800 dark:text-slate-100 mb-2"},"Catatan (History)",-1)),a("pre",Xe,r(s.notes_old||"-"),1)]),a("div",Ze,[t[92]||(t[92]=a("div",{class:"text-xs font-black text-slate-800 dark:text-slate-100 mb-2"},"Tambah Catatan",-1)),p(a("textarea",{"onUpdate:modelValue":t[38]||(t[38]=e=>s.note_append=e),rows:"5",class:"input w-full",placeholder:"Catatan ini akan di-append (seperti native)"},null,512),[[f,s.note_append]])])]),a("div",ta,[a("div",ea,[t[93]||(t[93]=a("div",{class:"text-xs font-black text-slate-800 dark:text-slate-100"},"Riwayat Perubahan Data",-1)),L.value?(o(),i("div",aa,[G(U,{size:"sm"})])):k("",!0)]),a("div",sa,[!L.value&&j.value.length===0?(o(),i("div",la,"Belum ada perubahan.")):k("",!0),(o(!0),i(g,null,y(j.value,(e,u)=>(o(),i("div",{key:u,class:"border-b border-slate-100 dark:border-white/10 pb-2"},[a("div",na,r(e.changed_at||"-")+" - "+r(e.changed_by||"-")+" ("+r(e.changed_by_role||"-")+") via "+r(e.source||"-"),1),a("div",oa,[a("span",ia,r(e.field_name||"-"),1),t[94]||(t[94]=z(": ",-1)),a("span",ra,r((e.old_value||"-").toString().trim()||"-"),1),t[95]||(t[95]=a("span",{class:"text-slate-400 px-1"},"->",-1)),a("span",da,r((e.new_value||"-").toString().trim()||"-"),1)])]))),128))])]),B.value!=="new"?(o(),i("div",ua,[t[96]||(t[96]=a("div",{class:"text-xs font-black text-slate-800 dark:text-slate-100 mb-2"},"Workflow",-1)),a("div",pa,[a("button",{class:"btn btn-secondary",type:"button",onClick:Ct,disabled:b.value},"Transfer",8,ca),a("button",{class:"btn btn-secondary",type:"button",onClick:St,disabled:b.value},"Ajukan Batal",8,ba),st.value?(o(),i("button",{key:0,class:"btn btn-danger",type:"button",onClick:t[39]||(t[39]=e=>lt("approve")),disabled:b.value},"Approve Batal",8,xa)):k("",!0),st.value?(o(),i("button",{key:1,class:"btn btn-secondary",type:"button",onClick:t[40]||(t[40]=e=>lt("reject")),disabled:b.value},"Reject (Pending)",8,fa)):k("",!0)])])):k("",!0)]))]),a("div",ma,[a("div",null,[B.value!=="new"?(o(),i("button",{key:0,class:"btn btn-danger",type:"button",onClick:ht,disabled:b.value},"Hapus",8,va)):k("",!0)]),a("div",ga,[a("button",{class:"btn btn-secondary",type:"button",onClick:A,disabled:b.value},"Batal",8,ka),a("button",{class:"btn btn-primary",type:"button",onClick:_t,disabled:b.value},[b.value?(o(),X(U,{key:0,size:"sm"})):(o(),i("span",_a,"Simpan"))],8,ya)])])])])):k("",!0),N.value?(o(),i("div",{key:1,class:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",onClick:t[44]||(t[44]=Z(e=>N.value=!1,["self"]))},[a("div",ha,[a("div",wa,[t[97]||(t[97]=a("div",{class:"text-sm font-black text-slate-900 dark:text-slate-100"},"Kirim Rekap WA",-1)),a("button",{class:"h-9 w-9 rounded-xl border border-slate-200 dark:border-white/10 bg-white dark:bg-slate-900 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-white/5",onClick:t[41]||(t[41]=e=>N.value=!1),type:"button"},"✕")]),a("div",Sa,[a("div",null,[t[98]||(t[98]=a("label",{class:"text-[11px] font-bold text-slate-500 dark:text-slate-400"},"Pilih POP",-1)),p(a("select",{"onUpdate:modelValue":t[42]||(t[42]=e=>V.value=e),class:"input w-full"},[(o(!0),i(g,null,y(x.pops,e=>(o(),i("option",{key:e,value:e},r(e),9,Ca))),128))],512),[[w,V.value]]),t[99]||(t[99]=a("div",{class:"mt-2 text-[11px] text-slate-500 dark:text-slate-400"},"Rekap akan mengirim status: Baru/Survey/Proses",-1))]),a("div",Pa,[a("button",{class:"btn btn-secondary",type:"button",onClick:t[43]||(t[43]=e=>N.value=!1),disabled:F.value},"Batal",8,$a),a("button",{class:"btn btn-primary",type:"button",onClick:$t,disabled:F.value},[F.value?(o(),X(U,{key:0,size:"sm"})):(o(),i("span",Da,"Kirim"))],8,Ba)])])])])):k("",!0)]),_:1})],64))}};export{Va as default};
